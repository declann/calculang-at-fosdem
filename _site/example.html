<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.543">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>calculang-at-fosdem</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-dashboard/quarto-dashboard.js"></script>
<script src="site_libs/quarto-dashboard/stickythead.js"></script>
<script src="site_libs/quarto-dashboard/datatables.min.js" kdttablesentinel="true"></script>
<script src="site_libs/quarto-dashboard/pdfmake.min.js" kdttablesentinel="true"></script>
<script src="site_libs/quarto-dashboard/vfs_fonts.js" kdttablesentinel="true"></script>
<script src="site_libs/quarto-dashboard/web-components.js" type="module"></script>
<script src="site_libs/quarto-dashboard/components.js"></script>
<link href="site_libs/quarto-dashboard/datatables.min.css" rel="stylesheet" kdttablesentinel="true">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<script type="module"> if (!("anchorName" in document.documentElement.style)) { import("https://unpkg.com/@oddbird/css-anchor-positioning");  }</script>


<meta name="twitter:title" content="calculang-at-fosdem">
<meta name="twitter:card" content="summary">
</head>

<body class="quarto-dashboard dashboard-fill fullcontent">

<header id="quarto-dashboard-header">
<nav class="navbar navbar-expand-md slim" data-bs-theme="dark">
  <div class="navbar-container container-fluid">
    <button class="navbar-toggler hidden" type="button" data-bs-toggle="collapse" data-bs-target="#dashboard-collapse" aria-controls="dashboard-collapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>    


<div class="quarto-dashboard-links"><a class="quarto-dashboard-link" href="https://github.com/declann/calculang-at-fosdem"><i class="bi bi-github"></i></a><a class="quarto-dashboard-link" href="/slides.html"><span class="quarto-dashboard-link-text">Slides</span></a><a class="quarto-dashboard-link" href="https://twitter.com/calculang"><i class="bi bi-twitter"></i></a><a class="quarto-dashboard-link" href="https://fosstodon.org/@calculang"><i class="bi bi-mastodon"></i></a></div></div></nav>
</header>
<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-layout-custom quarto-dashboard-content bslib-gap-spacing html-fill-container bslib-page-fill">
<!-- sidebar -->
<!-- margin-sidebar -->
<!-- main -->

<div class="cell hidden bslib-grid-item html-fill-item">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="32" data-source-offset="-15"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 31;"><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>viewof player_x_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="fl">1.7</span>)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>viewof player_y_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="fl">5.5</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>viewof ray_angle_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="kw">null</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>viewof step_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="dv">3</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>viewof x_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="fl">3.5</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>viewof y_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="fl">3.5</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>viewof f_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="dv">0</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>viewof key_stream_version_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="dv">0</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>viewof keys_stream_version_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="st">"hi"</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co">// savings</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>viewof annual_payment_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="dv">1000</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>viewof duration_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="dv">5</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>viewof interest_rate_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="op">.</span><span class="bn">02</span>)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>viewof year_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="dv">2</span>)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>viewof i_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="dv">2</span>)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>viewof date_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="kw">new</span> <span class="bu">Date</span>())</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>viewof timing_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="st">"start of today"</span>)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="co">// starfield</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>viewof star_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="dv">3</span>)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>viewof speed_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="dv">3</span>)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>viewof frame_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="dv">2</span>)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>viewof random_seed_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="st">"hello"</span>)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co">// savings-rec</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>viewof actual_interest_rate_co_in <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="dv">2</span>)</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>mini_binds <span class="op">=</span> {</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ({</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="dt">duration_in</span><span class="op">:</span> <span class="dv">1</span> <span class="op">?</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">'duration_in'</span>}) <span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="co">//Inputs.range([0,10], {label:'duration', value: 5, step: 1, width:100}),</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">'year_in'</span>}) <span class="co">//Inputs.range([0,10], {label:'year', value: 5, step: 1, width:100})</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">annual_payment_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">20000</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'annual_payment_in'</span>})</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">interest_rate_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">'.2f'</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'interest_rate_in'</span>}) <span class="co">// precision how?</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">actual_interest_rate_co_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'actual_interest_rate_co_in'</span>})</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">f_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">200</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'f_in'</span>})</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="co">//, keys_stream_function_in: md`(keys_stream_function_in)`</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">step_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'step_in'</span>})</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">x_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">200</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'x_in'</span>})</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">y_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">200</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'y_in'</span>})</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">player_x_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span><span class="dt">format</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">'.2f'</span>)<span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'player_x_in'</span>})</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">player_y_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">'.2f'</span>)<span class="op">,</span><span class="dt">label</span><span class="op">:</span><span class="st">'player_y_in'</span>})</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">ray_angle_in</span><span class="op">:</span> <span class="co">/*Inputs.range([-10,10], {label:'ray_angle_in'})*/</span><span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">'.2f'</span>)<span class="op">,</span><span class="dt">label</span><span class="op">:</span><span class="st">'ray_angle_in'</span>})</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">i_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">200</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'i_in'</span>})</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">date_in</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">date</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">"date"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"2024-01-23"</span>})</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">timing_in</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"start of today"</span><span class="op">,</span> <span class="st">"start of tomorrow"</span>])</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">random_seed_in</span><span class="op">:</span> Inputs<span class="op">.</span><span class="fu">text</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">'random_seed_in'</span>})</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">frame_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">200</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'frame_in'</span>})</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">star_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">200</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'star_in'</span>})</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="dt">speed_in</span><span class="op">:</span> <span class="fu">Tangle</span>({<span class="dt">min</span><span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'speed_in'</span>})</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">duration_in</span><span class="op">,</span> viewof duration_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-23" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="89" data-source-offset="-2600"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 88;"><span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">year_in</span><span class="op">,</span> viewof year_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-24" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="90" data-source-offset="-2648"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 89;"><span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">annual_payment_in</span><span class="op">,</span> viewof annual_payment_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-25" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="91" data-source-offset="-2716"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 90;"><span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">interest_rate_in</span><span class="op">,</span> viewof interest_rate_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-26" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="92" data-source-offset="-2782"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 91;"><span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">actual_interest_rate_co_in</span><span class="op">,</span> viewof actual_interest_rate_co_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-27" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="93" data-source-offset="-2868"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 92;"><span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">f_in</span><span class="op">,</span> viewof f_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-28" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="94" data-source-offset="-2910"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 93;"><span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">x_in</span><span class="op">,</span> viewof x_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-29" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="95" data-source-offset="-2952"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 94;"><span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">y_in</span><span class="op">,</span> viewof y_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-30" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="96" data-source-offset="-2994"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 95;"><span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">player_x_in</span><span class="op">,</span> viewof player_x_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-31" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="97" data-source-offset="-3050"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 96;"><span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">player_y_in</span><span class="op">,</span> viewof player_y_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-32" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb11" data-startfrom="98" data-source-offset="-3106"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 97;"><span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">step_in</span><span class="op">,</span> viewof step_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-33" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb12" data-startfrom="99" data-source-offset="-3154"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 98;"><span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">ray_angle_in</span><span class="op">,</span> viewof ray_angle_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-34" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb13" data-startfrom="100" data-source-offset="-3212"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 99;"><span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">i_in</span><span class="op">,</span> viewof i_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-35" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb14" data-startfrom="101" data-source-offset="-3254"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 100;"><span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">date_in</span><span class="op">,</span> viewof date_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-36" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb15" data-startfrom="102" data-source-offset="-3302"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 101;"><span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">timing_in</span><span class="op">,</span> viewof timing_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-37" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb16" data-startfrom="103" data-source-offset="-3354"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 102;"><span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">random_seed_in</span><span class="op">,</span> viewof random_seed_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-38" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb17" data-startfrom="104" data-source-offset="-3416"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 103;"><span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">frame_in</span><span class="op">,</span> viewof frame_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-39" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb18" data-startfrom="105" data-source-offset="-3466"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 104;"><span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">speed_in</span><span class="op">,</span> viewof speed_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-40" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb19" data-startfrom="106" data-source-offset="-3516"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 105;"><span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(mini_binds<span class="op">.</span><span class="at">star_in</span><span class="op">,</span> viewof star_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-1-41" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="cell hidden bslib-grid-item html-fill-item">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb20" data-startfrom="113" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 112;"><span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a><span class="co">// working interactivity</span></span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;style&gt;</span></span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a><span class="vs">.inputs {</span></span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 20px;</span></span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a><span class="vs">button.btn {</span></span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a><span class="vs">  background-color: antiquewhite;</span></span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: blue;</span></span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding:0;</span></span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a><span class="vs">.calculang {</span></span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a><span class="vs">  line-height: 40px;</span></span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: blue;</span></span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a><span class="vs">    -webkit-transition: all 0.2s linear;</span></span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a><span class="vs">    -moz-transition: all 0.2s linear;</span></span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a><span class="vs">    -o-transition: all 0.2s linear;</span></span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a><span class="vs">    transition: all 0.2s linear;</span></span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a><span class="vs">.calculang.calculang_overwritten {</span></span>
<span id="cb20-138"><a href="#cb20-138" aria-hidden="true" tabindex="-1"></a><span class="vs">  text-decoration: line-through;</span></span>
<span id="cb20-139"><a href="#cb20-139" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: bold;</span></span>
<span id="cb20-140"><a href="#cb20-140" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>formulae_hidden<span class="op">.</span><span class="at">length</span> <span class="op">?</span> <span class="vs">`.calculang {</span></span>
<span id="cb20-143"><a href="#cb20-143" aria-hidden="true" tabindex="-1"></a><span class="vs">    background: #aaf3;</span></span>
<span id="cb20-144"><a href="#cb20-144" aria-hidden="true" tabindex="-1"></a><span class="vs">}`</span> <span class="op">:</span> <span class="st">''</span><span class="sc">}</span></span>
<span id="cb20-145"><a href="#cb20-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-146"><a href="#cb20-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-147"><a href="#cb20-147" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>formulae_hidden<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="vs">`.calculang_f_</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs"> + .calculang_f_</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs">`</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">', '</span>)<span class="sc">}</span><span class="vs"> {</span></span>
<span id="cb20-148"><a href="#cb20-148" aria-hidden="true" tabindex="-1"></a><span class="vs">  filter: blur(7px);</span></span>
<span id="cb20-149"><a href="#cb20-149" aria-hidden="true" tabindex="-1"></a><span class="vs">  line-height: 5px;</span></span>
<span id="cb20-150"><a href="#cb20-150" aria-hidden="true" tabindex="-1"></a><span class="vs">  opacity: 0.5;</span></span>
<span id="cb20-151"><a href="#cb20-151" aria-hidden="true" tabindex="-1"></a><span class="vs">} /* + selector to exclude first! https://coderwall.com/p/uugurw/css-selector-trick-select-all-elements-except-the-first */</span></span>
<span id="cb20-152"><a href="#cb20-152" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>formulae_hidden<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="vs">`.calculang_f_</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs">`</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">', '</span>)<span class="sc">}</span><span class="vs"> {</span></span>
<span id="cb20-153"><a href="#cb20-153" aria-hidden="true" tabindex="-1"></a><span class="vs">  opacity: 0.5;</span></span>
<span id="cb20-154"><a href="#cb20-154" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: white;</span></span>
<span id="cb20-155"><a href="#cb20-155" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span><span class="sc">${</span>formulae_hidden<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="vs">`.calculang_f_</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs"> .calculang_tooltip`</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">', '</span>)<span class="sc">}</span><span class="vs"> {</span></span>
<span id="cb20-156"><a href="#cb20-156" aria-hidden="true" tabindex="-1"></a><span class="vs">  opacity: 0.1;</span></span>
<span id="cb20-157"><a href="#cb20-157" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: white;</span></span>
<span id="cb20-158"><a href="#cb20-158" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb20-159"><a href="#cb20-159" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>formulae_hidden<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="vs">`.calculang_f_</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs"> &gt; .calculang_title`</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">', '</span>)<span class="sc">}</span><span class="vs"> {</span></span>
<span id="cb20-160"><a href="#cb20-160" aria-hidden="true" tabindex="-1"></a><span class="vs">  background-color: lightgreen;</span></span>
<span id="cb20-161"><a href="#cb20-161" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-size: 0.5em;</span></span>
<span id="cb20-162"><a href="#cb20-162" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb20-163"><a href="#cb20-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-164"><a href="#cb20-164" aria-hidden="true" tabindex="-1"></a><span class="vs">span.calculang_call {</span></span>
<span id="cb20-165"><a href="#cb20-165" aria-hidden="true" tabindex="-1"></a><span class="vs">  white-space:nowrap;</span></span>
<span id="cb20-166"><a href="#cb20-166" aria-hidden="true" tabindex="-1"></a><span class="vs">  cursor: zoom-in;</span></span>
<span id="cb20-167"><a href="#cb20-167" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: red;</span></span>
<span id="cb20-168"><a href="#cb20-168" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: bold;</span></span>
<span id="cb20-169"><a href="#cb20-169" aria-hidden="true" tabindex="-1"></a><span class="vs">  background-color: lightblue;</span></span>
<span id="cb20-170"><a href="#cb20-170" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb20-171"><a href="#cb20-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-172"><a href="#cb20-172" aria-hidden="true" tabindex="-1"></a><span class="vs">.calculang_call.calculang_call_input {</span></span>
<span id="cb20-173"><a href="#cb20-173" aria-hidden="true" tabindex="-1"></a><span class="vs">  cursor: none;</span></span>
<span id="cb20-174"><a href="#cb20-174" aria-hidden="true" tabindex="-1"></a><span class="vs">  background-color: pink;</span></span>
<span id="cb20-175"><a href="#cb20-175" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb20-176"><a href="#cb20-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-177"><a href="#cb20-177" aria-hidden="true" tabindex="-1"></a><span class="vs">.calculang .calculang_title span {</span></span>
<span id="cb20-178"><a href="#cb20-178" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 3px;</span></span>
<span id="cb20-179"><a href="#cb20-179" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: #af54;</span></span>
<span id="cb20-180"><a href="#cb20-180" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-size: 1.5em;</span></span>
<span id="cb20-181"><a href="#cb20-181" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: bold;</span></span>
<span id="cb20-182"><a href="#cb20-182" aria-hidden="true" tabindex="-1"></a><span class="vs">  border: 1px solid grey;</span></span>
<span id="cb20-183"><a href="#cb20-183" aria-hidden="true" tabindex="-1"></a><span class="vs">    -webkit-transition: all 0.2s linear;</span></span>
<span id="cb20-184"><a href="#cb20-184" aria-hidden="true" tabindex="-1"></a><span class="vs">    -moz-transition: all 0.2s linear;</span></span>
<span id="cb20-185"><a href="#cb20-185" aria-hidden="true" tabindex="-1"></a><span class="vs">    -o-transition: all 0.2s linear;</span></span>
<span id="cb20-186"><a href="#cb20-186" aria-hidden="true" tabindex="-1"></a><span class="vs">    transition: all 0.2s linear;</span></span>
<span id="cb20-187"><a href="#cb20-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-188"><a href="#cb20-188" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb20-189"><a href="#cb20-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-190"><a href="#cb20-190" aria-hidden="true" tabindex="-1"></a><span class="vs">.calculang_title.calculang_title_renamed {</span></span>
<span id="cb20-191"><a href="#cb20-191" aria-hidden="true" tabindex="-1"></a><span class="vs">  text-decoration: line-through;</span></span>
<span id="cb20-192"><a href="#cb20-192" aria-hidden="true" tabindex="-1"></a><span class="vs">  text-decoration-style: dashed;</span></span>
<span id="cb20-193"><a href="#cb20-193" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb20-194"><a href="#cb20-194" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/style&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-2" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell hidden bslib-grid-item html-fill-item">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb21" data-startfrom="208" data-source-offset="-237"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 207;"><span id="cb21-208"><a href="#cb21-208" aria-hidden="true" tabindex="-1"></a>fizzbuzz <span class="op">=</span> <span class="cf">await</span> <span class="pp">require</span>(<span class="vs">`https://calculang.dev/models/fizzbuzz/fizzbuzz.js`</span>)</span>
<span id="cb21-209"><a href="#cb21-209" aria-hidden="true" tabindex="-1"></a>year_remaining <span class="op">=</span> <span class="cf">await</span> <span class="pp">require</span>(<span class="vs">`https://calculang.dev/models/year-remaining/year-remaining.js`</span>)</span>
<span id="cb21-210"><a href="#cb21-210" aria-hidden="true" tabindex="-1"></a>starfield <span class="op">=</span> <span class="cf">await</span> <span class="pp">require</span>(<span class="vs">`https://calculang.dev/models/starfield/starfield.js`</span>)</span>
<span id="cb21-211"><a href="#cb21-211" aria-hidden="true" tabindex="-1"></a><span class="co">// UPDATE1 LOAD MODEL USING CORRECT REF</span></span>
<span id="cb21-212"><a href="#cb21-212" aria-hidden="true" tabindex="-1"></a>  raycasting2 <span class="op">=</span> <span class="cf">await</span> <span class="pp">require</span>(<span class="vs">`http://localhost:8080/raycasting/raycasting.js?</span><span class="sc">${</span>refresh<span class="sc">}${</span><span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb21-213"><a href="#cb21-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-214"><a href="#cb21-214" aria-hidden="true" tabindex="-1"></a>savings <span class="op">=</span> <span class="cf">await</span> <span class="pp">require</span>(<span class="vs">`https://calculang.dev/models/savings/savings.js`</span>)<span class="op">;</span></span>
<span id="cb21-215"><a href="#cb21-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-216"><a href="#cb21-216" aria-hidden="true" tabindex="-1"></a>savings_rec <span class="op">=</span> <span class="cf">await</span> <span class="pp">require</span>(<span class="vs">`https://calculang.dev/models/savings/savings-rec.js`</span>)</span>
<span id="cb21-217"><a href="#cb21-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-218"><a href="#cb21-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-219"><a href="#cb21-219" aria-hidden="true" tabindex="-1"></a>introspection_fetch <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`</span><span class="sc">${</span>entrypoint_no_cul_js<span class="sc">}</span><span class="vs">.introspection.json`</span>)</span>
<span id="cb21-220"><a href="#cb21-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-221"><a href="#cb21-221" aria-hidden="true" tabindex="-1"></a>introspection <span class="op">=</span> <span class="cf">await</span> introspection_fetch<span class="op">.</span><span class="fu">json</span>({<span class="dt">typed</span><span class="op">:</span><span class="kw">true</span>})</span>
<span id="cb21-222"><a href="#cb21-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-223"><a href="#cb21-223" aria-hidden="true" tabindex="-1"></a>introspection_nomemo_fetch <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`</span><span class="sc">${</span>entrypoint_no_cul_js<span class="sc">}${</span>calculang_source_nomemo<span class="op">.</span><span class="at">length</span> <span class="op">?</span> <span class="st">'-nomemo'</span> <span class="op">:</span> <span class="st">''</span><span class="sc">}</span><span class="vs">.introspection.json`</span>)</span>
<span id="cb21-224"><a href="#cb21-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-225"><a href="#cb21-225" aria-hidden="true" tabindex="-1"></a>introspection_nomemo <span class="op">=</span> <span class="cf">await</span> introspection_nomemo_fetch<span class="op">.</span><span class="fu">json</span>({<span class="dt">typed</span><span class="op">:</span><span class="kw">true</span>})</span>
<span id="cb21-226"><a href="#cb21-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-227"><a href="#cb21-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-228"><a href="#cb21-228" aria-hidden="true" tabindex="-1"></a>calculang_source_introspection <span class="op">=</span> calculang_source_nomemo<span class="op">.</span><span class="at">length</span> <span class="op">?</span> introspection_nomemo <span class="op">:</span> introspection</span>
<span id="cb21-229"><a href="#cb21-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-230"><a href="#cb21-230" aria-hidden="true" tabindex="-1"></a>formulae_objs <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(calculang_source_introspection<span class="op">.</span><span class="at">cul_functions</span>)<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">reason</span> <span class="op">==</span> <span class="st">'definition'</span> <span class="op">&amp;&amp;</span> inputs<span class="op">.</span><span class="fu">indexOf</span>(d<span class="op">.</span><span class="at">name</span><span class="op">+</span><span class="st">'_in'</span>) <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb21-231"><a href="#cb21-231" aria-hidden="true" tabindex="-1"></a>input_formulae_objs <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(calculang_source_introspection<span class="op">.</span><span class="at">cul_functions</span>)<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">reason</span> <span class="op">==</span> <span class="st">'definition'</span> <span class="op">&amp;&amp;</span> inputs<span class="op">.</span><span class="fu">indexOf</span>(d<span class="op">.</span><span class="at">name</span><span class="op">+</span><span class="st">'_in'</span>) <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb21-232"><a href="#cb21-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-233"><a href="#cb21-233" aria-hidden="true" tabindex="-1"></a>inputs <span class="op">=</span> _<span class="op">.</span><span class="fu">uniq</span>(<span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(calculang_source_introspection<span class="op">.</span><span class="at">cul_functions</span>)<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">reason</span> <span class="op">==</span> <span class="st">'input definition'</span>)<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">name</span>)<span class="op">.</span><span class="fu">sort</span>())</span>
<span id="cb21-234"><a href="#cb21-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-235"><a href="#cb21-235" aria-hidden="true" tabindex="-1"></a>fns0 <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(calculang_source_introspection<span class="op">.</span><span class="at">cul_functions</span>)<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cul_scope_id</span> <span class="op">==</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">inputs</span>)<span class="op">.</span><span class="fu">flat</span>()</span>
<span id="cb21-236"><a href="#cb21-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-237"><a href="#cb21-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-238"><a href="#cb21-238" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { CodeMirror<span class="op">,</span> loadCodeMirrorModules } <span class="im">from</span> <span class="st">"@jmatsushita/codemirror@670"</span><span class="op">;</span></span>
<span id="cb21-239"><a href="#cb21-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-240"><a href="#cb21-240" aria-hidden="true" tabindex="-1"></a>cmImports <span class="op">=</span> <span class="fu">loadCodeMirrorModules</span>([</span>
<span id="cb21-241"><a href="#cb21-241" aria-hidden="true" tabindex="-1"></a>  <span class="st">"view@6.22.2"</span><span class="op">,</span> <span class="co">// chk versions?</span></span>
<span id="cb21-242"><a href="#cb21-242" aria-hidden="true" tabindex="-1"></a>  <span class="st">"state@6.3.3"</span><span class="op">,</span></span>
<span id="cb21-243"><a href="#cb21-243" aria-hidden="true" tabindex="-1"></a>  <span class="st">"language@6.9.3"</span><span class="op">,</span></span>
<span id="cb21-244"><a href="#cb21-244" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lang-javascript"</span></span>
<span id="cb21-245"><a href="#cb21-245" aria-hidden="true" tabindex="-1"></a>  <span class="co">//"commands@6.3.2",</span></span>
<span id="cb21-246"><a href="#cb21-246" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb21-247"><a href="#cb21-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-248"><a href="#cb21-248" aria-hidden="true" tabindex="-1"></a>EditorView <span class="op">=</span> cmImports<span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="at">EditorView</span></span>
<span id="cb21-249"><a href="#cb21-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-250"><a href="#cb21-250" aria-hidden="true" tabindex="-1"></a>EditorState <span class="op">=</span> cmImports<span class="op">.</span><span class="at">state</span><span class="op">.</span><span class="at">EditorState</span></span>
<span id="cb21-251"><a href="#cb21-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-252"><a href="#cb21-252" aria-hidden="true" tabindex="-1"></a>Decoration <span class="op">=</span> cmImports<span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="at">Decoration</span></span>
<span id="cb21-253"><a href="#cb21-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-254"><a href="#cb21-254" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="op">=</span> (input<span class="op">,</span> value) <span class="kw">=&gt;</span> {</span>
<span id="cb21-255"><a href="#cb21-255" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb21-256"><a href="#cb21-256" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">Event</span>(<span class="st">"input"</span><span class="op">,</span> {<span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span>}))<span class="op">;</span></span>
<span id="cb21-257"><a href="#cb21-257" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-258"><a href="#cb21-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-259"><a href="#cb21-259" aria-hidden="true" tabindex="-1"></a><span class="co">//////////// plugin 1: decoration &amp; cul navigation for function-level</span></span>
<span id="cb21-260"><a href="#cb21-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-261"><a href="#cb21-261" aria-hidden="true" tabindex="-1"></a>syntaxTree <span class="op">=</span> cmImports<span class="op">.</span><span class="at">language</span><span class="op">.</span><span class="at">syntaxTree</span></span>
<span id="cb21-262"><a href="#cb21-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-263"><a href="#cb21-263" aria-hidden="true" tabindex="-1"></a>formulaDecorations <span class="op">=</span> {</span>
<span id="cb21-264"><a href="#cb21-264" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (options) <span class="kw">=&gt;</span> {</span>
<span id="cb21-265"><a href="#cb21-265" aria-hidden="true" tabindex="-1"></a>    <span class="co">//set(options.formulae_visible, [""]) // this was doing a lot of jank!!</span></span>
<span id="cb21-266"><a href="#cb21-266" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> formulaDecorations <span class="op">=</span> cmImports<span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="at">ViewPlugin</span><span class="op">.</span><span class="fu">fromClass</span>(</span>
<span id="cb21-267"><a href="#cb21-267" aria-hidden="true" tabindex="-1"></a>      <span class="kw">class</span> {</span>
<span id="cb21-268"><a href="#cb21-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-269"><a href="#cb21-269" aria-hidden="true" tabindex="-1"></a>        <span class="fu">constructor</span>(view) {</span>
<span id="cb21-270"><a href="#cb21-270" aria-hidden="true" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">decorations</span> <span class="op">=</span> <span class="fu">formulaDecoration</span>(view)<span class="op">;</span></span>
<span id="cb21-271"><a href="#cb21-271" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-272"><a href="#cb21-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-273"><a href="#cb21-273" aria-hidden="true" tabindex="-1"></a>        <span class="fu">update</span>(update) {</span>
<span id="cb21-274"><a href="#cb21-274" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (update<span class="op">.</span><span class="at">docChanged</span> <span class="op">||</span> update<span class="op">.</span><span class="at">viewportChanged</span>)</span>
<span id="cb21-275"><a href="#cb21-275" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="at">decorations</span> <span class="op">=</span> <span class="fu">formulaDecoration</span>(update<span class="op">.</span><span class="at">view</span>)<span class="op">;</span></span>
<span id="cb21-276"><a href="#cb21-276" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-277"><a href="#cb21-277" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb21-278"><a href="#cb21-278" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb21-279"><a href="#cb21-279" aria-hidden="true" tabindex="-1"></a>        <span class="dt">decorations</span><span class="op">:</span> (v) <span class="kw">=&gt;</span> v<span class="op">.</span><span class="at">decorations</span><span class="op">,</span></span>
<span id="cb21-280"><a href="#cb21-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-281"><a href="#cb21-281" aria-hidden="true" tabindex="-1"></a>        <span class="dt">eventHandlers</span><span class="op">:</span> {</span>
<span id="cb21-282"><a href="#cb21-282" aria-hidden="true" tabindex="-1"></a>          <span class="dt">mousedown</span><span class="op">:</span> (e<span class="op">,</span> view) <span class="kw">=&gt;</span> { <span class="co">// HMMM I'll need to resolve that calls get precedence!!! Should be working:</span></span>
<span id="cb21-283"><a href="#cb21-283" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> classList <span class="op">=</span> [<span class="op">...</span>e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">classList</span><span class="op">,</span> <span class="op">...</span>e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">parentElement</span><span class="op">.</span><span class="at">classList</span>] <span class="co">// very open, be aware of bugs ?!</span></span>
<span id="cb21-284"><a href="#cb21-284" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">contains</span>(<span class="st">"cul_call"</span>)) <span class="co">// </span><span class="al">TODO</span></span>
<span id="cb21-285"><a href="#cb21-285" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span><span class="op">;</span><span class="co">//set(viewof formulae_shown, [target.textContent]); </span><span class="al">TODO</span></span>
<span id="cb21-286"><a href="#cb21-286" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span> (</span>
<span id="cb21-287"><a href="#cb21-287" aria-hidden="true" tabindex="-1"></a>              <span class="co">//e.target.classList.contains("deposits") ||</span></span>
<span id="cb21-288"><a href="#cb21-288" aria-hidden="true" tabindex="-1"></a>              <span class="co">//e.target.parentElement.classList.contains("deposits")</span></span>
<span id="cb21-289"><a href="#cb21-289" aria-hidden="true" tabindex="-1"></a>              classList<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">includes</span>(<span class="st">"calculang_f_"</span>))<span class="op">.</span><span class="at">length</span></span>
<span id="cb21-290"><a href="#cb21-290" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb21-291"><a href="#cb21-291" aria-hidden="true" tabindex="-1"></a>              <span class="kw">set</span>(options<span class="op">.</span><span class="at">formulae_visible</span><span class="op">,</span> [classList<span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">includes</span>(<span class="st">"calculang_f_"</span>))<span class="op">.</span><span class="fu">slice</span>(<span class="st">"calculang_f_"</span><span class="op">.</span><span class="at">length</span>)])<span class="op">;</span></span>
<span id="cb21-292"><a href="#cb21-292" aria-hidden="true" tabindex="-1"></a>              <span class="co">/////// causes unnecessary jitter when we already see f document.querySelector('.'+classList.find(d =&gt; d.includes("calculang_f_"))).scrollIntoView(scrollIntoViewOpts)</span></span>
<span id="cb21-293"><a href="#cb21-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-294"><a href="#cb21-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-295"><a href="#cb21-295" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb21-296"><a href="#cb21-296" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-297"><a href="#cb21-297" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-298"><a href="#cb21-298" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb21-299"><a href="#cb21-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-300"><a href="#cb21-300" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [formulaDecorations]<span class="op">;</span></span>
<span id="cb21-301"><a href="#cb21-301" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-302"><a href="#cb21-302" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-303"><a href="#cb21-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-304"><a href="#cb21-304" aria-hidden="true" tabindex="-1"></a><span class="co">// Decoration.lines</span></span>
<span id="cb21-305"><a href="#cb21-305" aria-hidden="true" tabindex="-1"></a>formulaDecoration <span class="op">=</span> (view) <span class="kw">=&gt;</span> Decoration<span class="op">.</span><span class="fu">set</span>(</span>
<span id="cb21-306"><a href="#cb21-306" aria-hidden="true" tabindex="-1"></a>  formula_line_details</span>
<span id="cb21-307"><a href="#cb21-307" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span></span>
<span id="cb21-308"><a href="#cb21-308" aria-hidden="true" tabindex="-1"></a>      _<span class="op">.</span><span class="fu">range</span>(d<span class="op">.</span><span class="at">lineStart</span><span class="op">,</span> d<span class="op">.</span><span class="at">lineEnd</span> <span class="op">+</span> <span class="fl">0.1</span>)<span class="op">.</span><span class="fu">map</span>((e) <span class="kw">=&gt;</span></span>
<span id="cb21-309"><a href="#cb21-309" aria-hidden="true" tabindex="-1"></a>        Decoration<span class="op">.</span><span class="fu">line</span>({</span>
<span id="cb21-310"><a href="#cb21-310" aria-hidden="true" tabindex="-1"></a>          <span class="dt">attributes</span><span class="op">:</span> {</span>
<span id="cb21-311"><a href="#cb21-311" aria-hidden="true" tabindex="-1"></a>            <span class="dt">class</span><span class="op">:</span> <span class="st">"calculang"</span> <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> <span class="st">"calculang_f_"</span><span class="op">+</span>d<span class="op">.</span><span class="at">name</span> <span class="op">+</span> (d<span class="op">.</span><span class="at">overwritten</span> <span class="op">?</span> <span class="st">' calculang_overwritten'</span> <span class="op">:</span> <span class="st">''</span>) <span class="co">/* +style available */</span> <span class="co">// leaving scope and other potential conflicts out</span></span>
<span id="cb21-312"><a href="#cb21-312" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb21-313"><a href="#cb21-313" aria-hidden="true" tabindex="-1"></a>        })<span class="op">.</span><span class="fu">range</span>(view<span class="op">.</span><span class="at">state</span><span class="op">.</span><span class="at">doc</span><span class="op">.</span><span class="fu">line</span>(e)<span class="op">.</span><span class="at">from</span>)</span>
<span id="cb21-314"><a href="#cb21-314" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb21-315"><a href="#cb21-315" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-316"><a href="#cb21-316" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flat</span>())</span>
<span id="cb21-317"><a href="#cb21-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-318"><a href="#cb21-318" aria-hidden="true" tabindex="-1"></a>formula_line_details <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(calculang_source_introspection<span class="op">.</span><span class="at">cul_functions</span>)</span>
<span id="cb21-319"><a href="#cb21-319" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">reason</span><span class="op">.</span><span class="fu">includes</span>(<span class="st">"definition"</span>) <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">name</span><span class="op">.</span><span class="fu">slice</span>(<span class="op">-</span><span class="dv">3</span>) <span class="op">!=</span> <span class="st">'_in'</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">cul_scope_id</span> <span class="op">==</span> cul_scope_id)</span>
<span id="cb21-320"><a href="#cb21-320" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(({ name<span class="op">,</span> loc<span class="op">,</span> reason }) <span class="kw">=&gt;</span> ({</span>
<span id="cb21-321"><a href="#cb21-321" aria-hidden="true" tabindex="-1"></a>    name<span class="op">,</span></span>
<span id="cb21-322"><a href="#cb21-322" aria-hidden="true" tabindex="-1"></a>    <span class="dt">lineStart</span><span class="op">:</span> loc<span class="op">?.</span><span class="at">start</span><span class="op">.</span><span class="at">line</span><span class="op">,</span></span>
<span id="cb21-323"><a href="#cb21-323" aria-hidden="true" tabindex="-1"></a>    <span class="dt">lineEnd</span><span class="op">:</span> loc<span class="op">?.</span><span class="at">end</span><span class="op">.</span><span class="at">line</span><span class="op">,</span></span>
<span id="cb21-324"><a href="#cb21-324" aria-hidden="true" tabindex="-1"></a>    <span class="dt">overwritten</span><span class="op">:</span> name<span class="op">.</span><span class="fu">slice</span>(<span class="op">-</span><span class="dv">1</span>) <span class="op">==</span> <span class="st">'_'</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>(<span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(calculang_source_introspection<span class="op">.</span><span class="at">cul_functions</span>)<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">imported</span> <span class="op">==</span> name <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">cul_source_scope_id</span> <span class="op">==</span> cul_scope_id))<span class="op">.</span><span class="at">length</span> <span class="co">// and not explicit imported/used in parent defn</span></span>
<span id="cb21-325"><a href="#cb21-325" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb21-326"><a href="#cb21-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-327"><a href="#cb21-327" aria-hidden="true" tabindex="-1"></a>formula_line_details_0 <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(calculang_source_introspection<span class="op">.</span><span class="at">cul_functions</span>)</span>
<span id="cb21-328"><a href="#cb21-328" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">reason</span><span class="op">.</span><span class="fu">includes</span>(<span class="st">"definition"</span>) <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">name</span><span class="op">.</span><span class="fu">slice</span>(<span class="op">-</span><span class="dv">3</span>) <span class="op">!=</span> <span class="st">'_in'</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">cul_scope_id</span> <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb21-329"><a href="#cb21-329" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(({ name<span class="op">,</span> loc<span class="op">,</span> reason }) <span class="kw">=&gt;</span> ({</span>
<span id="cb21-330"><a href="#cb21-330" aria-hidden="true" tabindex="-1"></a>    name<span class="op">,</span></span>
<span id="cb21-331"><a href="#cb21-331" aria-hidden="true" tabindex="-1"></a>    <span class="dt">lineStart</span><span class="op">:</span> loc<span class="op">?.</span><span class="at">start</span><span class="op">.</span><span class="at">line</span><span class="op">,</span></span>
<span id="cb21-332"><a href="#cb21-332" aria-hidden="true" tabindex="-1"></a>    <span class="dt">lineEnd</span><span class="op">:</span> loc<span class="op">?.</span><span class="at">end</span><span class="op">.</span><span class="at">line</span><span class="op">,</span></span>
<span id="cb21-333"><a href="#cb21-333" aria-hidden="true" tabindex="-1"></a>    <span class="dt">overwritten</span><span class="op">:</span> name<span class="op">.</span><span class="fu">slice</span>(<span class="op">-</span><span class="dv">1</span>) <span class="op">==</span> <span class="st">'_'</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>(<span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(calculang_source_introspection<span class="op">.</span><span class="at">cul_functions</span>)<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">imported</span> <span class="op">==</span> name))<span class="op">.</span><span class="at">length</span> <span class="co">// and not explicit imported/used in parent defn</span></span>
<span id="cb21-334"><a href="#cb21-334" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb21-335"><a href="#cb21-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-336"><a href="#cb21-336" aria-hidden="true" tabindex="-1"></a><span class="co">//////////// plugin 2: decoration &amp; cul navigation for call-level, also decoration for titles. By syntax tree analysis</span></span>
<span id="cb21-337"><a href="#cb21-337" aria-hidden="true" tabindex="-1"></a><span class="co">// uses formulae_all, inputs: should derive from entrypoint/introspection before splitting up</span></span>
<span id="cb21-338"><a href="#cb21-338" aria-hidden="true" tabindex="-1"></a><span class="co">// also sets formae_visible</span></span>
<span id="cb21-339"><a href="#cb21-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-340"><a href="#cb21-340" aria-hidden="true" tabindex="-1"></a><span class="co">// inconsistent naming !</span></span>
<span id="cb21-341"><a href="#cb21-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-342"><a href="#cb21-342" aria-hidden="true" tabindex="-1"></a>formulae_hidden <span class="op">=</span> formulae_all<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> <span class="op">!</span>formulae_visible<span class="op">.</span><span class="fu">includes</span>(d))</span>
<span id="cb21-343"><a href="#cb21-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-344"><a href="#cb21-344" aria-hidden="true" tabindex="-1"></a>formulae_all <span class="op">=</span> formula_line_details<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">name</span>) <span class="co">// poor?</span></span>
<span id="cb21-345"><a href="#cb21-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-346"><a href="#cb21-346" aria-hidden="true" tabindex="-1"></a><span class="co">//inputs = _.uniq(Object.values(introspection.cul_input_map).flat())</span></span>
<span id="cb21-347"><a href="#cb21-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-348"><a href="#cb21-348" aria-hidden="true" tabindex="-1"></a>calculang_identifier_decorations <span class="op">=</span> {</span>
<span id="cb21-349"><a href="#cb21-349" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (options) <span class="kw">=&gt;</span> {</span>
<span id="cb21-350"><a href="#cb21-350" aria-hidden="true" tabindex="-1"></a>    <span class="co">//set(options.formulae_visible, formulae_all) // WHERE DOES THIS NEED TO GO?</span></span>
<span id="cb21-351"><a href="#cb21-351" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> decorations <span class="op">=</span> cmImports<span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="at">ViewPlugin</span><span class="op">.</span><span class="fu">fromClass</span>(</span>
<span id="cb21-352"><a href="#cb21-352" aria-hidden="true" tabindex="-1"></a>      <span class="kw">class</span> {</span>
<span id="cb21-353"><a href="#cb21-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-354"><a href="#cb21-354" aria-hidden="true" tabindex="-1"></a>        <span class="fu">constructor</span>(view) {</span>
<span id="cb21-355"><a href="#cb21-355" aria-hidden="true" tabindex="-1"></a>          <span class="kw">this</span><span class="op">.</span><span class="at">decorations</span> <span class="op">=</span> <span class="fu">identifier_decorations</span>(view)<span class="op">;</span></span>
<span id="cb21-356"><a href="#cb21-356" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-357"><a href="#cb21-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-358"><a href="#cb21-358" aria-hidden="true" tabindex="-1"></a>        <span class="fu">update</span>(update) {</span>
<span id="cb21-359"><a href="#cb21-359" aria-hidden="true" tabindex="-1"></a>          <span class="co">//debugger; this is called a LOT!!</span></span>
<span id="cb21-360"><a href="#cb21-360" aria-hidden="true" tabindex="-1"></a>          <span class="co">//if (update.docChanged || update.focusChanged|| update.viewportChanged || update.geometryChanged || update.heightChanged) // expensive things on scroll, but didn't run on full doc for some reason?!</span></span>
<span id="cb21-361"><a href="#cb21-361" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="at">decorations</span> <span class="op">=</span> <span class="fu">identifier_decorations</span>(update<span class="op">.</span><span class="at">view</span>)<span class="op">;</span></span>
<span id="cb21-362"><a href="#cb21-362" aria-hidden="true" tabindex="-1"></a>            <span class="co">// why </span></span>
<span id="cb21-363"><a href="#cb21-363" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-364"><a href="#cb21-364" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb21-365"><a href="#cb21-365" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb21-366"><a href="#cb21-366" aria-hidden="true" tabindex="-1"></a>        <span class="dt">decorations</span><span class="op">:</span> (v) <span class="kw">=&gt;</span> v<span class="op">.</span><span class="at">decorations</span><span class="op">,</span></span>
<span id="cb21-367"><a href="#cb21-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-368"><a href="#cb21-368" aria-hidden="true" tabindex="-1"></a>        <span class="dt">eventHandlers</span><span class="op">:</span> {</span>
<span id="cb21-369"><a href="#cb21-369" aria-hidden="true" tabindex="-1"></a>          <span class="dt">mousedown</span><span class="op">:</span> (e<span class="op">,</span> view) <span class="kw">=&gt;</span> {</span>
<span id="cb21-370"><a href="#cb21-370" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> classList <span class="op">=</span> [<span class="op">...</span>e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">classList</span><span class="op">,</span> <span class="op">...</span>e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">parentElement</span><span class="op">.</span><span class="at">classList</span>] <span class="co">// very open, be aware of bugs ?!</span></span>
<span id="cb21-371"><a href="#cb21-371" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">contains</span>(<span class="st">"calculang_call"</span>) <span class="op">||</span> classList<span class="op">.</span><span class="fu">includes</span>(<span class="st">"calculang_title"</span>)) { <span class="co">// </span><span class="al">TODO</span><span class="co"> only if the containing formula is visible, I have options.formulae_visible:</span></span>
<span id="cb21-372"><a href="#cb21-372" aria-hidden="true" tabindex="-1"></a>            <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'HIHIHIEE'</span>)</span>
<span id="cb21-373"><a href="#cb21-373" aria-hidden="true" tabindex="-1"></a>            <span class="co">//debugger;</span></span>
<span id="cb21-374"><a href="#cb21-374" aria-hidden="true" tabindex="-1"></a>              <span class="kw">set</span>(options<span class="op">.</span><span class="at">formulae_visible</span><span class="op">,</span> [e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">textContent</span>])</span>
<span id="cb21-375"><a href="#cb21-375" aria-hidden="true" tabindex="-1"></a>              <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.calculang_f_'</span><span class="op">+</span>e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">textContent</span>)<span class="op">.</span><span class="fu">scrollIntoView</span>(scrollIntoViewOpts)</span>
<span id="cb21-376"><a href="#cb21-376" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb21-377"><a href="#cb21-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-378"><a href="#cb21-378" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span> (</span>
<span id="cb21-379"><a href="#cb21-379" aria-hidden="true" tabindex="-1"></a>              <span class="co">//e.target.classList.contains("deposits") ||</span></span>
<span id="cb21-380"><a href="#cb21-380" aria-hidden="true" tabindex="-1"></a>              <span class="co">//e.target.parentElement.classList.contains("deposits")</span></span>
<span id="cb21-381"><a href="#cb21-381" aria-hidden="true" tabindex="-1"></a>              classList<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">includes</span>(<span class="st">"calculang_f_"</span>))<span class="op">.</span><span class="at">length</span></span>
<span id="cb21-382"><a href="#cb21-382" aria-hidden="true" tabindex="-1"></a>            ) {</span>
<span id="cb21-383"><a href="#cb21-383" aria-hidden="true" tabindex="-1"></a>              <span class="kw">set</span>(options<span class="op">.</span><span class="at">formulae_visible</span><span class="op">,</span> [classList<span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">includes</span>(<span class="st">"calculang_f_"</span>))<span class="op">.</span><span class="fu">slice</span>(<span class="st">"calculang_f_"</span><span class="op">.</span><span class="at">length</span>)])<span class="op">;</span></span>
<span id="cb21-384"><a href="#cb21-384" aria-hidden="true" tabindex="-1"></a>              <span class="co">//document.querySelector('.'+classList.find(d =&gt; d.includes("calculang_f_"))).scrollIntoView(scrollIntoViewOpts)</span></span>
<span id="cb21-385"><a href="#cb21-385" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb21-386"><a href="#cb21-386" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb21-387"><a href="#cb21-387" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-388"><a href="#cb21-388" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-389"><a href="#cb21-389" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb21-390"><a href="#cb21-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-391"><a href="#cb21-391" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [decorations]<span class="op">;</span></span>
<span id="cb21-392"><a href="#cb21-392" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-393"><a href="#cb21-393" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-394"><a href="#cb21-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-395"><a href="#cb21-395" aria-hidden="true" tabindex="-1"></a><span class="co">// Decoration.marks specified by ranges</span></span>
<span id="cb21-396"><a href="#cb21-396" aria-hidden="true" tabindex="-1"></a>identifier_decorations <span class="op">=</span> view <span class="kw">=&gt;</span> {</span>
<span id="cb21-397"><a href="#cb21-397" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> decorations <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb21-398"><a href="#cb21-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-399"><a href="#cb21-399" aria-hidden="true" tabindex="-1"></a>  <span class="co">//for (let { from, to } of view.visibleRanges) {</span></span>
<span id="cb21-400"><a href="#cb21-400" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(view<span class="op">.</span><span class="at">state</span>)</span>
<span id="cb21-401"><a href="#cb21-401" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(view<span class="op">.</span><span class="at">visibleRanges</span>)</span>
<span id="cb21-402"><a href="#cb21-402" aria-hidden="true" tabindex="-1"></a>  <span class="co">//for (let { from, to } of [{from: 0, to: 1000}]) {</span></span>
<span id="cb21-403"><a href="#cb21-403" aria-hidden="true" tabindex="-1"></a>    <span class="co">//debugger;</span></span>
<span id="cb21-404"><a href="#cb21-404" aria-hidden="true" tabindex="-1"></a>    <span class="co">//debugger;</span></span>
<span id="cb21-405"><a href="#cb21-405" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> { <span class="im">from</span><span class="op">,</span> to } <span class="kw">of</span> view<span class="op">.</span><span class="at">visibleRanges</span>) {</span>
<span id="cb21-406"><a href="#cb21-406" aria-hidden="true" tabindex="-1"></a>    <span class="co">//for (let { from, to } of [{from:0, to:5000}]) {</span></span>
<span id="cb21-407"><a href="#cb21-407" aria-hidden="true" tabindex="-1"></a>      <span class="co">//cmImports.language.syntaxTreeAvailable(view.state, )</span></span>
<span id="cb21-408"><a href="#cb21-408" aria-hidden="true" tabindex="-1"></a>      <span class="co">//cmImports.language.forceParsing(view, )</span></span>
<span id="cb21-409"><a href="#cb21-409" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-410"><a href="#cb21-410" aria-hidden="true" tabindex="-1"></a>    cmImports<span class="op">.</span><span class="at">language</span><span class="op">.</span><span class="fu">syntaxTree</span>(view<span class="op">.</span><span class="at">state</span>)<span class="op">.</span><span class="fu">iterate</span>({</span>
<span id="cb21-411"><a href="#cb21-411" aria-hidden="true" tabindex="-1"></a>      <span class="im">from</span><span class="op">,</span></span>
<span id="cb21-412"><a href="#cb21-412" aria-hidden="true" tabindex="-1"></a>      to<span class="op">,</span></span>
<span id="cb21-413"><a href="#cb21-413" aria-hidden="true" tabindex="-1"></a>      <span class="dt">enter</span><span class="op">:</span> (node) <span class="kw">=&gt;</span> {</span>
<span id="cb21-414"><a href="#cb21-414" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (node<span class="op">.</span><span class="at">name</span> <span class="op">==</span> <span class="st">"VariableDefinition"</span>) {</span>
<span id="cb21-415"><a href="#cb21-415" aria-hidden="true" tabindex="-1"></a>          <span class="kw">let</span> name <span class="op">=</span> view<span class="op">.</span><span class="at">state</span><span class="op">.</span><span class="at">doc</span><span class="op">.</span><span class="fu">sliceString</span>(node<span class="op">.</span><span class="at">from</span><span class="op">,</span> node<span class="op">.</span><span class="at">to</span>)<span class="op">;</span></span>
<span id="cb21-416"><a href="#cb21-416" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (formulae_all<span class="op">.</span><span class="fu">includes</span>(name)) {</span>
<span id="cb21-417"><a href="#cb21-417" aria-hidden="true" tabindex="-1"></a>            decorations<span class="op">.</span><span class="fu">push</span>(</span>
<span id="cb21-418"><a href="#cb21-418" aria-hidden="true" tabindex="-1"></a>              Decoration<span class="op">.</span><span class="fu">mark</span>({ <span class="dt">class</span><span class="op">:</span> <span class="st">"calculang_title"</span> })<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb21-419"><a href="#cb21-419" aria-hidden="true" tabindex="-1"></a>                node<span class="op">.</span><span class="at">from</span><span class="op">,</span></span>
<span id="cb21-420"><a href="#cb21-420" aria-hidden="true" tabindex="-1"></a>                node<span class="op">.</span><span class="at">to</span></span>
<span id="cb21-421"><a href="#cb21-421" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb21-422"><a href="#cb21-422" aria-hidden="true" tabindex="-1"></a>            )<span class="op">;</span></span>
<span id="cb21-423"><a href="#cb21-423" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb21-424"><a href="#cb21-424" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (formulae_all<span class="op">.</span><span class="fu">includes</span>(name <span class="op">+</span> <span class="st">'_'</span>)) {</span>
<span id="cb21-425"><a href="#cb21-425" aria-hidden="true" tabindex="-1"></a>            decorations<span class="op">.</span><span class="fu">push</span>(</span>
<span id="cb21-426"><a href="#cb21-426" aria-hidden="true" tabindex="-1"></a>              Decoration<span class="op">.</span><span class="fu">mark</span>({ <span class="dt">class</span><span class="op">:</span> <span class="st">"calculang_title calculang_title_renamed"</span> })<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb21-427"><a href="#cb21-427" aria-hidden="true" tabindex="-1"></a>                node<span class="op">.</span><span class="at">from</span><span class="op">,</span></span>
<span id="cb21-428"><a href="#cb21-428" aria-hidden="true" tabindex="-1"></a>                node<span class="op">.</span><span class="at">to</span></span>
<span id="cb21-429"><a href="#cb21-429" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb21-430"><a href="#cb21-430" aria-hidden="true" tabindex="-1"></a>            )<span class="op">;</span></span>
<span id="cb21-431"><a href="#cb21-431" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb21-432"><a href="#cb21-432" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-433"><a href="#cb21-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-434"><a href="#cb21-434" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (node<span class="op">.</span><span class="at">name</span> <span class="op">==</span> <span class="st">"VariableName"</span>) {</span>
<span id="cb21-435"><a href="#cb21-435" aria-hidden="true" tabindex="-1"></a>          <span class="kw">let</span> name <span class="op">=</span> view<span class="op">.</span><span class="at">state</span><span class="op">.</span><span class="at">doc</span><span class="op">.</span><span class="fu">sliceString</span>(node<span class="op">.</span><span class="at">from</span><span class="op">,</span> node<span class="op">.</span><span class="at">to</span>)<span class="op">;</span></span>
<span id="cb21-436"><a href="#cb21-436" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (formulae_all<span class="op">.</span><span class="fu">includes</span>(name)) {</span>
<span id="cb21-437"><a href="#cb21-437" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (inputs<span class="op">.</span><span class="fu">includes</span>(name <span class="op">+</span> <span class="st">"_in"</span>))</span>
<span id="cb21-438"><a href="#cb21-438" aria-hidden="true" tabindex="-1"></a>              decorations<span class="op">.</span><span class="fu">push</span>(</span>
<span id="cb21-439"><a href="#cb21-439" aria-hidden="true" tabindex="-1"></a>                Decoration<span class="op">.</span><span class="fu">mark</span>({ <span class="dt">class</span><span class="op">:</span> <span class="st">"calculang_call calculang_call_input"</span> })<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb21-440"><a href="#cb21-440" aria-hidden="true" tabindex="-1"></a>                  node<span class="op">.</span><span class="at">from</span><span class="op">,</span></span>
<span id="cb21-441"><a href="#cb21-441" aria-hidden="true" tabindex="-1"></a>                  node<span class="op">.</span><span class="at">to</span></span>
<span id="cb21-442"><a href="#cb21-442" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb21-443"><a href="#cb21-443" aria-hidden="true" tabindex="-1"></a>              )<span class="op">;</span></span>
<span id="cb21-444"><a href="#cb21-444" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span>
<span id="cb21-445"><a href="#cb21-445" aria-hidden="true" tabindex="-1"></a>              decorations<span class="op">.</span><span class="fu">push</span>(</span>
<span id="cb21-446"><a href="#cb21-446" aria-hidden="true" tabindex="-1"></a>                Decoration<span class="op">.</span><span class="fu">mark</span>({ <span class="dt">class</span><span class="op">:</span> <span class="st">"calculang_call"</span> })<span class="op">.</span><span class="fu">range</span>(node<span class="op">.</span><span class="at">from</span><span class="op">,</span> node<span class="op">.</span><span class="at">to</span>)</span>
<span id="cb21-447"><a href="#cb21-447" aria-hidden="true" tabindex="-1"></a>              )<span class="op">;</span></span>
<span id="cb21-448"><a href="#cb21-448" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb21-449"><a href="#cb21-449" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-450"><a href="#cb21-450" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-451"><a href="#cb21-451" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb21-452"><a href="#cb21-452" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-453"><a href="#cb21-453" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Decoration<span class="op">.</span><span class="fu">set</span>(decorations)<span class="op">;</span></span>
<span id="cb21-454"><a href="#cb21-454" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-28" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-29" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-30" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<!--## Row {height=50%}-->
<div class="bslib-grid-item html-fill-item bslib-grid" data-layout="fill" style="display: grid; grid-template-columns: minmax(3em, 1fr) minmax(3em, 1fr);
grid-auto-rows: minmax(0, 1fr);">
<div class="bslib-grid" style="display: grid; grid-template-rows: minmax(3em, max-content); grid-auto-columns: minmax(0, 1fr);">
<div class="card bslib-card html-fill-container" data-fill="false" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<!--## formulas 🕵🏼‍♀️ {width=800px}-->
<div id="left" class="fill html-fill-item html-fill-container">
<div class="fill html-fill-item html-fill-container">

</div>
<style>
  .card:has(#left) {
    background-color: #69ff6111;
  }
  #left {
    /*background-color: ;*/
    border: 0;
  }
  #left * .card-body {
    background-color: white;
    padding: 0;
    border: 0;
  }
  #left .observablehq {
    background-color: white;
  }
  .card:has(.modeldept) {
    background-color: #D81B6011;
  }
</style>
<!-- hassle for modularity => tabs (so pretty in Quarto) need to become select box or buttons. Style later -->
<div class="cell hidden html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb22" data-startfrom="504" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 503;"><span id="cb22-504"><a href="#cb22-504" aria-hidden="true" tabindex="-1"></a>viewof x <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="dv">0</span>)</span>
<span id="cb22-505"><a href="#cb22-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-506"><a href="#cb22-506" aria-hidden="true" tabindex="-1"></a>formulae_visible</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-2" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb23" data-startfrom="508" data-source-offset="-46"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 507;"><span id="cb23-508"><a href="#cb23-508" aria-hidden="true" tabindex="-1"></a>formulae_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-3" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb24" data-startfrom="510" data-source-offset="-60"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 509;"><span id="cb24-510"><a href="#cb24-510" aria-hidden="true" tabindex="-1"></a>inputs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-4" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb25" data-startfrom="512" data-source-offset="-68"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 511;"><span id="cb25-512"><a href="#cb25-512" aria-hidden="true" tabindex="-1"></a>formulae_hidden</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-5" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb26" data-startfrom="514" data-source-offset="-85"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 513;"><span id="cb26-514"><a href="#cb26-514" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-6" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb27" data-startfrom="518" data-source-offset="-136"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 517;"><span id="cb27-518"><a href="#cb27-518" aria-hidden="true" tabindex="-1"></a>examples_yaml <span class="op">=</span> <span class="cf">await</span> (<span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">'https://calculang.dev/gallery.yml'</span>))<span class="op">.</span><span class="fu">text</span>()</span>
<span id="cb27-519"><a href="#cb27-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-520"><a href="#cb27-520" aria-hidden="true" tabindex="-1"></a>yaml <span class="op">=</span> <span class="pp">require</span>(<span class="st">'js-yaml@4.1.0/dist/js-yaml.min.js'</span>)</span>
<span id="cb27-521"><a href="#cb27-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-522"><a href="#cb27-522" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> yaml<span class="op">.</span><span class="fu">load</span>(examples_yaml)</span>
<span id="cb27-523"><a href="#cb27-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-524"><a href="#cb27-524" aria-hidden="true" tabindex="-1"></a>selected_model <span class="op">=</span> Generators<span class="op">.</span><span class="fu">input</span>(a_thing2)</span>
<span id="cb27-525"><a href="#cb27-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-526"><a href="#cb27-526" aria-hidden="true" tabindex="-1"></a>example_details <span class="op">=</span> examples<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">tiles</span>)<span class="op">.</span><span class="fu">flat</span>()<span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span> <span class="op">==</span> selected_model)</span>
<span id="cb27-527"><a href="#cb27-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-528"><a href="#cb27-528" aria-hidden="true" tabindex="-1"></a>modelname <span class="op">=</span> example_details<span class="op">.</span><span class="at">id</span><span class="op">.</span><span class="fu">replace</span>(<span class="st">'-'</span><span class="op">,</span><span class="st">'_'</span>) <span class="co">// replace due to object lookups</span></span>
<span id="cb27-529"><a href="#cb27-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-530"><a href="#cb27-530" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="kw">new</span> <span class="fu">URLSearchParams</span>(location<span class="op">.</span><span class="at">search</span>)</span>
<span id="cb27-531"><a href="#cb27-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-532"><a href="#cb27-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-533"><a href="#cb27-533" aria-hidden="true" tabindex="-1"></a>default_example_id <span class="op">=</span> q<span class="op">.</span><span class="fu">get</span>(<span class="st">'id'</span>) <span class="op">??</span> <span class="st">''</span></span>
<span id="cb27-534"><a href="#cb27-534" aria-hidden="true" tabindex="-1"></a>show_hidden <span class="op">=</span> <span class="kw">true</span><span class="co">// q.get('hidden') == 'hidden' ?? true</span></span>
<span id="cb27-535"><a href="#cb27-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-536"><a href="#cb27-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-537"><a href="#cb27-537" aria-hidden="true" tabindex="-1"></a>dir <span class="op">=</span> <span class="fu">dirname</span>(example_entrypoint)</span>
<span id="cb27-538"><a href="#cb27-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-539"><a href="#cb27-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-540"><a href="#cb27-540" aria-hidden="true" tabindex="-1"></a><span class="co">//https://www.abeautifulsite.net/posts/javascript-functions-for-basename-and-dirname/</span></span>
<span id="cb27-541"><a href="#cb27-541" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dirname</span>(path) {</span>
<span id="cb27-542"><a href="#cb27-542" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> path<span class="op">.</span><span class="fu">match</span>(<span class="ss">/.</span><span class="sc">*\/</span><span class="ss">/</span>)<span class="op">;</span></span>
<span id="cb27-543"><a href="#cb27-543" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-544"><a href="#cb27-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-545"><a href="#cb27-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-546"><a href="#cb27-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-547"><a href="#cb27-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-548"><a href="#cb27-548" aria-hidden="true" tabindex="-1"></a>example_entrypoint <span class="op">=</span> entrypoint</span>
<span id="cb27-549"><a href="#cb27-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-550"><a href="#cb27-550" aria-hidden="true" tabindex="-1"></a>entrypoint <span class="op">=</span> (example_details<span class="op">.</span><span class="at">entrypoint</span>[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"/"</span> <span class="op">?</span> <span class="st">"https://calculang.dev"</span> <span class="op">:</span> <span class="st">""</span>) <span class="op">+</span></span>
<span id="cb27-551"><a href="#cb27-551" aria-hidden="true" tabindex="-1"></a>  example_details<span class="op">.</span><span class="at">entrypoint</span></span>
<span id="cb27-552"><a href="#cb27-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-553"><a href="#cb27-553" aria-hidden="true" tabindex="-1"></a>entrypoint_no_cul_js <span class="op">=</span> entrypoint<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,-</span><span class="dv">7</span>)</span>
<span id="cb27-554"><a href="#cb27-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-555"><a href="#cb27-555" aria-hidden="true" tabindex="-1"></a><span class="co">//viewof entrypoint = Inputs.select(new Map(entrypoints_all.map((d,i) =&gt; [d[1],i])), {label:'model 👀', value:1}) // leaving on simple-climate as it breaks if not default :o</span></span>
<span id="cb27-556"><a href="#cb27-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-557"><a href="#cb27-557" aria-hidden="true" tabindex="-1"></a><span class="co">// hacky, do qs parsing?</span></span>
<span id="cb27-558"><a href="#cb27-558" aria-hidden="true" tabindex="-1"></a><span class="co">// I should view .mjs instead of .cul.js for memo case?</span></span>
<span id="cb27-559"><a href="#cb27-559" aria-hidden="true" tabindex="-1"></a>cul_resources <span class="op">=</span> {</span>
<span id="cb27-560"><a href="#cb27-560" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (cul_js_cul)</span>
<span id="cb27-561"><a href="#cb27-561" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(introspection_nomemo<span class="op">.</span><span class="at">cul_scope_ids_to_resource</span>)<span class="op">.</span><span class="fu">map</span>(loc <span class="kw">=&gt;</span> loc<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span>)<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span>loc<span class="op">.</span><span class="fu">indexOf</span>(<span class="st">'?'</span>) <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">?</span> loc<span class="op">.</span><span class="fu">indexOf</span>(<span class="st">'?'</span>)<span class="op">-</span><span class="dv">2</span> <span class="op">:</span> <span class="dv">999</span>))<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d <span class="op">+</span> ((d<span class="op">.</span><span class="fu">slice</span>(<span class="op">-</span><span class="dv">3</span>) <span class="op">!=</span> <span class="st">'.js'</span>) <span class="op">?</span> <span class="st">'.js'</span> <span class="op">:</span> <span class="st">''</span>))<span class="op">.</span><span class="fu">map</span>(loc <span class="kw">=&gt;</span> dir<span class="op">+</span> loc)</span>
<span id="cb27-562"><a href="#cb27-562" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> [<span class="op">...</span><span class="bu">Array</span>(<span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(introspection_nomemo<span class="op">.</span><span class="at">cul_scope_ids_to_resource</span>)<span class="op">.</span><span class="at">length</span>)]<span class="op">.</span><span class="fu">map</span>((_<span class="op">,</span> i) <span class="kw">=&gt;</span> entrypoint_no_cul_js <span class="co">/* this is not modelname! this should be related to entrypoit, not id */</span><span class="op">+</span>(calculang_source_nomemo<span class="op">.</span><span class="at">length</span><span class="op">?</span> <span class="st">'-nomemo'</span> <span class="op">:</span> <span class="st">''</span>) <span class="op">+</span><span class="st">'_esm/'</span><span class="op">+</span><span class="st">'cul_scope_'</span><span class="op">+</span>i<span class="op">+</span><span class="st">'.mjs'</span>)</span>
<span id="cb27-563"><a href="#cb27-563" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-564"><a href="#cb27-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-565"><a href="#cb27-565" aria-hidden="true" tabindex="-1"></a><span class="co">//cul_resources</span></span>
<span id="cb27-566"><a href="#cb27-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-567"><a href="#cb27-567" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> {</span>
<span id="cb27-568"><a href="#cb27-568" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> o <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb27-569"><a href="#cb27-569" aria-hidden="true" tabindex="-1"></a>  cul_resources<span class="op">.</span><span class="fu">forEach</span>(loc <span class="kw">=&gt;</span> {</span>
<span id="cb27-570"><a href="#cb27-570" aria-hidden="true" tabindex="-1"></a>    o<span class="op">.</span><span class="fu">push</span>(<span class="fu">fetch</span>(loc)<span class="op">.</span><span class="fu">then</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">text</span>()))</span>
<span id="cb27-571"><a href="#cb27-571" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb27-572"><a href="#cb27-572" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> o</span>
<span id="cb27-573"><a href="#cb27-573" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-574"><a href="#cb27-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-575"><a href="#cb27-575" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">TODO</span><span class="co"> replace duplicate (source) code by a message</span></span>
<span id="cb27-576"><a href="#cb27-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-577"><a href="#cb27-577" aria-hidden="true" tabindex="-1"></a>calculang <span class="op">=</span> [<span class="cf">await</span> output[<span class="dv">0</span>]<span class="op">,</span> cul_resources<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">1</span> <span class="op">?</span> <span class="cf">await</span> output[<span class="dv">1</span>] <span class="op">:</span> <span class="st">''</span></span>
<span id="cb27-578"><a href="#cb27-578" aria-hidden="true" tabindex="-1"></a><span class="op">,</span> cul_resources<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">?</span> <span class="cf">await</span> output[<span class="dv">2</span>] <span class="op">:</span> <span class="st">''</span></span>
<span id="cb27-579"><a href="#cb27-579" aria-hidden="true" tabindex="-1"></a><span class="op">,</span> cul_resources<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">3</span> <span class="op">?</span> <span class="cf">await</span> output[<span class="dv">3</span>] <span class="op">:</span> <span class="st">''</span></span>
<span id="cb27-580"><a href="#cb27-580" aria-hidden="true" tabindex="-1"></a><span class="op">,</span> cul_resources<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">4</span> <span class="op">?</span> <span class="cf">await</span> output[<span class="dv">4</span>] <span class="op">:</span> <span class="st">''</span></span>
<span id="cb27-581"><a href="#cb27-581" aria-hidden="true" tabindex="-1"></a><span class="op">,</span> cul_resources<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">5</span> <span class="op">?</span> <span class="cf">await</span> output[<span class="dv">5</span>] <span class="op">:</span> <span class="st">''</span></span>
<span id="cb27-582"><a href="#cb27-582" aria-hidden="true" tabindex="-1"></a><span class="op">,</span> cul_resources<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">6</span> <span class="op">?</span> <span class="cf">await</span> output[<span class="dv">6</span>] <span class="op">:</span> <span class="st">''</span> <span class="co">// </span><span class="al">TODO</span><span class="co"> warn when overflows</span></span>
<span id="cb27-583"><a href="#cb27-583" aria-hidden="true" tabindex="-1"></a><span class="op">,</span> cul_resources<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">7</span> <span class="op">?</span> <span class="cf">await</span> output[<span class="dv">7</span>] <span class="op">:</span> <span class="st">''</span>]<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d <span class="op">!=</span> <span class="st">''</span>)</span>
<span id="cb27-584"><a href="#cb27-584" aria-hidden="true" tabindex="-1"></a><span class="co">//calculang</span></span>
<span id="cb27-585"><a href="#cb27-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-586"><a href="#cb27-586" aria-hidden="true" tabindex="-1"></a><span class="co">// "x.cul.js formulae?"</span></span>
<span id="cb27-587"><a href="#cb27-587" aria-hidden="true" tabindex="-1"></a>fff <span class="op">=</span> calculang<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">split</span>(<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>))<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="fu">findIndex</span>(e <span class="kw">=&gt;</span> e<span class="op">.</span><span class="fu">indexOf</span>(<span class="st">'inputs:'</span> <span class="op">+</span> (options<span class="op">.</span><span class="fu">includes</span>(<span class="st">'inputs'</span>) <span class="op">?</span> <span class="st">'BLAH'</span> <span class="op">:</span> <span class="st">''</span>)) <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>) <span class="op">??</span> <span class="dv">999</span><span class="op">,</span> <span class="op">...</span>d])<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">filter</span>((e<span class="op">,</span>i) <span class="kw">=&gt;</span> i <span class="op">&lt;=</span> d[<span class="dv">0</span>] <span class="op">||</span> d[<span class="dv">0</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>))<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>))<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">join</span>(<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>))<span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span>i) <span class="kw">=&gt;</span> <span class="vs">`***[</span><span class="sc">${</span>introspection<span class="op">.</span><span class="at">cul_scope_ids_to_resource</span>[i]<span class="op">.</span><span class="fu">split</span>(<span class="st">'?'</span>)[<span class="dv">0</span>]<span class="op">.</span><span class="fu">replaceAll</span>(<span class="st">'-nomemo'</span><span class="op">,</span> <span class="st">''</span>)<span class="sc">}</span><span class="vs">](</span><span class="sc">${</span>cul_resources[i]<span class="op">.</span><span class="fu">replaceAll</span>(<span class="st">'-nomemo'</span><span class="op">,</span><span class="st">''</span>)<span class="sc">}</span><span class="vs">) </span><span class="sc">${</span>cul_js_cul <span class="op">?</span> <span class="vs">`-&gt; [js](</span><span class="sc">${</span>entrypoint_no_cul_js<span class="sc">}</span><span class="vs">_esm/cul_scope_</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">.mjs)`</span> <span class="op">:</span> <span class="vs">``</span><span class="sc">}</span><span class="vs">***</span></span>
<span id="cb27-588"><a href="#cb27-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-589"><a href="#cb27-589" aria-hidden="true" tabindex="-1"></a><span class="vs">~~~js</span></span>
<span id="cb27-590"><a href="#cb27-590" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>d<span class="op">.</span><span class="fu">replaceAll</span>(<span class="st">'export const '</span> <span class="op">+</span> (options<span class="op">.</span><span class="fu">includes</span>(<span class="st">'export consts'</span>)</span>
<span id="cb27-591"><a href="#cb27-591" aria-hidden="true" tabindex="-1"></a> <span class="op">?</span> <span class="st">'BLAH'</span> <span class="op">:</span> <span class="st">''</span>)<span class="op">,</span> <span class="st">''</span>)<span class="sc">}</span></span>
<span id="cb27-592"><a href="#cb27-592" aria-hidden="true" tabindex="-1"></a><span class="vs">~~~</span></span>
<span id="cb27-593"><a href="#cb27-593" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span>
<span id="cb27-594"><a href="#cb27-594" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-595"><a href="#cb27-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-596"><a href="#cb27-596" aria-hidden="true" tabindex="-1"></a>fff2 <span class="op">=</span> calculang<span class="op">.</span><span class="fu">filter</span>((d<span class="op">,</span>i) <span class="kw">=&gt;</span> i <span class="op">==</span> cul_scope_id)<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">split</span>(<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>))<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="fu">findIndex</span>(e <span class="kw">=&gt;</span> e<span class="op">.</span><span class="fu">indexOf</span>(<span class="st">'inputs:'</span> <span class="op">+</span> (options<span class="op">.</span><span class="fu">includes</span>(<span class="st">'inputs'</span>) <span class="op">?</span> <span class="st">'BLAH'</span> <span class="op">:</span> <span class="st">''</span>)) <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>) <span class="op">??</span> <span class="dv">999</span><span class="op">,</span> <span class="op">...</span>d])<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">filter</span>((e<span class="op">,</span>i) <span class="kw">=&gt;</span> i <span class="op">&lt;=</span> d[<span class="dv">0</span>] <span class="op">||</span> d[<span class="dv">0</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>))<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>))<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">join</span>(<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>))</span>
<span id="cb27-597"><a href="#cb27-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-598"><a href="#cb27-598" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span>i) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">replaceAll</span>(<span class="st">'export const '</span> <span class="op">+</span> (options<span class="op">.</span><span class="fu">includes</span>(<span class="st">'export consts'</span>)</span>
<span id="cb27-599"><a href="#cb27-599" aria-hidden="true" tabindex="-1"></a> <span class="op">?</span> <span class="st">'BLAH'</span> <span class="op">:</span> <span class="st">''</span>)<span class="op">,</span> <span class="st">''</span>)<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb27-600"><a href="#cb27-600" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-601"><a href="#cb27-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-602"><a href="#cb27-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-603"><a href="#cb27-603" aria-hidden="true" tabindex="-1"></a>fff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-7" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-8" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-9" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-10" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-11" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-12" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-13" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-14" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-15" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-16" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-17" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-18" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-19" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-20" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-21" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-22" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-23" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-24" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-25" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-4-26" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div id="fdsa" class="html-fill-item html-fill-container">
<p><img src="./logo4.svg" class="img-fluid" width="40"> <strong style="font-size:1.5em;">calculang model</strong></p>
<style>
  #fdsa {
    background-color: lightgreen;
    padding: 10px;
    margin-bottom:20px;
    border-radius: 0 20px 20px 20px;
    min-height: fit-content;
  }
</style>
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb28" data-startfrom="625" data-source-offset="-27"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 624;"><span id="cb28-625"><a href="#cb28-625" aria-hidden="true" tabindex="-1"></a>enabled <span class="op">=</span> [<span class="st">"raycasting2"</span><span class="op">,</span> <span class="st">"savings"</span><span class="op">,</span> <span class="st">"savings_rec"</span><span class="op">,</span> <span class="st">"starfield"</span><span class="op">,</span> <span class="st">"fizzbuzz"</span><span class="op">,</span> <span class="st">"year_remaining"</span>]</span>
<span id="cb28-626"><a href="#cb28-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-627"><a href="#cb28-627" aria-hidden="true" tabindex="-1"></a>a_thing2 <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;select style="font-size: 1.5em"&gt;</span></span>
<span id="cb28-628"><a href="#cb28-628" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>examples<span class="op">.</span><span class="fu">map</span>(category <span class="kw">=&gt;</span> <span class="vs">`&lt;optgroup label="</span><span class="sc">${</span>category<span class="op">.</span><span class="at">category</span><span class="sc">}</span><span class="vs">"&gt;</span></span>
<span id="cb28-629"><a href="#cb28-629" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>category<span class="op">.</span><span class="at">tiles</span><span class="op">.</span><span class="fu">filter</span>(tile <span class="kw">=&gt;</span> ((<span class="op">!</span>tile<span class="op">.</span><span class="at">disabled</span>) <span class="op">||</span> show_hidden))<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> enabled<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">id</span><span class="op">.</span><span class="fu">replace</span>(<span class="st">'-'</span><span class="op">,</span><span class="st">'_'</span>)))<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="vs">`&lt;option value="</span><span class="sc">${</span>d<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">"</span><span class="sc">${</span>d<span class="op">.</span><span class="at">id</span> <span class="op">==</span> default_example_id <span class="op">?</span> <span class="st">' selected="selected"'</span> <span class="op">:</span> <span class="st">''</span><span class="sc">}</span><span class="vs">}&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">title</span><span class="sc">}</span><span class="vs">&lt;/option&gt;`</span>)<span class="sc">}</span></span>
<span id="cb28-630"><a href="#cb28-630" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>category<span class="op">.</span><span class="at">tiles</span><span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span> <span class="op">==</span> default_example_id <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">disabled</span> <span class="op">&amp;&amp;</span> (<span class="op">!</span>show_hidden))<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="vs">`&lt;option value="</span><span class="sc">${</span>d<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">"</span><span class="sc">${</span>d<span class="op">.</span><span class="at">id</span> <span class="op">==</span> default_example_id <span class="op">?</span> <span class="st">' selected="selected"'</span> <span class="op">:</span> <span class="st">''</span><span class="sc">}</span><span class="vs">}&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">title</span><span class="sc">}</span><span class="vs">&lt;/option&gt;`</span>)<span class="sc">}</span></span>
<span id="cb28-631"><a href="#cb28-631" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/optgroup&gt;</span></span>
<span id="cb28-632"><a href="#cb28-632" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="sc">}</span><span class="vs">&lt;/select&gt;`</span></span>
<span id="cb28-633"><a href="#cb28-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-634"><a href="#cb28-634" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>example_details<span class="op">.</span><span class="at">modular</span> <span class="op">?</span> <span class="st">'♻️'</span> <span class="op">:</span> <span class="st">''</span><span class="sc">}</span><span class="vs"> *</span><span class="sc">${</span>example_details<span class="op">.</span><span class="at">subtitle</span><span class="sc">}</span><span class="vs">*`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-5-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-5-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-5-3" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb29" data-startfrom="636" data-source-offset="-789"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 635;"><span id="cb29-636"><a href="#cb29-636" aria-hidden="true" tabindex="-1"></a>viewof cul_scope_id <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span><span class="dv">15</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">'cul scope id'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span><span class="dv">1</span>})</span>
<span id="cb29-637"><a href="#cb29-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-638"><a href="#cb29-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-639"><a href="#cb29-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-640"><a href="#cb29-640" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb29-641"><a href="#cb29-641" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> o <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb29-642"><a href="#cb29-642" aria-hidden="true" tabindex="-1"></a>  show<span class="op">.</span><span class="fu">forEach</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb29-643"><a href="#cb29-643" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (mini_binds[d])</span>
<span id="cb29-644"><a href="#cb29-644" aria-hidden="true" tabindex="-1"></a>    o[d] <span class="op">=</span> mini_binds[d]</span>
<span id="cb29-645"><a href="#cb29-645" aria-hidden="true" tabindex="-1"></a>    <span class="co">//else o[d] = md`${d}`</span></span>
<span id="cb29-646"><a href="#cb29-646" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb29-647"><a href="#cb29-647" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">form</span>(o<span class="op">,</span> {<span class="dt">template</span><span class="op">:</span> els <span class="kw">=&gt;</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;div class="styled"&gt;</span><span class="sc">${</span><span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(els)<span class="sc">}</span><span class="vs">&lt;/div&gt;&lt;style&gt;</span></span>
<span id="cb29-648"><a href="#cb29-648" aria-hidden="true" tabindex="-1"></a><span class="vs">  div.styled {</span></span>
<span id="cb29-649"><a href="#cb29-649" aria-hidden="true" tabindex="-1"></a><span class="vs">    text-align: left;</span></span>
<span id="cb29-650"><a href="#cb29-650" aria-hidden="true" tabindex="-1"></a><span class="vs">    /*column-count: 2;*/</span></span>
<span id="cb29-651"><a href="#cb29-651" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb29-652"><a href="#cb29-652" aria-hidden="true" tabindex="-1"></a><span class="vs">  div.styled span {</span></span>
<span id="cb29-653"><a href="#cb29-653" aria-hidden="true" tabindex="-1"></a><span class="vs">    margin-right: 20px;</span></span>
<span id="cb29-654"><a href="#cb29-654" aria-hidden="true" tabindex="-1"></a><span class="vs">    /*font-size:0.7em;*/</span></span>
<span id="cb29-655"><a href="#cb29-655" aria-hidden="true" tabindex="-1"></a><span class="vs">    /*font-weight: bold;*/</span></span>
<span id="cb29-656"><a href="#cb29-656" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb29-657"><a href="#cb29-657" aria-hidden="true" tabindex="-1"></a><span class="vs">  div.styled span {</span></span>
<span id="cb29-658"><a href="#cb29-658" aria-hidden="true" tabindex="-1"></a><span class="vs">    width:70px;</span></span>
<span id="cb29-659"><a href="#cb29-659" aria-hidden="true" tabindex="-1"></a><span class="vs">    /*font-weight: bold;*/</span></span>
<span id="cb29-660"><a href="#cb29-660" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb29-661"><a href="#cb29-661" aria-hidden="true" tabindex="-1"></a><span class="vs">  div.styled label:not(div&gt;label):after {</span></span>
<span id="cb29-662"><a href="#cb29-662" aria-hidden="true" tabindex="-1"></a><span class="vs">    //content: ":";</span></span>
<span id="cb29-663"><a href="#cb29-663" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb29-664"><a href="#cb29-664" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/style&gt;`</span>}) <span class="co">// https://observablehq.com/@martien/horizontal-inputs</span></span>
<span id="cb29-665"><a href="#cb29-665" aria-hidden="true" tabindex="-1"></a><span class="co">// still not reliable, do set implementation?</span></span>
<span id="cb29-666"><a href="#cb29-666" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-5-4" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-5-5" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
<!-- details here is nice to collapse the editor, but alters layout when open -->
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb30" data-startfrom="676" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 675;"><span id="cb30-676"><a href="#cb30-676" aria-hidden="true" tabindex="-1"></a>show <span class="op">=</span> _<span class="op">.</span><span class="fu">uniq</span>(<span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(calculang_source_introspection<span class="op">.</span><span class="at">cul_functions</span>)<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">reason</span> <span class="op">==</span> <span class="st">'input definition'</span>)<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">name</span>)<span class="op">.</span><span class="fu">sort</span>())<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> formula_line_details_0<span class="op">.</span><span class="fu">filter</span>(e <span class="kw">=&gt;</span> e<span class="op">.</span><span class="at">name</span> <span class="op">+</span> <span class="st">'_in'</span> <span class="op">==</span> d <span class="op">&amp;&amp;</span> (e<span class="op">.</span><span class="at">overwritten</span> <span class="op">==</span> <span class="kw">undefined</span> <span class="op">||</span> e<span class="op">.</span><span class="at">overwritten</span> <span class="op">==</span> <span class="kw">false</span>))<span class="op">.</span><span class="at">length</span>)</span>
<span id="cb30-677"><a href="#cb30-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-678"><a href="#cb30-678" aria-hidden="true" tabindex="-1"></a>st <span class="op">=</span> {</span>
<span id="cb30-679"><a href="#cb30-679" aria-hidden="true" tabindex="-1"></a>  entrypoint_no_cul_js<span class="op">;</span></span>
<span id="cb30-680"><a href="#cb30-680" aria-hidden="true" tabindex="-1"></a>  <span class="co">// I cannot fetch !!!</span></span>
<span id="cb30-681"><a href="#cb30-681" aria-hidden="true" tabindex="-1"></a>  <span class="co">//fetch(`${entrypoint_no_cul_js}${1 ? '-nomemo' : ''}.introspection.json`);</span></span>
<span id="cb30-682"><a href="#cb30-682" aria-hidden="true" tabindex="-1"></a>  <span class="co">//await introspection_nomemo; // I can depend on modelname but NOT inputs or introspection !</span></span>
<span id="cb30-683"><a href="#cb30-683" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [<span class="st">'year_in'</span><span class="op">,</span> <span class="st">'duration_in'</span><span class="op">,</span> <span class="st">'f_in'</span>] <span class="co">// "annual_payment_in", "duration_in", "interest_rate_in", "year_in"</span></span>
<span id="cb30-684"><a href="#cb30-684" aria-hidden="true" tabindex="-1"></a>  <span class="co">// not working</span></span>
<span id="cb30-685"><a href="#cb30-685" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-686"><a href="#cb30-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-687"><a href="#cb30-687" aria-hidden="true" tabindex="-1"></a><span class="co">//fff2.join('\n\n')</span></span>
<span id="cb30-688"><a href="#cb30-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-689"><a href="#cb30-689" aria-hidden="true" tabindex="-1"></a><span class="co">/*mjs_q_eval</span></span>
<span id="cb30-690"><a href="#cb30-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-691"><a href="#cb30-691" aria-hidden="true" tabindex="-1"></a><span class="co">aa</span></span>
<span id="cb30-692"><a href="#cb30-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-693"><a href="#cb30-693" aria-hidden="true" tabindex="-1"></a><span class="co">model*/</span></span>
<span id="cb30-694"><a href="#cb30-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-695"><a href="#cb30-695" aria-hidden="true" tabindex="-1"></a>viewof editor <span class="op">=</span> <span class="fu">CodeMirror</span>(</span>
<span id="cb30-696"><a href="#cb30-696" aria-hidden="true" tabindex="-1"></a>  <span class="co">// This needs to be entrypoint scopeid?</span></span>
<span id="cb30-697"><a href="#cb30-697" aria-hidden="true" tabindex="-1"></a>  fff2<span class="op">.</span><span class="fu">join</span>(<span class="st">'</span><span class="sc">\n\n</span><span class="st">'</span>)<span class="op">,</span></span>
<span id="cb30-698"><a href="#cb30-698" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb30-699"><a href="#cb30-699" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extensions</span><span class="op">:</span> [ <span class="co">// wrap indicators would be nice</span></span>
<span id="cb30-700"><a href="#cb30-700" aria-hidden="true" tabindex="-1"></a>      <span class="co">// myDefaultTheme, // </span><span class="al">TODO</span><span class="co"> bring this in, + dark version</span></span>
<span id="cb30-701"><a href="#cb30-701" aria-hidden="true" tabindex="-1"></a>      cmImports[<span class="st">"lang-javascript"</span>]<span class="op">.</span><span class="fu">javascript</span>()<span class="op">,</span></span>
<span id="cb30-702"><a href="#cb30-702" aria-hidden="true" tabindex="-1"></a>      <span class="co">//cmImports["language"].foldGutter(),</span></span>
<span id="cb30-703"><a href="#cb30-703" aria-hidden="true" tabindex="-1"></a>      <span class="co">//EditorView.decorations.of(Decoration.set(yellow.range(r)))</span></span>
<span id="cb30-704"><a href="#cb30-704" aria-hidden="true" tabindex="-1"></a>      <span class="co">/* BUILDING cmCheckboxPluginViewof, // does cul code annotation and navigation, depending on showStripes</span></span>
<span id="cb30-705"><a href="#cb30-705" aria-hidden="true" tabindex="-1"></a><span class="co">      cmOverlayPluginViewof,*/</span></span>
<span id="cb30-706"><a href="#cb30-706" aria-hidden="true" tabindex="-1"></a>      overlay <span class="op">?</span> overlay_answers <span class="op">:</span> EditorState<span class="op">.</span><span class="at">readOnly</span><span class="op">.</span><span class="fu">of</span>(readonly)<span class="op">,</span></span>
<span id="cb30-707"><a href="#cb30-707" aria-hidden="true" tabindex="-1"></a>      overlay <span class="op">?</span> overlay_workings <span class="op">:</span> EditorState<span class="op">.</span><span class="at">readOnly</span><span class="op">.</span><span class="fu">of</span>(readonly)<span class="op">,</span></span>
<span id="cb30-708"><a href="#cb30-708" aria-hidden="true" tabindex="-1"></a>      <span class="fu">formulaDecorations</span>({<span class="dt">formulae_visible</span><span class="op">:</span> viewof formulae_visible})<span class="op">,</span> <span class="co">// https://codemirror.net/examples/zebra/</span></span>
<span id="cb30-709"><a href="#cb30-709" aria-hidden="true" tabindex="-1"></a>      <span class="co">/* </span><span class="al">TODO</span><span class="co"> don't process Import/Exports for now */</span> <span class="fu">calculang_identifier_decorations</span>({<span class="dt">formulae_visible</span><span class="op">:</span> viewof formulae_visible})<span class="op">,</span></span>
<span id="cb30-710"><a href="#cb30-710" aria-hidden="true" tabindex="-1"></a>      EditorView<span class="op">.</span><span class="at">lineWrapping</span><span class="op">,</span></span>
<span id="cb30-711"><a href="#cb30-711" aria-hidden="true" tabindex="-1"></a>      EditorView<span class="op">.</span><span class="at">editable</span><span class="op">.</span><span class="fu">of</span>(readonly)<span class="op">,</span></span>
<span id="cb30-712"><a href="#cb30-712" aria-hidden="true" tabindex="-1"></a>      EditorState<span class="op">.</span><span class="at">readOnly</span><span class="op">.</span><span class="fu">of</span>(readonly)</span>
<span id="cb30-713"><a href="#cb30-713" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb30-714"><a href="#cb30-714" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-715"><a href="#cb30-715" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-6-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-6-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-6-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<div class="cell hidden html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb31" data-startfrom="725" data-source-offset="-81"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 724;"><span id="cb31-725"><a href="#cb31-725" aria-hidden="true" tabindex="-1"></a>interest_rate_expected <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="dv">0</span> <span class="co">// still needed, </span><span class="al">TODO</span><span class="co"> fix!</span></span>
<span id="cb31-726"><a href="#cb31-726" aria-hidden="true" tabindex="-1"></a><span class="co">//interest_rate_expected = () =&gt; 0</span></span>
<span id="cb31-727"><a href="#cb31-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-728"><a href="#cb31-728" aria-hidden="true" tabindex="-1"></a><span class="co">///// COPY EVALS</span></span>
<span id="cb31-729"><a href="#cb31-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-730"><a href="#cb31-730" aria-hidden="true" tabindex="-1"></a>mjs_q_eval <span class="op">=</span>  { <span class="cf">return</span> ({<span class="st">"savings"</span><span class="op">:</span>[[{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"deposits"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">deposits</span>({ year_in<span class="op">,</span> duration_in<span class="op">,</span> annual_payment_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"balance"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">balance</span>({ duration_in<span class="op">,</span> annual_payment_in<span class="op">,</span> interest_rate_in<span class="op">,</span> <span class="dt">year_in</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">year</span>({ year_in }) <span class="op">-</span> <span class="dv">1</span> })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof year_in<span class="op">,</span> savings<span class="op">.</span><span class="fu">year</span>({ year_in }) <span class="op">-</span> <span class="dv">1</span>)}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"deposits"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">deposits</span>({ year_in<span class="op">,</span> duration_in<span class="op">,</span> annual_payment_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"interest"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">interest</span>({ year_in<span class="op">,</span> duration_in<span class="op">,</span> annual_payment_in<span class="op">,</span> interest_rate_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"duration"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">duration</span>({ duration_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"annual_payment"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">annual_payment</span>({ annual_payment_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"balance"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">balance</span>({ duration_in<span class="op">,</span> annual_payment_in<span class="op">,</span> interest_rate_in<span class="op">,</span> <span class="dt">year_in</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">year</span>({ year_in }) <span class="op">-</span> <span class="dv">1</span> })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof year_in<span class="op">,</span> savings<span class="op">.</span><span class="fu">year</span>({ year_in }) <span class="op">-</span> <span class="dv">1</span>)}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"interest_rate"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">interest_rate</span>({ interest_rate_in })}]]<span class="op">,</span><span class="st">"savings_rec"</span><span class="op">:</span>[[{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"actual_interest_rate_co"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">actual_interest_rate_co</span>({ actual_interest_rate_co_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"interest_rate_expected"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span><span class="fu">interest_rate_expected</span>({})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"actual_interest_rates"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">actual_interest_rates</span>({})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">year</span>({ year_in })}]<span class="op">,</span>[]<span class="op">,</span>[{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"deposits"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">deposits</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"balance"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">balance</span>({ actual_interest_rate_co_in<span class="op">,</span> <span class="dt">year_in</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">year</span>({ year_in }) <span class="op">-</span> <span class="dv">1</span> })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof year_in<span class="op">,</span> savings_rec<span class="op">.</span><span class="fu">year</span>({ year_in }) <span class="op">-</span> <span class="dv">1</span>)}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"deposits"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">deposits</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"interest"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">interest</span>({ year_in<span class="op">,</span> actual_interest_rate_co_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"duration"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">duration</span>({})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"annual_payment"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">annual_payment</span>({})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"balance"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">balance</span>({ actual_interest_rate_co_in<span class="op">,</span> <span class="dt">year_in</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">year</span>({ year_in }) <span class="op">-</span> <span class="dv">1</span> })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof year_in<span class="op">,</span> savings_rec<span class="op">.</span><span class="fu">year</span>({ year_in }) <span class="op">-</span> <span class="dv">1</span>)}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">year</span>({ year_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"interest_rate"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">interest_rate</span>({ year_in<span class="op">,</span> actual_interest_rate_co_in })}]]<span class="op">,</span><span class="st">"starfield"</span><span class="op">:</span>[[{<span class="dt">name</span><span class="op">:</span> <span class="st">"random_seed"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">random_seed</span>({ random_seed_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"seeded"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">seeded</span>({ <span class="dt">random_seed_in</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">random_seed</span>({ random_seed_in }) })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof random_seed_in<span class="op">,</span> starfield<span class="op">.</span><span class="fu">random_seed</span>({ random_seed_in }))}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"random_seed"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">random_seed</span>({ random_seed_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"random"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">random</span>({ random_seed_in<span class="op">,</span> <span class="dt">star_in</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">star</span>({ star_in })<span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"x"</span> })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof star_in<span class="op">,</span> starfield<span class="op">.</span><span class="fu">star</span>({ star_in }))}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"star"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">star</span>({ star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"random"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">random</span>({ random_seed_in<span class="op">,</span> <span class="dt">star_in</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">star</span>({ star_in })<span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"y"</span> })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof star_in<span class="op">,</span> starfield<span class="op">.</span><span class="fu">star</span>({ star_in }))}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"star"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">star</span>({ star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"random"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">random</span>({ random_seed_in<span class="op">,</span> <span class="dt">star_in</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">star</span>({ star_in })<span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"z"</span> })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof star_in<span class="op">,</span> starfield<span class="op">.</span><span class="fu">star</span>({ star_in }))}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"star"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">star</span>({ star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"frame"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"z0"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">z0</span>({ random_seed_in<span class="op">,</span> star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"z"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">z</span>({ random_seed_in<span class="op">,</span> star_in<span class="op">,</span> speed_in<span class="op">,</span> <span class="dt">frame_in</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in }) <span class="op">-</span> <span class="dv">1</span> })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof frame_in<span class="op">,</span> starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in }) <span class="op">-</span> <span class="dv">1</span>)}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"frame"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"speed"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">speed</span>({ speed_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"z"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">z</span>({ random_seed_in<span class="op">,</span> star_in<span class="op">,</span> speed_in<span class="op">,</span> <span class="dt">frame_in</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in }) <span class="op">-</span> <span class="dv">1</span> })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof frame_in<span class="op">,</span> starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in }) <span class="op">-</span> <span class="dv">1</span>)}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"frame"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"speed"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">speed</span>({ speed_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"z"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">z</span>({ frame_in<span class="op">,</span> random_seed_in<span class="op">,</span> star_in<span class="op">,</span> speed_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"frame"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"x0"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">x0</span>({ random_seed_in<span class="op">,</span> star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"visible"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">visible</span>({ random_seed_in<span class="op">,</span> star_in<span class="op">,</span> speed_in<span class="op">,</span> <span class="dt">frame_in</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in }) <span class="op">-</span> <span class="dv">1</span> })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof frame_in<span class="op">,</span> starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in }) <span class="op">-</span> <span class="dv">1</span>)}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"frame"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"x0"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">x0</span>({ random_seed_in<span class="op">,</span> star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"x0"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">x0</span>({ random_seed_in<span class="op">,</span> star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"z"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">z</span>({ frame_in<span class="op">,</span> random_seed_in<span class="op">,</span> star_in<span class="op">,</span> speed_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"frame"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"y0"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">y0</span>({ random_seed_in<span class="op">,</span> star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"visible"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">visible</span>({ random_seed_in<span class="op">,</span> star_in<span class="op">,</span> speed_in<span class="op">,</span> <span class="dt">frame_in</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in }) <span class="op">-</span> <span class="dv">1</span> })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof frame_in<span class="op">,</span> starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in }) <span class="op">-</span> <span class="dv">1</span>)}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"frame"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"y0"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">y0</span>({ random_seed_in<span class="op">,</span> star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"y0"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">y0</span>({ random_seed_in<span class="op">,</span> star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"z"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">z</span>({ frame_in<span class="op">,</span> random_seed_in<span class="op">,</span> star_in<span class="op">,</span> speed_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">x</span>({ frame_in<span class="op">,</span> random_seed_in<span class="op">,</span> star_in<span class="op">,</span> speed_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"x0"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">x0</span>({ random_seed_in<span class="op">,</span> star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"x0"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">x0</span>({ random_seed_in<span class="op">,</span> star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">x</span>({ random_seed_in<span class="op">,</span> star_in<span class="op">,</span> speed_in<span class="op">,</span> <span class="dt">frame_in</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in }) <span class="op">-</span> <span class="dv">1</span> })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof frame_in<span class="op">,</span> starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in }) <span class="op">-</span> <span class="dv">1</span>)}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"frame"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">y</span>({ frame_in<span class="op">,</span> random_seed_in<span class="op">,</span> star_in<span class="op">,</span> speed_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"y0"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">y0</span>({ random_seed_in<span class="op">,</span> star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"y0"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">y0</span>({ random_seed_in<span class="op">,</span> star_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">y</span>({ random_seed_in<span class="op">,</span> star_in<span class="op">,</span> speed_in<span class="op">,</span> <span class="dt">frame_in</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in }) <span class="op">-</span> <span class="dv">1</span> })<span class="op">,</span> <span class="dt">handler</span><span class="op">:</span> () <span class="kw">=&gt;</span> {<span class="kw">set</span>(viewof frame_in<span class="op">,</span> starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in }) <span class="op">-</span> <span class="dv">1</span>)}}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"frame"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({ frame_in })}]]<span class="op">,</span><span class="st">"fizzbuzz"</span><span class="op">:</span>[[{<span class="dt">name</span><span class="op">:</span> <span class="st">"i"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>fizzbuzz<span class="op">.</span><span class="fu">i</span>({ i_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"i"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>fizzbuzz<span class="op">.</span><span class="fu">i</span>({ i_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"fizz"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>fizzbuzz<span class="op">.</span><span class="fu">fizz</span>({ i_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"buzz"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>fizzbuzz<span class="op">.</span><span class="fu">buzz</span>({ i_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"fizz"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>fizzbuzz<span class="op">.</span><span class="fu">fizz</span>({ i_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"buzz"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>fizzbuzz<span class="op">.</span><span class="fu">buzz</span>({ i_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"i"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>fizzbuzz<span class="op">.</span><span class="fu">i</span>({ i_in })}]]<span class="op">,</span><span class="st">"year_remaining"</span><span class="op">:</span>[[{<span class="dt">name</span><span class="op">:</span> <span class="st">"date"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">date</span>({ date_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">year</span>({ date_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"isLeap"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">isLeap</span>({ date_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"date"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">date</span>({ date_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"date"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">date</span>({ date_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"date"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">date</span>({ date_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"date"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">date</span>({ date_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"daysIntoYearStartTomorrow"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">daysIntoYearStartTomorrow</span>({ date_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"timing"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">timing</span>({ timing_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"daysIntoYearStartToday"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">daysIntoYearStartToday</span>({ date_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"daysIntoYearStartTomorrow"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">daysIntoYearStartTomorrow</span>({ date_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"daysIntoYear"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">daysIntoYear</span>({ timing_in<span class="op">,</span> date_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"daysInYear"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">daysInYear</span>({ date_in })}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span> <span class="st">"fractionIntoYear"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">fractionIntoYear</span>({ timing_in<span class="op">,</span> date_in })}]]}</span>
<span id="cb31-731"><a href="#cb31-731" aria-hidden="true" tabindex="-1"></a>)}</span>
<span id="cb31-732"><a href="#cb31-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-733"><a href="#cb31-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-734"><a href="#cb31-734" aria-hidden="true" tabindex="-1"></a>fns_with_mjs_q_eval <span class="op">=</span>{ <span class="cf">return</span> (</span>
<span id="cb31-735"><a href="#cb31-735" aria-hidden="true" tabindex="-1"></a>{<span class="st">"savings"</span><span class="op">:</span>[[{<span class="dt">name</span><span class="op">:</span><span class="st">"balance"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">balance</span>({year_in<span class="op">,</span>duration_in<span class="op">,</span>annual_payment_in<span class="op">,</span>interest_rate_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"deposits"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">deposits</span>({year_in<span class="op">,</span>duration_in<span class="op">,</span>annual_payment_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"interest"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">interest</span>({year_in<span class="op">,</span>duration_in<span class="op">,</span>annual_payment_in<span class="op">,</span>interest_rate_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"year"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">year</span>({year_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"annual_payment"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">annual_payment</span>({annual_payment_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"duration"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">duration</span>({duration_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"interest_rate"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings<span class="op">.</span><span class="fu">interest_rate</span>({interest_rate_in})}]]<span class="op">,</span><span class="st">"savings_rec"</span><span class="op">:</span>[[{<span class="dt">name</span><span class="op">:</span><span class="st">"year"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">year</span>({year_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"actual_interest_rates"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">actual_interest_rates</span>({})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"actual_interest_rate_co"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">actual_interest_rate_co</span>({actual_interest_rate_co_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"interest_rate"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">interest_rate</span>({year_in<span class="op">,</span>actual_interest_rate_co_in})}]<span class="op">,</span>[{<span class="dt">name</span><span class="op">:</span><span class="st">"annual_payment"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">annual_payment</span>({})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"duration"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">duration</span>({})}]<span class="op">,</span>[{<span class="dt">name</span><span class="op">:</span><span class="st">"balance"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">balance</span>({year_in<span class="op">,</span>actual_interest_rate_co_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"deposits"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">deposits</span>({year_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"interest"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>savings_rec<span class="op">.</span><span class="fu">interest</span>({year_in<span class="op">,</span>actual_interest_rate_co_in})}]]<span class="op">,</span><span class="st">"starfield"</span><span class="op">:</span>[[{<span class="dt">name</span><span class="op">:</span><span class="st">"random_seed"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">random_seed</span>({random_seed_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"seeded"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">seeded</span>({random_seed_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"random"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">random</span>({random_seed_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"frame"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">frame</span>({frame_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"star"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">star</span>({star_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"star_life"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">star_life</span>({})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"x0"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">x0</span>({random_seed_in<span class="op">,</span>star_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"y0"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">y0</span>({random_seed_in<span class="op">,</span>star_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"z0"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">z0</span>({random_seed_in<span class="op">,</span>star_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"speed"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">speed</span>({speed_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"z"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">z</span>({frame_in<span class="op">,</span>random_seed_in<span class="op">,</span>star_in<span class="op">,</span>speed_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"visible"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">visible</span>({frame_in<span class="op">,</span>random_seed_in<span class="op">,</span>star_in<span class="op">,</span>speed_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"x"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">x</span>({frame_in<span class="op">,</span>random_seed_in<span class="op">,</span>star_in<span class="op">,</span>speed_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"y"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">y</span>({frame_in<span class="op">,</span>random_seed_in<span class="op">,</span>star_in<span class="op">,</span>speed_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"px"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">px</span>({frame_in<span class="op">,</span>random_seed_in<span class="op">,</span>star_in<span class="op">,</span>speed_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"py"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>starfield<span class="op">.</span><span class="fu">py</span>({frame_in<span class="op">,</span>random_seed_in<span class="op">,</span>star_in<span class="op">,</span>speed_in})}]]<span class="op">,</span><span class="st">"fizzbuzz"</span><span class="op">:</span>[[{<span class="dt">name</span><span class="op">:</span><span class="st">"fizz"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>fizzbuzz<span class="op">.</span><span class="fu">fizz</span>({i_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"buzz"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>fizzbuzz<span class="op">.</span><span class="fu">buzz</span>({i_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"fizzbuzz"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>fizzbuzz<span class="op">.</span><span class="fu">fizzbuzz</span>({i_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"i"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>fizzbuzz<span class="op">.</span><span class="fu">i</span>({i_in})}]]<span class="op">,</span><span class="st">"year_remaining"</span><span class="op">:</span>[[{<span class="dt">name</span><span class="op">:</span><span class="st">"date"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">date</span>({date_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"year"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">year</span>({date_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"isLeap"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">isLeap</span>({date_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"daysInYear"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">daysInYear</span>({date_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"daysIntoYearStartTomorrow"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">daysIntoYearStartTomorrow</span>({date_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"daysIntoYearStartToday"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">daysIntoYearStartToday</span>({date_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"daysIntoYear"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">daysIntoYear</span>({timing_in<span class="op">,</span>date_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"fractionIntoYear"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">fractionIntoYear</span>({timing_in<span class="op">,</span>date_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"fractionLeftInYear"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">fractionLeftInYear</span>({timing_in<span class="op">,</span>date_in})}<span class="op">,</span>{<span class="dt">name</span><span class="op">:</span><span class="st">"timing"</span><span class="op">,</span><span class="dt">value</span><span class="op">:</span>year_remaining<span class="op">.</span><span class="fu">timing</span>({timing_in})}]]}</span>
<span id="cb31-736"><a href="#cb31-736" aria-hidden="true" tabindex="-1"></a>)}</span>
<span id="cb31-737"><a href="#cb31-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-738"><a href="#cb31-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-739"><a href="#cb31-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-740"><a href="#cb31-740" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb31-741"><a href="#cb31-741" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb31-742"><a href="#cb31-742" aria-hidden="true" tabindex="-1"></a> <span class="bu">window</span><span class="op">.</span><span class="at">fns_with_mjs_q_eval</span> <span class="op">=</span> fns_with_mjs_q_eval</span>
<span id="cb31-743"><a href="#cb31-743" aria-hidden="true" tabindex="-1"></a> <span class="bu">window</span><span class="op">.</span><span class="at">mjs_q_eval</span> <span class="op">=</span> mjs_q_eval</span>
<span id="cb31-744"><a href="#cb31-744" aria-hidden="true" tabindex="-1"></a> <span class="co">// trigger an update animation here, but is that good without checking if individual numbers changed ?</span></span>
<span id="cb31-745"><a href="#cb31-745" aria-hidden="true" tabindex="-1"></a> <span class="co">// setup a history?</span></span>
<span id="cb31-746"><a href="#cb31-746" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-4" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb32" data-startfrom="750" data-source-offset="-11574"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 749;"><span id="cb32-750"><a href="#cb32-750" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb32-751"><a href="#cb32-751" aria-hidden="true" tabindex="-1"></a>  <span class="co">// can I make this run on editor scroll? or make CM generate full dom?</span></span>
<span id="cb32-752"><a href="#cb32-752" aria-hidden="true" tabindex="-1"></a>      <span class="co">//document.getElementById('a-'+32).textContent = fmt(fns_with_mjs_q_eval[32]);</span></span>
<span id="cb32-753"><a href="#cb32-753" aria-hidden="true" tabindex="-1"></a><span class="co">// Seems like these cells stop if there is a single error,</span></span>
<span id="cb32-754"><a href="#cb32-754" aria-hidden="true" tabindex="-1"></a><span class="co">// like modifying an element that isn't yet created</span></span>
<span id="cb32-755"><a href="#cb32-755" aria-hidden="true" tabindex="-1"></a><span class="co">// Quarto/OJS gives no error!</span></span>
<span id="cb32-756"><a href="#cb32-756" aria-hidden="true" tabindex="-1"></a><span class="co">// maybe due to output: false? DANGEROUS</span></span>
<span id="cb32-757"><a href="#cb32-757" aria-hidden="true" tabindex="-1"></a><span class="co">//console.log('UPDATE')</span></span>
<span id="cb32-758"><a href="#cb32-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-759"><a href="#cb32-759" aria-hidden="true" tabindex="-1"></a>  fns_with_mjs_q_eval[modelname][cul_scope_id]<span class="op">.</span><span class="fu">forEach</span>((v<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb32-760"><a href="#cb32-760" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> d <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'a-'</span><span class="op">+</span>i)</span>
<span id="cb32-761"><a href="#cb32-761" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (d)</span>
<span id="cb32-762"><a href="#cb32-762" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="fu">fmt2</span>(v<span class="op">.</span><span class="at">name</span><span class="op">,</span> v<span class="op">.</span><span class="at">value</span>)<span class="co">//fmt(v);</span></span>
<span id="cb32-763"><a href="#cb32-763" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb32-764"><a href="#cb32-764" aria-hidden="true" tabindex="-1"></a>  mjs_q_eval[modelname][cul_scope_id]<span class="op">.</span><span class="fu">forEach</span>(({name<span class="op">,</span> value}<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb32-765"><a href="#cb32-765" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> d <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'w-'</span><span class="op">+</span>i)</span>
<span id="cb32-766"><a href="#cb32-766" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (d)    <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'w-'</span><span class="op">+</span>i)<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="fu">fmt2</span>(name<span class="op">,</span> value)<span class="op">;</span> <span class="co">// does this get used? on update?</span></span>
<span id="cb32-767"><a href="#cb32-767" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb32-768"><a href="#cb32-768" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-5" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb33" data-startfrom="771" data-source-offset="-12411"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 770;"><span id="cb33-771"><a href="#cb33-771" aria-hidden="true" tabindex="-1"></a>fmt2 <span class="op">=</span> (name<span class="op">,</span> value) <span class="kw">=&gt;</span> {</span>
<span id="cb33-772"><a href="#cb33-772" aria-hidden="true" tabindex="-1"></a>  name <span class="op">=</span> name<span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">;</span></span>
<span id="cb33-773"><a href="#cb33-773" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (name<span class="op">.</span><span class="fu">includes</span>(<span class="st">"_co"</span>)) <span class="cf">return</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",.0f"</span>)(value)</span>
<span id="cb33-774"><a href="#cb33-774" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (name<span class="op">.</span><span class="fu">includes</span>(<span class="st">"rate"</span>) <span class="op">||</span> name<span class="op">.</span><span class="fu">includes</span>(<span class="st">"percent"</span>) <span class="op">||</span> name<span class="op">.</span><span class="fu">includes</span>(<span class="st">"fraction"</span>)) <span class="cf">return</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".2%"</span>)(value)</span>
<span id="cb33-775"><a href="#cb33-775" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((name<span class="op">.</span><span class="fu">includes</span>(<span class="st">"year"</span>)) <span class="op">||</span> name<span class="op">.</span><span class="fu">includes</span>(<span class="st">"term"</span>) <span class="op">||</span> name<span class="op">.</span><span class="fu">includes</span>(<span class="st">"duration"</span>) <span class="op">||</span> name<span class="op">.</span><span class="fu">includes</span>(<span class="st">"frame"</span>)) <span class="cf">return</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",.0f"</span>)(value)</span>
<span id="cb33-776"><a href="#cb33-776" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (name<span class="op">.</span><span class="fu">includes</span>(<span class="st">"object"</span>) <span class="op">||</span> <span class="kw">typeof</span> value <span class="op">!=</span> <span class="st">'number'</span>) <span class="cf">return</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(value)</span>
<span id="cb33-777"><a href="#cb33-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-778"><a href="#cb33-778" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",.2f"</span>)(value)</span>
<span id="cb33-779"><a href="#cb33-779" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-780"><a href="#cb33-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-781"><a href="#cb33-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-782"><a href="#cb33-782" aria-hidden="true" tabindex="-1"></a><span class="co">////</span></span>
<span id="cb33-783"><a href="#cb33-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-784"><a href="#cb33-784" aria-hidden="true" tabindex="-1"></a><span class="co">// how to call a function</span></span>
<span id="cb33-785"><a href="#cb33-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-786"><a href="#cb33-786" aria-hidden="true" tabindex="-1"></a>fns_with_mjs <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(calculang_source_introspection<span class="op">.</span><span class="at">cul_functions</span>)</span>
<span id="cb33-787"><a href="#cb33-787" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb33-788"><a href="#cb33-788" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span></span>
<span id="cb33-789"><a href="#cb33-789" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">reason</span> <span class="op">==</span> <span class="st">"definition"</span> <span class="co">/*input definition doesn't have a loc*/</span> <span class="op">&amp;&amp;</span></span>
<span id="cb33-790"><a href="#cb33-790" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">cul_scope_id</span> <span class="op">==</span> cul_scope_id</span>
<span id="cb33-791"><a href="#cb33-791" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-792"><a href="#cb33-792" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d<span class="op">,</span> <span class="dt">mjs</span><span class="op">:</span> <span class="vs">`{</span><span class="sc">${</span>d<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="fu">join</span>(<span class="st">","</span>)<span class="sc">}</span><span class="vs">}`</span> })) <span class="co">// assuming completely on one line</span></span>
<span id="cb33-793"><a href="#cb33-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-794"><a href="#cb33-794" aria-hidden="true" tabindex="-1"></a><span class="co">// ex- calls_with_mjs, relates to that in generator</span></span>
<span id="cb33-795"><a href="#cb33-795" aria-hidden="true" tabindex="-1"></a>calls <span class="op">=</span> calculang_source_introspection<span class="op">.</span><span class="at">cul_links</span></span>
<span id="cb33-796"><a href="#cb33-796" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> <span class="op">!</span>d<span class="op">.</span><span class="at">from</span><span class="op">.</span><span class="fu">includes</span>(<span class="st">'undefined'</span>))<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">reason</span> <span class="op">==</span> <span class="st">"call"</span> <span class="op">&amp;&amp;</span> cul_scope_id <span class="op">==</span> <span class="op">+</span>d<span class="op">.</span><span class="at">to</span><span class="op">.</span><span class="fu">split</span>(<span class="st">"_"</span>)[<span class="dv">0</span>]) <span class="co">// bugs for double digit scopes</span></span>
<span id="cb33-797"><a href="#cb33-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-798"><a href="#cb33-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-799"><a href="#cb33-799" aria-hidden="true" tabindex="-1"></a><span class="co">// ex CheckboxWidget</span></span>
<span id="cb33-800"><a href="#cb33-800" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AnswersWorkingsOverlayWidget <span class="kw">extends</span> cmImports<span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="at">WidgetType</span> {</span>
<span id="cb33-801"><a href="#cb33-801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(v<span class="op">,</span> call<span class="op">,</span> call_i<span class="op">,</span> type) {</span>
<span id="cb33-802"><a href="#cb33-802" aria-hidden="true" tabindex="-1"></a>    <span class="co">//a = v;</span></span>
<span id="cb33-803"><a href="#cb33-803" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>()<span class="op">;</span></span>
<span id="cb33-804"><a href="#cb33-804" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">v</span> <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb33-805"><a href="#cb33-805" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">call</span> <span class="op">=</span> call<span class="op">;</span></span>
<span id="cb33-806"><a href="#cb33-806" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">call_i</span> <span class="op">=</span> call_i<span class="op">;</span></span>
<span id="cb33-807"><a href="#cb33-807" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">type</span> <span class="op">=</span> type<span class="op">;</span></span>
<span id="cb33-808"><a href="#cb33-808" aria-hidden="true" tabindex="-1"></a>    <span class="co">//this.evals = type == "definition" ? mjs_q_eval : fns_with_mjs_q_eval;</span></span>
<span id="cb33-809"><a href="#cb33-809" aria-hidden="true" tabindex="-1"></a>    <span class="co">//this.info = type == "definition" ? fns_with_mjs : calls_with_mjs_qualified;</span></span>
<span id="cb33-810"><a href="#cb33-810" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-811"><a href="#cb33-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-812"><a href="#cb33-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">toDOM</span>() {</span>
<span id="cb33-813"><a href="#cb33-813" aria-hidden="true" tabindex="-1"></a>    <span class="co">// mjs_q_eval; use this to test flicker/parse issues for plugins setting values (now set setparately by DOM calls)</span></span>
<span id="cb33-814"><a href="#cb33-814" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> wrap <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"span"</span>)<span class="op">;</span></span>
<span id="cb33-815"><a href="#cb33-815" aria-hidden="true" tabindex="-1"></a>    <span class="co">//wrap.className = "tooltip";</span></span>
<span id="cb33-816"><a href="#cb33-816" aria-hidden="true" tabindex="-1"></a>    <span class="co">//wrap.textContent = "101.19";</span></span>
<span id="cb33-817"><a href="#cb33-817" aria-hidden="true" tabindex="-1"></a>    wrap<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"aria-hidden"</span><span class="op">,</span> <span class="st">"true"</span>)<span class="op">;</span> <span class="co">// not in a good place, todo fix</span></span>
<span id="cb33-818"><a href="#cb33-818" aria-hidden="true" tabindex="-1"></a>    wrap<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">"calculang_tooltip"</span><span class="op">;</span></span>
<span id="cb33-819"><a href="#cb33-819" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">type</span> <span class="op">==</span> <span class="st">"definition"</span>) {</span>
<span id="cb33-820"><a href="#cb33-820" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;span class="calculang_tooltip answer" id="c-a-</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">v</span><span class="sc">}</span><span class="vs">"&gt;&lt;!--&lt;input type="checkbox"&gt;&lt;/input&gt;--&gt;&lt;span id="a-</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">v</span><span class="sc">}</span><span class="vs">" class="tooltiptext" anchor="c-a-</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">v</span><span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span><span class="fu">fmt2</span>(</span>
<span id="cb33-821"><a href="#cb33-821" aria-hidden="true" tabindex="-1"></a>        <span class="bu">window</span><span class="op">.</span><span class="at">fns_with_mjs_q_eval</span>[modelname][cul_scope_id][<span class="kw">this</span><span class="op">.</span><span class="at">v</span>]<span class="op">.</span><span class="at">name</span><span class="op">,</span> <span class="bu">window</span><span class="op">.</span><span class="at">fns_with_mjs_q_eval</span>[modelname][cul_scope_id][<span class="kw">this</span><span class="op">.</span><span class="at">v</span>]<span class="op">.</span><span class="at">value</span><span class="co">//999</span></span>
<span id="cb33-822"><a href="#cb33-822" aria-hidden="true" tabindex="-1"></a>      )<span class="sc">}</span><span class="vs">&lt;/span&gt;&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb33-823"><a href="#cb33-823" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-824"><a href="#cb33-824" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;span onclick=</span><span class="sc">${</span>() <span class="kw">=&gt;</span> {</span>
<span id="cb33-825"><a href="#cb33-825" aria-hidden="true" tabindex="-1"></a>      <span class="co">/* </span><span class="al">TODO</span><span class="co">*/</span> <span class="kw">set</span>(viewof formulae_visible<span class="op">,</span> [ <span class="co">// I'm supposed to use options.formulae_visible !!</span></span>
<span id="cb33-826"><a href="#cb33-826" aria-hidden="true" tabindex="-1"></a>        calls[<span class="kw">this</span><span class="op">.</span><span class="at">v</span>]<span class="op">.</span><span class="at">from</span><span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span>)</span>
<span id="cb33-827"><a href="#cb33-827" aria-hidden="true" tabindex="-1"></a>      ])<span class="op">;</span></span>
<span id="cb33-828"><a href="#cb33-828" aria-hidden="true" tabindex="-1"></a>      <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.calculang_f_'</span><span class="op">+</span>calls[<span class="kw">this</span><span class="op">.</span><span class="at">v</span>]<span class="op">.</span><span class="at">from</span><span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span>))<span class="op">.</span><span class="fu">scrollIntoView</span>(scrollIntoViewOpts)</span>
<span id="cb33-829"><a href="#cb33-829" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="bu">window</span><span class="op">.</span><span class="at">mjs_q_eval</span>[modelname][cul_scope_id][<span class="kw">this</span><span class="op">.</span><span class="at">v</span>]<span class="op">.</span><span class="at">handler</span>) <span class="bu">window</span><span class="op">.</span><span class="at">mjs_q_eval</span>[modelname][cul_scope_id][<span class="kw">this</span><span class="op">.</span><span class="at">v</span>]<span class="op">.</span><span class="fu">handler</span>()<span class="op">;</span></span>
<span id="cb33-830"><a href="#cb33-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-831"><a href="#cb33-831" aria-hidden="true" tabindex="-1"></a>    }<span class="sc">}</span><span class="vs"> class="calculang_tooltip" id="c-w-</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">call_i</span><span class="sc">}</span><span class="vs">"&gt;&lt;!--&amp;nbsp;&lt;input type="checkbox"&gt;&lt;/input&gt;--&gt;&lt;span id="w-</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">call_i</span><span class="sc">}</span><span class="vs">" class="tooltiptext" anchor="c-w-</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">call_i</span><span class="sc">}</span><span class="vs">"&gt;</span><span class="sc">${</span><span class="fu">fmt2</span>( <span class="bu">window</span><span class="op">.</span><span class="at">mjs_q_eval</span>[modelname][cul_scope_id][<span class="kw">this</span><span class="op">.</span><span class="at">call_i</span>]<span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb33-832"><a href="#cb33-832" aria-hidden="true" tabindex="-1"></a>     <span class="bu">window</span><span class="op">.</span><span class="at">mjs_q_eval</span>[modelname][cul_scope_id][<span class="kw">this</span><span class="op">.</span><span class="at">call_i</span>]<span class="op">.</span><span class="at">value</span></span>
<span id="cb33-833"><a href="#cb33-833" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">}</span><span class="vs">&lt;/span&gt;&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb33-834"><a href="#cb33-834" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> wrap<span class="op">;</span></span>
<span id="cb33-835"><a href="#cb33-835" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-836"><a href="#cb33-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-837"><a href="#cb33-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ignoreEvent</span>() {</span>
<span id="cb33-838"><a href="#cb33-838" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb33-839"><a href="#cb33-839" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-840"><a href="#cb33-840" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-841"><a href="#cb33-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-842"><a href="#cb33-842" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">workings</span>(view) {</span>
<span id="cb33-843"><a href="#cb33-843" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Decoration<span class="op">.</span><span class="fu">set</span>(</span>
<span id="cb33-844"><a href="#cb33-844" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb33-845"><a href="#cb33-845" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>calls<span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span></span>
<span id="cb33-846"><a href="#cb33-846" aria-hidden="true" tabindex="-1"></a>        Decoration<span class="op">.</span><span class="fu">widget</span>({</span>
<span id="cb33-847"><a href="#cb33-847" aria-hidden="true" tabindex="-1"></a>          <span class="dt">widget</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">AnswersWorkingsOverlayWidget</span>(i<span class="op">,</span> d<span class="op">,</span> i)<span class="op">,</span></span>
<span id="cb33-848"><a href="#cb33-848" aria-hidden="true" tabindex="-1"></a>          <span class="dt">side</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb33-849"><a href="#cb33-849" aria-hidden="true" tabindex="-1"></a>        })<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb33-850"><a href="#cb33-850" aria-hidden="true" tabindex="-1"></a>          d<span class="op">.</span><span class="at">loc</span><span class="op">.</span><span class="at">start</span><span class="op">.</span><span class="at">index</span> <span class="op">+</span></span>
<span id="cb33-851"><a href="#cb33-851" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">from</span><span class="op">.</span><span class="at">length</span> <span class="op">-</span></span>
<span id="cb33-852"><a href="#cb33-852" aria-hidden="true" tabindex="-1"></a>            <span class="dv">2</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(d<span class="op">.</span><span class="at">from</span><span class="op">.</span><span class="at">length</span><span class="op">/</span><span class="dv">2</span>) <span class="co">// this split is wrong for interest_rate for example!</span></span>
<span id="cb33-853"><a href="#cb33-853" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb33-854"><a href="#cb33-854" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb33-855"><a href="#cb33-855" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb33-856"><a href="#cb33-856" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb33-857"><a href="#cb33-857" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-858"><a href="#cb33-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-859"><a href="#cb33-859" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">answers</span>(view) {</span>
<span id="cb33-860"><a href="#cb33-860" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Decoration<span class="op">.</span><span class="fu">set</span>(</span>
<span id="cb33-861"><a href="#cb33-861" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb33-862"><a href="#cb33-862" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>fns_with_mjs<span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span></span>
<span id="cb33-863"><a href="#cb33-863" aria-hidden="true" tabindex="-1"></a>        Decoration<span class="op">.</span><span class="fu">widget</span>({</span>
<span id="cb33-864"><a href="#cb33-864" aria-hidden="true" tabindex="-1"></a>          <span class="dt">widget</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">AnswersWorkingsOverlayWidget</span>(i<span class="op">,</span> d<span class="op">,</span> i<span class="op">,</span> <span class="st">"definition"</span>)<span class="op">,</span></span>
<span id="cb33-865"><a href="#cb33-865" aria-hidden="true" tabindex="-1"></a>          <span class="dt">side</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb33-866"><a href="#cb33-866" aria-hidden="true" tabindex="-1"></a>        })<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb33-867"><a href="#cb33-867" aria-hidden="true" tabindex="-1"></a>          <span class="co">//                    }).range(view.state.doc.line(e).from)</span></span>
<span id="cb33-868"><a href="#cb33-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-869"><a href="#cb33-869" aria-hidden="true" tabindex="-1"></a>          view<span class="op">.</span><span class="at">state</span><span class="op">.</span><span class="at">doc</span><span class="op">.</span><span class="fu">line</span>(d<span class="op">.</span><span class="at">loc</span><span class="op">.</span><span class="at">start</span><span class="op">.</span><span class="at">line</span>)<span class="op">.</span><span class="at">to</span></span>
<span id="cb33-870"><a href="#cb33-870" aria-hidden="true" tabindex="-1"></a>          <span class="co">//d.from.length -</span></span>
<span id="cb33-871"><a href="#cb33-871" aria-hidden="true" tabindex="-1"></a>          <span class="co">/* todo take midpoint start-end */</span></span>
<span id="cb33-872"><a href="#cb33-872" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb33-873"><a href="#cb33-873" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb33-874"><a href="#cb33-874" aria-hidden="true" tabindex="-1"></a>    ] <span class="co">/* todo take midpoint start-end */</span></span>
<span id="cb33-875"><a href="#cb33-875" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb33-876"><a href="#cb33-876" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-877"><a href="#cb33-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-878"><a href="#cb33-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-879"><a href="#cb33-879" aria-hidden="true" tabindex="-1"></a>overlay_answers <span class="op">=</span> {</span>
<span id="cb33-880"><a href="#cb33-880" aria-hidden="true" tabindex="-1"></a>  <span class="co">// prevent input events coming from the contenteditable div that</span></span>
<span id="cb33-881"><a href="#cb33-881" aria-hidden="true" tabindex="-1"></a>  <span class="co">// propagates and triggers a cell refresh; we shall handle it ourselves.</span></span>
<span id="cb33-882"><a href="#cb33-882" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> answers_decorations <span class="op">=</span> cmImports<span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="at">ViewPlugin</span><span class="op">.</span><span class="fu">fromClass</span>(</span>
<span id="cb33-883"><a href="#cb33-883" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> {</span>
<span id="cb33-884"><a href="#cb33-884" aria-hidden="true" tabindex="-1"></a>      <span class="fu">constructor</span>(view) {</span>
<span id="cb33-885"><a href="#cb33-885" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">decorations</span> <span class="op">=</span> <span class="fu">answers</span>(view)<span class="op">;</span></span>
<span id="cb33-886"><a href="#cb33-886" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb33-887"><a href="#cb33-887" aria-hidden="true" tabindex="-1"></a>      <span class="fu">update</span>(update) {</span>
<span id="cb33-888"><a href="#cb33-888" aria-hidden="true" tabindex="-1"></a>        <span class="co">// updates cause difficulty clicking numbers - thankfully not needed</span></span>
<span id="cb33-889"><a href="#cb33-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-890"><a href="#cb33-890" aria-hidden="true" tabindex="-1"></a>        <span class="co">//this.decorations = answers(update.view);</span></span>
<span id="cb33-891"><a href="#cb33-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-892"><a href="#cb33-892" aria-hidden="true" tabindex="-1"></a>        <span class="co">// not necessary for read-only</span></span>
<span id="cb33-893"><a href="#cb33-893" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb33-894"><a href="#cb33-894" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb33-895"><a href="#cb33-895" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb33-896"><a href="#cb33-896" aria-hidden="true" tabindex="-1"></a>      <span class="dt">decorations</span><span class="op">:</span> (v) <span class="kw">=&gt;</span> v<span class="op">.</span><span class="at">decorations</span><span class="op">,</span></span>
<span id="cb33-897"><a href="#cb33-897" aria-hidden="true" tabindex="-1"></a>      <span class="dt">eventHandlers</span><span class="op">:</span> {}</span>
<span id="cb33-898"><a href="#cb33-898" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-899"><a href="#cb33-899" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb33-900"><a href="#cb33-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-901"><a href="#cb33-901" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [answers_decorations]<span class="op">;</span></span>
<span id="cb33-902"><a href="#cb33-902" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-903"><a href="#cb33-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-904"><a href="#cb33-904" aria-hidden="true" tabindex="-1"></a>overlay_workings <span class="op">=</span> {</span>
<span id="cb33-905"><a href="#cb33-905" aria-hidden="true" tabindex="-1"></a>  <span class="co">// prevent input events coming from the contenteditable div that</span></span>
<span id="cb33-906"><a href="#cb33-906" aria-hidden="true" tabindex="-1"></a>  <span class="co">// propagates and triggers a cell refresh; we shall handle it ourselves.</span></span>
<span id="cb33-907"><a href="#cb33-907" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> checkboxPlugin <span class="op">=</span> cmImports<span class="op">.</span><span class="at">view</span><span class="op">.</span><span class="at">ViewPlugin</span><span class="op">.</span><span class="fu">fromClass</span>(</span>
<span id="cb33-908"><a href="#cb33-908" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> {</span>
<span id="cb33-909"><a href="#cb33-909" aria-hidden="true" tabindex="-1"></a>      <span class="fu">constructor</span>(view) {</span>
<span id="cb33-910"><a href="#cb33-910" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">decorations</span> <span class="op">=</span> <span class="fu">workings</span>(view)<span class="op">;</span></span>
<span id="cb33-911"><a href="#cb33-911" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb33-912"><a href="#cb33-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-913"><a href="#cb33-913" aria-hidden="true" tabindex="-1"></a>      <span class="fu">update</span>(update) {</span>
<span id="cb33-914"><a href="#cb33-914" aria-hidden="true" tabindex="-1"></a>        <span class="co">// updates cause difficulty clicking numbers - thankfully not needed</span></span>
<span id="cb33-915"><a href="#cb33-915" aria-hidden="true" tabindex="-1"></a>        <span class="co">// not necessary for read-only</span></span>
<span id="cb33-916"><a href="#cb33-916" aria-hidden="true" tabindex="-1"></a>        <span class="co">//if (update.docChanged || update.viewportChanged)</span></span>
<span id="cb33-917"><a href="#cb33-917" aria-hidden="true" tabindex="-1"></a>         <span class="co">//this.decorations = workings(update.view);</span></span>
<span id="cb33-918"><a href="#cb33-918" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb33-919"><a href="#cb33-919" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb33-920"><a href="#cb33-920" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb33-921"><a href="#cb33-921" aria-hidden="true" tabindex="-1"></a>      <span class="dt">decorations</span><span class="op">:</span> (v) <span class="kw">=&gt;</span> v<span class="op">.</span><span class="at">decorations</span><span class="op">,</span></span>
<span id="cb33-922"><a href="#cb33-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-923"><a href="#cb33-923" aria-hidden="true" tabindex="-1"></a>      <span class="dt">eventHandlers</span><span class="op">:</span> {</span>
<span id="cb33-924"><a href="#cb33-924" aria-hidden="true" tabindex="-1"></a>        <span class="dt">mousedown</span><span class="op">:</span> (e<span class="op">,</span> view) <span class="kw">=&gt;</span> {</span>
<span id="cb33-925"><a href="#cb33-925" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"HELLO222"</span>)<span class="op">;</span></span>
<span id="cb33-926"><a href="#cb33-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-927"><a href="#cb33-927" aria-hidden="true" tabindex="-1"></a>          <span class="kw">let</span> target <span class="op">=</span> e<span class="op">.</span><span class="at">target</span><span class="op">;</span></span>
<span id="cb33-928"><a href="#cb33-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-929"><a href="#cb33-929" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"FDSAFSAD"</span><span class="op">,</span> e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">classList</span>)<span class="op">;</span></span>
<span id="cb33-930"><a href="#cb33-930" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (</span>
<span id="cb33-931"><a href="#cb33-931" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span> <span class="op">||</span> <span class="co">// DN</span></span>
<span id="cb33-932"><a href="#cb33-932" aria-hidden="true" tabindex="-1"></a>            (target<span class="op">.</span><span class="at">nodeName</span> <span class="op">==</span> <span class="st">"INPUT"</span> <span class="op">&amp;&amp;</span></span>
<span id="cb33-933"><a href="#cb33-933" aria-hidden="true" tabindex="-1"></a>              target<span class="op">.</span><span class="at">parentElement</span> <span class="co">/*! I removed this bang*/</span><span class="op">.</span><span class="at">classList</span></span>
<span id="cb33-934"><a href="#cb33-934" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">contains</span>(<span class="st">"cm-boolean-toggle"</span>))</span>
<span id="cb33-935"><a href="#cb33-935" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb33-936"><a href="#cb33-936" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span><span class="op">;</span><span class="co">//return toggleBoolean(view, view.posAtDOM(target));</span></span>
<span id="cb33-937"><a href="#cb33-937" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb33-938"><a href="#cb33-938" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb33-939"><a href="#cb33-939" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb33-940"><a href="#cb33-940" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb33-941"><a href="#cb33-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-942"><a href="#cb33-942" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [checkboxPlugin]<span class="op">;</span></span>
<span id="cb33-943"><a href="#cb33-943" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-944"><a href="#cb33-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-945"><a href="#cb33-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-946"><a href="#cb33-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-947"><a href="#cb33-947" aria-hidden="true" tabindex="-1"></a>fmt <span class="op">=</span> d <span class="kw">=&gt;</span> (<span class="kw">typeof</span> d <span class="op">==</span> <span class="st">'number'</span>) <span class="op">?</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(d) <span class="op">&lt;</span> <span class="dv">2</span> <span class="op">?</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">'.2%'</span>)(d) <span class="op">:</span> d3<span class="op">.</span><span class="fu">format</span>(fmt_fmt)(d)) <span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(d)</span>
<span id="cb33-948"><a href="#cb33-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-949"><a href="#cb33-949" aria-hidden="true" tabindex="-1"></a>embed <span class="op">=</span> <span class="pp">require</span>(<span class="st">"vega-embed"</span>)</span>
<span id="cb33-950"><a href="#cb33-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-951"><a href="#cb33-951" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb33-952"><a href="#cb33-952" aria-hidden="true" tabindex="-1"></a>  f_in<span class="op">;</span></span>
<span id="cb33-953"><a href="#cb33-953" aria-hidden="true" tabindex="-1"></a>  mutable frame_val <span class="op">=</span> f_in<span class="op">;</span></span>
<span id="cb33-954"><a href="#cb33-954" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-6" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-7" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-8" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-9" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-10" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-11" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-12" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-13" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-14" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-15" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-7-16" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<details>
<summary>
🤫
</summary>
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb34" data-startfrom="961" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 960;"><span id="cb34-961"><a href="#cb34-961" aria-hidden="true" tabindex="-1"></a>scrollIntoViewOpts <span class="op">=</span> ({<span class="dt">behaviour</span><span class="op">:</span><span class="st">'smooth'</span>})</span>
<span id="cb34-962"><a href="#cb34-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-963"><a href="#cb34-963" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">button</span>([</span>
<span id="cb34-964"><a href="#cb34-964" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"expand all"</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="kw">set</span>(viewof formulae_visible<span class="op">,</span> formulae_all)]<span class="op">,</span></span>
<span id="cb34-965"><a href="#cb34-965" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"collapse all"</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="kw">set</span>(viewof formulae_visible<span class="op">,</span> [])]<span class="op">,</span></span>
<span id="cb34-966"><a href="#cb34-966" aria-hidden="true" tabindex="-1"></a>  [<span class="st">"xx"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {<span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(viewof editor<span class="op">.</span><span class="at">value</span>)}]</span>
<span id="cb34-967"><a href="#cb34-967" aria-hidden="true" tabindex="-1"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-8-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-8-2" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb35" data-startfrom="970" data-source-offset="-246"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 969;"><span id="cb35-970"><a href="#cb35-970" aria-hidden="true" tabindex="-1"></a>viewof options <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">checkbox</span>([<span class="st">"export consts"</span><span class="op">,</span> <span class="st">"inputs"</span><span class="co">/*, "lists (todo)"*/</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"unhide?"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> [<span class="st">"export consts"</span><span class="op">,</span> <span class="st">"inputs"</span>]})</span>
<span id="cb35-971"><a href="#cb35-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-972"><a href="#cb35-972" aria-hidden="true" tabindex="-1"></a>viewof overlay <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({ <span class="dt">label</span><span class="op">:</span> <span class="st">"overlay?"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">false</span> })</span>
<span id="cb35-973"><a href="#cb35-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-974"><a href="#cb35-974" aria-hidden="true" tabindex="-1"></a><span class="co">//md`---`</span></span>
<span id="cb35-975"><a href="#cb35-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-976"><a href="#cb35-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-977"><a href="#cb35-977" aria-hidden="true" tabindex="-1"></a>viewof cul_js <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"📝 calculang source 💬"</span><span class="op">,</span> <span class="st">"✨ JS/ESM output ✨ (modular annotations bad)"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"🫶"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"📝 calculang source 💬"</span>})</span>
<span id="cb35-978"><a href="#cb35-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-979"><a href="#cb35-979" aria-hidden="true" tabindex="-1"></a>cul_js_cul <span class="op">=</span> cul_js <span class="op">==</span> <span class="st">"📝 calculang source 💬"</span> <span class="op">?</span> <span class="kw">true</span> <span class="op">:</span> <span class="kw">false</span></span>
<span id="cb35-980"><a href="#cb35-980" aria-hidden="true" tabindex="-1"></a>viewof calculang_source_nomemo <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">checkbox</span>([<span class="st">"nomemo"</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> [<span class="st">"nomemo"</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">'see memo? 💀'</span><span class="op">,</span> <span class="dt">disabled</span><span class="op">:</span>cul_js<span class="op">==</span><span class="st">"📝 calculang source 💬"</span>})</span>
<span id="cb35-981"><a href="#cb35-981" aria-hidden="true" tabindex="-1"></a>viewof opt <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({<span class="dt">label</span><span class="op">:</span><span class="st">'options'</span>})</span>
<span id="cb35-982"><a href="#cb35-982" aria-hidden="true" tabindex="-1"></a>viewof readonly <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({<span class="dt">label</span><span class="op">:</span><span class="st">'readonly'</span>})</span>
<span id="cb35-983"><a href="#cb35-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-984"><a href="#cb35-984" aria-hidden="true" tabindex="-1"></a>viewof formulae_visible <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>([<span class="st">"balance"</span><span class="op">,</span> <span class="st">"interest"</span><span class="op">,</span> <span class="st">"deposits"</span>])</span>
<span id="cb35-985"><a href="#cb35-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-986"><a href="#cb35-986" aria-hidden="true" tabindex="-1"></a>viewof fmt_fmt <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">text</span>({<span class="dt">value</span><span class="op">:</span><span class="st">",.2f"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">'format'</span>})</span>
<span id="cb35-987"><a href="#cb35-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-988"><a href="#cb35-988" aria-hidden="true" tabindex="-1"></a>viewof actions <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({<span class="dt">label</span><span class="op">:</span><span class="st">'vega actions?'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span><span class="kw">false</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-8-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-8-4" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-8-5" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-8-6" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-8-7" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-8-8" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-8-9" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-8-10" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-8-11" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-8-12" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</details>
</div>
<!-- can I make this column optional? -->
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div><div class="bslib-grid" style="display: grid; grid-template-rows: minmax(3em, max-content); grid-auto-columns: minmax(0, 1fr);">
<div class="card bslib-card html-fill-container" data-fill="false" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<strong style="font-size:1.5em;"><!--application(s)--></strong>
<p style="background-color:pink; padding: 5px; border-radius: 0 10px 10px 10px; font-size: 1.3em">
🎠🎈🕹️
</p>
<div id="raycasting2" class="modeldept html-fill-item html-fill-container" title="raycasting2">
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb36" data-startfrom="1013" data-source-offset="-50"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1012;"><span id="cb36-1013"><a href="#cb36-1013" aria-hidden="true" tabindex="-1"></a>mutable frame_val <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb36-1014"><a href="#cb36-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1015"><a href="#cb36-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1016"><a href="#cb36-1016" aria-hidden="true" tabindex="-1"></a>mutable keys_shared <span class="op">=</span> []</span>
<span id="cb36-1017"><a href="#cb36-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1018"><a href="#cb36-1018" aria-hidden="true" tabindex="-1"></a><span class="co">//Inputs.bind(Scrubber(_.range(0, 200), { autoplay: false, delay: 50 }), viewof f_in)</span></span>
<span id="cb36-1019"><a href="#cb36-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1020"><a href="#cb36-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1021"><a href="#cb36-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1022"><a href="#cb36-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1023"><a href="#cb36-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1024"><a href="#cb36-1024" aria-hidden="true" tabindex="-1"></a>viewof keys_stream <span class="op">=</span> { <span class="co">// https://observablehq.com/d/867e1424e1d093ab</span></span>
<span id="cb36-1025"><a href="#cb36-1025" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> e <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div class='target' style='color:pink; background:#eee' tabIndex=1&gt;Keyboard target&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb36-1026"><a href="#cb36-1026" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> keys <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb36-1027"><a href="#cb36-1027" aria-hidden="true" tabindex="-1"></a>  e<span class="op">.</span><span class="at">value</span> <span class="op">=</span> keys<span class="op">;</span></span>
<span id="cb36-1028"><a href="#cb36-1028" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> gap <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb36-1029"><a href="#cb36-1029" aria-hidden="true" tabindex="-1"></a>  e<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"keyup"</span><span class="op">,</span> (evt) <span class="kw">=&gt;</span> {</span>
<span id="cb36-1030"><a href="#cb36-1030" aria-hidden="true" tabindex="-1"></a>    keys<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb36-1031"><a href="#cb36-1031" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> evt<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb36-1032"><a href="#cb36-1032" aria-hidden="true" tabindex="-1"></a>      <span class="dt">delay</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>() <span class="op">-</span> gap<span class="op">,</span></span>
<span id="cb36-1033"><a href="#cb36-1033" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame</span><span class="op">:</span> mutable frame_val <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb36-1034"><a href="#cb36-1034" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb36-1035"><a href="#cb36-1035" aria-hidden="true" tabindex="-1"></a>    keys_shared<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb36-1036"><a href="#cb36-1036" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> evt<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb36-1037"><a href="#cb36-1037" aria-hidden="true" tabindex="-1"></a>      <span class="dt">delay</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>() <span class="op">-</span> gap<span class="op">,</span></span>
<span id="cb36-1038"><a href="#cb36-1038" aria-hidden="true" tabindex="-1"></a>      <span class="dt">frame</span><span class="op">:</span> mutable frame_val <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb36-1039"><a href="#cb36-1039" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb36-1040"><a href="#cb36-1040" aria-hidden="true" tabindex="-1"></a>    gap <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb36-1041"><a href="#cb36-1041" aria-hidden="true" tabindex="-1"></a>    e<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span>))<span class="op">;</span></span>
<span id="cb36-1042"><a href="#cb36-1042" aria-hidden="true" tabindex="-1"></a>    evt<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span> <span class="co">// for revealjs? not enough</span></span>
<span id="cb36-1043"><a href="#cb36-1043" aria-hidden="true" tabindex="-1"></a>          <span class="kw">set</span>(viewof f_in<span class="op">,</span> viewof f_in<span class="op">.</span><span class="at">value</span><span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb36-1044"><a href="#cb36-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1045"><a href="#cb36-1045" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb36-1046"><a href="#cb36-1046" aria-hidden="true" tabindex="-1"></a>  e<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"keydown"</span><span class="op">,</span> (evt) <span class="kw">=&gt;</span> {</span>
<span id="cb36-1047"><a href="#cb36-1047" aria-hidden="true" tabindex="-1"></a>    mutable show_ray <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb36-1048"><a href="#cb36-1048" aria-hidden="true" tabindex="-1"></a>    evt<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb36-1049"><a href="#cb36-1049" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb36-1050"><a href="#cb36-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1051"><a href="#cb36-1051" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> e<span class="op">;</span></span>
<span id="cb36-1052"><a href="#cb36-1052" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-1053"><a href="#cb36-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1054"><a href="#cb36-1054" aria-hidden="true" tabindex="-1"></a>viewof scene <span class="op">=</span> <span class="fu">embed</span>(scene_spec<span class="op">,</span> { <span class="dt">renderer</span><span class="op">:</span> <span class="st">"svg"</span><span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> actions<span class="op">,</span> <span class="dt">config</span><span class="op">:</span> { <span class="dt">autosize</span><span class="op">:</span> <span class="st">'fit-y'</span> }})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-9-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-9-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-9-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-9-4" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<details>
<summary>
🤫
</summary>
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb37" data-startfrom="1075" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1074;"><span id="cb37-1075"><a href="#cb37-1075" aria-hidden="true" tabindex="-1"></a>viewof refresh <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"refresh calculang model"</span>)</span>
<span id="cb37-1076"><a href="#cb37-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1077"><a href="#cb37-1077" aria-hidden="true" tabindex="-1"></a>htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;button onclick=</span><span class="sc">${</span>() <span class="kw">=&gt;</span> (mutable scene_data0 <span class="op">=</span> scene_data)<span class="sc">}</span><span class="vs">&gt;insert data -&gt; vega editor (dev)&lt;/button&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-10-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-10-2" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb38" data-startfrom="1079" data-source-offset="-173"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1078;"><span id="cb38-1079"><a href="#cb38-1079" aria-hidden="true" tabindex="-1"></a>viewof guides <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({ <span class="dt">label</span><span class="op">:</span> <span class="st">"guides"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">false</span> })</span>
<span id="cb38-1080"><a href="#cb38-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1081"><a href="#cb38-1081" aria-hidden="true" tabindex="-1"></a>viewof model_x <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span><span class="dv">10</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span><span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">'model version'</span>})</span>
<span id="cb38-1082"><a href="#cb38-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1083"><a href="#cb38-1083" aria-hidden="true" tabindex="-1"></a>viewof scene_size <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.1</span><span class="op">,</span><span class="dv">1</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span><span class="fl">0.5</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">'size'</span>})</span>
<span id="cb38-1084"><a href="#cb38-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1085"><a href="#cb38-1085" aria-hidden="true" tabindex="-1"></a>viewof show_ray_steps <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">'show ray steps?'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="kw">false</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-10-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-10-4" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-10-5" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-10-6" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</details>
<div class="cell hidden html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb39" data-startfrom="1094" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1093;"><span id="cb39-1094"><a href="#cb39-1094" aria-hidden="true" tabindex="-1"></a>htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;button onclick=</span><span class="sc">${</span>() <span class="kw">=&gt;</span> (mutable scene_data0 <span class="op">=</span> scene_data)<span class="sc">}</span><span class="vs">&gt;insert data -&gt; vega editor (dev)&lt;/button&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-1" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb40" data-startfrom="1095" data-source-offset="-112"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1094;"><span id="cb40-1095"><a href="#cb40-1095" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">10</span><span class="op">,</span><span class="dv">100</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span><span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">'step'</span>})<span class="op">,</span> viewof step_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-2" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb41" data-startfrom="1097" data-source-offset="-191"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1096;"><span id="cb41-1097"><a href="#cb41-1097" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb41-1098"><a href="#cb41-1098" aria-hidden="true" tabindex="-1"></a>  scene<span class="op">;</span></span>
<span id="cb41-1099"><a href="#cb41-1099" aria-hidden="true" tabindex="-1"></a>  <span class="bu">window</span><span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">Event</span>(<span class="st">'resize'</span>))</span>
<span id="cb41-1100"><a href="#cb41-1100" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-3" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb42" data-startfrom="1107" data-source-offset="-360"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1106;"><span id="cb42-1107"><a href="#cb42-1107" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb42-1108"><a href="#cb42-1108" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;style&gt;</span></span>
<span id="cb42-1109"><a href="#cb42-1109" aria-hidden="true" tabindex="-1"></a><span class="vs">  #raycasting2 .fit-y svg {</span></span>
<span id="cb42-1110"><a href="#cb42-1110" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: linear-gradient(to bottom, lightblue, pink, white);</span></span>
<span id="cb42-1111"><a href="#cb42-1111" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb42-1112"><a href="#cb42-1112" aria-hidden="true" tabindex="-1"></a><span class="vs">  #reflection svg {</span></span>
<span id="cb42-1113"><a href="#cb42-1113" aria-hidden="true" tabindex="-1"></a><span class="vs">    margin-top: -10px;</span></span>
<span id="cb42-1114"><a href="#cb42-1114" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: linear-gradient(to bottom, orange, pink, white);</span></span>
<span id="cb42-1115"><a href="#cb42-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1116"><a href="#cb42-1116" aria-hidden="true" tabindex="-1"></a><span class="vs">    /*filter: blur(10px);</span></span>
<span id="cb42-1117"><a href="#cb42-1117" aria-hidden="true" tabindex="-1"></a><span class="vs">      background: white; linear-gradient(to bottom, lightblue, green, white);*/</span></span>
<span id="cb42-1118"><a href="#cb42-1118" aria-hidden="true" tabindex="-1"></a><span class="vs">      transform: scaleY(-0.7); /*translateY(65px);*/</span></span>
<span id="cb42-1119"><a href="#cb42-1119" aria-hidden="true" tabindex="-1"></a><span class="vs">      mask: linear-gradient(to bottom, transparent, black 98%);</span></span>
<span id="cb42-1120"><a href="#cb42-1120" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb42-1121"><a href="#cb42-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1122"><a href="#cb42-1122" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/style&gt;</span></span>
<span id="cb42-1123"><a href="#cb42-1123" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-4" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb43" data-startfrom="1127" data-source-offset="-847"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1126;"><span id="cb43-1127"><a href="#cb43-1127" aria-hidden="true" tabindex="-1"></a>scene_spec <span class="op">=</span> { <span class="cf">return</span> ({</span>
<span id="cb43-1128"><a href="#cb43-1128" aria-hidden="true" tabindex="-1"></a>  <span class="dt">config</span><span class="op">:</span> {<span class="dt">autosize</span><span class="op">:</span> <span class="st">'fit'</span>}<span class="op">,</span></span>
<span id="cb43-1129"><a href="#cb43-1129" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span><span class="op">:</span> {<span class="st">"name"</span><span class="op">:</span> <span class="st">"source"</span>}<span class="op">,</span></span>
<span id="cb43-1130"><a href="#cb43-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1131"><a href="#cb43-1131" aria-hidden="true" tabindex="-1"></a>  <span class="dt">datasets</span><span class="op">:</span> {<span class="st">'source'</span><span class="op">:</span> scene_data0 }<span class="op">,</span></span>
<span id="cb43-1132"><a href="#cb43-1132" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="st">"container"</span><span class="op">,</span></span>
<span id="cb43-1133"><a href="#cb43-1133" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span> <span class="dv">350</span><span class="op">*</span>scene_size<span class="op">,</span></span>
<span id="cb43-1134"><a href="#cb43-1134" aria-hidden="true" tabindex="-1"></a>  <span class="co">//height: 400,</span></span>
<span id="cb43-1135"><a href="#cb43-1135" aria-hidden="true" tabindex="-1"></a>  <span class="co">//height: "container",</span></span>
<span id="cb43-1136"><a href="#cb43-1136" aria-hidden="true" tabindex="-1"></a>  <span class="co">//background: "linear-gradient(blue, pink)",</span></span>
<span id="cb43-1137"><a href="#cb43-1137" aria-hidden="true" tabindex="-1"></a>  <span class="dt">mark</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"bar"</span><span class="op">,</span> <span class="dt">clip</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb43-1138"><a href="#cb43-1138" aria-hidden="true" tabindex="-1"></a>  <span class="co">//transform: [{calculate: "2*datum.r_hit_v+(0)", as: "r_hit_v__r_hit_h_or_v"}],</span></span>
<span id="cb43-1139"><a href="#cb43-1139" aria-hidden="true" tabindex="-1"></a>  <span class="dt">encoding</span><span class="op">:</span> {</span>
<span id="cb43-1140"><a href="#cb43-1140" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb43-1141"><a href="#cb43-1141" aria-hidden="true" tabindex="-1"></a>      <span class="dt">field</span><span class="op">:</span> <span class="st">"ray_angle_in"</span><span class="op">,</span></span>
<span id="cb43-1142"><a href="#cb43-1142" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"ordinal"</span><span class="op">,</span></span>
<span id="cb43-1143"><a href="#cb43-1143" aria-hidden="true" tabindex="-1"></a>      <span class="dt">axis</span><span class="op">:</span> guides <span class="op">?</span> { <span class="dt">format</span><span class="op">:</span> <span class="st">",.2f"</span><span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">false</span> } <span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb43-1144"><a href="#cb43-1144" aria-hidden="true" tabindex="-1"></a>      <span class="dt">sort</span><span class="op">:</span> <span class="st">"descending"</span></span>
<span id="cb43-1145"><a href="#cb43-1145" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb43-1146"><a href="#cb43-1146" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb43-1147"><a href="#cb43-1147" aria-hidden="true" tabindex="-1"></a>      <span class="dt">field</span><span class="op">:</span> <span class="st">"r_inverse_length"</span><span class="op">,</span></span>
<span id="cb43-1148"><a href="#cb43-1148" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"quantitative"</span><span class="op">,</span></span>
<span id="cb43-1149"><a href="#cb43-1149" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>] }<span class="op">,</span></span>
<span id="cb43-1150"><a href="#cb43-1150" aria-hidden="true" tabindex="-1"></a>      <span class="dt">axis</span><span class="op">:</span> guides <span class="op">?</span> { <span class="dt">grid</span><span class="op">:</span> <span class="kw">false</span> } <span class="op">:</span> <span class="kw">null</span></span>
<span id="cb43-1151"><a href="#cb43-1151" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb43-1152"><a href="#cb43-1152" aria-hidden="true" tabindex="-1"></a>    <span class="dt">stroke</span><span class="op">:</span> {<span class="dt">value</span><span class="op">:</span> <span class="st">'black'</span>}<span class="op">,</span></span>
<span id="cb43-1153"><a href="#cb43-1153" aria-hidden="true" tabindex="-1"></a>    <span class="dt">strokeOpacity</span><span class="op">:</span> {      <span class="dt">condition</span><span class="op">:</span> { <span class="dt">param</span><span class="op">:</span> <span class="st">"ray_angle_in"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb43-1154"><a href="#cb43-1154" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb43-1155"><a href="#cb43-1155" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb43-1156"><a href="#cb43-1156" aria-hidden="true" tabindex="-1"></a>    <span class="dt">strokeWidth</span><span class="op">:</span> {</span>
<span id="cb43-1157"><a href="#cb43-1157" aria-hidden="true" tabindex="-1"></a>      <span class="dt">condition</span><span class="op">:</span> { <span class="dt">param</span><span class="op">:</span> <span class="st">"ray_angle_in"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb43-1158"><a href="#cb43-1158" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb43-1159"><a href="#cb43-1159" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb43-1160"><a href="#cb43-1160" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb43-1161"><a href="#cb43-1161" aria-hidden="true" tabindex="-1"></a>      <span class="dt">condition</span><span class="op">:</span> { <span class="dt">param</span><span class="op">:</span> <span class="st">"ray_angle_in"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"red"</span> }<span class="op">,</span></span>
<span id="cb43-1162"><a href="#cb43-1162" aria-hidden="true" tabindex="-1"></a>      <span class="co">//"datum": {</span></span>
<span id="cb43-1163"><a href="#cb43-1163" aria-hidden="true" tabindex="-1"></a>        <span class="co">//"value": "1",</span></span>
<span id="cb43-1164"><a href="#cb43-1164" aria-hidden="true" tabindex="-1"></a>      <span class="co">//},</span></span>
<span id="cb43-1165"><a href="#cb43-1165" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> {<span class="dt">domain</span><span class="op">:</span> [<span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">,</span><span class="dv">5</span><span class="op">,</span><span class="dv">6</span><span class="op">,</span><span class="dv">7</span>]<span class="op">,</span><span class="dt">range</span><span class="op">:</span> [<span class="st">"hsl(250, 76%, 60%)"</span><span class="op">,</span><span class="st">"hsl(250, 76%, 72%)"</span><span class="op">,</span><span class="st">"hsl(200, 76%, 60%)"</span><span class="op">,</span><span class="st">"hsl(200, 76%, 72%)"</span><span class="op">,</span><span class="st">"hsl(100, 76%, 60%)"</span><span class="op">,</span><span class="st">"hsl(100, 76%, 72%)"</span>]}<span class="op">,</span></span>
<span id="cb43-1166"><a href="#cb43-1166" aria-hidden="true" tabindex="-1"></a>      <span class="dt">field</span><span class="op">:</span> <span class="st">"r_hit_v__r_hit_h_or_v"</span><span class="op">,</span></span>
<span id="cb43-1167"><a href="#cb43-1167" aria-hidden="true" tabindex="-1"></a>      <span class="co">//type: "nominal",</span></span>
<span id="cb43-1168"><a href="#cb43-1168" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> guides</span>
<span id="cb43-1169"><a href="#cb43-1169" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb43-1170"><a href="#cb43-1170" aria-hidden="true" tabindex="-1"></a>    <span class="dt">opacity</span><span class="op">:</span> {</span>
<span id="cb43-1171"><a href="#cb43-1171" aria-hidden="true" tabindex="-1"></a>      <span class="dt">field</span><span class="op">:</span> <span class="st">'r_length'</span><span class="op">,</span></span>
<span id="cb43-1172"><a href="#cb43-1172" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> guides<span class="op">,</span></span>
<span id="cb43-1173"><a href="#cb43-1173" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> {<span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span><span class="dv">15</span>]<span class="op">,</span> <span class="dt">range</span><span class="op">:</span> [<span class="dv">1</span><span class="op">,.</span><span class="dv">1</span>]}<span class="op">,</span></span>
<span id="cb43-1174"><a href="#cb43-1174" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">'quantitative'</span></span>
<span id="cb43-1175"><a href="#cb43-1175" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-1176"><a href="#cb43-1176" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb43-1177"><a href="#cb43-1177" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> [</span>
<span id="cb43-1178"><a href="#cb43-1178" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb43-1179"><a href="#cb43-1179" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"player_angle_in"</span><span class="op">,</span></span>
<span id="cb43-1180"><a href="#cb43-1180" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> { <span class="dt">player_angle_in</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb43-1181"><a href="#cb43-1181" aria-hidden="true" tabindex="-1"></a>      <span class="dt">select</span><span class="op">:</span> {</span>
<span id="cb43-1182"><a href="#cb43-1182" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"point"</span><span class="op">,</span></span>
<span id="cb43-1183"><a href="#cb43-1183" aria-hidden="true" tabindex="-1"></a>        <span class="co">//on: "mousemove{0,50}",</span></span>
<span id="cb43-1184"><a href="#cb43-1184" aria-hidden="true" tabindex="-1"></a>        <span class="dt">on</span><span class="op">:</span> <span class="st">"[touchdown, touchup] &gt; touchmove, [mousedown, mouseup] &gt; mousemove"</span><span class="op">,</span> <span class="co">//{10, 100}",</span></span>
<span id="cb43-1185"><a href="#cb43-1185" aria-hidden="true" tabindex="-1"></a>        <span class="co">//        on: "[mousedown, mouseup] &gt; mousemove",</span></span>
<span id="cb43-1186"><a href="#cb43-1186" aria-hidden="true" tabindex="-1"></a>        <span class="dt">nearest</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb43-1187"><a href="#cb43-1187" aria-hidden="true" tabindex="-1"></a>        <span class="dt">toggle</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb43-1188"><a href="#cb43-1188" aria-hidden="true" tabindex="-1"></a>        <span class="dt">clear</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb43-1189"><a href="#cb43-1189" aria-hidden="true" tabindex="-1"></a>        <span class="dt">encodings</span><span class="op">:</span> [<span class="st">"x"</span>]</span>
<span id="cb43-1190"><a href="#cb43-1190" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb43-1191"><a href="#cb43-1191" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb43-1192"><a href="#cb43-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1193"><a href="#cb43-1193" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb43-1194"><a href="#cb43-1194" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"ray_angle_in"</span><span class="op">,</span></span>
<span id="cb43-1195"><a href="#cb43-1195" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> { <span class="dt">ray_angle_in</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb43-1196"><a href="#cb43-1196" aria-hidden="true" tabindex="-1"></a>      <span class="dt">select</span><span class="op">:</span> {</span>
<span id="cb43-1197"><a href="#cb43-1197" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"point"</span><span class="op">,</span></span>
<span id="cb43-1198"><a href="#cb43-1198" aria-hidden="true" tabindex="-1"></a>        <span class="co">//on: "mousemove{0,50}",</span></span>
<span id="cb43-1199"><a href="#cb43-1199" aria-hidden="true" tabindex="-1"></a>        <span class="dt">on</span><span class="op">:</span> <span class="st">"mousemove"</span><span class="op">,</span> <span class="co">//{10, 100}",</span></span>
<span id="cb43-1200"><a href="#cb43-1200" aria-hidden="true" tabindex="-1"></a>        <span class="co">//        on: "[mousedown, mouseup] &gt; mousemove",</span></span>
<span id="cb43-1201"><a href="#cb43-1201" aria-hidden="true" tabindex="-1"></a>        <span class="dt">nearest</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb43-1202"><a href="#cb43-1202" aria-hidden="true" tabindex="-1"></a>        <span class="dt">toggle</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb43-1203"><a href="#cb43-1203" aria-hidden="true" tabindex="-1"></a>        <span class="dt">clear</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb43-1204"><a href="#cb43-1204" aria-hidden="true" tabindex="-1"></a>        <span class="dt">encodings</span><span class="op">:</span> [<span class="st">"x"</span>]</span>
<span id="cb43-1205"><a href="#cb43-1205" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb43-1206"><a href="#cb43-1206" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-1207"><a href="#cb43-1207" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb43-1208"><a href="#cb43-1208" aria-hidden="true" tabindex="-1"></a>}) }</span>
<span id="cb43-1209"><a href="#cb43-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1210"><a href="#cb43-1210" aria-hidden="true" tabindex="-1"></a>player_angle_in <span class="op">=</span> raycasting2<span class="op">.</span><span class="fu">player_angle</span>({keys_stream_function_in<span class="op">,</span></span>
<span id="cb43-1211"><a href="#cb43-1211" aria-hidden="true" tabindex="-1"></a>keys_stream_version_in<span class="op">,</span> f_in})</span>
<span id="cb43-1212"><a href="#cb43-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1213"><a href="#cb43-1213" aria-hidden="true" tabindex="-1"></a><span class="co">// add additional for signalled ray angle exactly??</span></span>
<span id="cb43-1214"><a href="#cb43-1214" aria-hidden="true" tabindex="-1"></a>scene_data <span class="op">=</span> <span class="fu">calcuvegadata</span>({</span>
<span id="cb43-1215"><a href="#cb43-1215" aria-hidden="true" tabindex="-1"></a>  <span class="dt">$schema</span><span class="op">:</span> <span class="st">"https://vega.github.io/schema/vega-lite/v5.json"</span><span class="op">,</span></span>
<span id="cb43-1216"><a href="#cb43-1216" aria-hidden="true" tabindex="-1"></a>  <span class="dt">models</span><span class="op">:</span> [raycasting2]<span class="op">,</span></span>
<span id="cb43-1217"><a href="#cb43-1217" aria-hidden="true" tabindex="-1"></a>  <span class="dt">spec</span><span class="op">:</span> ({<span class="op">...</span>scene_spec<span class="op">,</span> <span class="dt">a</span><span class="op">:</span> {<span class="dt">field</span><span class="op">:</span> <span class="st">'r_hit_v'</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> {<span class="dt">field</span><span class="op">:</span><span class="st">'r_hit_h_or_v'</span>}}})<span class="op">,</span></span>
<span id="cb43-1218"><a href="#cb43-1218" aria-hidden="true" tabindex="-1"></a>  <span class="dt">domains</span><span class="op">:</span> {</span>
<span id="cb43-1219"><a href="#cb43-1219" aria-hidden="true" tabindex="-1"></a>    <span class="co">//step_in: _.range(0, 8.1, 1),</span></span>
<span id="cb43-1220"><a href="#cb43-1220" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ray_angle_in</span><span class="op">:</span> _<span class="op">.</span><span class="fu">range</span>(<span class="op">-</span><span class="dv">1</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="fl">1.01</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="fl">0.01</span>)<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d <span class="op">+</span> player_angle_in) <span class="co">//[ray_angle_in, ray_angle_in + 0.4, ray_angle_in - 0.4]</span></span>
<span id="cb43-1221"><a href="#cb43-1221" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb43-1222"><a href="#cb43-1222" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input_cursors</span><span class="op">:</span> [</span>
<span id="cb43-1223"><a href="#cb43-1223" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb43-1224"><a href="#cb43-1224" aria-hidden="true" tabindex="-1"></a>keys_stream_function_in<span class="op">,</span></span>
<span id="cb43-1225"><a href="#cb43-1225" aria-hidden="true" tabindex="-1"></a>keys_stream_version_in<span class="op">,</span> f_in<span class="op">,</span></span>
<span id="cb43-1226"><a href="#cb43-1226" aria-hidden="true" tabindex="-1"></a><span class="co">//player_angle_in /* needed for fisheye */</span></span>
<span id="cb43-1227"><a href="#cb43-1227" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-1228"><a href="#cb43-1228" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb43-1229"><a href="#cb43-1229" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({<span class="op">...</span>d<span class="op">,</span> <span class="dt">r_hit_v__r_hit_h_or_v</span><span class="op">:</span> <span class="dv">2</span><span class="op">*</span>d<span class="op">.</span><span class="at">r_hit_v</span><span class="op">+</span>(d<span class="op">.</span><span class="at">r_hit_h_or_v</span> <span class="op">==</span> <span class="st">'h'</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span>)}))</span>
<span id="cb43-1230"><a href="#cb43-1230" aria-hidden="true" tabindex="-1"></a><span class="co">//| output: false</span></span>
<span id="cb43-1231"><a href="#cb43-1231" aria-hidden="true" tabindex="-1"></a><span class="co">//| </span></span>
<span id="cb43-1232"><a href="#cb43-1232" aria-hidden="true" tabindex="-1"></a>scene_updates <span class="op">=</span> {</span>
<span id="cb43-1233"><a href="#cb43-1233" aria-hidden="true" tabindex="-1"></a>  <span class="co">//scene.signal("ray_angle_in", ray_angle_in); causes infinite re-runs</span></span>
<span id="cb43-1234"><a href="#cb43-1234" aria-hidden="true" tabindex="-1"></a>  scene<span class="op">.</span><span class="fu">data</span>(<span class="st">"source"</span><span class="op">,</span> scene_data)<span class="op">.</span><span class="fu">resize</span>()<span class="op">.</span><span class="fu">run</span>()<span class="op">;</span></span>
<span id="cb43-1235"><a href="#cb43-1235" aria-hidden="true" tabindex="-1"></a>  <span class="co">//scene2.data("source", scene_data).resize().run();</span></span>
<span id="cb43-1236"><a href="#cb43-1236" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-1237"><a href="#cb43-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1238"><a href="#cb43-1238" aria-hidden="true" tabindex="-1"></a>scene<span class="op">.</span><span class="fu">addSignalListener</span>(<span class="st">"player_angle_in"</span><span class="op">,</span> (a<span class="op">,</span> b) <span class="kw">=&gt;</span> {</span>
<span id="cb43-1239"><a href="#cb43-1239" aria-hidden="true" tabindex="-1"></a>  <span class="co">/*viewof aa.value = b.ray_angle_in; //scene.signal("ray_angle_in");</span></span>
<span id="cb43-1240"><a href="#cb43-1240" aria-hidden="true" tabindex="-1"></a><span class="co">  viewof aa.dispatchEvent(new CustomEvent("input", { bubbles: true }));</span></span>
<span id="cb43-1241"><a href="#cb43-1241" aria-hidden="true" tabindex="-1"></a><span class="co">  */</span></span>
<span id="cb43-1242"><a href="#cb43-1242" aria-hidden="true" tabindex="-1"></a> <span class="co">//if (b.ray_angle_in[0] !== ray_angle_in) {</span></span>
<span id="cb43-1243"><a href="#cb43-1243" aria-hidden="true" tabindex="-1"></a>  <span class="co">//console.log(b.ray_angle_in[0], ray_angle_in, b.ray_angle_in[0] !== ray_angle_in)</span></span>
<span id="cb43-1244"><a href="#cb43-1244" aria-hidden="true" tabindex="-1"></a> <span class="co">//viewof ray_angle_in.value = b.ray_angle_in[0]; //scene.signal("ray_angle_in");</span></span>
<span id="cb43-1245"><a href="#cb43-1245" aria-hidden="true" tabindex="-1"></a> <span class="co">// viewof ray_angle_in.dispatchEvent(</span></span>
<span id="cb43-1246"><a href="#cb43-1246" aria-hidden="true" tabindex="-1"></a> <span class="co">//   new CustomEvent("input", { bubbles: true })</span></span>
<span id="cb43-1247"><a href="#cb43-1247" aria-hidden="true" tabindex="-1"></a>  <span class="co">//);</span></span>
<span id="cb43-1248"><a href="#cb43-1248" aria-hidden="true" tabindex="-1"></a>  <span class="co">//debugger;</span></span>
<span id="cb43-1249"><a href="#cb43-1249" aria-hidden="true" tabindex="-1"></a>  <span class="co">//// set(viewof player_angle_in, b.ray_angle_in[0])</span></span>
<span id="cb43-1250"><a href="#cb43-1250" aria-hidden="true" tabindex="-1"></a>  <span class="co">//set(viewof formulae_visible, 'r_inverse_length') /// this is bad during brushing if I want to scan length for example :o</span></span>
<span id="cb43-1251"><a href="#cb43-1251" aria-hidden="true" tabindex="-1"></a> <span class="co">//}</span></span>
<span id="cb43-1252"><a href="#cb43-1252" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-5" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-6" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-7" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-8" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-9" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb44" data-startfrom="1254" data-source-offset="-4775"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1253;"><span id="cb44-1254"><a href="#cb44-1254" aria-hidden="true" tabindex="-1"></a>scene<span class="op">.</span><span class="fu">addSignalListener</span>(<span class="st">"ray_angle_in"</span><span class="op">,</span> (a<span class="op">,</span> b) <span class="kw">=&gt;</span> {</span>
<span id="cb44-1255"><a href="#cb44-1255" aria-hidden="true" tabindex="-1"></a>  mutable show_ray <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb44-1256"><a href="#cb44-1256" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span>(viewof ray_angle_in<span class="op">,</span> b<span class="op">.</span><span class="at">ray_angle_in</span>[<span class="dv">0</span>])</span>
<span id="cb44-1257"><a href="#cb44-1257" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'ooo'</span><span class="op">,</span>b<span class="op">.</span><span class="at">ray_angle_in</span>[<span class="dv">0</span>])</span>
<span id="cb44-1258"><a href="#cb44-1258" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-10" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb45" data-startfrom="1260" data-source-offset="-4943"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1259;"><span id="cb45-1260"><a href="#cb45-1260" aria-hidden="true" tabindex="-1"></a>ray_angle_in</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-11" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb46" data-startfrom="1262" data-source-offset="-4957"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1261;"><span id="cb46-1262"><a href="#cb46-1262" aria-hidden="true" tabindex="-1"></a>scene_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-12" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb47" data-startfrom="1264" data-source-offset="-4969"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1263;"><span id="cb47-1264"><a href="#cb47-1264" aria-hidden="true" tabindex="-1"></a>mjs_q_eval</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-13" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb48" data-startfrom="1266" data-source-offset="-4981"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1265;"><span id="cb48-1266"><a href="#cb48-1266" aria-hidden="true" tabindex="-1"></a>fns_with_mjs_q_eval</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-14" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb49" data-startfrom="1268" data-source-offset="-5002"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1267;"><span id="cb49-1268"><a href="#cb49-1268" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">100</span><span class="op">,</span><span class="dv">100</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span>})<span class="op">,</span> viewof ray_angle_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-15" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb50" data-startfrom="1270" data-source-offset="-5151"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1269;"><span id="cb50-1270"><a href="#cb50-1270" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">10</span><span class="op">,</span><span class="dv">10</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span><span class="dv">1</span>})<span class="op">,</span> viewof year_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-16" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb51" data-startfrom="1272" data-source-offset="-5214"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1271;"><span id="cb51-1272"><a href="#cb51-1272" aria-hidden="true" tabindex="-1"></a>viewof opacity_vertical <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> {</span>
<span id="cb51-1273"><a href="#cb51-1273" aria-hidden="true" tabindex="-1"></a>  <span class="dt">step</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb51-1274"><a href="#cb51-1274" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb51-1275"><a href="#cb51-1275" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"vert"</span></span>
<span id="cb51-1276"><a href="#cb51-1276" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-11-17" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="cell hidden html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb52" data-startfrom="1287" data-source-offset="-56"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1286;"><span id="cb52-1287"><a href="#cb52-1287" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb52-1288"><a href="#cb52-1288" aria-hidden="true" tabindex="-1"></a>  formulae_visible<span class="op">.</span><span class="fu">forEach</span>(f <span class="kw">=&gt;</span> {</span>
<span id="cb52-1289"><a href="#cb52-1289" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(introspection_nomemo<span class="op">.</span><span class="at">cul_functions</span>)<span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">name</span> <span class="op">==</span> f <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="fu">includes</span>(<span class="st">'step_in'</span>)))</span>
<span id="cb52-1290"><a href="#cb52-1290" aria-hidden="true" tabindex="-1"></a>      <span class="kw">set</span>(viewof show_ray_steps<span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb52-1291"><a href="#cb52-1291" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb52-1292"><a href="#cb52-1292" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-12-1" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb53" data-startfrom="1294" data-source-offset="-253"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1293;"><span id="cb53-1294"><a href="#cb53-1294" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb53-1295"><a href="#cb53-1295" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>show_ray) <span class="kw">set</span>(viewof show_ray_steps<span class="op">,</span> <span class="kw">false</span>)</span>
<span id="cb53-1296"><a href="#cb53-1296" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-12-2" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb54" data-startfrom="1298" data-source-offset="-309"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1297;"><span id="cb54-1298"><a href="#cb54-1298" aria-hidden="true" tabindex="-1"></a>show_ray_steps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-12-3" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb55" data-startfrom="1301" data-source-offset="-348"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1300;"><span id="cb55-1301"><a href="#cb55-1301" aria-hidden="true" tabindex="-1"></a>mutable show_ray <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb55-1302"><a href="#cb55-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-1303"><a href="#cb55-1303" aria-hidden="true" tabindex="-1"></a>show_ray</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-12-4" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-12-5" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb56" data-startfrom="1305" data-source-offset="-384"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1304;"><span id="cb56-1305"><a href="#cb56-1305" aria-hidden="true" tabindex="-1"></a>level<span class="op">.</span><span class="fu">addSignalListener</span>(<span class="st">'step_in'</span><span class="op">,</span> (_<span class="op">,</span>b) <span class="kw">=&gt;</span> {</span>
<span id="cb56-1306"><a href="#cb56-1306" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span>(viewof step_in<span class="op">,</span> b[<span class="dv">0</span>])</span>
<span id="cb56-1307"><a href="#cb56-1307" aria-hidden="true" tabindex="-1"></a>  <span class="co">// </span><span class="al">TODO</span><span class="co"> process the formula part [1]</span></span>
<span id="cb56-1308"><a href="#cb56-1308" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(b)<span class="op">;</span></span>
<span id="cb56-1309"><a href="#cb56-1309" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-12-6" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb57" data-startfrom="1313" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1312;"><span id="cb57-1313"><a href="#cb57-1313" aria-hidden="true" tabindex="-1"></a>viewof level <span class="op">=</span> <span class="fu">embed</span>(level_spec<span class="op">,</span> {<span class="dt">renderer</span><span class="op">:</span> <span class="st">'svg'</span><span class="op">,</span> actions})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-13" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<div class="cell hidden html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb58" data-startfrom="1323" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1322;"><span id="cb58-1323"><a href="#cb58-1323" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { calcuvegadata } <span class="im">from</span> <span class="st">"baafa4b071a5b66a"</span></span>
<span id="cb58-1324"><a href="#cb58-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1325"><a href="#cb58-1325" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {Scrubber} <span class="im">from</span> <span class="st">"@mbostock/scrubber"</span></span>
<span id="cb58-1326"><a href="#cb58-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1327"><a href="#cb58-1327" aria-hidden="true" tabindex="-1"></a>keys_stream_function_in <span class="op">=</span> (a) <span class="kw">=&gt;</span> [</span>
<span id="cb58-1328"><a href="#cb58-1328" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>keys_shared]</span>
<span id="cb58-1329"><a href="#cb58-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1330"><a href="#cb58-1330" aria-hidden="true" tabindex="-1"></a>level_data <span class="op">=</span> <span class="fu">calcuvegadata</span>({</span>
<span id="cb58-1331"><a href="#cb58-1331" aria-hidden="true" tabindex="-1"></a>  <span class="dt">models</span><span class="op">:</span> [raycasting2]<span class="op">,</span></span>
<span id="cb58-1332"><a href="#cb58-1332" aria-hidden="true" tabindex="-1"></a>  <span class="dt">spec</span><span class="op">:</span> rays<span class="op">,</span></span>
<span id="cb58-1333"><a href="#cb58-1333" aria-hidden="true" tabindex="-1"></a>  <span class="dt">domains</span><span class="op">:</span> {</span>
<span id="cb58-1334"><a href="#cb58-1334" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step_in</span><span class="op">:</span> _<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="fl">8.1</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">,</span></span>
<span id="cb58-1335"><a href="#cb58-1335" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ray_angle_in</span><span class="op">:</span> [ray_angle_in<span class="op">,</span> ]<span class="op">,</span><span class="co">//_.range(-1 / 2, 1.01 / 2, /*0.025*20 ROUNDING CAUSES </span><span class="al">BUG</span><span class="co"> TO NOT SHOW*/).map((d) =&gt; d + ray_angle_in) //[ray_angle_in, ray_angle_in + 0.4, ray_angle_in - 0.4]</span></span>
<span id="cb58-1336"><a href="#cb58-1336" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb58-1337"><a href="#cb58-1337" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input_cursors</span><span class="op">:</span> [{       keys_stream_function_in<span class="op">,</span></span>
<span id="cb58-1338"><a href="#cb58-1338" aria-hidden="true" tabindex="-1"></a>keys_stream_version_in<span class="op">,</span> f_in<span class="op">,</span></span>
<span id="cb58-1339"><a href="#cb58-1339" aria-hidden="true" tabindex="-1"></a><span class="co">//player_angle0_in//: ray_angle_in</span></span>
<span id="cb58-1340"><a href="#cb58-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1341"><a href="#cb58-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1342"><a href="#cb58-1342" aria-hidden="true" tabindex="-1"></a>}]</span>
<span id="cb58-1343"><a href="#cb58-1343" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb58-1344"><a href="#cb58-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1345"><a href="#cb58-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1346"><a href="#cb58-1346" aria-hidden="true" tabindex="-1"></a>fov_cursor <span class="op">=</span> { <span class="cf">return</span> ({    keys_stream_function_in<span class="op">,</span></span>
<span id="cb58-1347"><a href="#cb58-1347" aria-hidden="true" tabindex="-1"></a>    keys_stream_version_in<span class="op">,</span></span>
<span id="cb58-1348"><a href="#cb58-1348" aria-hidden="true" tabindex="-1"></a>    f_in<span class="op">,</span></span>
<span id="cb58-1349"><a href="#cb58-1349" aria-hidden="true" tabindex="-1"></a>})}</span>
<span id="cb58-1350"><a href="#cb58-1350" aria-hidden="true" tabindex="-1"></a>fov_data <span class="op">=</span> [{<span class="dt">id</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span>raycasting2<span class="op">.</span><span class="fu">player_x</span>(fov_cursor)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span>raycasting2<span class="op">.</span><span class="fu">player_y</span>(fov_cursor)}<span class="op">,</span>{<span class="dt">id</span><span class="op">:</span><span class="dv">1</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span>raycasting2<span class="op">.</span><span class="fu">rvx</span>({<span class="op">...</span>fov_cursor<span class="op">,</span> <span class="dt">step_in</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">ray_angle_in</span><span class="op">:</span> player_angle_in<span class="op">-.</span><span class="dv">5</span>})<span class="op">,</span> <span class="dt">y</span><span class="op">:</span>raycasting2<span class="op">.</span><span class="fu">rvy</span>({<span class="op">...</span>fov_cursor<span class="op">,</span> <span class="dt">step_in</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">ray_angle_in</span><span class="op">:</span> player_angle_in<span class="op">-.</span><span class="dv">5</span>})}<span class="op">,</span>{<span class="dt">id</span><span class="op">:</span><span class="dv">1</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span>raycasting2<span class="op">.</span><span class="fu">rvx</span>({<span class="op">...</span>fov_cursor<span class="op">,</span> <span class="dt">step_in</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">ray_angle_in</span><span class="op">:</span> player_angle_in<span class="op">+.</span><span class="dv">5</span>})<span class="op">,</span> <span class="dt">y</span><span class="op">:</span>raycasting2<span class="op">.</span><span class="fu">rvy</span>({<span class="op">...</span>fov_cursor<span class="op">,</span> <span class="dt">step_in</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">ray_angle_in</span><span class="op">:</span> player_angle_in<span class="op">+.</span><span class="dv">5</span>})}]</span>
<span id="cb58-1351"><a href="#cb58-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1352"><a href="#cb58-1352" aria-hidden="true" tabindex="-1"></a>player_data <span class="op">=</span>  <span class="fu">calcuvegadata</span>({</span>
<span id="cb58-1353"><a href="#cb58-1353" aria-hidden="true" tabindex="-1"></a>  <span class="dt">models</span><span class="op">:</span> [raycasting2]<span class="op">,</span></span>
<span id="cb58-1354"><a href="#cb58-1354" aria-hidden="true" tabindex="-1"></a>  <span class="dt">spec</span><span class="op">:</span> player_spec<span class="op">,</span></span>
<span id="cb58-1355"><a href="#cb58-1355" aria-hidden="true" tabindex="-1"></a>  <span class="dt">domains</span><span class="op">:</span> {</span>
<span id="cb58-1356"><a href="#cb58-1356" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb58-1357"><a href="#cb58-1357" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input_cursors</span><span class="op">:</span> [{</span>
<span id="cb58-1358"><a href="#cb58-1358" aria-hidden="true" tabindex="-1"></a>    keys_stream_function_in<span class="op">,</span></span>
<span id="cb58-1359"><a href="#cb58-1359" aria-hidden="true" tabindex="-1"></a>    keys_stream_version_in<span class="op">,</span></span>
<span id="cb58-1360"><a href="#cb58-1360" aria-hidden="true" tabindex="-1"></a>    f_in<span class="op">,</span></span>
<span id="cb58-1361"><a href="#cb58-1361" aria-hidden="true" tabindex="-1"></a>  }]</span>
<span id="cb58-1362"><a href="#cb58-1362" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb58-1363"><a href="#cb58-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1364"><a href="#cb58-1364" aria-hidden="true" tabindex="-1"></a>ray_steps_data <span class="op">=</span>  <span class="fu">calcuvegadata</span>({</span>
<span id="cb58-1365"><a href="#cb58-1365" aria-hidden="true" tabindex="-1"></a>  <span class="dt">models</span><span class="op">:</span> [raycasting2]<span class="op">,</span></span>
<span id="cb58-1366"><a href="#cb58-1366" aria-hidden="true" tabindex="-1"></a>  <span class="dt">spec</span><span class="op">:</span> ray_steps_spec<span class="op">,</span></span>
<span id="cb58-1367"><a href="#cb58-1367" aria-hidden="true" tabindex="-1"></a>  <span class="dt">domains</span><span class="op">:</span> {</span>
<span id="cb58-1368"><a href="#cb58-1368" aria-hidden="true" tabindex="-1"></a>    <span class="dt">step_in</span><span class="op">:</span> _<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span><span class="fl">8.1</span>)</span>
<span id="cb58-1369"><a href="#cb58-1369" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb58-1370"><a href="#cb58-1370" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input_cursors</span><span class="op">:</span> [{</span>
<span id="cb58-1371"><a href="#cb58-1371" aria-hidden="true" tabindex="-1"></a>    keys_stream_function_in<span class="op">,</span></span>
<span id="cb58-1372"><a href="#cb58-1372" aria-hidden="true" tabindex="-1"></a>    keys_stream_version_in<span class="op">,</span></span>
<span id="cb58-1373"><a href="#cb58-1373" aria-hidden="true" tabindex="-1"></a>    f_in<span class="op">,</span></span>
<span id="cb58-1374"><a href="#cb58-1374" aria-hidden="true" tabindex="-1"></a>    ray_angle_in</span>
<span id="cb58-1375"><a href="#cb58-1375" aria-hidden="true" tabindex="-1"></a>  }]</span>
<span id="cb58-1376"><a href="#cb58-1376" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb58-1377"><a href="#cb58-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1378"><a href="#cb58-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1379"><a href="#cb58-1379" aria-hidden="true" tabindex="-1"></a>map_data <span class="op">=</span> _<span class="op">.</span><span class="fu">range</span>(<span class="fl">0.5</span><span class="op">,</span><span class="dv">8</span>)<span class="op">.</span><span class="fu">map</span>(x_in <span class="kw">=&gt;</span> _<span class="op">.</span><span class="fu">range</span>(<span class="fl">0.5</span><span class="op">,</span><span class="dv">8</span>)<span class="op">.</span><span class="fu">map</span>(y_in <span class="kw">=&gt;</span> ({x_in<span class="op">,</span> y_in<span class="op">,</span> <span class="dt">map_check</span><span class="op">:</span> raycasting2<span class="op">.</span><span class="fu">map_check</span>({x_in<span class="op">,</span>y_in})})))<span class="op">.</span><span class="fu">flat</span>()</span>
<span id="cb58-1380"><a href="#cb58-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1381"><a href="#cb58-1381" aria-hidden="true" tabindex="-1"></a>updates_level <span class="op">=</span> {</span>
<span id="cb58-1382"><a href="#cb58-1382" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (ray_angle_in <span class="op">!=</span> <span class="kw">null</span>)</span>
<span id="cb58-1383"><a href="#cb58-1383" aria-hidden="true" tabindex="-1"></a>  <span class="co">//level.signal("ray_angle_in", ray_angle_in);</span></span>
<span id="cb58-1384"><a href="#cb58-1384" aria-hidden="true" tabindex="-1"></a>  level</span>
<span id="cb58-1385"><a href="#cb58-1385" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(<span class="st">"source"</span><span class="op">,</span> level_data) <span class="co">/*.resize()*/</span></span>
<span id="cb58-1386"><a href="#cb58-1386" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">run</span>()<span class="op">;</span></span>
<span id="cb58-1387"><a href="#cb58-1387" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-1388"><a href="#cb58-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1389"><a href="#cb58-1389" aria-hidden="true" tabindex="-1"></a>level<span class="op">.</span><span class="fu">data</span>(<span class="st">'player_data'</span><span class="op">,</span> player_data)<span class="op">.</span><span class="fu">run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-4" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-5" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-6" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-7" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-8" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-9" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-10" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-11" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb59" data-startfrom="1390" data-source-offset="-1909"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1389;"><span id="cb59-1390"><a href="#cb59-1390" aria-hidden="true" tabindex="-1"></a>level<span class="op">.</span><span class="fu">data</span>(<span class="st">'ray_steps_data'</span><span class="op">,</span> ray_steps_data)<span class="op">.</span><span class="fu">run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-12" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb60" data-startfrom="1392" data-source-offset="-1961"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1391;"><span id="cb60-1392"><a href="#cb60-1392" aria-hidden="true" tabindex="-1"></a>level<span class="op">.</span><span class="fu">signal</span>(<span class="st">'player_angle_in'</span><span class="op">,</span> player_angle_in)<span class="op">.</span><span class="fu">run</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-13" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb61" data-startfrom="1396" data-source-offset="-2019"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1395;"><span id="cb61-1396"><a href="#cb61-1396" aria-hidden="true" tabindex="-1"></a>updates_fov <span class="op">=</span> {</span>
<span id="cb61-1397"><a href="#cb61-1397" aria-hidden="true" tabindex="-1"></a>  level</span>
<span id="cb61-1398"><a href="#cb61-1398" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(<span class="st">"fov"</span><span class="op">,</span> fov_data) <span class="co">/*.resize()*/</span></span>
<span id="cb61-1399"><a href="#cb61-1399" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">run</span>()<span class="op">;</span></span>
<span id="cb61-1400"><a href="#cb61-1400" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-1401"><a href="#cb61-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1402"><a href="#cb61-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1403"><a href="#cb61-1403" aria-hidden="true" tabindex="-1"></a>mutable scene_data0 <span class="op">=</span> []</span>
<span id="cb61-1404"><a href="#cb61-1404" aria-hidden="true" tabindex="-1"></a>mutable level_data0 <span class="op">=</span> [] <span class="co">// includes data in spec for when I Open in Vega Editor</span></span>
<span id="cb61-1405"><a href="#cb61-1405" aria-hidden="true" tabindex="-1"></a>mutable fov_data0 <span class="op">=</span> [] </span>
<span id="cb61-1406"><a href="#cb61-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1407"><a href="#cb61-1407" aria-hidden="true" tabindex="-1"></a>rays <span class="op">=</span> {<span class="cf">return</span> [</span>
<span id="cb61-1408"><a href="#cb61-1408" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb61-1409"><a href="#cb61-1409" aria-hidden="true" tabindex="-1"></a>      <span class="dt">from</span><span class="op">:</span> { <span class="dt">data</span><span class="op">:</span> <span class="st">"source"</span> }<span class="op">,</span></span>
<span id="cb61-1410"><a href="#cb61-1410" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"symbol"</span><span class="op">,</span></span>
<span id="cb61-1411"><a href="#cb61-1411" aria-hidden="true" tabindex="-1"></a>      <span class="dt">encode</span><span class="op">:</span> {</span>
<span id="cb61-1412"><a href="#cb61-1412" aria-hidden="true" tabindex="-1"></a>        <span class="dt">enter</span><span class="op">:</span> {</span>
<span id="cb61-1413"><a href="#cb61-1413" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"r_hit_x"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span></span>
<span id="cb61-1414"><a href="#cb61-1414" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"r_hit_y"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"y"</span> }<span class="op">,</span></span>
<span id="cb61-1415"><a href="#cb61-1415" aria-hidden="true" tabindex="-1"></a>          <span class="dt">size</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"r_length"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"length"</span> }<span class="op">,</span></span>
<span id="cb61-1416"><a href="#cb61-1416" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">"orange"</span> }<span class="op">,</span></span>
<span id="cb61-1417"><a href="#cb61-1417" aria-hidden="true" tabindex="-1"></a>          <span class="co">//opacity: {value: 0.4},</span></span>
<span id="cb61-1418"><a href="#cb61-1418" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fillOpacity</span><span class="op">:</span> {<span class="dt">value</span><span class="op">:</span> <span class="fl">0.1</span>}<span class="op">,</span></span>
<span id="cb61-1419"><a href="#cb61-1419" aria-hidden="true" tabindex="-1"></a>          <span class="dt">stroke</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">"black"</span> }<span class="op">,</span></span>
<span id="cb61-1420"><a href="#cb61-1420" aria-hidden="true" tabindex="-1"></a>          <span class="dt">shape</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">"square"</span> }</span>
<span id="cb61-1421"><a href="#cb61-1421" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb61-1422"><a href="#cb61-1422" aria-hidden="true" tabindex="-1"></a>        <span class="dt">update</span><span class="op">:</span> {</span>
<span id="cb61-1423"><a href="#cb61-1423" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"r_hit_x"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span></span>
<span id="cb61-1424"><a href="#cb61-1424" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"r_hit_y"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"y"</span> }<span class="op">,</span></span>
<span id="cb61-1425"><a href="#cb61-1425" aria-hidden="true" tabindex="-1"></a>          <span class="dt">size</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"r_length"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"length"</span> }<span class="op">,</span></span>
<span id="cb61-1426"><a href="#cb61-1426" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb61-1427"><a href="#cb61-1427" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb61-1428"><a href="#cb61-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1429"><a href="#cb61-1429" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb61-1430"><a href="#cb61-1430" aria-hidden="true" tabindex="-1"></a>({</span>
<span id="cb61-1431"><a href="#cb61-1431" aria-hidden="true" tabindex="-1"></a>  <span class="dt">from</span><span class="op">:</span> { <span class="dt">data</span><span class="op">:</span> <span class="st">"source"</span> }<span class="op">,</span></span>
<span id="cb61-1432"><a href="#cb61-1432" aria-hidden="true" tabindex="-1"></a>  <span class="co">//mark: {type: "rule", clip: true},</span></span>
<span id="cb61-1433"><a href="#cb61-1433" aria-hidden="true" tabindex="-1"></a>  <span class="dt">type</span><span class="op">:</span> <span class="st">'rule'</span><span class="op">,</span></span>
<span id="cb61-1434"><a href="#cb61-1434" aria-hidden="true" tabindex="-1"></a>  <span class="dt">encode</span><span class="op">:</span> {</span>
<span id="cb61-1435"><a href="#cb61-1435" aria-hidden="true" tabindex="-1"></a>    <span class="dt">enter</span><span class="op">:</span> {</span>
<span id="cb61-1436"><a href="#cb61-1436" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">"red"</span> }<span class="op">,</span></span>
<span id="cb61-1437"><a href="#cb61-1437" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="dv">3</span> }<span class="op">,</span></span>
<span id="cb61-1438"><a href="#cb61-1438" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeOpacity</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb61-1439"><a href="#cb61-1439" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeDash</span><span class="op">:</span> {<span class="dt">value</span><span class="op">:</span> [<span class="dv">8</span><span class="op">,</span><span class="dv">8</span>]}</span>
<span id="cb61-1440"><a href="#cb61-1440" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb61-1441"><a href="#cb61-1441" aria-hidden="true" tabindex="-1"></a>    <span class="dt">update</span><span class="op">:</span> {</span>
<span id="cb61-1442"><a href="#cb61-1442" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"player_x"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span></span>
<span id="cb61-1443"><a href="#cb61-1443" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"player_y"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"y"</span> }<span class="op">,</span></span>
<span id="cb61-1444"><a href="#cb61-1444" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"r_hit_x"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span></span>
<span id="cb61-1445"><a href="#cb61-1445" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"r_hit_y"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"y"</span> }</span>
<span id="cb61-1446"><a href="#cb61-1446" aria-hidden="true" tabindex="-1"></a>      <span class="co">//stroke: { field: "ray_angle_in" }</span></span>
<span id="cb61-1447"><a href="#cb61-1447" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-1448"><a href="#cb61-1448" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-1449"><a href="#cb61-1449" aria-hidden="true" tabindex="-1"></a>})]}</span>
<span id="cb61-1450"><a href="#cb61-1450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1451"><a href="#cb61-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1452"><a href="#cb61-1452" aria-hidden="true" tabindex="-1"></a>hits <span class="op">=</span> {<span class="cf">return</span> ({</span>
<span id="cb61-1453"><a href="#cb61-1453" aria-hidden="true" tabindex="-1"></a>      <span class="co">//</span></span>
<span id="cb61-1454"><a href="#cb61-1454" aria-hidden="true" tabindex="-1"></a>    })}</span>
<span id="cb61-1455"><a href="#cb61-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1456"><a href="#cb61-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1457"><a href="#cb61-1457" aria-hidden="true" tabindex="-1"></a>fov_spec <span class="op">=</span> {<span class="cf">return</span> ({</span>
<span id="cb61-1458"><a href="#cb61-1458" aria-hidden="true" tabindex="-1"></a>  <span class="dt">from</span><span class="op">:</span> { <span class="dt">data</span><span class="op">:</span> <span class="st">"fov"</span> }<span class="op">,</span></span>
<span id="cb61-1459"><a href="#cb61-1459" aria-hidden="true" tabindex="-1"></a>  <span class="dt">type</span><span class="op">:</span> <span class="st">"line"</span><span class="op">,</span></span>
<span id="cb61-1460"><a href="#cb61-1460" aria-hidden="true" tabindex="-1"></a>  <span class="dt">encode</span><span class="op">:</span> {</span>
<span id="cb61-1461"><a href="#cb61-1461" aria-hidden="true" tabindex="-1"></a>    <span class="dt">enter</span><span class="op">:</span> {</span>
<span id="cb61-1462"><a href="#cb61-1462" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">"#0FFF50"</span> }<span class="op">,</span></span>
<span id="cb61-1463"><a href="#cb61-1463" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="fl">5.01</span> }<span class="op">,</span></span>
<span id="cb61-1464"><a href="#cb61-1464" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeOpacity</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb61-1465"><a href="#cb61-1465" aria-hidden="true" tabindex="-1"></a>      <span class="dt">interpolate</span><span class="op">:</span> {<span class="dt">value</span><span class="op">:</span> <span class="st">'linear-closed'</span>}</span>
<span id="cb61-1466"><a href="#cb61-1466" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb61-1467"><a href="#cb61-1467" aria-hidden="true" tabindex="-1"></a>    <span class="dt">update</span><span class="op">:</span> {</span>
<span id="cb61-1468"><a href="#cb61-1468" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span></span>
<span id="cb61-1469"><a href="#cb61-1469" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"y"</span> }<span class="op">,</span></span>
<span id="cb61-1470"><a href="#cb61-1470" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">"green"</span> }<span class="op">,</span></span>
<span id="cb61-1471"><a href="#cb61-1471" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> {<span class="dt">value</span><span class="op">:</span> <span class="fl">0.2</span>}</span>
<span id="cb61-1472"><a href="#cb61-1472" aria-hidden="true" tabindex="-1"></a>      <span class="co">//x2: { field: "rvx", scale: "x" },</span></span>
<span id="cb61-1473"><a href="#cb61-1473" aria-hidden="true" tabindex="-1"></a>      <span class="co">//y2: { field: "rvy", scale: "y" }</span></span>
<span id="cb61-1474"><a href="#cb61-1474" aria-hidden="true" tabindex="-1"></a>      <span class="co">//stroke: { field: "ray_angle_in" }</span></span>
<span id="cb61-1475"><a href="#cb61-1475" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-1476"><a href="#cb61-1476" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-1477"><a href="#cb61-1477" aria-hidden="true" tabindex="-1"></a>})}</span>
<span id="cb61-1478"><a href="#cb61-1478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1479"><a href="#cb61-1479" aria-hidden="true" tabindex="-1"></a>map_spec <span class="op">=</span> {<span class="cf">return</span> ({</span>
<span id="cb61-1480"><a href="#cb61-1480" aria-hidden="true" tabindex="-1"></a>  <span class="dt">from</span><span class="op">:</span> { <span class="dt">data</span><span class="op">:</span> <span class="st">"map_data"</span> }<span class="op">,</span></span>
<span id="cb61-1481"><a href="#cb61-1481" aria-hidden="true" tabindex="-1"></a>  <span class="dt">type</span><span class="op">:</span> <span class="st">"rect"</span><span class="op">,</span></span>
<span id="cb61-1482"><a href="#cb61-1482" aria-hidden="true" tabindex="-1"></a>  <span class="dt">encode</span><span class="op">:</span> {</span>
<span id="cb61-1483"><a href="#cb61-1483" aria-hidden="true" tabindex="-1"></a>    <span class="dt">enter</span><span class="op">:</span> {</span>
<span id="cb61-1484"><a href="#cb61-1484" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> { <span class="dt">signal</span><span class="op">:</span> <span class="st">"floor(datum.x_in)"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">'x'</span> }<span class="op">,</span></span>
<span id="cb61-1485"><a href="#cb61-1485" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> { <span class="dt">signal</span><span class="op">:</span> <span class="st">"floor(datum.x_in)+1-0.05"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">'x'</span> }<span class="op">,</span></span>
<span id="cb61-1486"><a href="#cb61-1486" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> { <span class="dt">signal</span><span class="op">:</span> <span class="st">"floor(datum.y_in)"</span> <span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">'y'</span>}<span class="op">,</span></span>
<span id="cb61-1487"><a href="#cb61-1487" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> { <span class="dt">signal</span><span class="op">:</span> <span class="st">"floor(datum.y_in)+1-0.05"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">'y'</span> }<span class="op">,</span></span>
<span id="cb61-1488"><a href="#cb61-1488" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">'map_check'</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">'map_check'</span>}</span>
<span id="cb61-1489"><a href="#cb61-1489" aria-hidden="true" tabindex="-1"></a>      <span class="co">//color: { field: "floor(datum.y_in)+1" },</span></span>
<span id="cb61-1490"><a href="#cb61-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1491"><a href="#cb61-1491" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb61-1492"><a href="#cb61-1492" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-1493"><a href="#cb61-1493" aria-hidden="true" tabindex="-1"></a>})}</span>
<span id="cb61-1494"><a href="#cb61-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1495"><a href="#cb61-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1496"><a href="#cb61-1496" aria-hidden="true" tabindex="-1"></a>player_spec <span class="op">=</span> {<span class="cf">return</span> ({</span>
<span id="cb61-1497"><a href="#cb61-1497" aria-hidden="true" tabindex="-1"></a>      <span class="co">// PLAYER</span></span>
<span id="cb61-1498"><a href="#cb61-1498" aria-hidden="true" tabindex="-1"></a>      <span class="dt">from</span><span class="op">:</span> { <span class="dt">data</span><span class="op">:</span> <span class="st">"player_data"</span> }<span class="op">,</span></span>
<span id="cb61-1499"><a href="#cb61-1499" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"symbol"</span><span class="op">,</span></span>
<span id="cb61-1500"><a href="#cb61-1500" aria-hidden="true" tabindex="-1"></a>      <span class="dt">encode</span><span class="op">:</span> {</span>
<span id="cb61-1501"><a href="#cb61-1501" aria-hidden="true" tabindex="-1"></a>        <span class="dt">enter</span><span class="op">:</span> {</span>
<span id="cb61-1502"><a href="#cb61-1502" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"player_x"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span></span>
<span id="cb61-1503"><a href="#cb61-1503" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"player_y"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"y"</span> }<span class="op">,</span></span>
<span id="cb61-1504"><a href="#cb61-1504" aria-hidden="true" tabindex="-1"></a>          <span class="dt">size</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="dv">500</span> }<span class="op">,</span></span>
<span id="cb61-1505"><a href="#cb61-1505" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">"yellow"</span> }<span class="op">,</span></span>
<span id="cb61-1506"><a href="#cb61-1506" aria-hidden="true" tabindex="-1"></a>          <span class="dt">stroke</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">"black"</span> }<span class="op">,</span></span>
<span id="cb61-1507"><a href="#cb61-1507" aria-hidden="true" tabindex="-1"></a>          <span class="dt">shape</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">"arrow"</span> }</span>
<span id="cb61-1508"><a href="#cb61-1508" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb61-1509"><a href="#cb61-1509" aria-hidden="true" tabindex="-1"></a>        <span class="dt">update</span><span class="op">:</span> {</span>
<span id="cb61-1510"><a href="#cb61-1510" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"player_x"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span></span>
<span id="cb61-1511"><a href="#cb61-1511" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"player_y"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"y"</span> }<span class="op">,</span></span>
<span id="cb61-1512"><a href="#cb61-1512" aria-hidden="true" tabindex="-1"></a>          <span class="dt">angle</span><span class="op">:</span> { <span class="dt">signal</span><span class="op">:</span> <span class="st">"-180 - 90 - player_angle_in * 180 / PI"</span> }</span>
<span id="cb61-1513"><a href="#cb61-1513" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb61-1514"><a href="#cb61-1514" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb61-1515"><a href="#cb61-1515" aria-hidden="true" tabindex="-1"></a>    })}</span>
<span id="cb61-1516"><a href="#cb61-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1517"><a href="#cb61-1517" aria-hidden="true" tabindex="-1"></a>ray_steps_spec <span class="op">=</span> {<span class="cf">return</span> ([</span>
<span id="cb61-1518"><a href="#cb61-1518" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb61-1519"><a href="#cb61-1519" aria-hidden="true" tabindex="-1"></a>      <span class="co">// HORIZONTAL REDS</span></span>
<span id="cb61-1520"><a href="#cb61-1520" aria-hidden="true" tabindex="-1"></a>      <span class="dt">from</span><span class="op">:</span> { <span class="dt">data</span><span class="op">:</span> <span class="st">"ray_steps_data"</span> }<span class="op">,</span></span>
<span id="cb61-1521"><a href="#cb61-1521" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">'h'</span><span class="op">,</span></span>
<span id="cb61-1522"><a href="#cb61-1522" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"symbol"</span><span class="op">,</span></span>
<span id="cb61-1523"><a href="#cb61-1523" aria-hidden="true" tabindex="-1"></a>      <span class="dt">encode</span><span class="op">:</span> {</span>
<span id="cb61-1524"><a href="#cb61-1524" aria-hidden="true" tabindex="-1"></a>        <span class="dt">enter</span><span class="op">:</span> {</span>
<span id="cb61-1525"><a href="#cb61-1525" aria-hidden="true" tabindex="-1"></a>          <span class="co">//opacity: { value: opacity_vertical },</span></span>
<span id="cb61-1526"><a href="#cb61-1526" aria-hidden="true" tabindex="-1"></a>          <span class="co">//opacity: { field: "if_ray_hit_horizontal", scale: "hit" },</span></span>
<span id="cb61-1527"><a href="#cb61-1527" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"rhx"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span></span>
<span id="cb61-1528"><a href="#cb61-1528" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"rhy"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"y"</span> }<span class="op">,</span></span>
<span id="cb61-1529"><a href="#cb61-1529" aria-hidden="true" tabindex="-1"></a>          <span class="dt">size</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="dv">300</span> }<span class="op">,</span></span>
<span id="cb61-1530"><a href="#cb61-1530" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">"red"</span> }<span class="op">,</span></span>
<span id="cb61-1531"><a href="#cb61-1531" aria-hidden="true" tabindex="-1"></a>          <span class="dt">shape</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">"circle"</span> }<span class="op">,</span></span>
<span id="cb61-1532"><a href="#cb61-1532" aria-hidden="true" tabindex="-1"></a>          <span class="dt">strokeWidth</span><span class="op">:</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">5</span>}<span class="op">,</span></span>
<span id="cb61-1533"><a href="#cb61-1533" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb61-1534"><a href="#cb61-1534" aria-hidden="true" tabindex="-1"></a>        <span class="dt">update</span><span class="op">:</span> {</span>
<span id="cb61-1535"><a href="#cb61-1535" aria-hidden="true" tabindex="-1"></a>          <span class="dt">stroke</span><span class="op">:</span> { <span class="dt">signal</span><span class="op">:</span> <span class="st">"(datum.step_in == step_in[0] &amp;&amp; step_in[1] == 'h') ? 'yellow' : null"</span>}<span class="op">,</span><span class="co">//, scale: "hit" },</span></span>
<span id="cb61-1536"><a href="#cb61-1536" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"rhx"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span></span>
<span id="cb61-1537"><a href="#cb61-1537" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"rhy"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"y"</span> }</span>
<span id="cb61-1538"><a href="#cb61-1538" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb61-1539"><a href="#cb61-1539" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb61-1540"><a href="#cb61-1540" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb61-1541"><a href="#cb61-1541" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-1542"><a href="#cb61-1542" aria-hidden="true" tabindex="-1"></a>      <span class="co">// VERTICAL GREENS</span></span>
<span id="cb61-1543"><a href="#cb61-1543" aria-hidden="true" tabindex="-1"></a>      <span class="dt">from</span><span class="op">:</span> { <span class="dt">data</span><span class="op">:</span> <span class="st">"ray_steps_data"</span> }<span class="op">,</span></span>
<span id="cb61-1544"><a href="#cb61-1544" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"symbol"</span><span class="op">,</span></span>
<span id="cb61-1545"><a href="#cb61-1545" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">'v'</span><span class="op">,</span></span>
<span id="cb61-1546"><a href="#cb61-1546" aria-hidden="true" tabindex="-1"></a>      <span class="dt">encode</span><span class="op">:</span> {</span>
<span id="cb61-1547"><a href="#cb61-1547" aria-hidden="true" tabindex="-1"></a>        <span class="dt">enter</span><span class="op">:</span> {</span>
<span id="cb61-1548"><a href="#cb61-1548" aria-hidden="true" tabindex="-1"></a>          <span class="co">//opacity: { value: opacity_vertical },</span></span>
<span id="cb61-1549"><a href="#cb61-1549" aria-hidden="true" tabindex="-1"></a>          <span class="co">//opacity: { field: "if_ray_hit_vertical", scale: "hit" },</span></span>
<span id="cb61-1550"><a href="#cb61-1550" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"rvx"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span></span>
<span id="cb61-1551"><a href="#cb61-1551" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"rvy"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"y"</span> }<span class="op">,</span></span>
<span id="cb61-1552"><a href="#cb61-1552" aria-hidden="true" tabindex="-1"></a>          <span class="dt">size</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="dv">200</span> }<span class="op">,</span></span>
<span id="cb61-1553"><a href="#cb61-1553" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">"green"</span> }<span class="op">,</span></span>
<span id="cb61-1554"><a href="#cb61-1554" aria-hidden="true" tabindex="-1"></a>          <span class="dt">shape</span><span class="op">:</span> { <span class="dt">value</span><span class="op">:</span> <span class="st">"circle"</span> }<span class="op">,</span></span>
<span id="cb61-1555"><a href="#cb61-1555" aria-hidden="true" tabindex="-1"></a>          <span class="dt">strokeWidth</span><span class="op">:</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">5</span>}<span class="op">,</span></span>
<span id="cb61-1556"><a href="#cb61-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1557"><a href="#cb61-1557" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb61-1558"><a href="#cb61-1558" aria-hidden="true" tabindex="-1"></a>        <span class="dt">update</span><span class="op">:</span> {</span>
<span id="cb61-1559"><a href="#cb61-1559" aria-hidden="true" tabindex="-1"></a>          <span class="co">//opacity: { value: opacity_vertical },</span></span>
<span id="cb61-1560"><a href="#cb61-1560" aria-hidden="true" tabindex="-1"></a>          <span class="dt">stroke</span><span class="op">:</span> { <span class="dt">signal</span><span class="op">:</span> <span class="st">"(datum.step_in == step_in[0] &amp;&amp; step_in[1] == 'v') ? 'yellow' : null"</span>}<span class="op">,</span><span class="co">//, scale: "hit" },</span></span>
<span id="cb61-1561"><a href="#cb61-1561" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"rvx"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"x"</span> }<span class="op">,</span></span>
<span id="cb61-1562"><a href="#cb61-1562" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> { <span class="dt">field</span><span class="op">:</span> <span class="st">"rvy"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"y"</span> }</span>
<span id="cb61-1563"><a href="#cb61-1563" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb61-1564"><a href="#cb61-1564" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb61-1565"><a href="#cb61-1565" aria-hidden="true" tabindex="-1"></a>    }])}</span>
<span id="cb61-1566"><a href="#cb61-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1567"><a href="#cb61-1567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1568"><a href="#cb61-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1569"><a href="#cb61-1569" aria-hidden="true" tabindex="-1"></a>level_spec <span class="op">=</span> { <span class="cf">return</span> ({</span>
<span id="cb61-1570"><a href="#cb61-1570" aria-hidden="true" tabindex="-1"></a>  <span class="dt">data</span><span class="op">:</span> [</span>
<span id="cb61-1571"><a href="#cb61-1571" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"source"</span><span class="op">,</span> <span class="dt">values</span><span class="op">:</span> level_data0 }<span class="op">,</span> <span class="co">// layer 5 for rays by step</span></span>
<span id="cb61-1572"><a href="#cb61-1572" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"fov"</span><span class="op">,</span> <span class="dt">values</span><span class="op">:</span> fov_data0 }<span class="op">,</span></span>
<span id="cb61-1573"><a href="#cb61-1573" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"map_data"</span><span class="op">,</span> <span class="dt">values</span><span class="op">:</span> map_data }<span class="op">,</span></span>
<span id="cb61-1574"><a href="#cb61-1574" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"player_data"</span><span class="op">,</span> <span class="dt">values</span><span class="op">:</span> [] }<span class="op">,</span></span>
<span id="cb61-1575"><a href="#cb61-1575" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"hits_data"</span><span class="op">,</span> <span class="dt">values</span><span class="op">:</span> [] }<span class="op">,</span></span>
<span id="cb61-1576"><a href="#cb61-1576" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"ray_steps_data"</span><span class="op">,</span> <span class="dt">values</span><span class="op">:</span> [] }<span class="op">,</span></span>
<span id="cb61-1577"><a href="#cb61-1577" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb61-1578"><a href="#cb61-1578" aria-hidden="true" tabindex="-1"></a>  <span class="co">//background: "grey",</span></span>
<span id="cb61-1579"><a href="#cb61-1579" aria-hidden="true" tabindex="-1"></a>  <span class="co">//width: 'container',</span></span>
<span id="cb61-1580"><a href="#cb61-1580" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb61-1581"><a href="#cb61-1581" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span></span>
<span id="cb61-1582"><a href="#cb61-1582" aria-hidden="true" tabindex="-1"></a>  <span class="dt">background</span><span class="op">:</span> <span class="st">'#ddd'</span><span class="op">,</span></span>
<span id="cb61-1583"><a href="#cb61-1583" aria-hidden="true" tabindex="-1"></a>  <span class="dt">signals</span><span class="op">:</span> [</span>
<span id="cb61-1584"><a href="#cb61-1584" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"player_angle_in"</span> }<span class="op">,</span></span>
<span id="cb61-1585"><a href="#cb61-1585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1586"><a href="#cb61-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1587"><a href="#cb61-1587" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-1588"><a href="#cb61-1588" aria-hidden="true" tabindex="-1"></a>      <span class="st">"name"</span><span class="op">:</span> <span class="st">"step_in"</span><span class="op">,</span></span>
<span id="cb61-1589"><a href="#cb61-1589" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> [<span class="op">-</span><span class="dv">10</span><span class="op">,</span><span class="st">'?'</span>]<span class="op">,</span></span>
<span id="cb61-1590"><a href="#cb61-1590" aria-hidden="true" tabindex="-1"></a>      <span class="st">"on"</span><span class="op">:</span> [{<span class="st">"events"</span><span class="op">:</span> <span class="st">"@h:mouseover"</span><span class="op">,</span> <span class="st">"update"</span><span class="op">:</span> <span class="st">"[datum.step_in, 'h']"</span>}<span class="op">,</span>{<span class="st">"events"</span><span class="op">:</span> <span class="st">"@v:mouseover"</span><span class="op">,</span> <span class="st">"update"</span><span class="op">:</span> <span class="st">"[datum.step_in, 'v']"</span>}]</span>
<span id="cb61-1591"><a href="#cb61-1591" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-1592"><a href="#cb61-1592" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb61-1593"><a href="#cb61-1593" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scales</span><span class="op">:</span> [</span>
<span id="cb61-1594"><a href="#cb61-1594" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">"linear"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span> <span class="dt">range</span><span class="op">:</span> <span class="st">"width"</span> }<span class="op">,</span></span>
<span id="cb61-1595"><a href="#cb61-1595" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">"linear"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span> <span class="dt">range</span><span class="op">:</span> <span class="st">"height"</span><span class="op">,</span> <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb61-1596"><a href="#cb61-1596" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"hit"</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">"ordinal"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> <span class="dt">range</span><span class="op">:</span> [<span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.1</span>] }<span class="op">,</span></span>
<span id="cb61-1597"><a href="#cb61-1597" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"length"</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">"linear"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="dv">2</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span> <span class="dt">range</span><span class="op">:</span> [<span class="dv">1000</span><span class="op">,</span> <span class="dv">10</span>]  }<span class="op">,</span></span>
<span id="cb61-1598"><a href="#cb61-1598" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"length2"</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">"linear"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="dv">2</span><span class="op">,</span> <span class="dv">6</span>]<span class="op">,</span> <span class="dt">range</span><span class="op">:</span> [<span class="dv">1000</span><span class="op">,</span> <span class="dv">0</span>]  }<span class="op">,</span></span>
<span id="cb61-1599"><a href="#cb61-1599" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">name</span><span class="op">:</span> <span class="st">"map_check"</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">"ordinal"</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">,</span> <span class="dt">range</span><span class="op">:</span> [<span class="st">"white"</span><span class="op">,</span> <span class="st">"hsl(250, 76%, 60%)"</span><span class="op">,</span><span class="st">"hsl(200, 76%, 60%)"</span><span class="op">,</span><span class="st">"hsl(100, 76%, 60%)"</span>] }</span>
<span id="cb61-1600"><a href="#cb61-1600" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb61-1601"><a href="#cb61-1601" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb61-1602"><a href="#cb61-1602" aria-hidden="true" tabindex="-1"></a>    map_spec<span class="op">,</span></span>
<span id="cb61-1603"><a href="#cb61-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1604"><a href="#cb61-1604" aria-hidden="true" tabindex="-1"></a>    fov_spec<span class="op">,</span></span>
<span id="cb61-1605"><a href="#cb61-1605" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>(show_ray <span class="op">?</span> rays <span class="op">:</span> [])<span class="op">,</span></span>
<span id="cb61-1606"><a href="#cb61-1606" aria-hidden="true" tabindex="-1"></a>    player_spec<span class="op">,</span></span>
<span id="cb61-1607"><a href="#cb61-1607" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>(show_ray_steps <span class="op">?</span> ray_steps_spec <span class="op">:</span> [])<span class="op">,</span></span>
<span id="cb61-1608"><a href="#cb61-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1609"><a href="#cb61-1609" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb61-1610"><a href="#cb61-1610" aria-hidden="true" tabindex="-1"></a>  <span class="dt">axes</span><span class="op">:</span> [</span>
<span id="cb61-1611"><a href="#cb61-1611" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">orient</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">labelFontSize</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">labelColor</span><span class="op">:</span> <span class="st">'blue'</span>}<span class="op">,</span></span>
<span id="cb61-1612"><a href="#cb61-1612" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">orient</span><span class="op">:</span> <span class="st">"left"</span><span class="op">,</span> <span class="dt">scale</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">labelFontSize</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">labelColor</span><span class="op">:</span> <span class="st">'blue'</span>}</span>
<span id="cb61-1613"><a href="#cb61-1613" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb61-1614"><a href="#cb61-1614" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb61-1615"><a href="#cb61-1615" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-1616"><a href="#cb61-1616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1617"><a href="#cb61-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1618"><a href="#cb61-1618" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;style&gt;</span></span>
<span id="cb61-1619"><a href="#cb61-1619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1620"><a href="#cb61-1620" aria-hidden="true" tabindex="-1"></a><span class="vs">.modeldept {</span></span>
<span id="cb61-1621"><a href="#cb61-1621" aria-hidden="true" tabindex="-1"></a><span class="vs">  display: none;</span></span>
<span id="cb61-1622"><a href="#cb61-1622" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb61-1623"><a href="#cb61-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1624"><a href="#cb61-1624" aria-hidden="true" tabindex="-1"></a><span class="vs">#</span><span class="sc">${</span>modelname<span class="sc">}</span><span class="vs">.modeldept {</span></span>
<span id="cb61-1625"><a href="#cb61-1625" aria-hidden="true" tabindex="-1"></a><span class="vs">  display: block;</span></span>
<span id="cb61-1626"><a href="#cb61-1626" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb61-1627"><a href="#cb61-1627" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/style&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-14" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-15" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-16" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-17" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-18" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-19" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-20" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-21" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-22" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-23" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-24" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-25" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb62" data-startfrom="1631" data-source-offset="-8188"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1630;"><span id="cb62-1631"><a href="#cb62-1631" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb62-1632"><a href="#cb62-1632" aria-hidden="true" tabindex="-1"></a>    savings_viz<span class="op">.</span><span class="fu">addSignalListener</span>(<span class="st">'doubleclick'</span><span class="op">,</span> _ <span class="kw">=&gt;</span> {</span>
<span id="cb62-1633"><a href="#cb62-1633" aria-hidden="true" tabindex="-1"></a>      <span class="kw">set</span>(viewof overlay<span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb62-1634"><a href="#cb62-1634" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb62-1635"><a href="#cb62-1635" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-14-26" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
</div>
<div id="savings" class="modeldept html-fill-item html-fill-container">
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb63" data-startfrom="1645" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1644;"><span id="cb63-1645"><a href="#cb63-1645" aria-hidden="true" tabindex="-1"></a>mutable savings_data0 <span class="op">=</span> []</span>
<span id="cb63-1646"><a href="#cb63-1646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1647"><a href="#cb63-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1648"><a href="#cb63-1648" aria-hidden="true" tabindex="-1"></a>savings_spec <span class="op">=</span> { <span class="cf">return</span> ({</span>
<span id="cb63-1649"><a href="#cb63-1649" aria-hidden="true" tabindex="-1"></a>  <span class="co">//width: 'container', height:'container', bad for mobile</span></span>
<span id="cb63-1650"><a href="#cb63-1650" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="st">'container'</span><span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">350</span><span class="op">,</span></span>
<span id="cb63-1651"><a href="#cb63-1651" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span><span class="op">:</span> {<span class="st">"name"</span><span class="op">:</span> <span class="st">"source"</span>}<span class="op">,</span></span>
<span id="cb63-1652"><a href="#cb63-1652" aria-hidden="true" tabindex="-1"></a>  <span class="dt">datasets</span><span class="op">:</span> {<span class="st">'source'</span><span class="op">:</span> savings_data0 }<span class="op">,</span></span>
<span id="cb63-1653"><a href="#cb63-1653" aria-hidden="true" tabindex="-1"></a>  <span class="dt">mark</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">'text'</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">tooltip</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">,</span></span>
<span id="cb63-1654"><a href="#cb63-1654" aria-hidden="true" tabindex="-1"></a>  <span class="dt">encoding</span><span class="op">:</span> {</span>
<span id="cb63-1655"><a href="#cb63-1655" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {<span class="dt">field</span><span class="op">:</span> <span class="st">'formula'</span>}<span class="op">,</span></span>
<span id="cb63-1656"><a href="#cb63-1656" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {<span class="dt">field</span><span class="op">:</span> <span class="st">'formula'</span><span class="op">,</span> <span class="dt">legend</span><span class="op">:</span> <span class="kw">false</span>}<span class="op">,</span></span>
<span id="cb63-1657"><a href="#cb63-1657" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {<span class="dt">field</span><span class="op">:</span> <span class="st">'year_in'</span>}<span class="op">,</span></span>
<span id="cb63-1658"><a href="#cb63-1658" aria-hidden="true" tabindex="-1"></a>    <span class="dt">text</span><span class="op">:</span> {<span class="dt">field</span><span class="op">:</span> <span class="st">'value'</span><span class="co">/*, format:',.2f'*/</span>}</span>
<span id="cb63-1659"><a href="#cb63-1659" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb63-1660"><a href="#cb63-1660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1661"><a href="#cb63-1661" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> [</span>
<span id="cb63-1662"><a href="#cb63-1662" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb63-1663"><a href="#cb63-1663" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"formula"</span><span class="op">,</span></span>
<span id="cb63-1664"><a href="#cb63-1664" aria-hidden="true" tabindex="-1"></a>      <span class="co">//value: { ray_angle_in: 0 },</span></span>
<span id="cb63-1665"><a href="#cb63-1665" aria-hidden="true" tabindex="-1"></a>      <span class="dt">select</span><span class="op">:</span> {</span>
<span id="cb63-1666"><a href="#cb63-1666" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"point"</span><span class="op">,</span></span>
<span id="cb63-1667"><a href="#cb63-1667" aria-hidden="true" tabindex="-1"></a>        <span class="co">//on: "mousemove{0,50}",</span></span>
<span id="cb63-1668"><a href="#cb63-1668" aria-hidden="true" tabindex="-1"></a>        <span class="dt">on</span><span class="op">:</span> <span class="st">"mouseup, touchup, [mousedown, mouseup] &gt; mousemove"</span><span class="op">,</span></span>
<span id="cb63-1669"><a href="#cb63-1669" aria-hidden="true" tabindex="-1"></a>        <span class="co">//on: "[touchdown, touchup] &gt; touchmove, [mousedown, mouseup] &gt; mousemove", //{10, 100}",</span></span>
<span id="cb63-1670"><a href="#cb63-1670" aria-hidden="true" tabindex="-1"></a>        <span class="co">//        on: "[mousedown, mouseup] &gt; mousemove",</span></span>
<span id="cb63-1671"><a href="#cb63-1671" aria-hidden="true" tabindex="-1"></a>        <span class="dt">nearest</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb63-1672"><a href="#cb63-1672" aria-hidden="true" tabindex="-1"></a>        <span class="dt">toggle</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb63-1673"><a href="#cb63-1673" aria-hidden="true" tabindex="-1"></a>        <span class="dt">clear</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb63-1674"><a href="#cb63-1674" aria-hidden="true" tabindex="-1"></a>        <span class="dt">encodings</span><span class="op">:</span> [<span class="st">"x"</span><span class="op">,</span> <span class="st">"y"</span>]</span>
<span id="cb63-1675"><a href="#cb63-1675" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb63-1676"><a href="#cb63-1676" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-1677"><a href="#cb63-1677" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb63-1678"><a href="#cb63-1678" aria-hidden="true" tabindex="-1"></a>}) }</span>
<span id="cb63-1679"><a href="#cb63-1679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1680"><a href="#cb63-1680" aria-hidden="true" tabindex="-1"></a>savings_data <span class="op">=</span> <span class="fu">calcuvegadata</span>({</span>
<span id="cb63-1681"><a href="#cb63-1681" aria-hidden="true" tabindex="-1"></a>  <span class="dt">models</span><span class="op">:</span> [savings]<span class="op">,</span></span>
<span id="cb63-1682"><a href="#cb63-1682" aria-hidden="true" tabindex="-1"></a>  <span class="dt">spec</span><span class="op">:</span> savings_spec<span class="op">,</span></span>
<span id="cb63-1683"><a href="#cb63-1683" aria-hidden="true" tabindex="-1"></a>  <span class="dt">domains</span><span class="op">:</span> {</span>
<span id="cb63-1684"><a href="#cb63-1684" aria-hidden="true" tabindex="-1"></a>    <span class="dt">year_in</span><span class="op">:</span> _<span class="op">.</span><span class="fu">range</span>(<span class="op">-</span><span class="dv">1</span><span class="op">,</span>duration_in<span class="op">+</span><span class="fl">0.1</span>)<span class="op">,</span></span>
<span id="cb63-1685"><a href="#cb63-1685" aria-hidden="true" tabindex="-1"></a>    <span class="dt">formula</span><span class="op">:</span> [<span class="st">'balance'</span><span class="op">,</span> <span class="st">'interest'</span><span class="op">,</span> <span class="st">'deposits'</span>]</span>
<span id="cb63-1686"><a href="#cb63-1686" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb63-1687"><a href="#cb63-1687" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input_cursors</span><span class="op">:</span> [{duration_in<span class="op">,</span>interest_rate_in<span class="op">,</span>annual_payment_in}]</span>
<span id="cb63-1688"><a href="#cb63-1688" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({<span class="op">...</span>d<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">fmt2</span>(d<span class="op">.</span><span class="at">formula</span><span class="op">,</span> d<span class="op">.</span><span class="at">value</span>)})) <span class="co">// fmt2 doesn't matter in this case</span></span>
<span id="cb63-1689"><a href="#cb63-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1690"><a href="#cb63-1690" aria-hidden="true" tabindex="-1"></a><span class="co">//Inputs.table(savings_data)</span></span>
<span id="cb63-1691"><a href="#cb63-1691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1692"><a href="#cb63-1692" aria-hidden="true" tabindex="-1"></a>viewof savings_viz <span class="op">=</span> <span class="fu">embed</span>(savings_spec<span class="op">,</span> {<span class="dt">renderer</span><span class="op">:</span><span class="st">'svg'</span><span class="op">,</span> actions<span class="op">,</span></span>
<span id="cb63-1693"><a href="#cb63-1693" aria-hidden="true" tabindex="-1"></a><span class="dt">patch</span><span class="op">:</span> s <span class="kw">=&gt;</span> {s<span class="op">.</span><span class="at">signals</span><span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb63-1694"><a href="#cb63-1694" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-1695"><a href="#cb63-1695" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">"doubleclick"</span><span class="op">,</span></span>
<span id="cb63-1696"><a href="#cb63-1696" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb63-1697"><a href="#cb63-1697" aria-hidden="true" tabindex="-1"></a>      <span class="st">"on"</span><span class="op">:</span> [{<span class="st">"events"</span><span class="op">:</span> <span class="st">"dblclick"</span><span class="op">,</span> <span class="st">"update"</span><span class="op">:</span> <span class="st">"datum"</span>}]</span>
<span id="cb63-1698"><a href="#cb63-1698" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-1699"><a href="#cb63-1699" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb63-1700"><a href="#cb63-1700" aria-hidden="true" tabindex="-1"></a> <span class="cf">return</span> s}</span>
<span id="cb63-1701"><a href="#cb63-1701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-1702"><a href="#cb63-1702" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-15-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-15-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-15-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-15-4" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<style>


/*body {
  height: 100vh;
}*/

.pc {
  height: 100%;
}


/*.vega-embed {
  width: 100%;
  height: calc(100%);
}*/

/* svg, .chart-wrapper, .vega-embed, .vega-embed-wrapper, .observablehq, .ojs-cell-2-2, .html-fill-item, .cell-output, .card, .bslib-grid, .bslib-card { */
/*#savings .chart-wrapper, .vega-embed, .vega-embed-wrapper, #savings .observablehq, #savings .html-fill-item {
  height:80%
}*/

.cell-output, .card, .bslib-grid, .marks.svg, .chart-wrapper, .vega-embed, .vega-embed-wrapper {
  /*height: 100%*/
}




  </style>
<div class="cell hidden html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb64" data-startfrom="1745" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1744;"><span id="cb64-1745"><a href="#cb64-1745" aria-hidden="true" tabindex="-1"></a>htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;button onclick=</span><span class="sc">${</span>() <span class="kw">=&gt;</span> (mutable savings_data0 <span class="op">=</span> savings_data)<span class="sc">}</span><span class="vs">&gt;insert data -&gt; vega editor (dev)&lt;/button&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-16-1" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb65" data-startfrom="1748" data-source-offset="-119"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1747;"><span id="cb65-1748"><a href="#cb65-1748" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb65-1749"><a href="#cb65-1749" aria-hidden="true" tabindex="-1"></a>  savings_viz<span class="op">;</span> <span class="co">// force resize event on load or user sees nothing</span></span>
<span id="cb65-1750"><a href="#cb65-1750" aria-hidden="true" tabindex="-1"></a>  <span class="co">// see limitations here: https://vega.github.io/vega-lite/docs/size.html#specifying-responsive-width-and-height</span></span>
<span id="cb65-1751"><a href="#cb65-1751" aria-hidden="true" tabindex="-1"></a>  <span class="bu">window</span><span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">Event</span>(<span class="st">'resize'</span>))</span>
<span id="cb65-1752"><a href="#cb65-1752" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-16-2" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb66" data-startfrom="1755" data-source-offset="-349"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1754;"><span id="cb66-1755"><a href="#cb66-1755" aria-hidden="true" tabindex="-1"></a>savings_viz<span class="op">.</span><span class="fu">addSignalListener</span>(<span class="st">"formula"</span><span class="op">,</span> (a<span class="op">,</span> b) <span class="kw">=&gt;</span> {</span>
<span id="cb66-1756"><a href="#cb66-1756" aria-hidden="true" tabindex="-1"></a>  <span class="co">/*viewof aa.value = b.ray_angle_in; //scene.signal("ray_angle_in");</span></span>
<span id="cb66-1757"><a href="#cb66-1757" aria-hidden="true" tabindex="-1"></a><span class="co">  viewof aa.dispatchEvent(new CustomEvent("input", { bubbles: true }));</span></span>
<span id="cb66-1758"><a href="#cb66-1758" aria-hidden="true" tabindex="-1"></a><span class="co">  */</span></span>
<span id="cb66-1759"><a href="#cb66-1759" aria-hidden="true" tabindex="-1"></a> <span class="co">//if (b.ray_angle_in[0] !== ray_angle_in) {</span></span>
<span id="cb66-1760"><a href="#cb66-1760" aria-hidden="true" tabindex="-1"></a>  <span class="co">//console.log(b.ray_angle_in[0], ray_angle_in, b.ray_angle_in[0] !== ray_angle_in)</span></span>
<span id="cb66-1761"><a href="#cb66-1761" aria-hidden="true" tabindex="-1"></a> <span class="co">//viewof ray_angle_in.value = b.ray_angle_in[0]; //scene.signal("ray_angle_in");</span></span>
<span id="cb66-1762"><a href="#cb66-1762" aria-hidden="true" tabindex="-1"></a> <span class="co">// viewof ray_angle_in.dispatchEvent(</span></span>
<span id="cb66-1763"><a href="#cb66-1763" aria-hidden="true" tabindex="-1"></a> <span class="co">//   new CustomEvent("input", { bubbles: true })</span></span>
<span id="cb66-1764"><a href="#cb66-1764" aria-hidden="true" tabindex="-1"></a>  <span class="co">//);</span></span>
<span id="cb66-1765"><a href="#cb66-1765" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span>(viewof formulae_visible<span class="op">,</span> [b<span class="op">.</span><span class="at">formula</span>[<span class="dv">0</span>]])</span>
<span id="cb66-1766"><a href="#cb66-1766" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span>(viewof year_in<span class="op">,</span> b<span class="op">.</span><span class="at">year_in</span>[<span class="dv">0</span>])</span>
<span id="cb66-1767"><a href="#cb66-1767" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.calculang_f_'</span><span class="op">+</span>b<span class="op">.</span><span class="at">formula</span>[<span class="dv">0</span>])<span class="op">.</span><span class="fu">scrollIntoView</span>(scrollIntoViewOpts)</span>
<span id="cb66-1768"><a href="#cb66-1768" aria-hidden="true" tabindex="-1"></a> <span class="co">//}</span></span>
<span id="cb66-1769"><a href="#cb66-1769" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-16-3" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb67" data-startfrom="1772" data-source-offset="-1040"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1771;"><span id="cb67-1772"><a href="#cb67-1772" aria-hidden="true" tabindex="-1"></a>savings_actualator<span class="op">.</span><span class="fu">addSignalListener</span>(<span class="st">"formula"</span><span class="op">,</span> (a<span class="op">,</span> b) <span class="kw">=&gt;</span> {</span>
<span id="cb67-1773"><a href="#cb67-1773" aria-hidden="true" tabindex="-1"></a>  <span class="co">/*viewof aa.value = b.ray_angle_in; //scene.signal("ray_angle_in");</span></span>
<span id="cb67-1774"><a href="#cb67-1774" aria-hidden="true" tabindex="-1"></a><span class="co">  viewof aa.dispatchEvent(new CustomEvent("input", { bubbles: true }));</span></span>
<span id="cb67-1775"><a href="#cb67-1775" aria-hidden="true" tabindex="-1"></a><span class="co">  */</span></span>
<span id="cb67-1776"><a href="#cb67-1776" aria-hidden="true" tabindex="-1"></a> <span class="co">//if (b.ray_angle_in[0] !== ray_angle_in) {</span></span>
<span id="cb67-1777"><a href="#cb67-1777" aria-hidden="true" tabindex="-1"></a>  <span class="co">//console.log(b.ray_angle_in[0], ray_angle_in, b.ray_angle_in[0] !== ray_angle_in)</span></span>
<span id="cb67-1778"><a href="#cb67-1778" aria-hidden="true" tabindex="-1"></a> <span class="co">//viewof ray_angle_in.value = b.ray_angle_in[0]; //scene.signal("ray_angle_in");</span></span>
<span id="cb67-1779"><a href="#cb67-1779" aria-hidden="true" tabindex="-1"></a> <span class="co">// viewof ray_angle_in.dispatchEvent(</span></span>
<span id="cb67-1780"><a href="#cb67-1780" aria-hidden="true" tabindex="-1"></a> <span class="co">//   new CustomEvent("input", { bubbles: true })</span></span>
<span id="cb67-1781"><a href="#cb67-1781" aria-hidden="true" tabindex="-1"></a>  <span class="co">//);</span></span>
<span id="cb67-1782"><a href="#cb67-1782" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(b)</span>
<span id="cb67-1783"><a href="#cb67-1783" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span>(viewof formulae_visible<span class="op">,</span> [b<span class="op">.</span><span class="at">formula</span>[<span class="dv">0</span>]])</span>
<span id="cb67-1784"><a href="#cb67-1784" aria-hidden="true" tabindex="-1"></a>  <span class="kw">set</span>(viewof year_in<span class="op">,</span> b<span class="op">.</span><span class="at">year_in</span>[<span class="dv">0</span>])</span>
<span id="cb67-1785"><a href="#cb67-1785" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.calculang_f_'</span><span class="op">+</span>b<span class="op">.</span><span class="at">formula</span>[<span class="dv">0</span>])<span class="op">.</span><span class="fu">scrollIntoView</span>(scrollIntoViewOpts)</span>
<span id="cb67-1786"><a href="#cb67-1786" aria-hidden="true" tabindex="-1"></a> <span class="co">//}</span></span>
<span id="cb67-1787"><a href="#cb67-1787" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-16-4" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb68" data-startfrom="1797" data-source-offset="-1872"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1796;"><span id="cb68-1797"><a href="#cb68-1797" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb68-1798"><a href="#cb68-1798" aria-hidden="true" tabindex="-1"></a>  <span class="co">//scene.signal("ray_angle_in", ray_angle_in); causes infinite re-runs</span></span>
<span id="cb68-1799"><a href="#cb68-1799" aria-hidden="true" tabindex="-1"></a>  savings_viz<span class="op">.</span><span class="fu">data</span>(<span class="st">"source"</span><span class="op">,</span> savings_data)<span class="op">.</span><span class="fu">resize</span>()<span class="op">.</span><span class="fu">run</span>()<span class="op">;</span></span>
<span id="cb68-1800"><a href="#cb68-1800" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-16-5" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
</div>
<div id="starfield" class="modeldept html-fill-item html-fill-container">
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb69" data-startfrom="1820" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1819;"><span id="cb69-1820"><a href="#cb69-1820" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(<span class="fu">Scrubber</span>(_<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span><span class="dv">60</span><span class="op">*</span><span class="dv">5</span>)<span class="op">,</span> {<span class="dt">autoplay</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">delay</span><span class="op">:</span><span class="dv">50</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'frame'</span><span class="op">,</span> <span class="dt">initial</span><span class="op">:</span> <span class="dv">2</span>})<span class="op">,</span> viewof frame_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-17-1" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb70" data-startfrom="1824" data-source-offset="-195"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1823;"><span id="cb70-1824"><a href="#cb70-1824" aria-hidden="true" tabindex="-1"></a>starfield_spec <span class="op">=</span> { <span class="cf">return</span> ({</span>
<span id="cb70-1825"><a href="#cb70-1825" aria-hidden="true" tabindex="-1"></a>  <span class="dt">background</span><span class="op">:</span> <span class="st">'black'</span><span class="op">,</span><span class="co">//'lightblue',</span></span>
<span id="cb70-1826"><a href="#cb70-1826" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span><span class="op">:</span> {<span class="st">"name"</span><span class="op">:</span> <span class="st">"data"</span>}<span class="op">,</span></span>
<span id="cb70-1827"><a href="#cb70-1827" aria-hidden="true" tabindex="-1"></a>  <span class="st">"datasets"</span><span class="op">:</span> { <span class="st">"data"</span><span class="op">:</span> starfield_data0}<span class="op">,</span></span>
<span id="cb70-1828"><a href="#cb70-1828" aria-hidden="true" tabindex="-1"></a>    <span class="st">"height"</span><span class="op">:</span> <span class="dv">400</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb70-1829"><a href="#cb70-1829" aria-hidden="true" tabindex="-1"></a>    <span class="dt">layer</span><span class="op">:</span> [{</span>
<span id="cb70-1830"><a href="#cb70-1830" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mark"</span><span class="op">:</span> {<span class="dt">type</span><span class="op">:</span> <span class="st">"point"</span><span class="op">,</span> <span class="dt">tooltip</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">clip</span><span class="op">:</span> <span class="kw">false</span>}<span class="op">,</span></span>
<span id="cb70-1831"><a href="#cb70-1831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1832"><a href="#cb70-1832" aria-hidden="true" tabindex="-1"></a>  <span class="dt">params</span><span class="op">:</span> [</span>
<span id="cb70-1833"><a href="#cb70-1833" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb70-1834"><a href="#cb70-1834" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">"star_select"</span><span class="op">,</span></span>
<span id="cb70-1835"><a href="#cb70-1835" aria-hidden="true" tabindex="-1"></a>      <span class="co">//value: { ray_angle_in: 0 },</span></span>
<span id="cb70-1836"><a href="#cb70-1836" aria-hidden="true" tabindex="-1"></a>      <span class="dt">select</span><span class="op">:</span> {</span>
<span id="cb70-1837"><a href="#cb70-1837" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"point"</span><span class="op">,</span></span>
<span id="cb70-1838"><a href="#cb70-1838" aria-hidden="true" tabindex="-1"></a>        <span class="co">//on: "mousemove{0,50}",</span></span>
<span id="cb70-1839"><a href="#cb70-1839" aria-hidden="true" tabindex="-1"></a>        <span class="dt">on</span><span class="op">:</span> <span class="st">"mouseup, touchup, [mousedown, mouseup] &gt; mousemove"</span><span class="op">,</span></span>
<span id="cb70-1840"><a href="#cb70-1840" aria-hidden="true" tabindex="-1"></a>        <span class="co">//on: "[touchdown, touchup] &gt; touchmove, [mousedown, mouseup] &gt; mousemove", //{10, 100}",</span></span>
<span id="cb70-1841"><a href="#cb70-1841" aria-hidden="true" tabindex="-1"></a>        <span class="co">//        on: "[mousedown, mouseup] &gt; mousemove",</span></span>
<span id="cb70-1842"><a href="#cb70-1842" aria-hidden="true" tabindex="-1"></a>        <span class="dt">nearest</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb70-1843"><a href="#cb70-1843" aria-hidden="true" tabindex="-1"></a>        <span class="dt">toggle</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb70-1844"><a href="#cb70-1844" aria-hidden="true" tabindex="-1"></a>        <span class="dt">clear</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb70-1845"><a href="#cb70-1845" aria-hidden="true" tabindex="-1"></a>        <span class="co">//encodings: ["x", "y"]</span></span>
<span id="cb70-1846"><a href="#cb70-1846" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fields</span><span class="op">:</span> [<span class="st">"star_in"</span>]</span>
<span id="cb70-1847"><a href="#cb70-1847" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb70-1848"><a href="#cb70-1848" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-1849"><a href="#cb70-1849" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb70-1850"><a href="#cb70-1850" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*"params": [{</span></span>
<span id="cb70-1851"><a href="#cb70-1851" aria-hidden="true" tabindex="-1"></a><span class="co">      "name": "brush",</span></span>
<span id="cb70-1852"><a href="#cb70-1852" aria-hidden="true" tabindex="-1"></a><span class="co">       value: { x: [leap_year_start, leap_year_start+50]}, // initial value here fails whenever I switch to this model after loading a different one ... understand</span></span>
<span id="cb70-1853"><a href="#cb70-1853" aria-hidden="true" tabindex="-1"></a><span class="co">      //"value": {"year_in": [2000, 2010]},</span></span>
<span id="cb70-1854"><a href="#cb70-1854" aria-hidden="true" tabindex="-1"></a><span class="co">      "select": {"type": "interval", "encodings": ["x"]}</span></span>
<span id="cb70-1855"><a href="#cb70-1855" aria-hidden="true" tabindex="-1"></a><span class="co">    }],*/</span></span>
<span id="cb70-1856"><a href="#cb70-1856" aria-hidden="true" tabindex="-1"></a>    <span class="st">"encoding"</span><span class="op">:</span> {</span>
<span id="cb70-1857"><a href="#cb70-1857" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x"</span><span class="op">:</span> {</span>
<span id="cb70-1858"><a href="#cb70-1858" aria-hidden="true" tabindex="-1"></a>        <span class="st">"field"</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb70-1859"><a href="#cb70-1859" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span><span class="op">:</span> <span class="st">"quantitative"</span><span class="op">,</span></span>
<span id="cb70-1860"><a href="#cb70-1860" aria-hidden="true" tabindex="-1"></a>        <span class="dt">scale</span><span class="op">:</span> {<span class="dt">zero</span><span class="op">:</span><span class="kw">false</span><span class="op">,</span> <span class="dt">nice</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span>[<span class="op">-</span><span class="dv">50</span><span class="op">,</span><span class="dv">50</span>]}<span class="op">,</span></span>
<span id="cb70-1861"><a href="#cb70-1861" aria-hidden="true" tabindex="-1"></a>        <span class="co">//axis: {format:".0f", grid: false, tickCount:12, ticks:true }</span></span>
<span id="cb70-1862"><a href="#cb70-1862" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb70-1863"><a href="#cb70-1863" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y"</span><span class="op">:</span> {</span>
<span id="cb70-1864"><a href="#cb70-1864" aria-hidden="true" tabindex="-1"></a>        <span class="st">"field"</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb70-1865"><a href="#cb70-1865" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span><span class="op">:</span> <span class="st">"quantitative"</span><span class="op">,</span></span>
<span id="cb70-1866"><a href="#cb70-1866" aria-hidden="true" tabindex="-1"></a>        <span class="dt">scale</span><span class="op">:</span> {<span class="dt">zero</span><span class="op">:</span><span class="kw">false</span><span class="op">,</span> <span class="dt">nice</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span>[<span class="op">-</span><span class="dv">50</span><span class="op">,</span><span class="dv">50</span>]}<span class="op">,</span></span>
<span id="cb70-1867"><a href="#cb70-1867" aria-hidden="true" tabindex="-1"></a>        <span class="co">//"axis": { "grid": false, values: [0,1], format: '.0f'}</span></span>
<span id="cb70-1868"><a href="#cb70-1868" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb70-1869"><a href="#cb70-1869" aria-hidden="true" tabindex="-1"></a>      <span class="st">"size"</span><span class="op">:</span> {</span>
<span id="cb70-1870"><a href="#cb70-1870" aria-hidden="true" tabindex="-1"></a>        <span class="st">"field"</span><span class="op">:</span> <span class="st">"z"</span><span class="op">,</span></span>
<span id="cb70-1871"><a href="#cb70-1871" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span><span class="op">:</span> <span class="st">"quantitative"</span><span class="op">,</span></span>
<span id="cb70-1872"><a href="#cb70-1872" aria-hidden="true" tabindex="-1"></a>        <span class="dt">scale</span><span class="op">:</span> {<span class="dt">reverse</span><span class="op">:</span><span class="kw">true</span>}<span class="op">,</span></span>
<span id="cb70-1873"><a href="#cb70-1873" aria-hidden="true" tabindex="-1"></a>        <span class="dt">legend</span><span class="op">:</span><span class="kw">false</span></span>
<span id="cb70-1874"><a href="#cb70-1874" aria-hidden="true" tabindex="-1"></a>        <span class="co">//scale: {zero:false, nice: false, domain:[-50,50]},</span></span>
<span id="cb70-1875"><a href="#cb70-1875" aria-hidden="true" tabindex="-1"></a>        <span class="co">//"axis": { "grid": false, values: [0,1], format: '.0f'}</span></span>
<span id="cb70-1876"><a href="#cb70-1876" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb70-1877"><a href="#cb70-1877" aria-hidden="true" tabindex="-1"></a>      <span class="dt">color</span><span class="op">:</span> {<span class="dt">value</span><span class="op">:</span><span class="st">'white'</span>}<span class="op">,</span> <span class="co">//opacity: {value:1}</span></span>
<span id="cb70-1878"><a href="#cb70-1878" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb70-1879"><a href="#cb70-1879" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb70-1880"><a href="#cb70-1880" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb70-1881"><a href="#cb70-1881" aria-hidden="true" tabindex="-1"></a>      <span class="dt">mark</span><span class="op">:</span> <span class="st">'rule'</span><span class="op">,</span></span>
<span id="cb70-1882"><a href="#cb70-1882" aria-hidden="true" tabindex="-1"></a>      <span class="dt">encoding</span><span class="op">:</span> {</span>
<span id="cb70-1883"><a href="#cb70-1883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1884"><a href="#cb70-1884" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x"</span><span class="op">:</span> {</span>
<span id="cb70-1885"><a href="#cb70-1885" aria-hidden="true" tabindex="-1"></a>        <span class="st">"field"</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb70-1886"><a href="#cb70-1886" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span><span class="op">:</span> <span class="st">"quantitative"</span><span class="op">,</span></span>
<span id="cb70-1887"><a href="#cb70-1887" aria-hidden="true" tabindex="-1"></a>        <span class="dt">scale</span><span class="op">:</span> {<span class="dt">zero</span><span class="op">:</span><span class="kw">false</span><span class="op">,</span> <span class="dt">nice</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span>[<span class="op">-</span><span class="dv">50</span><span class="op">,</span><span class="dv">50</span>]}<span class="op">,</span></span>
<span id="cb70-1888"><a href="#cb70-1888" aria-hidden="true" tabindex="-1"></a>        <span class="co">//axis: {format:".0f", grid: false, tickCount:12, ticks:true }</span></span>
<span id="cb70-1889"><a href="#cb70-1889" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb70-1890"><a href="#cb70-1890" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y"</span><span class="op">:</span> {</span>
<span id="cb70-1891"><a href="#cb70-1891" aria-hidden="true" tabindex="-1"></a>        <span class="st">"field"</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb70-1892"><a href="#cb70-1892" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span><span class="op">:</span> <span class="st">"quantitative"</span><span class="op">,</span></span>
<span id="cb70-1893"><a href="#cb70-1893" aria-hidden="true" tabindex="-1"></a>        <span class="dt">scale</span><span class="op">:</span> {<span class="dt">zero</span><span class="op">:</span><span class="kw">false</span><span class="op">,</span> <span class="dt">nice</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span>[<span class="op">-</span><span class="dv">50</span><span class="op">,</span><span class="dv">50</span>]}<span class="op">,</span></span>
<span id="cb70-1894"><a href="#cb70-1894" aria-hidden="true" tabindex="-1"></a>        <span class="co">//"axis": { "grid": false, values: [0,1], format: '.0f'}</span></span>
<span id="cb70-1895"><a href="#cb70-1895" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb70-1896"><a href="#cb70-1896" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x2"</span><span class="op">:</span> {</span>
<span id="cb70-1897"><a href="#cb70-1897" aria-hidden="true" tabindex="-1"></a>        <span class="st">"field"</span><span class="op">:</span> <span class="st">"px"</span><span class="op">,</span></span>
<span id="cb70-1898"><a href="#cb70-1898" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span><span class="op">:</span> <span class="st">"quantitative"</span><span class="op">,</span></span>
<span id="cb70-1899"><a href="#cb70-1899" aria-hidden="true" tabindex="-1"></a>        <span class="dt">scale</span><span class="op">:</span> {<span class="dt">zero</span><span class="op">:</span><span class="kw">false</span><span class="op">,</span> <span class="dt">nice</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span>[<span class="op">-</span><span class="dv">50</span><span class="op">,</span><span class="dv">50</span>]}<span class="op">,</span></span>
<span id="cb70-1900"><a href="#cb70-1900" aria-hidden="true" tabindex="-1"></a>        <span class="co">//axis: {format:".0f", grid: false, tickCount:12, ticks:true }</span></span>
<span id="cb70-1901"><a href="#cb70-1901" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb70-1902"><a href="#cb70-1902" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y2"</span><span class="op">:</span> {</span>
<span id="cb70-1903"><a href="#cb70-1903" aria-hidden="true" tabindex="-1"></a>        <span class="st">"field"</span><span class="op">:</span> <span class="st">"py"</span><span class="op">,</span></span>
<span id="cb70-1904"><a href="#cb70-1904" aria-hidden="true" tabindex="-1"></a>        <span class="st">"type"</span><span class="op">:</span> <span class="st">"quantitative"</span><span class="op">,</span></span>
<span id="cb70-1905"><a href="#cb70-1905" aria-hidden="true" tabindex="-1"></a>        <span class="dt">scale</span><span class="op">:</span> {<span class="dt">zero</span><span class="op">:</span><span class="kw">false</span><span class="op">,</span> <span class="dt">nice</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span>[<span class="op">-</span><span class="dv">50</span><span class="op">,</span><span class="dv">50</span>]}<span class="op">,</span></span>
<span id="cb70-1906"><a href="#cb70-1906" aria-hidden="true" tabindex="-1"></a>        <span class="co">//"axis": { "grid": false, values: [0,1], format: '.0f'}</span></span>
<span id="cb70-1907"><a href="#cb70-1907" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb70-1908"><a href="#cb70-1908" aria-hidden="true" tabindex="-1"></a>      <span class="dt">color</span><span class="op">:</span> {<span class="dt">value</span><span class="op">:</span><span class="st">'white'</span>}</span>
<span id="cb70-1909"><a href="#cb70-1909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1910"><a href="#cb70-1910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1911"><a href="#cb70-1911" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb70-1912"><a href="#cb70-1912" aria-hidden="true" tabindex="-1"></a>    }]</span>
<span id="cb70-1913"><a href="#cb70-1913" aria-hidden="true" tabindex="-1"></a>})}</span>
<span id="cb70-1914"><a href="#cb70-1914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1915"><a href="#cb70-1915" aria-hidden="true" tabindex="-1"></a>starfield_data <span class="op">=</span> <span class="fu">calcuvegadata</span>({</span>
<span id="cb70-1916"><a href="#cb70-1916" aria-hidden="true" tabindex="-1"></a>  <span class="dt">models</span><span class="op">:</span> [starfield]<span class="op">,</span><span class="co">//modelname == 'starfield' ? [starfield] : [],</span></span>
<span id="cb70-1917"><a href="#cb70-1917" aria-hidden="true" tabindex="-1"></a>  <span class="dt">spec</span><span class="op">:</span> starfield_spec<span class="op">,</span></span>
<span id="cb70-1918"><a href="#cb70-1918" aria-hidden="true" tabindex="-1"></a>  <span class="dt">domains</span><span class="op">:</span> { <span class="dt">star_in</span><span class="op">:</span> _<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>) }<span class="op">,</span></span>
<span id="cb70-1919"><a href="#cb70-1919" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input_cursors</span><span class="op">:</span> [{speed_in<span class="op">,</span> frame_in<span class="op">,</span> <span class="dt">random_seed_in</span><span class="op">:</span><span class="st">'hello'</span>}]</span>
<span id="cb70-1920"><a href="#cb70-1920" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb70-1921"><a href="#cb70-1921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1922"><a href="#cb70-1922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1923"><a href="#cb70-1923" aria-hidden="true" tabindex="-1"></a>viewof starfield_viz <span class="op">=</span> <span class="fu">embed</span>(starfield_spec<span class="op">,</span> {actions})</span>
<span id="cb70-1924"><a href="#cb70-1924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-1925"><a href="#cb70-1925" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb70-1926"><a href="#cb70-1926" aria-hidden="true" tabindex="-1"></a>  starfield_viz<span class="op">.</span><span class="fu">data</span>(<span class="st">"data"</span><span class="op">,</span> starfield_data)<span class="co">/*.resize()*/</span><span class="op">.</span><span class="fu">run</span>()<span class="op">;</span></span>
<span id="cb70-1927"><a href="#cb70-1927" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-17-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-17-3" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-17-4" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-17-5" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb71" data-startfrom="1929" data-source-offset="-3293"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1928;"><span id="cb71-1929"><a href="#cb71-1929" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb71-1930"><a href="#cb71-1930" aria-hidden="true" tabindex="-1"></a>  starfield_viz<span class="op">.</span><span class="fu">addSignalListener</span>(<span class="st">'star_select'</span><span class="op">,</span> (_<span class="op">,</span> b) <span class="kw">=&gt;</span> {</span>
<span id="cb71-1931"><a href="#cb71-1931" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof star_in<span class="op">,</span> b<span class="op">.</span><span class="at">star_in</span>[<span class="dv">0</span>])</span>
<span id="cb71-1932"><a href="#cb71-1932" aria-hidden="true" tabindex="-1"></a>    <span class="co">//console.log(b)</span></span>
<span id="cb71-1933"><a href="#cb71-1933" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb71-1934"><a href="#cb71-1934" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-17-6" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb72" data-startfrom="1946" data-source-offset="-3760"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1945;"><span id="cb72-1946"><a href="#cb72-1946" aria-hidden="true" tabindex="-1"></a>mutable starfield_data0 <span class="op">=</span> [] <span class="co">// includes data in spec for when I Open in Vega Editor</span></span>
<span id="cb72-1947"><a href="#cb72-1947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-1948"><a href="#cb72-1948" aria-hidden="true" tabindex="-1"></a>htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;button onclick=</span><span class="sc">${</span>() <span class="kw">=&gt;</span> (mutable starfield_data0 <span class="op">=</span> starfield_data)<span class="sc">}</span><span class="vs">&gt;insert data -&gt; vega editor (dev)&lt;/button&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-17-7" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-17-8" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
<div id="savings_rec" class="modeldept html-fill-item html-fill-container">
<details open="">
<summary>
<strong>inputs ⚙️</strong>
</summary>
<div class="card cell panel-input bg-light p-2 html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb73" data-startfrom="1961" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1960;"><span id="cb73-1961"><a href="#cb73-1961" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">1</span><span class="op">,</span><span class="dv">6</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span><span class="dv">2</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span><span class="st">'actual_interest_rate_co_in'</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span><span class="dv">1</span>})<span class="op">,</span> viewof actual_interest_rate_co_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-18" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</details>
👀
<p><em>highlight for actual-updates</em> 🪄</p>
<div class="cell hidden html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb74" data-startfrom="1975" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1974;"><span id="cb74-1975"><a href="#cb74-1975" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb74-1976"><a href="#cb74-1976" aria-hidden="true" tabindex="-1"></a>  savings_actualator<span class="op">;</span></span>
<span id="cb74-1977"><a href="#cb74-1977" aria-hidden="true" tabindex="-1"></a>  <span class="bu">window</span><span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">Event</span>(<span class="st">'resize'</span>))</span>
<span id="cb74-1978"><a href="#cb74-1978" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-19-1" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb75" data-startfrom="1982" data-source-offset="-74"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1981;"><span id="cb75-1982"><a href="#cb75-1982" aria-hidden="true" tabindex="-1"></a>savings_actualator<span class="op">.</span><span class="fu">addSignalListener</span>(<span class="st">"y"</span><span class="op">,</span> (_<span class="op">,</span> r) <span class="kw">=&gt;</span> { <span class="co">// this didn't improve perf a lot vs event listener: nearly every mousemove is a signal change, I suppose</span></span>
<span id="cb75-1983"><a href="#cb75-1983" aria-hidden="true" tabindex="-1"></a>  <span class="co">//if (observable_world == 0) return;</span></span>
<span id="cb75-1984"><a href="#cb75-1984" aria-hidden="true" tabindex="-1"></a>  viewof actual_interest_rate_co_in<span class="op">.</span><span class="at">value</span> <span class="op">=</span> r<span class="op">.</span><span class="at">year_in</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb75-1985"><a href="#cb75-1985" aria-hidden="true" tabindex="-1"></a>  viewof actual_interest_rate_co_in<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">'input'</span>)<span class="op">,</span> {<span class="dt">bubbles</span><span class="op">:</span><span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb75-1986"><a href="#cb75-1986" aria-hidden="true" tabindex="-1"></a>}) <span class="op">&amp;&amp;</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-19-2" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb76" data-startfrom="1994" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1993;"><span id="cb76-1994"><a href="#cb76-1994" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {calcudata<span class="op">,</span> calcuvizspec} <span class="im">from</span> <span class="st">'@declann/little-calcu-helpers'</span></span>
<span id="cb76-1995"><a href="#cb76-1995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-1996"><a href="#cb76-1996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-1997"><a href="#cb76-1997" aria-hidden="true" tabindex="-1"></a>savings_rec_data <span class="op">=</span> <span class="fu">calcudata</span>({</span>
<span id="cb76-1998"><a href="#cb76-1998" aria-hidden="true" tabindex="-1"></a>  <span class="dt">models</span><span class="op">:</span> [savings_rec]<span class="op">,</span></span>
<span id="cb76-1999"><a href="#cb76-1999" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input_domains</span><span class="op">:</span> {<span class="dt">year_in</span><span class="op">:</span>_<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span><span class="dv">6</span>)<span class="op">,</span> <span class="dt">actual_interest_rate_co_in</span><span class="op">:</span> [actual_interest_rate_co_in<span class="op">-</span><span class="dv">1</span><span class="op">,</span>actual_interest_rate_co_in]}<span class="op">,</span></span>
<span id="cb76-2000"><a href="#cb76-2000" aria-hidden="true" tabindex="-1"></a>  <span class="dt">input_cursors</span><span class="op">:</span> [{<span class="dt">annual_payment_in</span><span class="op">:</span><span class="dv">1000</span>}]<span class="op">,</span> </span>
<span id="cb76-2001"><a href="#cb76-2001" aria-hidden="true" tabindex="-1"></a>  <span class="dt">outputs</span><span class="op">:</span> [<span class="st">'balance'</span><span class="op">,</span><span class="st">'interest'</span><span class="op">,</span><span class="st">'deposits'</span><span class="op">,</span><span class="st">'interest_rate'</span>]</span>
<span id="cb76-2002"><a href="#cb76-2002" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb76-2003"><a href="#cb76-2003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-2004"><a href="#cb76-2004" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb76-2005"><a href="#cb76-2005" aria-hidden="true" tabindex="-1"></a>  savings_actualator<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'click'</span><span class="op">,</span> (<span class="bu">event</span><span class="op">,</span> item) <span class="kw">=&gt;</span> { <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(item) }) </span>
<span id="cb76-2006"><a href="#cb76-2006" aria-hidden="true" tabindex="-1"></a>  <span class="co">// difficult for layers?</span></span>
<span id="cb76-2007"><a href="#cb76-2007" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-20-1" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-20-2" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-20-3" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb77" data-startfrom="2009" data-source-offset="-488"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2008;"><span id="cb77-2009"><a href="#cb77-2009" aria-hidden="true" tabindex="-1"></a>viewof savings_actualator <span class="op">=</span> <span class="fu">embed</span>(</span>
<span id="cb77-2010"><a href="#cb77-2010" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb77-2011"><a href="#cb77-2011" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span><span class="op">:</span> {<span class="st">"name"</span><span class="op">:</span> <span class="st">"data"</span>}<span class="op">,</span></span>
<span id="cb77-2012"><a href="#cb77-2012" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="st">"container"</span><span class="op">,</span></span>
<span id="cb77-2013"><a href="#cb77-2013" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span></span>
<span id="cb77-2014"><a href="#cb77-2014" aria-hidden="true" tabindex="-1"></a>  <span class="st">"transform"</span><span class="op">:</span> [</span>
<span id="cb77-2015"><a href="#cb77-2015" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb77-2016"><a href="#cb77-2016" aria-hidden="true" tabindex="-1"></a>      <span class="st">"window"</span><span class="op">:</span> [{<span class="st">"op"</span><span class="op">:</span> <span class="st">"lag"</span><span class="op">,</span> <span class="st">"field"</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span> <span class="st">"as"</span><span class="op">:</span> <span class="st">"A_value"</span>}]<span class="op">,</span></span>
<span id="cb77-2017"><a href="#cb77-2017" aria-hidden="true" tabindex="-1"></a>      <span class="st">"groupby"</span><span class="op">:</span> [<span class="st">"formula"</span><span class="op">,</span><span class="st">"year_in"</span>]<span class="op">,</span></span>
<span id="cb77-2018"><a href="#cb77-2018" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sort"</span><span class="op">:</span> [{<span class="st">"field"</span><span class="op">:</span> <span class="st">"actual_interest_rate_co_in"</span>}]<span class="op">,</span></span>
<span id="cb77-2019"><a href="#cb77-2019" aria-hidden="true" tabindex="-1"></a>      <span class="st">"frame"</span><span class="op">:</span> [<span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span>]</span>
<span id="cb77-2020"><a href="#cb77-2020" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb77-2021"><a href="#cb77-2021" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"calculate"</span><span class="op">:</span> <span class="st">"datum.value-datum.A_value"</span><span class="op">,</span> <span class="st">"as"</span><span class="op">:</span> <span class="st">"impact"</span>}<span class="op">,</span></span>
<span id="cb77-2022"><a href="#cb77-2022" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb77-2023"><a href="#cb77-2023" aria-hidden="true" tabindex="-1"></a>  <span class="st">"encoding"</span><span class="op">:</span> {</span>
<span id="cb77-2024"><a href="#cb77-2024" aria-hidden="true" tabindex="-1"></a>    <span class="st">"y"</span><span class="op">:</span> {<span class="st">"field"</span><span class="op">:</span> <span class="st">"year_in"</span><span class="op">,</span> <span class="st">"type"</span><span class="op">:</span> <span class="st">"nominal"</span><span class="op">,</span> <span class="st">"sort"</span><span class="op">:</span> <span class="st">"ascending"</span>}<span class="op">,</span></span>
<span id="cb77-2025"><a href="#cb77-2025" aria-hidden="true" tabindex="-1"></a>    <span class="st">"color"</span><span class="op">:</span> {<span class="st">"field"</span><span class="op">:</span> <span class="st">"formula"</span><span class="op">,</span> <span class="st">"type"</span><span class="op">:</span> <span class="st">"nominal"</span>}<span class="op">,</span></span>
<span id="cb77-2026"><a href="#cb77-2026" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x"</span><span class="op">:</span> {</span>
<span id="cb77-2027"><a href="#cb77-2027" aria-hidden="true" tabindex="-1"></a>      <span class="st">"field"</span><span class="op">:</span> <span class="st">"formula"</span><span class="op">,</span></span>
<span id="cb77-2028"><a href="#cb77-2028" aria-hidden="true" tabindex="-1"></a>      <span class="st">"type"</span><span class="op">:</span> <span class="st">"nominal"</span><span class="op">,</span></span>
<span id="cb77-2029"><a href="#cb77-2029" aria-hidden="true" tabindex="-1"></a>      <span class="st">"axis"</span><span class="op">:</span> {<span class="st">"labelAngle"</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="st">"orient"</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span> <span class="st">"labelLimit"</span><span class="op">:</span> <span class="dv">90</span>}</span>
<span id="cb77-2030"><a href="#cb77-2030" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb77-2031"><a href="#cb77-2031" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb77-2032"><a href="#cb77-2032" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layer</span><span class="op">:</span> [{</span>
<span id="cb77-2033"><a href="#cb77-2033" aria-hidden="true" tabindex="-1"></a>            <span class="st">"params"</span><span class="op">:</span> [{<span class="st">"name"</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="st">"select"</span><span class="op">:</span> { <span class="st">"type"</span><span class="op">:</span> <span class="st">"point"</span><span class="op">,</span> <span class="st">"on"</span><span class="op">:</span> <span class="st">"mouseover"</span><span class="op">,</span> <span class="st">"nearest"</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="st">"encodings"</span><span class="op">:</span> [<span class="st">"y"</span>]<span class="op">,</span> <span class="st">"toggle"</span><span class="op">:</span><span class="kw">false</span>}}<span class="op">,</span></span>
<span id="cb77-2034"><a href="#cb77-2034" aria-hidden="true" tabindex="-1"></a>                 <span class="co">// params for layers not working good !{"name": "formula", "select": { "type": "point", "on": "mouseup, touchup, [mousedown, mouseup] &gt; mousemove", "nearest": true, "encodings": ["x", "y"]}}</span></span>
<span id="cb77-2035"><a href="#cb77-2035" aria-hidden="true" tabindex="-1"></a>                 ]</span>
<span id="cb77-2036"><a href="#cb77-2036" aria-hidden="true" tabindex="-1"></a>                 <span class="op">,</span></span>
<span id="cb77-2037"><a href="#cb77-2037" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mark"</span><span class="op">:</span> {</span>
<span id="cb77-2038"><a href="#cb77-2038" aria-hidden="true" tabindex="-1"></a>    <span class="st">"type"</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb77-2039"><a href="#cb77-2039" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fontSize"</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb77-2040"><a href="#cb77-2040" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fontWeight"</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb77-2041"><a href="#cb77-2041" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tooltip"</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb77-2042"><a href="#cb77-2042" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb77-2043"><a href="#cb77-2043" aria-hidden="true" tabindex="-1"></a>        <span class="st">"transform"</span><span class="op">:</span> [{<span class="st">"filter"</span><span class="op">:</span> <span class="vs">`datum.actual_interest_rate_co_in != </span><span class="sc">${</span>actual_interest_rate_co_in<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="vs">`</span>}<span class="op">,</span></span>
<span id="cb77-2044"><a href="#cb77-2044" aria-hidden="true" tabindex="-1"></a>        <span class="co">//{"calculate": "datum.year_in &gt; datum.actual_interest_rate_co_in", "as": "fut"}</span></span>
<span id="cb77-2045"><a href="#cb77-2045" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb77-2046"><a href="#cb77-2046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-2047"><a href="#cb77-2047" aria-hidden="true" tabindex="-1"></a>  <span class="dt">encoding</span><span class="op">:</span> {</span>
<span id="cb77-2048"><a href="#cb77-2048" aria-hidden="true" tabindex="-1"></a>    <span class="st">"opacity"</span><span class="op">:</span>             {<span class="st">"condition"</span><span class="op">:</span> {<span class="st">"test"</span><span class="op">:</span> <span class="st">"datum.year_in &gt; datum.actual_interest_rate_co_in"</span><span class="op">,</span> <span class="st">"value"</span><span class="op">:</span> <span class="fl">0.5</span>}<span class="op">,</span> <span class="st">"value"</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span></span>
<span id="cb77-2049"><a href="#cb77-2049" aria-hidden="true" tabindex="-1"></a><span class="co">// {"field": "fut", "type": "nominal", "sort": "descending"},</span></span>
<span id="cb77-2050"><a href="#cb77-2050" aria-hidden="true" tabindex="-1"></a>        <span class="st">"text"</span><span class="op">:</span> {</span>
<span id="cb77-2051"><a href="#cb77-2051" aria-hidden="true" tabindex="-1"></a>      <span class="st">"field"</span><span class="op">:</span> <span class="st">"value"</span><span class="op">,</span></span>
<span id="cb77-2052"><a href="#cb77-2052" aria-hidden="true" tabindex="-1"></a>      <span class="st">"type"</span><span class="op">:</span> <span class="st">"quantitative"</span><span class="op">,</span></span>
<span id="cb77-2053"><a href="#cb77-2053" aria-hidden="true" tabindex="-1"></a>      <span class="st">"format"</span><span class="op">:</span> <span class="st">",.2f"</span><span class="op">,</span> <span class="co">// I can't do a conditional format here yet</span></span>
<span id="cb77-2054"><a href="#cb77-2054" aria-hidden="true" tabindex="-1"></a>      <span class="st">"axis"</span><span class="op">:</span> {<span class="st">"format"</span><span class="op">:</span> <span class="st">",.2f"</span>}</span>
<span id="cb77-2055"><a href="#cb77-2055" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb77-2056"><a href="#cb77-2056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-2057"><a href="#cb77-2057" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-2058"><a href="#cb77-2058" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span>{</span>
<span id="cb77-2059"><a href="#cb77-2059" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mark"</span><span class="op">:</span> {</span>
<span id="cb77-2060"><a href="#cb77-2060" aria-hidden="true" tabindex="-1"></a>    <span class="st">"type"</span><span class="op">:</span> <span class="st">"text"</span><span class="op">,</span> <span class="dt">dx</span><span class="op">:</span><span class="dv">20</span><span class="op">,</span> <span class="dt">dy</span><span class="op">:</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb77-2061"><a href="#cb77-2061" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fontSize"</span><span class="op">:</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb77-2062"><a href="#cb77-2062" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fontWeight"</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span><span class="co">//</span></span>
<span id="cb77-2063"><a href="#cb77-2063" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tooltip"</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb77-2064"><a href="#cb77-2064" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb77-2065"><a href="#cb77-2065" aria-hidden="true" tabindex="-1"></a>        <span class="st">"transform"</span><span class="op">:</span> [{<span class="st">"filter"</span><span class="op">:</span> <span class="vs">`abs(datum.impact) &gt;= 0.00001 &amp;&amp; datum.actual_interest_rate_co_in != </span><span class="sc">${</span>actual_interest_rate_co_in<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="vs">`</span>}]<span class="op">,</span></span>
<span id="cb77-2066"><a href="#cb77-2066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-2067"><a href="#cb77-2067" aria-hidden="true" tabindex="-1"></a>  <span class="dt">encoding</span><span class="op">:</span> {</span>
<span id="cb77-2068"><a href="#cb77-2068" aria-hidden="true" tabindex="-1"></a>            <span class="st">"color"</span><span class="op">:</span> {<span class="st">"value"</span><span class="op">:</span> <span class="st">"green"</span><span class="op">,</span> <span class="st">"condition"</span><span class="op">:</span> {<span class="st">"test"</span><span class="op">:</span> <span class="st">"datum.impact &lt; 0"</span><span class="op">,</span> <span class="st">"value"</span><span class="op">:</span> <span class="st">"red"</span>}}<span class="op">,</span></span>
<span id="cb77-2069"><a href="#cb77-2069" aria-hidden="true" tabindex="-1"></a>                <span class="st">"opacity"</span><span class="op">:</span>             {<span class="st">"condition"</span><span class="op">:</span> {<span class="st">"test"</span><span class="op">:</span> <span class="st">"datum.year_in &gt; datum.actual_interest_rate_co_in"</span><span class="op">,</span> <span class="st">"value"</span><span class="op">:</span> <span class="fl">0.5</span>}<span class="op">,</span> <span class="st">"value"</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span></span>
<span id="cb77-2070"><a href="#cb77-2070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-2071"><a href="#cb77-2071" aria-hidden="true" tabindex="-1"></a>        <span class="st">"text"</span><span class="op">:</span> {</span>
<span id="cb77-2072"><a href="#cb77-2072" aria-hidden="true" tabindex="-1"></a>      <span class="st">"field"</span><span class="op">:</span> <span class="st">"impact"</span><span class="op">,</span></span>
<span id="cb77-2073"><a href="#cb77-2073" aria-hidden="true" tabindex="-1"></a>      <span class="st">"type"</span><span class="op">:</span> <span class="st">"quantitative"</span><span class="op">,</span></span>
<span id="cb77-2074"><a href="#cb77-2074" aria-hidden="true" tabindex="-1"></a>      <span class="st">"format"</span><span class="op">:</span> <span class="st">",.2f"</span><span class="op">,</span></span>
<span id="cb77-2075"><a href="#cb77-2075" aria-hidden="true" tabindex="-1"></a>      <span class="st">"axis"</span><span class="op">:</span> {<span class="st">"format"</span><span class="op">:</span> <span class="st">",.2f"</span>}</span>
<span id="cb77-2076"><a href="#cb77-2076" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb77-2077"><a href="#cb77-2077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-2078"><a href="#cb77-2078" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-2079"><a href="#cb77-2079" aria-hidden="true" tabindex="-1"></a>  }]<span class="op">,</span></span>
<span id="cb77-2080"><a href="#cb77-2080" aria-hidden="true" tabindex="-1"></a>  <span class="st">"config"</span><span class="op">:</span> {<span class="st">"legend"</span><span class="op">:</span> {<span class="st">"disable"</span><span class="op">:</span> <span class="kw">true</span>}}<span class="op">,</span></span>
<span id="cb77-2081"><a href="#cb77-2081" aria-hidden="true" tabindex="-1"></a>  <span class="st">"datasets"</span><span class="op">:</span> { <span class="dt">data</span><span class="op">:</span> savings_rec_data</span>
<span id="cb77-2082"><a href="#cb77-2082" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb77-2083"><a href="#cb77-2083" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-20-4" data-nodetype="declaration" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
<div id="fizzbuzz" class="modeldept html-fill-item html-fill-container">
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<details class="code-fold">
<summary>Show the code! (calcuvizspec)</summary>
<div class="sourceCode cell-code html-fill-item html-fill-container" id="cb78" data-startfrom="2100" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2099;"><span id="cb78-2100"><a href="#cb78-2100" aria-hidden="true" tabindex="-1"></a><span class="fu">embed</span>(</span>
<span id="cb78-2101"><a href="#cb78-2101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calcuvizspec</span>({</span>
<span id="cb78-2102"><a href="#cb78-2102" aria-hidden="true" tabindex="-1"></a>    <span class="dt">models</span><span class="op">:</span> [fizzbuzz]<span class="op">,</span></span>
<span id="cb78-2103"><a href="#cb78-2103" aria-hidden="true" tabindex="-1"></a>    <span class="dt">input_cursors</span><span class="op">:</span> [{}]<span class="op">,</span></span>
<span id="cb78-2104"><a href="#cb78-2104" aria-hidden="true" tabindex="-1"></a>    <span class="dt">mark</span><span class="op">:</span> {<span class="dt">type</span><span class="op">:</span> <span class="st">'text'</span><span class="op">,</span> <span class="dt">fontSize</span><span class="op">:</span><span class="dv">15</span><span class="op">,</span> <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span>}<span class="op">,</span></span>
<span id="cb78-2105"><a href="#cb78-2105" aria-hidden="true" tabindex="-1"></a>    <span class="dt">encodings</span><span class="op">:</span> {</span>
<span id="cb78-2106"><a href="#cb78-2106" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> {<span class="dt">name</span><span class="op">:</span> <span class="st">'formula'</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span><span class="st">'nominal'</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> [<span class="st">'fizz'</span><span class="op">,</span><span class="st">'buzz'</span><span class="op">,</span><span class="st">'fizzbuzz'</span>]<span class="op">,</span> <span class="dt">axis</span><span class="op">:</span> {<span class="dt">labelFontSize</span><span class="op">:</span> <span class="dv">60</span>}<span class="op">,</span> <span class="dt">sort</span><span class="op">:</span> [<span class="st">'fizzbuzz'</span>]}<span class="op">,</span></span>
<span id="cb78-2107"><a href="#cb78-2107" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> {<span class="dt">name</span><span class="op">:</span> <span class="st">'i_in'</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span><span class="st">'nominal'</span><span class="op">,</span> <span class="dt">domain</span><span class="op">:</span> _<span class="op">.</span><span class="fu">range</span>(i_in<span class="op">,</span> i_in<span class="op">+</span><span class="dv">20</span>)<span class="op">,</span> <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">,</span></span>
<span id="cb78-2108"><a href="#cb78-2108" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> {<span class="dt">name</span><span class="op">:</span> <span class="st">'value'</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">'nominal'</span>}<span class="op">,</span></span>
<span id="cb78-2109"><a href="#cb78-2109" aria-hidden="true" tabindex="-1"></a>      <span class="dt">color</span><span class="op">:</span> {<span class="dt">name</span><span class="op">:</span> <span class="st">'value'</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="st">'nominal'</span><span class="op">,</span> <span class="dt">legend</span><span class="op">:</span><span class="kw">false</span>}<span class="op">,</span></span>
<span id="cb78-2110"><a href="#cb78-2110" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb78-2111"><a href="#cb78-2111" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">250</span>}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div id="ojs-cell-21" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
</div>
<div id="year_remaining" class="modeldept html-fill-item html-fill-container">
<div class="card cell html-fill-item html-fill-container bslib-card" data-bslib-card-init="" data-require-bs-caller="card()" data-full-screen="false">
<div class="card-body html-fill-item html-fill-container">
<details class="code-fold hidden">
<summary>Show the code! (model calls -&gt; Plot)</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb79" data-startfrom="2127" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2126;"><span id="cb79-2127"><a href="#cb79-2127" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">bind</span>(Inputs<span class="op">.</span><span class="fu">select</span>([<span class="st">"start of today"</span><span class="op">,</span> <span class="st">"start of tomorrow"</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span><span class="st">'from'</span>})<span class="op">,</span> viewof timing_in)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-22-1" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code! (model calls -&gt; Plot)</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb80" data-startfrom="2129" data-source-offset="-104"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2128;"><span id="cb80-2129"><a href="#cb80-2129" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`**</span><span class="sc">${</span>(d3<span class="op">.</span><span class="fu">format</span>(<span class="st">'.2%'</span>)(year_remaining<span class="op">.</span><span class="fu">fractionLeftInYear</span>({<span class="dt">date_in</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span> timing_in})))<span class="sc">}</span><span class="vs">** of year reamining, or visually:`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-22-2" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code! (model calls -&gt; Plot)</summary>
<div class="sourceCode cell-code hidden html-fill-item html-fill-container" id="cb81" data-startfrom="2131" data-source-offset="-236"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2130;"><span id="cb81-2131"><a href="#cb81-2131" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb81-2132"><a href="#cb81-2132" aria-hidden="true" tabindex="-1"></a>  <span class="co">//marginLeft: 90,</span></span>
<span id="cb81-2133"><a href="#cb81-2133" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span><span class="dv">80</span><span class="op">,</span></span>
<span id="cb81-2134"><a href="#cb81-2134" aria-hidden="true" tabindex="-1"></a>  <span class="co">//width:5000,</span></span>
<span id="cb81-2135"><a href="#cb81-2135" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> { <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb81-2136"><a href="#cb81-2136" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [    Plot<span class="op">.</span><span class="fu">axisX</span>({<span class="dt">anchor</span><span class="op">:</span> <span class="st">"top"</span>})<span class="op">,</span></span>
<span id="cb81-2137"><a href="#cb81-2137" aria-hidden="true" tabindex="-1"></a><span class="op">,</span>Plot<span class="op">.</span><span class="fu">barX</span>(</span>
<span id="cb81-2138"><a href="#cb81-2138" aria-hidden="true" tabindex="-1"></a>    [{<span class="dt">sort</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">status</span><span class="op">:</span><span class="st">'remaining'</span><span class="op">,</span><span class="dt">percent</span><span class="op">:</span><span class="dv">100</span><span class="op">*</span>year_remaining<span class="op">.</span><span class="fu">fractionLeftInYear</span>({<span class="dt">date_in</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span> timing_in})}<span class="op">,</span></span>
<span id="cb81-2139"><a href="#cb81-2139" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">sort</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">status</span><span class="op">:</span><span class="st">'complete'</span><span class="op">,</span><span class="dt">percent</span><span class="op">:</span><span class="dv">100</span><span class="op">*</span>year_remaining<span class="op">.</span><span class="fu">fractionIntoYear</span>({<span class="dt">date_in</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span> timing_in})</span>
<span id="cb81-2140"><a href="#cb81-2140" aria-hidden="true" tabindex="-1"></a>}]</span>
<span id="cb81-2141"><a href="#cb81-2141" aria-hidden="true" tabindex="-1"></a><span class="op">,</span>{ <span class="dt">x</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"status"</span><span class="op">,</span> <span class="dt">sort</span><span class="op">:</span><span class="st">'sort'</span> })]</span>
<span id="cb81-2142"><a href="#cb81-2142" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display html-fill-item html-fill-container">
<div class="html-fill-item html-fill-container">
<div id="ojs-cell-22-3" data-nodetype="expression" class="html-fill-item html-fill-container">

</div>
</div>
</div>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<p>Not so sure? Check workings in the calculang model using ‘overlay’ option!</p>
<em>Inspired by <a href="https://twitter.com/year_remaining"><span class="citation" data-cites="year_remaining">@year_remaining</span></a></em>
</div>
<!------------- --->
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
    <template>Expand</template>
    <span class="bslib-full-screen-enter badge rounded-pill">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" style="height:1em;width:1em;" aria-hidden="true" role="img"><path d="M20 5C20 4.4 19.6 4 19 4H13C12.4 4 12 3.6 12 3C12 2.4 12.4 2 13 2H21C21.6 2 22 2.4 22 3V11C22 11.6 21.6 12 21 12C20.4 12 20 11.6 20 11V5ZM4 19C4 19.6 4.4 20 5 20H11C11.6 20 12 20.4 12 21C12 21.6 11.6 22 11 22H3C2.4 22 2 21.6 2 21V13C2 12.4 2.4 12 3 12C3.6 12 4 12.4 4 13V19Z"></path></svg>
    </span>
</bslib-tooltip><script data-bslib-card-init="">bslib.Card.initializeAllCards();</script></div>
<div class="cell hidden">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb82" data-startfrom="2165" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2164;"><span id="cb82-2165"><a href="#cb82-2165" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb82-2166"><a href="#cb82-2166" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;style&gt;</span></span>
<span id="cb82-2167"><a href="#cb82-2167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2168"><a href="#cb82-2168" aria-hidden="true" tabindex="-1"></a><span class="vs">.vega-embed {</span></span>
<span id="cb82-2169"><a href="#cb82-2169" aria-hidden="true" tabindex="-1"></a><span class="vs">  width: 100%;</span></span>
<span id="cb82-2170"><a href="#cb82-2170" aria-hidden="true" tabindex="-1"></a><span class="vs">  height: 100%;</span></span>
<span id="cb82-2171"><a href="#cb82-2171" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb82-2172"><a href="#cb82-2172" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb82-2173"><a href="#cb82-2173" aria-hidden="true" tabindex="-1"></a><span class="vs">  .answer {</span></span>
<span id="cb82-2174"><a href="#cb82-2174" aria-hidden="true" tabindex="-1"></a><span class="vs">    color: red !important;</span></span>
<span id="cb82-2175"><a href="#cb82-2175" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-weight: bold;</span></span>
<span id="cb82-2176"><a href="#cb82-2176" aria-hidden="true" tabindex="-1"></a><span class="vs">    font-size: 1.5em !important;</span></span>
<span id="cb82-2177"><a href="#cb82-2177" aria-hidden="true" tabindex="-1"></a><span class="vs">    left: 100px !important;</span></span>
<span id="cb82-2178"><a href="#cb82-2178" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb82-2179"><a href="#cb82-2179" aria-hidden="true" tabindex="-1"></a><span class="vs">  .answer .tooltiptext  {</span></span>
<span id="cb82-2180"><a href="#cb82-2180" aria-hidden="true" tabindex="-1"></a><span class="vs">    border: 2px dashed black;</span></span>
<span id="cb82-2181"><a href="#cb82-2181" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb82-2182"><a href="#cb82-2182" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb82-2183"><a href="#cb82-2183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2184"><a href="#cb82-2184" aria-hidden="true" tabindex="-1"></a><span class="vs">  .answer .tooltiptext::after {</span></span>
<span id="cb82-2185"><a href="#cb82-2185" aria-hidden="true" tabindex="-1"></a><span class="vs">    color: red;</span></span>
<span id="cb82-2186"><a href="#cb82-2186" aria-hidden="true" tabindex="-1"></a><span class="vs">    border: none;</span></span>
<span id="cb82-2187"><a href="#cb82-2187" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb82-2188"><a href="#cb82-2188" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb82-2189"><a href="#cb82-2189" aria-hidden="true" tabindex="-1"></a><span class="vs">.answer:hover {</span></span>
<span id="cb82-2190"><a href="#cb82-2190" aria-hidden="true" tabindex="-1"></a><span class="vs">  /*font-size:2em !important;*/</span></span>
<span id="cb82-2191"><a href="#cb82-2191" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb82-2192"><a href="#cb82-2192" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb82-2193"><a href="#cb82-2193" aria-hidden="true" tabindex="-1"></a><span class="vs">  body {</span></span>
<span id="cb82-2194"><a href="#cb82-2194" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: system-ui;</span></span>
<span id="cb82-2195"><a href="#cb82-2195" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb82-2196"><a href="#cb82-2196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2197"><a href="#cb82-2197" aria-hidden="true" tabindex="-1"></a><span class="vs">pre {</span></span>
<span id="cb82-2198"><a href="#cb82-2198" aria-hidden="true" tabindex="-1"></a><span class="vs">  line-height: 25px;</span></span>
<span id="cb82-2199"><a href="#cb82-2199" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb82-2200"><a href="#cb82-2200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2201"><a href="#cb82-2201" aria-hidden="true" tabindex="-1"></a><span class="vs">.calculang_tooltip {</span></span>
<span id="cb82-2202"><a href="#cb82-2202" aria-hidden="true" tabindex="-1"></a><span class="vs">  position: relative;</span></span>
<span id="cb82-2203"><a href="#cb82-2203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2204"><a href="#cb82-2204" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb82-2205"><a href="#cb82-2205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2206"><a href="#cb82-2206" aria-hidden="true" tabindex="-1"></a><span class="vs">.tooltiptext {</span></span>
<span id="cb82-2207"><a href="#cb82-2207" aria-hidden="true" tabindex="-1"></a><span class="vs">  position: absolute;</span></span>
<span id="cb82-2208"><a href="#cb82-2208" aria-hidden="true" tabindex="-1"></a><span class="vs">  bottom: calc(100% - 10px);</span></span>
<span id="cb82-2209"><a href="#cb82-2209" aria-hidden="true" tabindex="-1"></a><span class="vs">  left: anchor(center);</span></span>
<span id="cb82-2210"><a href="#cb82-2210" aria-hidden="true" tabindex="-1"></a><span class="vs">  transform: translateX(-50%);</span></span>
<span id="cb82-2211"><a href="#cb82-2211" aria-hidden="true" tabindex="-1"></a><span class="vs">  width: max-content;</span></span>
<span id="cb82-2212"><a href="#cb82-2212" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb82-2213"><a href="#cb82-2213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2214"><a href="#cb82-2214" aria-hidden="true" tabindex="-1"></a><span class="vs">.tooltiptext {</span></span>
<span id="cb82-2215"><a href="#cb82-2215" aria-hidden="true" tabindex="-1"></a><span class="vs">  cursor: zoom-in;</span></span>
<span id="cb82-2216"><a href="#cb82-2216" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb82-2217"><a href="#cb82-2217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2218"><a href="#cb82-2218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2219"><a href="#cb82-2219" aria-hidden="true" tabindex="-1"></a><span class="vs">.calculang_tooltip.answer .tooltiptext {</span></span>
<span id="cb82-2220"><a href="#cb82-2220" aria-hidden="true" tabindex="-1"></a><span class="vs">  bottom: 0;</span></span>
<span id="cb82-2221"><a href="#cb82-2221" aria-hidden="true" tabindex="-1"></a><span class="vs">} </span></span>
<span id="cb82-2222"><a href="#cb82-2222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2223"><a href="#cb82-2223" aria-hidden="true" tabindex="-1"></a><span class="vs">calculang_tooltip.answer {</span></span>
<span id="cb82-2224"><a href="#cb82-2224" aria-hidden="true" tabindex="-1"></a><span class="vs">    background-color: lightorange;</span></span>
<span id="cb82-2225"><a href="#cb82-2225" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb82-2226"><a href="#cb82-2226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2227"><a href="#cb82-2227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2228"><a href="#cb82-2228" aria-hidden="true" tabindex="-1"></a><span class="vs">pre {</span></span>
<span id="cb82-2229"><a href="#cb82-2229" aria-hidden="true" tabindex="-1"></a><span class="vs">  cursor:default</span></span>
<span id="cb82-2230"><a href="#cb82-2230" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb82-2231"><a href="#cb82-2231" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/style&gt;</span></span>
<span id="cb82-2232"><a href="#cb82-2232" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-23-1" data-nodetype="expression">

</div>
</div>
</div>
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb83" data-startfrom="2234" data-source-offset="-843"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2233;"><span id="cb83-2234"><a href="#cb83-2234" aria-hidden="true" tabindex="-1"></a>viewof color <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">text</span>({ <span class="dt">label</span><span class="op">:</span> <span class="st">"color"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"#0D0"</span> })</span>
<span id="cb83-2235"><a href="#cb83-2235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-2236"><a href="#cb83-2236" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {Tangle} <span class="im">from</span> <span class="st">"@declann/colored-tangle"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-23-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-23-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>


<div id="3ade8a4a-fb1d-4a6c-8409-ac45482d5fc9" class="hidden">

</div>
</div>
</div>


<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuLy8gcmF5Y2FzdGluZ1xudmlld29mIHBsYXllcl94X2luID0gSW5wdXRzLmlucHV0KDEuNylcbnZpZXdvZiBwbGF5ZXJfeV9pbiA9IElucHV0cy5pbnB1dCg1LjUpXG52aWV3b2YgcmF5X2FuZ2xlX2luID0gSW5wdXRzLmlucHV0KG51bGwpXG52aWV3b2Ygc3RlcF9pbiA9IElucHV0cy5pbnB1dCgzKVxudmlld29mIHhfaW4gPSBJbnB1dHMuaW5wdXQoMy41KVxudmlld29mIHlfaW4gPSBJbnB1dHMuaW5wdXQoMy41KVxudmlld29mIGZfaW4gPSBJbnB1dHMuaW5wdXQoMClcbnZpZXdvZiBrZXlfc3RyZWFtX3ZlcnNpb25faW4gPSBJbnB1dHMuaW5wdXQoMClcbnZpZXdvZiBrZXlzX3N0cmVhbV92ZXJzaW9uX2luID0gSW5wdXRzLmlucHV0KFwiaGlcIilcblxuLy8gc2F2aW5nc1xudmlld29mIGFubnVhbF9wYXltZW50X2luID0gSW5wdXRzLmlucHV0KDEwMDApXG52aWV3b2YgZHVyYXRpb25faW4gPSBJbnB1dHMuaW5wdXQoNSlcbnZpZXdvZiBpbnRlcmVzdF9yYXRlX2luID0gSW5wdXRzLmlucHV0KC4wMilcbnZpZXdvZiB5ZWFyX2luID0gSW5wdXRzLmlucHV0KDIpXG52aWV3b2YgaV9pbiA9IElucHV0cy5pbnB1dCgyKVxudmlld29mIGRhdGVfaW4gPSBJbnB1dHMuaW5wdXQobmV3IERhdGUoKSlcbnZpZXdvZiB0aW1pbmdfaW4gPSBJbnB1dHMuaW5wdXQoXCJzdGFydCBvZiB0b2RheVwiKVxuXG5cbi8vIHN0YXJmaWVsZFxudmlld29mIHN0YXJfaW4gPSBJbnB1dHMuaW5wdXQoMylcbnZpZXdvZiBzcGVlZF9pbiA9IElucHV0cy5pbnB1dCgzKVxudmlld29mIGZyYW1lX2luID0gSW5wdXRzLmlucHV0KDIpXG52aWV3b2YgcmFuZG9tX3NlZWRfaW4gPSBJbnB1dHMuaW5wdXQoXCJoZWxsb1wiKVxuXG5cbi8vIHNhdmluZ3MtcmVjXG52aWV3b2YgYWN0dWFsX2ludGVyZXN0X3JhdGVfY29faW4gPSBJbnB1dHMuaW5wdXQoMilcblxubWluaV9iaW5kcyA9IHtcbiAgcmV0dXJuICh7XG4gICAgZHVyYXRpb25faW46IDEgPyBUYW5nbGUoe21pbjogMCwgbWF4OiAyMCwgbGFiZWw6ICdkdXJhdGlvbl9pbid9KSA6IDAsIC8vSW5wdXRzLnJhbmdlKFswLDEwXSwge2xhYmVsOidkdXJhdGlvbicsIHZhbHVlOiA1LCBzdGVwOiAxLCB3aWR0aDoxMDB9KSxcbiAgICB5ZWFyX2luOiBUYW5nbGUoe21pbjogLTEwLCBtYXg6IDIwLCBsYWJlbDogJ3llYXJfaW4nfSkgLy9JbnB1dHMucmFuZ2UoWzAsMTBdLCB7bGFiZWw6J3llYXInLCB2YWx1ZTogNSwgc3RlcDogMSwgd2lkdGg6MTAwfSlcbiAgICAsIGFubnVhbF9wYXltZW50X2luOiBUYW5nbGUoe21pbjogMCwgbWF4OiAyMDAwMCwgbGFiZWw6J2FubnVhbF9wYXltZW50X2luJ30pXG4gICAgLCBpbnRlcmVzdF9yYXRlX2luOiBUYW5nbGUoe21pbjogMCwgbWF4OiAwLjEsIGZvcm1hdDogZDMuZm9ybWF0KCcuMmYnKSwgbGFiZWw6J2ludGVyZXN0X3JhdGVfaW4nfSkgLy8gcHJlY2lzaW9uIGhvdz9cbiAgICAsIGFjdHVhbF9pbnRlcmVzdF9yYXRlX2NvX2luOiBUYW5nbGUoe21pbjogLTEsIG1heDogMjAsIGxhYmVsOidhY3R1YWxfaW50ZXJlc3RfcmF0ZV9jb19pbid9KVxuICAgICwgZl9pbjogVGFuZ2xlKHttaW46IC0xLCBtYXg6IDIwMCwgbGFiZWw6J2ZfaW4nfSlcbiAgICAvLywga2V5c19zdHJlYW1fZnVuY3Rpb25faW46IG1kYChrZXlzX3N0cmVhbV9mdW5jdGlvbl9pbilgXG4gICAgLCBzdGVwX2luOiBUYW5nbGUoe21pbjogLTEsIG1heDogMjAsIGxhYmVsOidzdGVwX2luJ30pXG4gICAgLCB4X2luOiBUYW5nbGUoe21pbjogLTEsIG1heDogMjAwLCBsYWJlbDoneF9pbid9KVxuICAgICwgeV9pbjogVGFuZ2xlKHttaW46IC0xLCBtYXg6IDIwMCwgbGFiZWw6J3lfaW4nfSlcbiAgICAsIHBsYXllcl94X2luOiBUYW5nbGUoe21pbjogLTEsIG1heDogMTAsZm9ybWF0OiBkMy5mb3JtYXQoJy4yZicpLCBsYWJlbDoncGxheWVyX3hfaW4nfSlcbiAgICAsIHBsYXllcl95X2luOiBUYW5nbGUoe21pbjogLTEsIG1heDogMTAsIGZvcm1hdDogZDMuZm9ybWF0KCcuMmYnKSxsYWJlbDoncGxheWVyX3lfaW4nfSlcbiAgICAsIHJheV9hbmdsZV9pbjogLypJbnB1dHMucmFuZ2UoWy0xMCwxMF0sIHtsYWJlbDoncmF5X2FuZ2xlX2luJ30pKi9UYW5nbGUoe21pbjogLTEsIG1heDogMTAsIGZvcm1hdDogZDMuZm9ybWF0KCcuMmYnKSxsYWJlbDoncmF5X2FuZ2xlX2luJ30pXG4gICAgLCBpX2luOiBUYW5nbGUoe21pbjogLTEwLCBtYXg6IDIwMCwgbGFiZWw6J2lfaW4nfSlcbiAgICAsIGRhdGVfaW46IElucHV0cy5kYXRlKHtsYWJlbDogXCJkYXRlXCIsIHZhbHVlOiBcIjIwMjQtMDEtMjNcIn0pXG4gICAgLCB0aW1pbmdfaW46IElucHV0cy5zZWxlY3QoW1wic3RhcnQgb2YgdG9kYXlcIiwgXCJzdGFydCBvZiB0b21vcnJvd1wiXSlcbiAgICAsIHJhbmRvbV9zZWVkX2luOiBJbnB1dHMudGV4dCh7bGFiZWw6ICdyYW5kb21fc2VlZF9pbid9KVxuICAgICwgZnJhbWVfaW46IFRhbmdsZSh7bWluOiAtMSwgbWF4OiAyMDAsIGxhYmVsOidmcmFtZV9pbid9KVxuICAgICwgc3Rhcl9pbjogVGFuZ2xlKHttaW46IC0xLCBtYXg6IDIwMCwgbGFiZWw6J3N0YXJfaW4nfSlcbiAgICAsIHNwZWVkX2luOiBUYW5nbGUoe21pbjogLTEsIG1heDogMjAsIGxhYmVsOidzcGVlZF9pbid9KVxuXG4gIH0pXG59XG5cbklucHV0cy5iaW5kKG1pbmlfYmluZHMuZHVyYXRpb25faW4sIHZpZXdvZiBkdXJhdGlvbl9pbilcbklucHV0cy5iaW5kKG1pbmlfYmluZHMueWVhcl9pbiwgdmlld29mIHllYXJfaW4pXG5JbnB1dHMuYmluZChtaW5pX2JpbmRzLmFubnVhbF9wYXltZW50X2luLCB2aWV3b2YgYW5udWFsX3BheW1lbnRfaW4pXG5JbnB1dHMuYmluZChtaW5pX2JpbmRzLmludGVyZXN0X3JhdGVfaW4sIHZpZXdvZiBpbnRlcmVzdF9yYXRlX2luKVxuSW5wdXRzLmJpbmQobWluaV9iaW5kcy5hY3R1YWxfaW50ZXJlc3RfcmF0ZV9jb19pbiwgdmlld29mIGFjdHVhbF9pbnRlcmVzdF9yYXRlX2NvX2luKVxuSW5wdXRzLmJpbmQobWluaV9iaW5kcy5mX2luLCB2aWV3b2YgZl9pbilcbklucHV0cy5iaW5kKG1pbmlfYmluZHMueF9pbiwgdmlld29mIHhfaW4pXG5JbnB1dHMuYmluZChtaW5pX2JpbmRzLnlfaW4sIHZpZXdvZiB5X2luKVxuSW5wdXRzLmJpbmQobWluaV9iaW5kcy5wbGF5ZXJfeF9pbiwgdmlld29mIHBsYXllcl94X2luKVxuSW5wdXRzLmJpbmQobWluaV9iaW5kcy5wbGF5ZXJfeV9pbiwgdmlld29mIHBsYXllcl95X2luKVxuSW5wdXRzLmJpbmQobWluaV9iaW5kcy5zdGVwX2luLCB2aWV3b2Ygc3RlcF9pbilcbklucHV0cy5iaW5kKG1pbmlfYmluZHMucmF5X2FuZ2xlX2luLCB2aWV3b2YgcmF5X2FuZ2xlX2luKVxuSW5wdXRzLmJpbmQobWluaV9iaW5kcy5pX2luLCB2aWV3b2YgaV9pbilcbklucHV0cy5iaW5kKG1pbmlfYmluZHMuZGF0ZV9pbiwgdmlld29mIGRhdGVfaW4pXG5JbnB1dHMuYmluZChtaW5pX2JpbmRzLnRpbWluZ19pbiwgdmlld29mIHRpbWluZ19pbilcbklucHV0cy5iaW5kKG1pbmlfYmluZHMucmFuZG9tX3NlZWRfaW4sIHZpZXdvZiByYW5kb21fc2VlZF9pbilcbklucHV0cy5iaW5kKG1pbmlfYmluZHMuZnJhbWVfaW4sIHZpZXdvZiBmcmFtZV9pbilcbklucHV0cy5iaW5kKG1pbmlfYmluZHMuc3BlZWRfaW4sIHZpZXdvZiBzcGVlZF9pbilcbklucHV0cy5iaW5kKG1pbmlfYmluZHMuc3Rhcl9pbiwgdmlld29mIHN0YXJfaW4pXG5cbi8vIFRPRE8gTUFLRSBTVEVQUyBISUdITElHSFQgUkVBQ1QgVE8gU1RFUF9JTiBUQU5HTEVcblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG4vLyB3b3JraW5nIGludGVyYWN0aXZpdHlcblxuaHRtbGA8c3R5bGU+XG5cbi5pbnB1dHMge1xuICBwYWRkaW5nOiAyMHB4O1xufVxuXG5idXR0b24uYnRuIHtcbiAgYmFja2dyb3VuZC1jb2xvcjogYW50aXF1ZXdoaXRlO1xuICBjb2xvcjogYmx1ZTtcbiAgcGFkZGluZzowO1xufVxuXG4uY2FsY3VsYW5nIHtcbiAgbGluZS1oZWlnaHQ6IDQwcHg7XG4gIGNvbG9yOiBibHVlO1xuICAgIC13ZWJraXQtdHJhbnNpdGlvbjogYWxsIDAuMnMgbGluZWFyO1xuICAgIC1tb3otdHJhbnNpdGlvbjogYWxsIDAuMnMgbGluZWFyO1xuICAgIC1vLXRyYW5zaXRpb246IGFsbCAwLjJzIGxpbmVhcjtcbiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBsaW5lYXI7XG4gIFxufVxuXG4uY2FsY3VsYW5nLmNhbGN1bGFuZ19vdmVyd3JpdHRlbiB7XG4gIHRleHQtZGVjb3JhdGlvbjogbGluZS10aHJvdWdoO1xuICBmb250LXdlaWdodDogYm9sZDtcbn1cblxuJHtmb3JtdWxhZV9oaWRkZW4ubGVuZ3RoID8gYC5jYWxjdWxhbmcge1xuICAgIGJhY2tncm91bmQ6ICNhYWYzO1xufWAgOiAnJ31cblxuXG4ke2Zvcm11bGFlX2hpZGRlbi5tYXAoZCA9PiBgLmNhbGN1bGFuZ19mXyR7ZH0gKyAuY2FsY3VsYW5nX2ZfJHtkfWApLmpvaW4oJywgJyl9IHtcbiAgZmlsdGVyOiBibHVyKDdweCk7XG4gIGxpbmUtaGVpZ2h0OiA1cHg7XG4gIG9wYWNpdHk6IDAuNTtcbn0gLyogKyBzZWxlY3RvciB0byBleGNsdWRlIGZpcnN0ISBodHRwczovL2NvZGVyd2FsbC5jb20vcC91dWd1cncvY3NzLXNlbGVjdG9yLXRyaWNrLXNlbGVjdC1hbGwtZWxlbWVudHMtZXhjZXB0LXRoZS1maXJzdCAqL1xuJHtmb3JtdWxhZV9oaWRkZW4ubWFwKGQgPT4gYC5jYWxjdWxhbmdfZl8ke2R9YCkuam9pbignLCAnKX0ge1xuICBvcGFjaXR5OiAwLjU7XG4gIGJhY2tncm91bmQ6IHdoaXRlO1xufSR7Zm9ybXVsYWVfaGlkZGVuLm1hcChkID0+IGAuY2FsY3VsYW5nX2ZfJHtkfSAuY2FsY3VsYW5nX3Rvb2x0aXBgKS5qb2luKCcsICcpfSB7XG4gIG9wYWNpdHk6IDAuMTtcbiAgYmFja2dyb3VuZDogd2hpdGU7XG59XG4ke2Zvcm11bGFlX2hpZGRlbi5tYXAoZCA9PiBgLmNhbGN1bGFuZ19mXyR7ZH0gPiAuY2FsY3VsYW5nX3RpdGxlYCkuam9pbignLCAnKX0ge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiBsaWdodGdyZWVuO1xuICBmb250LXNpemU6IDAuNWVtO1xufVxuXG5zcGFuLmNhbGN1bGFuZ19jYWxsIHtcbiAgd2hpdGUtc3BhY2U6bm93cmFwO1xuICBjdXJzb3I6IHpvb20taW47XG4gIGNvbG9yOiByZWQ7XG4gIGZvbnQtd2VpZ2h0OiBib2xkO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiBsaWdodGJsdWU7XG59XG5cbi5jYWxjdWxhbmdfY2FsbC5jYWxjdWxhbmdfY2FsbF9pbnB1dCB7XG4gIGN1cnNvcjogbm9uZTtcbiAgYmFja2dyb3VuZC1jb2xvcjogcGluaztcbn1cblxuLmNhbGN1bGFuZyAuY2FsY3VsYW5nX3RpdGxlIHNwYW4ge1xuICBwYWRkaW5nOiAzcHg7XG4gIGJhY2tncm91bmQ6ICNhZjU0O1xuICBmb250LXNpemU6IDEuNWVtO1xuICBmb250LXdlaWdodDogYm9sZDtcbiAgYm9yZGVyOiAxcHggc29saWQgZ3JleTtcbiAgICAtd2Via2l0LXRyYW5zaXRpb246IGFsbCAwLjJzIGxpbmVhcjtcbiAgICAtbW96LXRyYW5zaXRpb246IGFsbCAwLjJzIGxpbmVhcjtcbiAgICAtby10cmFuc2l0aW9uOiBhbGwgMC4ycyBsaW5lYXI7XG4gICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgbGluZWFyO1xuXG59XG5cbi5jYWxjdWxhbmdfdGl0bGUuY2FsY3VsYW5nX3RpdGxlX3JlbmFtZWQge1xuICB0ZXh0LWRlY29yYXRpb246IGxpbmUtdGhyb3VnaDtcbiAgdGV4dC1kZWNvcmF0aW9uLXN0eWxlOiBkYXNoZWQ7XG59XG48L3N0eWxlPmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vbW9kZWwgPSByZXF1aXJlKGAke2VudHJ5cG9pbnRfbm9fY3VsX2pzfS5qc2ApLy9cblxuLyptb2RlbHMgPSAoe3NhdmluZ3M6IDMsLy9yZXF1aXJlKGAke2VudHJ5cG9pbnRfbm9fY3VsX2pzfS5qc2ApLFxuICByYXljYXN0aW5nMjogcmVxdWlyZSgnaHR0cHM6Ly9jYWxjdWxhbmcuZGV2L21vZGVscy9yYXljYXN0aW5nL3JheWNhc3RpbmcuanMnKX0pKi9cblxuLy8gVE9ETyB3b3JrIHdpdGggbWVtbyBzYXZpbmdzLXJlY1xuXG5maXp6YnV6eiA9IGF3YWl0IHJlcXVpcmUoYGh0dHBzOi8vY2FsY3VsYW5nLmRldi9tb2RlbHMvZml6emJ1enovZml6emJ1enouanNgKVxueWVhcl9yZW1haW5pbmcgPSBhd2FpdCByZXF1aXJlKGBodHRwczovL2NhbGN1bGFuZy5kZXYvbW9kZWxzL3llYXItcmVtYWluaW5nL3llYXItcmVtYWluaW5nLmpzYClcbnN0YXJmaWVsZCA9IGF3YWl0IHJlcXVpcmUoYGh0dHBzOi8vY2FsY3VsYW5nLmRldi9tb2RlbHMvc3RhcmZpZWxkL3N0YXJmaWVsZC5qc2ApXG4vLyBVUERBVEUxIExPQUQgTU9ERUwgVVNJTkcgQ09SUkVDVCBSRUZcbiAgcmF5Y2FzdGluZzIgPSBhd2FpdCByZXF1aXJlKGBodHRwOi8vbG9jYWxob3N0OjgwODAvcmF5Y2FzdGluZy9yYXljYXN0aW5nLmpzPyR7cmVmcmVzaH0ke0RhdGUubm93KCl9YCk7XG5cbnNhdmluZ3MgPSBhd2FpdCByZXF1aXJlKGBodHRwczovL2NhbGN1bGFuZy5kZXYvbW9kZWxzL3NhdmluZ3Mvc2F2aW5ncy5qc2ApO1xuXG5zYXZpbmdzX3JlYyA9IGF3YWl0IHJlcXVpcmUoYGh0dHBzOi8vY2FsY3VsYW5nLmRldi9tb2RlbHMvc2F2aW5ncy9zYXZpbmdzLXJlYy5qc2ApXG5cblxuaW50cm9zcGVjdGlvbl9mZXRjaCA9IGF3YWl0IGZldGNoKGAke2VudHJ5cG9pbnRfbm9fY3VsX2pzfS5pbnRyb3NwZWN0aW9uLmpzb25gKVxuXG5pbnRyb3NwZWN0aW9uID0gYXdhaXQgaW50cm9zcGVjdGlvbl9mZXRjaC5qc29uKHt0eXBlZDp0cnVlfSlcblxuaW50cm9zcGVjdGlvbl9ub21lbW9fZmV0Y2ggPSBhd2FpdCBmZXRjaChgJHtlbnRyeXBvaW50X25vX2N1bF9qc30ke2NhbGN1bGFuZ19zb3VyY2Vfbm9tZW1vLmxlbmd0aCA/ICctbm9tZW1vJyA6ICcnfS5pbnRyb3NwZWN0aW9uLmpzb25gKVxuXG5pbnRyb3NwZWN0aW9uX25vbWVtbyA9IGF3YWl0IGludHJvc3BlY3Rpb25fbm9tZW1vX2ZldGNoLmpzb24oe3R5cGVkOnRydWV9KVxuXG5cbmNhbGN1bGFuZ19zb3VyY2VfaW50cm9zcGVjdGlvbiA9IGNhbGN1bGFuZ19zb3VyY2Vfbm9tZW1vLmxlbmd0aCA/IGludHJvc3BlY3Rpb25fbm9tZW1vIDogaW50cm9zcGVjdGlvblxuXG5mb3JtdWxhZV9vYmpzID0gT2JqZWN0LnZhbHVlcyhjYWxjdWxhbmdfc291cmNlX2ludHJvc3BlY3Rpb24uY3VsX2Z1bmN0aW9ucykuZmlsdGVyKGQgPT4gZC5yZWFzb24gPT0gJ2RlZmluaXRpb24nICYmIGlucHV0cy5pbmRleE9mKGQubmFtZSsnX2luJykgPT0gLTEpXG5pbnB1dF9mb3JtdWxhZV9vYmpzID0gT2JqZWN0LnZhbHVlcyhjYWxjdWxhbmdfc291cmNlX2ludHJvc3BlY3Rpb24uY3VsX2Z1bmN0aW9ucykuZmlsdGVyKGQgPT4gZC5yZWFzb24gPT0gJ2RlZmluaXRpb24nICYmIGlucHV0cy5pbmRleE9mKGQubmFtZSsnX2luJykgIT0gLTEpXG5cbmlucHV0cyA9IF8udW5pcShPYmplY3QudmFsdWVzKGNhbGN1bGFuZ19zb3VyY2VfaW50cm9zcGVjdGlvbi5jdWxfZnVuY3Rpb25zKS5maWx0ZXIoZCA9PiBkLnJlYXNvbiA9PSAnaW5wdXQgZGVmaW5pdGlvbicpLm1hcChkID0+IGQubmFtZSkuc29ydCgpKVxuXG5mbnMwID0gT2JqZWN0LnZhbHVlcyhjYWxjdWxhbmdfc291cmNlX2ludHJvc3BlY3Rpb24uY3VsX2Z1bmN0aW9ucykuZmlsdGVyKGQgPT4gZC5jdWxfc2NvcGVfaWQgPT0gMCkubWFwKGQgPT4gZC5pbnB1dHMpLmZsYXQoKVxuXG5cbmltcG9ydCB7IENvZGVNaXJyb3IsIGxvYWRDb2RlTWlycm9yTW9kdWxlcyB9IGZyb20gXCJAam1hdHN1c2hpdGEvY29kZW1pcnJvckA2NzBcIjtcblxuY21JbXBvcnRzID0gbG9hZENvZGVNaXJyb3JNb2R1bGVzKFtcbiAgXCJ2aWV3QDYuMjIuMlwiLCAvLyBjaGsgdmVyc2lvbnM/XG4gIFwic3RhdGVANi4zLjNcIixcbiAgXCJsYW5ndWFnZUA2LjkuM1wiLFxuICBcImxhbmctamF2YXNjcmlwdFwiXG4gIC8vXCJjb21tYW5kc0A2LjMuMlwiLFxuXSk7XG5cbkVkaXRvclZpZXcgPSBjbUltcG9ydHMudmlldy5FZGl0b3JWaWV3XG5cbkVkaXRvclN0YXRlID0gY21JbXBvcnRzLnN0YXRlLkVkaXRvclN0YXRlXG5cbkRlY29yYXRpb24gPSBjbUltcG9ydHMudmlldy5EZWNvcmF0aW9uXG5cbnNldCA9IChpbnB1dCwgdmFsdWUpID0+IHtcbiAgaW5wdXQudmFsdWUgPSB2YWx1ZTtcbiAgaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoXCJpbnB1dFwiLCB7YnViYmxlczogdHJ1ZX0pKTtcbn1cblxuLy8vLy8vLy8vLy8vIHBsdWdpbiAxOiBkZWNvcmF0aW9uICYgY3VsIG5hdmlnYXRpb24gZm9yIGZ1bmN0aW9uLWxldmVsXG5cbnN5bnRheFRyZWUgPSBjbUltcG9ydHMubGFuZ3VhZ2Uuc3ludGF4VHJlZVxuXG5mb3JtdWxhRGVjb3JhdGlvbnMgPSB7XG4gIHJldHVybiAob3B0aW9ucykgPT4ge1xuICAgIC8vc2V0KG9wdGlvbnMuZm9ybXVsYWVfdmlzaWJsZSwgW1wiXCJdKSAvLyB0aGlzIHdhcyBkb2luZyBhIGxvdCBvZiBqYW5rISFcbiAgICBjb25zdCBmb3JtdWxhRGVjb3JhdGlvbnMgPSBjbUltcG9ydHMudmlldy5WaWV3UGx1Z2luLmZyb21DbGFzcyhcbiAgICAgIGNsYXNzIHtcblxuICAgICAgICBjb25zdHJ1Y3Rvcih2aWV3KSB7XG4gICAgICAgICAgdGhpcy5kZWNvcmF0aW9ucyA9IGZvcm11bGFEZWNvcmF0aW9uKHZpZXcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdXBkYXRlKHVwZGF0ZSkge1xuICAgICAgICAgIGlmICh1cGRhdGUuZG9jQ2hhbmdlZCB8fCB1cGRhdGUudmlld3BvcnRDaGFuZ2VkKVxuICAgICAgICAgICAgdGhpcy5kZWNvcmF0aW9ucyA9IGZvcm11bGFEZWNvcmF0aW9uKHVwZGF0ZS52aWV3KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgZGVjb3JhdGlvbnM6ICh2KSA9PiB2LmRlY29yYXRpb25zLFxuXG4gICAgICAgIGV2ZW50SGFuZGxlcnM6IHtcbiAgICAgICAgICBtb3VzZWRvd246IChlLCB2aWV3KSA9PiB7IC8vIEhNTU0gSSdsbCBuZWVkIHRvIHJlc29sdmUgdGhhdCBjYWxscyBnZXQgcHJlY2VkZW5jZSEhISBTaG91bGQgYmUgd29ya2luZzpcbiAgICAgICAgICAgIGxldCBjbGFzc0xpc3QgPSBbLi4uZS50YXJnZXQuY2xhc3NMaXN0LCAuLi5lLnRhcmdldC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdF0gLy8gdmVyeSBvcGVuLCBiZSBhd2FyZSBvZiBidWdzID8hXG4gICAgICAgICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiY3VsX2NhbGxcIikpIC8vIFRPRE9cbiAgICAgICAgICAgICAgMTsvL3NldCh2aWV3b2YgZm9ybXVsYWVfc2hvd24sIFt0YXJnZXQudGV4dENvbnRlbnRdKTsgVE9ET1xuICAgICAgICAgICAgZWxzZSBpZiAoXG4gICAgICAgICAgICAgIC8vZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiZGVwb3NpdHNcIikgfHxcbiAgICAgICAgICAgICAgLy9lLnRhcmdldC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcImRlcG9zaXRzXCIpXG4gICAgICAgICAgICAgIGNsYXNzTGlzdC5maWx0ZXIoZCA9PiBkLmluY2x1ZGVzKFwiY2FsY3VsYW5nX2ZfXCIpKS5sZW5ndGhcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgc2V0KG9wdGlvbnMuZm9ybXVsYWVfdmlzaWJsZSwgW2NsYXNzTGlzdC5maW5kKGQgPT4gZC5pbmNsdWRlcyhcImNhbGN1bGFuZ19mX1wiKSkuc2xpY2UoXCJjYWxjdWxhbmdfZl9cIi5sZW5ndGgpXSk7XG4gICAgICAgICAgICAgIC8vLy8vLy8gY2F1c2VzIHVubmVjZXNzYXJ5IGppdHRlciB3aGVuIHdlIGFscmVhZHkgc2VlIGYgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicrY2xhc3NMaXN0LmZpbmQoZCA9PiBkLmluY2x1ZGVzKFwiY2FsY3VsYW5nX2ZfXCIpKSkuc2Nyb2xsSW50b1ZpZXcoc2Nyb2xsSW50b1ZpZXdPcHRzKVxuXG5cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuXG4gICAgcmV0dXJuIFtmb3JtdWxhRGVjb3JhdGlvbnNdO1xuICB9XG59XG5cbi8vIERlY29yYXRpb24ubGluZXNcbmZvcm11bGFEZWNvcmF0aW9uID0gKHZpZXcpID0+IERlY29yYXRpb24uc2V0KFxuICBmb3JtdWxhX2xpbmVfZGV0YWlsc1xuICAgIC5tYXAoKGQpID0+XG4gICAgICBfLnJhbmdlKGQubGluZVN0YXJ0LCBkLmxpbmVFbmQgKyAwLjEpLm1hcCgoZSkgPT5cbiAgICAgICAgRGVjb3JhdGlvbi5saW5lKHtcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICBjbGFzczogXCJjYWxjdWxhbmdcIiArIFwiIFwiICsgXCJjYWxjdWxhbmdfZl9cIitkLm5hbWUgKyAoZC5vdmVyd3JpdHRlbiA/ICcgY2FsY3VsYW5nX292ZXJ3cml0dGVuJyA6ICcnKSAvKiArc3R5bGUgYXZhaWxhYmxlICovIC8vIGxlYXZpbmcgc2NvcGUgYW5kIG90aGVyIHBvdGVudGlhbCBjb25mbGljdHMgb3V0XG4gICAgICAgICAgfVxuICAgICAgICB9KS5yYW5nZSh2aWV3LnN0YXRlLmRvYy5saW5lKGUpLmZyb20pXG4gICAgICApXG4gICAgKVxuICAgIC5mbGF0KCkpXG5cbmZvcm11bGFfbGluZV9kZXRhaWxzID0gT2JqZWN0LnZhbHVlcyhjYWxjdWxhbmdfc291cmNlX2ludHJvc3BlY3Rpb24uY3VsX2Z1bmN0aW9ucylcbiAgLmZpbHRlcigoZCkgPT4gZC5yZWFzb24uaW5jbHVkZXMoXCJkZWZpbml0aW9uXCIpICYmIGQubmFtZS5zbGljZSgtMykgIT0gJ19pbicgJiYgZC5jdWxfc2NvcGVfaWQgPT0gY3VsX3Njb3BlX2lkKVxuICAubWFwKCh7IG5hbWUsIGxvYywgcmVhc29uIH0pID0+ICh7XG4gICAgbmFtZSxcbiAgICBsaW5lU3RhcnQ6IGxvYz8uc3RhcnQubGluZSxcbiAgICBsaW5lRW5kOiBsb2M/LmVuZC5saW5lLFxuICAgIG92ZXJ3cml0dGVuOiBuYW1lLnNsaWNlKC0xKSA9PSAnXycgJiYgIShPYmplY3QudmFsdWVzKGNhbGN1bGFuZ19zb3VyY2VfaW50cm9zcGVjdGlvbi5jdWxfZnVuY3Rpb25zKS5maWx0ZXIoZCA9PiBkLmltcG9ydGVkID09IG5hbWUgJiYgZC5jdWxfc291cmNlX3Njb3BlX2lkID09IGN1bF9zY29wZV9pZCkpLmxlbmd0aCAvLyBhbmQgbm90IGV4cGxpY2l0IGltcG9ydGVkL3VzZWQgaW4gcGFyZW50IGRlZm5cbiAgfSkpXG5cbmZvcm11bGFfbGluZV9kZXRhaWxzXzAgPSBPYmplY3QudmFsdWVzKGNhbGN1bGFuZ19zb3VyY2VfaW50cm9zcGVjdGlvbi5jdWxfZnVuY3Rpb25zKVxuICAuZmlsdGVyKChkKSA9PiBkLnJlYXNvbi5pbmNsdWRlcyhcImRlZmluaXRpb25cIikgJiYgZC5uYW1lLnNsaWNlKC0zKSAhPSAnX2luJyAmJiBkLmN1bF9zY29wZV9pZCA9PSAwKVxuICAubWFwKCh7IG5hbWUsIGxvYywgcmVhc29uIH0pID0+ICh7XG4gICAgbmFtZSxcbiAgICBsaW5lU3RhcnQ6IGxvYz8uc3RhcnQubGluZSxcbiAgICBsaW5lRW5kOiBsb2M/LmVuZC5saW5lLFxuICAgIG92ZXJ3cml0dGVuOiBuYW1lLnNsaWNlKC0xKSA9PSAnXycgJiYgIShPYmplY3QudmFsdWVzKGNhbGN1bGFuZ19zb3VyY2VfaW50cm9zcGVjdGlvbi5jdWxfZnVuY3Rpb25zKS5maWx0ZXIoZCA9PiBkLmltcG9ydGVkID09IG5hbWUpKS5sZW5ndGggLy8gYW5kIG5vdCBleHBsaWNpdCBpbXBvcnRlZC91c2VkIGluIHBhcmVudCBkZWZuXG4gIH0pKVxuXG4vLy8vLy8vLy8vLy8gcGx1Z2luIDI6IGRlY29yYXRpb24gJiBjdWwgbmF2aWdhdGlvbiBmb3IgY2FsbC1sZXZlbCwgYWxzbyBkZWNvcmF0aW9uIGZvciB0aXRsZXMuIEJ5IHN5bnRheCB0cmVlIGFuYWx5c2lzXG4vLyB1c2VzIGZvcm11bGFlX2FsbCwgaW5wdXRzOiBzaG91bGQgZGVyaXZlIGZyb20gZW50cnlwb2ludC9pbnRyb3NwZWN0aW9uIGJlZm9yZSBzcGxpdHRpbmcgdXBcbi8vIGFsc28gc2V0cyBmb3JtYWVfdmlzaWJsZVxuXG4vLyBpbmNvbnNpc3RlbnQgbmFtaW5nICFcblxuZm9ybXVsYWVfaGlkZGVuID0gZm9ybXVsYWVfYWxsLmZpbHRlcigoZCkgPT4gIWZvcm11bGFlX3Zpc2libGUuaW5jbHVkZXMoZCkpXG5cbmZvcm11bGFlX2FsbCA9IGZvcm11bGFfbGluZV9kZXRhaWxzLm1hcCgoZCkgPT4gZC5uYW1lKSAvLyBwb29yP1xuXG4vL2lucHV0cyA9IF8udW5pcShPYmplY3QudmFsdWVzKGludHJvc3BlY3Rpb24uY3VsX2lucHV0X21hcCkuZmxhdCgpKVxuXG5jYWxjdWxhbmdfaWRlbnRpZmllcl9kZWNvcmF0aW9ucyA9IHtcbiAgcmV0dXJuIChvcHRpb25zKSA9PiB7XG4gICAgLy9zZXQob3B0aW9ucy5mb3JtdWxhZV92aXNpYmxlLCBmb3JtdWxhZV9hbGwpIC8vIFdIRVJFIERPRVMgVEhJUyBORUVEIFRPIEdPP1xuICAgIGNvbnN0IGRlY29yYXRpb25zID0gY21JbXBvcnRzLnZpZXcuVmlld1BsdWdpbi5mcm9tQ2xhc3MoXG4gICAgICBjbGFzcyB7XG5cbiAgICAgICAgY29uc3RydWN0b3Iodmlldykge1xuICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSBpZGVudGlmaWVyX2RlY29yYXRpb25zKHZpZXcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdXBkYXRlKHVwZGF0ZSkge1xuICAgICAgICAgIC8vZGVidWdnZXI7IHRoaXMgaXMgY2FsbGVkIGEgTE9UISFcbiAgICAgICAgICAvL2lmICh1cGRhdGUuZG9jQ2hhbmdlZCB8fCB1cGRhdGUuZm9jdXNDaGFuZ2VkfHwgdXBkYXRlLnZpZXdwb3J0Q2hhbmdlZCB8fCB1cGRhdGUuZ2VvbWV0cnlDaGFuZ2VkIHx8IHVwZGF0ZS5oZWlnaHRDaGFuZ2VkKSAvLyBleHBlbnNpdmUgdGhpbmdzIG9uIHNjcm9sbCwgYnV0IGRpZG4ndCBydW4gb24gZnVsbCBkb2MgZm9yIHNvbWUgcmVhc29uPyFcbiAgICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSBpZGVudGlmaWVyX2RlY29yYXRpb25zKHVwZGF0ZS52aWV3KTtcbiAgICAgICAgICAgIC8vIHdoeSBcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgZGVjb3JhdGlvbnM6ICh2KSA9PiB2LmRlY29yYXRpb25zLFxuXG4gICAgICAgIGV2ZW50SGFuZGxlcnM6IHtcbiAgICAgICAgICBtb3VzZWRvd246IChlLCB2aWV3KSA9PiB7XG4gICAgICAgICAgICBsZXQgY2xhc3NMaXN0ID0gWy4uLmUudGFyZ2V0LmNsYXNzTGlzdCwgLi4uZS50YXJnZXQucGFyZW50RWxlbWVudC5jbGFzc0xpc3RdIC8vIHZlcnkgb3BlbiwgYmUgYXdhcmUgb2YgYnVncyA/IVxuICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNhbGN1bGFuZ19jYWxsXCIpIHx8IGNsYXNzTGlzdC5pbmNsdWRlcyhcImNhbGN1bGFuZ190aXRsZVwiKSkgeyAvLyBUT0RPIG9ubHkgaWYgdGhlIGNvbnRhaW5pbmcgZm9ybXVsYSBpcyB2aXNpYmxlLCBJIGhhdmUgb3B0aW9ucy5mb3JtdWxhZV92aXNpYmxlOlxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0hJSElISUVFJylcbiAgICAgICAgICAgIC8vZGVidWdnZXI7XG4gICAgICAgICAgICAgIHNldChvcHRpb25zLmZvcm11bGFlX3Zpc2libGUsIFtlLnRhcmdldC50ZXh0Q29udGVudF0pXG4gICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYWxjdWxhbmdfZl8nK2UudGFyZ2V0LnRleHRDb250ZW50KS5zY3JvbGxJbnRvVmlldyhzY3JvbGxJbnRvVmlld09wdHMpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsc2UgaWYgKFxuICAgICAgICAgICAgICAvL2UudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImRlcG9zaXRzXCIpIHx8XG4gICAgICAgICAgICAgIC8vZS50YXJnZXQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoXCJkZXBvc2l0c1wiKVxuICAgICAgICAgICAgICBjbGFzc0xpc3QuZmlsdGVyKGQgPT4gZC5pbmNsdWRlcyhcImNhbGN1bGFuZ19mX1wiKSkubGVuZ3RoXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgc2V0KG9wdGlvbnMuZm9ybXVsYWVfdmlzaWJsZSwgW2NsYXNzTGlzdC5maW5kKGQgPT4gZC5pbmNsdWRlcyhcImNhbGN1bGFuZ19mX1wiKSkuc2xpY2UoXCJjYWxjdWxhbmdfZl9cIi5sZW5ndGgpXSk7XG4gICAgICAgICAgICAgIC8vZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicrY2xhc3NMaXN0LmZpbmQoZCA9PiBkLmluY2x1ZGVzKFwiY2FsY3VsYW5nX2ZfXCIpKSkuc2Nyb2xsSW50b1ZpZXcoc2Nyb2xsSW50b1ZpZXdPcHRzKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG5cbiAgICByZXR1cm4gW2RlY29yYXRpb25zXTtcbiAgfVxufVxuXG4vLyBEZWNvcmF0aW9uLm1hcmtzIHNwZWNpZmllZCBieSByYW5nZXNcbmlkZW50aWZpZXJfZGVjb3JhdGlvbnMgPSB2aWV3ID0+IHtcbiAgbGV0IGRlY29yYXRpb25zID0gW107XG5cbiAgLy9mb3IgKGxldCB7IGZyb20sIHRvIH0gb2Ygdmlldy52aXNpYmxlUmFuZ2VzKSB7XG4gICAgY29uc29sZS5sb2codmlldy5zdGF0ZSlcbiAgICBjb25zb2xlLmxvZyh2aWV3LnZpc2libGVSYW5nZXMpXG4gIC8vZm9yIChsZXQgeyBmcm9tLCB0byB9IG9mIFt7ZnJvbTogMCwgdG86IDEwMDB9XSkge1xuICAgIC8vZGVidWdnZXI7XG4gICAgLy9kZWJ1Z2dlcjtcbiAgICBmb3IgKGxldCB7IGZyb20sIHRvIH0gb2Ygdmlldy52aXNpYmxlUmFuZ2VzKSB7XG4gICAgLy9mb3IgKGxldCB7IGZyb20sIHRvIH0gb2YgW3tmcm9tOjAsIHRvOjUwMDB9XSkge1xuICAgICAgLy9jbUltcG9ydHMubGFuZ3VhZ2Uuc3ludGF4VHJlZUF2YWlsYWJsZSh2aWV3LnN0YXRlLCApXG4gICAgICAvL2NtSW1wb3J0cy5sYW5ndWFnZS5mb3JjZVBhcnNpbmcodmlldywgKVxuICAgICAgXG4gICAgY21JbXBvcnRzLmxhbmd1YWdlLnN5bnRheFRyZWUodmlldy5zdGF0ZSkuaXRlcmF0ZSh7XG4gICAgICBmcm9tLFxuICAgICAgdG8sXG4gICAgICBlbnRlcjogKG5vZGUpID0+IHtcbiAgICAgICAgaWYgKG5vZGUubmFtZSA9PSBcIlZhcmlhYmxlRGVmaW5pdGlvblwiKSB7XG4gICAgICAgICAgbGV0IG5hbWUgPSB2aWV3LnN0YXRlLmRvYy5zbGljZVN0cmluZyhub2RlLmZyb20sIG5vZGUudG8pO1xuICAgICAgICAgIGlmIChmb3JtdWxhZV9hbGwuaW5jbHVkZXMobmFtZSkpIHtcbiAgICAgICAgICAgIGRlY29yYXRpb25zLnB1c2goXG4gICAgICAgICAgICAgIERlY29yYXRpb24ubWFyayh7IGNsYXNzOiBcImNhbGN1bGFuZ190aXRsZVwiIH0pLnJhbmdlKFxuICAgICAgICAgICAgICAgIG5vZGUuZnJvbSxcbiAgICAgICAgICAgICAgICBub2RlLnRvXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChmb3JtdWxhZV9hbGwuaW5jbHVkZXMobmFtZSArICdfJykpIHtcbiAgICAgICAgICAgIGRlY29yYXRpb25zLnB1c2goXG4gICAgICAgICAgICAgIERlY29yYXRpb24ubWFyayh7IGNsYXNzOiBcImNhbGN1bGFuZ190aXRsZSBjYWxjdWxhbmdfdGl0bGVfcmVuYW1lZFwiIH0pLnJhbmdlKFxuICAgICAgICAgICAgICAgIG5vZGUuZnJvbSxcbiAgICAgICAgICAgICAgICBub2RlLnRvXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5vZGUubmFtZSA9PSBcIlZhcmlhYmxlTmFtZVwiKSB7XG4gICAgICAgICAgbGV0IG5hbWUgPSB2aWV3LnN0YXRlLmRvYy5zbGljZVN0cmluZyhub2RlLmZyb20sIG5vZGUudG8pO1xuICAgICAgICAgIGlmIChmb3JtdWxhZV9hbGwuaW5jbHVkZXMobmFtZSkpIHtcbiAgICAgICAgICAgIGlmIChpbnB1dHMuaW5jbHVkZXMobmFtZSArIFwiX2luXCIpKVxuICAgICAgICAgICAgICBkZWNvcmF0aW9ucy5wdXNoKFxuICAgICAgICAgICAgICAgIERlY29yYXRpb24ubWFyayh7IGNsYXNzOiBcImNhbGN1bGFuZ19jYWxsIGNhbGN1bGFuZ19jYWxsX2lucHV0XCIgfSkucmFuZ2UoXG4gICAgICAgICAgICAgICAgICBub2RlLmZyb20sXG4gICAgICAgICAgICAgICAgICBub2RlLnRvXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICBkZWNvcmF0aW9ucy5wdXNoKFxuICAgICAgICAgICAgICAgIERlY29yYXRpb24ubWFyayh7IGNsYXNzOiBcImNhbGN1bGFuZ19jYWxsXCIgfSkucmFuZ2Uobm9kZS5mcm9tLCBub2RlLnRvKVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIHJldHVybiBEZWNvcmF0aW9uLnNldChkZWNvcmF0aW9ucyk7XG59XG5cblxuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgeCA9IElucHV0cy5pbnB1dCgwKVxuXG5mb3JtdWxhZV92aXNpYmxlXG5cbmZvcm11bGFlX2FsbFxuXG5pbnB1dHNcblxuZm9ybXVsYWVfaGlkZGVuXG5cbm1kYC0tLWBcblxuLy8vLy8vLy8vLy8vLy8vLyBjb2RlIGZvciBnZXR0aW5nIHNvdXJjZVxuXG5leGFtcGxlc195YW1sID0gYXdhaXQgKGF3YWl0IGZldGNoKCdodHRwczovL2NhbGN1bGFuZy5kZXYvZ2FsbGVyeS55bWwnKSkudGV4dCgpXG5cbnlhbWwgPSByZXF1aXJlKCdqcy15YW1sQDQuMS4wL2Rpc3QvanMteWFtbC5taW4uanMnKVxuXG5leGFtcGxlcyA9IHlhbWwubG9hZChleGFtcGxlc195YW1sKVxuXG5zZWxlY3RlZF9tb2RlbCA9IEdlbmVyYXRvcnMuaW5wdXQoYV90aGluZzIpXG5cbmV4YW1wbGVfZGV0YWlscyA9IGV4YW1wbGVzLm1hcChkID0+IGQudGlsZXMpLmZsYXQoKS5maW5kKGQgPT4gZC5pZCA9PSBzZWxlY3RlZF9tb2RlbClcblxubW9kZWxuYW1lID0gZXhhbXBsZV9kZXRhaWxzLmlkLnJlcGxhY2UoJy0nLCdfJykgLy8gcmVwbGFjZSBkdWUgdG8gb2JqZWN0IGxvb2t1cHNcblxucSA9IG5ldyBVUkxTZWFyY2hQYXJhbXMobG9jYXRpb24uc2VhcmNoKVxuXG5cbmRlZmF1bHRfZXhhbXBsZV9pZCA9IHEuZ2V0KCdpZCcpID8/ICcnXG5zaG93X2hpZGRlbiA9IHRydWUvLyBxLmdldCgnaGlkZGVuJykgPT0gJ2hpZGRlbicgPz8gdHJ1ZVxuXG5cbmRpciA9IGRpcm5hbWUoZXhhbXBsZV9lbnRyeXBvaW50KVxuXG5cbi8vaHR0cHM6Ly93d3cuYWJlYXV0aWZ1bHNpdGUubmV0L3Bvc3RzL2phdmFzY3JpcHQtZnVuY3Rpb25zLWZvci1iYXNlbmFtZS1hbmQtZGlybmFtZS9cbmZ1bmN0aW9uIGRpcm5hbWUocGF0aCkge1xuICByZXR1cm4gcGF0aC5tYXRjaCgvLipcXC8vKTtcbn1cblxuXG5cblxuZXhhbXBsZV9lbnRyeXBvaW50ID0gZW50cnlwb2ludFxuXG5lbnRyeXBvaW50ID0gKGV4YW1wbGVfZGV0YWlscy5lbnRyeXBvaW50WzBdID09IFwiL1wiID8gXCJodHRwczovL2NhbGN1bGFuZy5kZXZcIiA6IFwiXCIpICtcbiAgZXhhbXBsZV9kZXRhaWxzLmVudHJ5cG9pbnRcblxuZW50cnlwb2ludF9ub19jdWxfanMgPSBlbnRyeXBvaW50LnNsaWNlKDAsLTcpXG5cbi8vdmlld29mIGVudHJ5cG9pbnQgPSBJbnB1dHMuc2VsZWN0KG5ldyBNYXAoZW50cnlwb2ludHNfYWxsLm1hcCgoZCxpKSA9PiBbZFsxXSxpXSkpLCB7bGFiZWw6J21vZGVsIPCfkYAnLCB2YWx1ZToxfSkgLy8gbGVhdmluZyBvbiBzaW1wbGUtY2xpbWF0ZSBhcyBpdCBicmVha3MgaWYgbm90IGRlZmF1bHQgOm9cblxuLy8gaGFja3ksIGRvIHFzIHBhcnNpbmc/XG4vLyBJIHNob3VsZCB2aWV3IC5tanMgaW5zdGVhZCBvZiAuY3VsLmpzIGZvciBtZW1vIGNhc2U/XG5jdWxfcmVzb3VyY2VzID0ge1xuICBpZiAoY3VsX2pzX2N1bClcbiAgcmV0dXJuIE9iamVjdC52YWx1ZXMoaW50cm9zcGVjdGlvbl9ub21lbW8uY3VsX3Njb3BlX2lkc190b19yZXNvdXJjZSkubWFwKGxvYyA9PiBsb2Muc2xpY2UoMikuc2xpY2UoMCxsb2MuaW5kZXhPZignPycpICE9IC0xID8gbG9jLmluZGV4T2YoJz8nKS0yIDogOTk5KSkubWFwKGQgPT4gZCArICgoZC5zbGljZSgtMykgIT0gJy5qcycpID8gJy5qcycgOiAnJykpLm1hcChsb2MgPT4gZGlyKyBsb2MpXG4gIGVsc2UgcmV0dXJuIFsuLi5BcnJheShPYmplY3Qua2V5cyhpbnRyb3NwZWN0aW9uX25vbWVtby5jdWxfc2NvcGVfaWRzX3RvX3Jlc291cmNlKS5sZW5ndGgpXS5tYXAoKF8sIGkpID0+IGVudHJ5cG9pbnRfbm9fY3VsX2pzIC8qIHRoaXMgaXMgbm90IG1vZGVsbmFtZSEgdGhpcyBzaG91bGQgYmUgcmVsYXRlZCB0byBlbnRyeXBvaXQsIG5vdCBpZCAqLysoY2FsY3VsYW5nX3NvdXJjZV9ub21lbW8ubGVuZ3RoPyAnLW5vbWVtbycgOiAnJykgKydfZXNtLycrJ2N1bF9zY29wZV8nK2krJy5tanMnKVxufVxuXG4vL2N1bF9yZXNvdXJjZXNcblxub3V0cHV0ID0ge1xuICBsZXQgbyA9IFtdO1xuICBjdWxfcmVzb3VyY2VzLmZvckVhY2gobG9jID0+IHtcbiAgICBvLnB1c2goZmV0Y2gobG9jKS50aGVuKGQgPT4gZC50ZXh0KCkpKVxuICB9KVxuICByZXR1cm4gb1xufVxuXG4vLyBUT0RPIHJlcGxhY2UgZHVwbGljYXRlIChzb3VyY2UpIGNvZGUgYnkgYSBtZXNzYWdlXG5cbmNhbGN1bGFuZyA9IFthd2FpdCBvdXRwdXRbMF0sIGN1bF9yZXNvdXJjZXMubGVuZ3RoID4gMSA/IGF3YWl0IG91dHB1dFsxXSA6ICcnXG4sIGN1bF9yZXNvdXJjZXMubGVuZ3RoID4gMiA/IGF3YWl0IG91dHB1dFsyXSA6ICcnXG4sIGN1bF9yZXNvdXJjZXMubGVuZ3RoID4gMyA/IGF3YWl0IG91dHB1dFszXSA6ICcnXG4sIGN1bF9yZXNvdXJjZXMubGVuZ3RoID4gNCA/IGF3YWl0IG91dHB1dFs0XSA6ICcnXG4sIGN1bF9yZXNvdXJjZXMubGVuZ3RoID4gNSA/IGF3YWl0IG91dHB1dFs1XSA6ICcnXG4sIGN1bF9yZXNvdXJjZXMubGVuZ3RoID4gNiA/IGF3YWl0IG91dHB1dFs2XSA6ICcnIC8vIFRPRE8gd2FybiB3aGVuIG92ZXJmbG93c1xuLCBjdWxfcmVzb3VyY2VzLmxlbmd0aCA+IDcgPyBhd2FpdCBvdXRwdXRbN10gOiAnJ10uZmlsdGVyKGQgPT4gZCAhPSAnJylcbi8vY2FsY3VsYW5nXG5cbi8vIFwieC5jdWwuanMgZm9ybXVsYWU/XCJcbmZmZiA9IGNhbGN1bGFuZy5tYXAoZCA9PiBkLnNwbGl0KCdcXG4nKSkubWFwKGQgPT4gW2QuZmluZEluZGV4KGUgPT4gZS5pbmRleE9mKCdpbnB1dHM6JyArIChvcHRpb25zLmluY2x1ZGVzKCdpbnB1dHMnKSA/ICdCTEFIJyA6ICcnKSkgIT0gLTEpID8/IDk5OSwgLi4uZF0pLm1hcChkID0+IGQuZmlsdGVyKChlLGkpID0+IGkgPD0gZFswXSB8fCBkWzBdID09IC0xKSkubWFwKGQgPT4gZC5zbGljZSgxKSkubWFwKGQgPT4gZC5qb2luKCdcXG4nKSkubWFwKChkLGkpID0+IGAqKipbJHtpbnRyb3NwZWN0aW9uLmN1bF9zY29wZV9pZHNfdG9fcmVzb3VyY2VbaV0uc3BsaXQoJz8nKVswXS5yZXBsYWNlQWxsKCctbm9tZW1vJywgJycpfV0oJHtjdWxfcmVzb3VyY2VzW2ldLnJlcGxhY2VBbGwoJy1ub21lbW8nLCcnKX0pICR7Y3VsX2pzX2N1bCA/IGAtPiBbanNdKCR7ZW50cnlwb2ludF9ub19jdWxfanN9X2VzbS9jdWxfc2NvcGVfJHtpfS5tanMpYCA6IGBgfSoqKlxuXG5+fn5qc1xuJHtkLnJlcGxhY2VBbGwoJ2V4cG9ydCBjb25zdCAnICsgKG9wdGlvbnMuaW5jbHVkZXMoJ2V4cG9ydCBjb25zdHMnKVxuID8gJ0JMQUgnIDogJycpLCAnJyl9XG5+fn5cbmBcbilcblxuZmZmMiA9IGNhbGN1bGFuZy5maWx0ZXIoKGQsaSkgPT4gaSA9PSBjdWxfc2NvcGVfaWQpLm1hcChkID0+IGQuc3BsaXQoJ1xcbicpKS5tYXAoZCA9PiBbZC5maW5kSW5kZXgoZSA9PiBlLmluZGV4T2YoJ2lucHV0czonICsgKG9wdGlvbnMuaW5jbHVkZXMoJ2lucHV0cycpID8gJ0JMQUgnIDogJycpKSAhPSAtMSkgPz8gOTk5LCAuLi5kXSkubWFwKGQgPT4gZC5maWx0ZXIoKGUsaSkgPT4gaSA8PSBkWzBdIHx8IGRbMF0gPT0gLTEpKS5tYXAoZCA9PiBkLnNsaWNlKDEpKS5tYXAoZCA9PiBkLmpvaW4oJ1xcbicpKVxuXG4ubWFwKChkLGkpID0+IGAke2QucmVwbGFjZUFsbCgnZXhwb3J0IGNvbnN0ICcgKyAob3B0aW9ucy5pbmNsdWRlcygnZXhwb3J0IGNvbnN0cycpXG4gPyAnQkxBSCcgOiAnJyksICcnKX1gXG4pXG5cblxuZmZmXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vbWRgJHtmZmYuam9pbignXFxuXFxuJyl9YFxuXG5lbmFibGVkID0gW1wicmF5Y2FzdGluZzJcIiwgXCJzYXZpbmdzXCIsIFwic2F2aW5nc19yZWNcIiwgXCJzdGFyZmllbGRcIiwgXCJmaXp6YnV6elwiLCBcInllYXJfcmVtYWluaW5nXCJdXG5cbmFfdGhpbmcyID0gaHRtbGA8c2VsZWN0IHN0eWxlPVwiZm9udC1zaXplOiAxLjVlbVwiPlxuJHtleGFtcGxlcy5tYXAoY2F0ZWdvcnkgPT4gYDxvcHRncm91cCBsYWJlbD1cIiR7Y2F0ZWdvcnkuY2F0ZWdvcnl9XCI+XG4gICR7Y2F0ZWdvcnkudGlsZXMuZmlsdGVyKHRpbGUgPT4gKCghdGlsZS5kaXNhYmxlZCkgfHwgc2hvd19oaWRkZW4pKS5maWx0ZXIoZCA9PiBlbmFibGVkLmluY2x1ZGVzKGQuaWQucmVwbGFjZSgnLScsJ18nKSkpLm1hcChkID0+IGA8b3B0aW9uIHZhbHVlPVwiJHtkLmlkfVwiJHtkLmlkID09IGRlZmF1bHRfZXhhbXBsZV9pZCA/ICcgc2VsZWN0ZWQ9XCJzZWxlY3RlZFwiJyA6ICcnfX0+JHtkLnRpdGxlfTwvb3B0aW9uPmApfVxuICAke2NhdGVnb3J5LnRpbGVzLmZpbHRlcihkID0+IGQuaWQgPT0gZGVmYXVsdF9leGFtcGxlX2lkICYmIGQuZGlzYWJsZWQgJiYgKCFzaG93X2hpZGRlbikpLm1hcChkID0+IGA8b3B0aW9uIHZhbHVlPVwiJHtkLmlkfVwiJHtkLmlkID09IGRlZmF1bHRfZXhhbXBsZV9pZCA/ICcgc2VsZWN0ZWQ9XCJzZWxlY3RlZFwiJyA6ICcnfX0+JHtkLnRpdGxlfTwvb3B0aW9uPmApfVxuPC9vcHRncm91cD5cbmApfTwvc2VsZWN0PmBcblxubWRgJHtleGFtcGxlX2RldGFpbHMubW9kdWxhciA/ICfimbvvuI8nIDogJyd9ICoke2V4YW1wbGVfZGV0YWlscy5zdWJ0aXRsZX0qYFxuXG52aWV3b2YgY3VsX3Njb3BlX2lkID0gSW5wdXRzLnJhbmdlKFswLDE1XSwge2xhYmVsOiAnY3VsIHNjb3BlIGlkJywgdmFsdWU6MCwgc3RlcDoxfSlcblxuXG5cbntcbiAgdmFyIG8gPSB7fTtcbiAgc2hvdy5mb3JFYWNoKGQgPT4ge1xuICAgIGlmIChtaW5pX2JpbmRzW2RdKVxuICAgIG9bZF0gPSBtaW5pX2JpbmRzW2RdXG4gICAgLy9lbHNlIG9bZF0gPSBtZGAke2R9YFxuICB9KVxuICByZXR1cm4gSW5wdXRzLmZvcm0obywge3RlbXBsYXRlOiBlbHMgPT4gaHRsLmh0bWxgPGRpdiBjbGFzcz1cInN0eWxlZFwiPiR7T2JqZWN0LnZhbHVlcyhlbHMpfTwvZGl2PjxzdHlsZT5cbiAgZGl2LnN0eWxlZCB7XG4gICAgdGV4dC1hbGlnbjogbGVmdDtcbiAgICAvKmNvbHVtbi1jb3VudDogMjsqL1xuICB9XG4gIGRpdi5zdHlsZWQgc3BhbiB7XG4gICAgbWFyZ2luLXJpZ2h0OiAyMHB4O1xuICAgIC8qZm9udC1zaXplOjAuN2VtOyovXG4gICAgLypmb250LXdlaWdodDogYm9sZDsqL1xuICB9XG4gIGRpdi5zdHlsZWQgc3BhbiB7XG4gICAgd2lkdGg6NzBweDtcbiAgICAvKmZvbnQtd2VpZ2h0OiBib2xkOyovXG4gIH1cbiAgZGl2LnN0eWxlZCBsYWJlbDpub3QoZGl2PmxhYmVsKTphZnRlciB7XG4gICAgLy9jb250ZW50OiBcIjpcIjtcbiAgfVxuPC9zdHlsZT5gfSkgLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BtYXJ0aWVuL2hvcml6b250YWwtaW5wdXRzXG4vLyBzdGlsbCBub3QgcmVsaWFibGUsIGRvIHNldCBpbXBsZW1lbnRhdGlvbj9cbn1cblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5zaG93ID0gXy51bmlxKE9iamVjdC52YWx1ZXMoY2FsY3VsYW5nX3NvdXJjZV9pbnRyb3NwZWN0aW9uLmN1bF9mdW5jdGlvbnMpLmZpbHRlcihkID0+IGQucmVhc29uID09ICdpbnB1dCBkZWZpbml0aW9uJykubWFwKGQgPT4gZC5uYW1lKS5zb3J0KCkpLmZpbHRlcihkID0+IGZvcm11bGFfbGluZV9kZXRhaWxzXzAuZmlsdGVyKGUgPT4gZS5uYW1lICsgJ19pbicgPT0gZCAmJiAoZS5vdmVyd3JpdHRlbiA9PSB1bmRlZmluZWQgfHwgZS5vdmVyd3JpdHRlbiA9PSBmYWxzZSkpLmxlbmd0aClcblxuc3QgPSB7XG4gIGVudHJ5cG9pbnRfbm9fY3VsX2pzO1xuICAvLyBJIGNhbm5vdCBmZXRjaCAhISFcbiAgLy9mZXRjaChgJHtlbnRyeXBvaW50X25vX2N1bF9qc30kezEgPyAnLW5vbWVtbycgOiAnJ30uaW50cm9zcGVjdGlvbi5qc29uYCk7XG4gIC8vYXdhaXQgaW50cm9zcGVjdGlvbl9ub21lbW87IC8vIEkgY2FuIGRlcGVuZCBvbiBtb2RlbG5hbWUgYnV0IE5PVCBpbnB1dHMgb3IgaW50cm9zcGVjdGlvbiAhXG4gIHJldHVybiBbJ3llYXJfaW4nLCAnZHVyYXRpb25faW4nLCAnZl9pbiddIC8vIFwiYW5udWFsX3BheW1lbnRfaW5cIiwgXCJkdXJhdGlvbl9pblwiLCBcImludGVyZXN0X3JhdGVfaW5cIiwgXCJ5ZWFyX2luXCJcbiAgLy8gbm90IHdvcmtpbmdcbn1cblxuLy9mZmYyLmpvaW4oJ1xcblxcbicpXG5cbi8qbWpzX3FfZXZhbFxuXG5hYVxuXG5tb2RlbCovXG5cbnZpZXdvZiBlZGl0b3IgPSBDb2RlTWlycm9yKFxuICAvLyBUaGlzIG5lZWRzIHRvIGJlIGVudHJ5cG9pbnQgc2NvcGVpZD9cbiAgZmZmMi5qb2luKCdcXG5cXG4nKSxcbiAge1xuICAgIGV4dGVuc2lvbnM6IFsgLy8gd3JhcCBpbmRpY2F0b3JzIHdvdWxkIGJlIG5pY2VcbiAgICAgIC8vIG15RGVmYXVsdFRoZW1lLCAvLyBUT0RPIGJyaW5nIHRoaXMgaW4sICsgZGFyayB2ZXJzaW9uXG4gICAgICBjbUltcG9ydHNbXCJsYW5nLWphdmFzY3JpcHRcIl0uamF2YXNjcmlwdCgpLFxuICAgICAgLy9jbUltcG9ydHNbXCJsYW5ndWFnZVwiXS5mb2xkR3V0dGVyKCksXG4gICAgICAvL0VkaXRvclZpZXcuZGVjb3JhdGlvbnMub2YoRGVjb3JhdGlvbi5zZXQoeWVsbG93LnJhbmdlKHIpKSlcbiAgICAgIC8qIEJVSUxESU5HIGNtQ2hlY2tib3hQbHVnaW5WaWV3b2YsIC8vIGRvZXMgY3VsIGNvZGUgYW5ub3RhdGlvbiBhbmQgbmF2aWdhdGlvbiwgZGVwZW5kaW5nIG9uIHNob3dTdHJpcGVzXG4gICAgICBjbU92ZXJsYXlQbHVnaW5WaWV3b2YsKi9cbiAgICAgIG92ZXJsYXkgPyBvdmVybGF5X2Fuc3dlcnMgOiBFZGl0b3JTdGF0ZS5yZWFkT25seS5vZihyZWFkb25seSksXG4gICAgICBvdmVybGF5ID8gb3ZlcmxheV93b3JraW5ncyA6IEVkaXRvclN0YXRlLnJlYWRPbmx5Lm9mKHJlYWRvbmx5KSxcbiAgICAgIGZvcm11bGFEZWNvcmF0aW9ucyh7Zm9ybXVsYWVfdmlzaWJsZTogdmlld29mIGZvcm11bGFlX3Zpc2libGV9KSwgLy8gaHR0cHM6Ly9jb2RlbWlycm9yLm5ldC9leGFtcGxlcy96ZWJyYS9cbiAgICAgIC8qIFRPRE8gZG9uJ3QgcHJvY2VzcyBJbXBvcnQvRXhwb3J0cyBmb3Igbm93ICovIGNhbGN1bGFuZ19pZGVudGlmaWVyX2RlY29yYXRpb25zKHtmb3JtdWxhZV92aXNpYmxlOiB2aWV3b2YgZm9ybXVsYWVfdmlzaWJsZX0pLFxuICAgICAgRWRpdG9yVmlldy5saW5lV3JhcHBpbmcsXG4gICAgICBFZGl0b3JWaWV3LmVkaXRhYmxlLm9mKHJlYWRvbmx5KSxcbiAgICAgIEVkaXRvclN0YXRlLnJlYWRPbmx5Lm9mKHJlYWRvbmx5KVxuICAgIF1cbiAgfVxuKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG4vLy8vLy8vLy8vLy8vIG92ZXJsYXkgcGx1Z2luOlxuXG4vLy8vIGV2YWxzOyBmcm9tIGdlbmVyYXRvciBpbiByZWFjdGl2ZS13b3JraW5nc1xuXG5pbnRlcmVzdF9yYXRlX2V4cGVjdGVkID0gKCkgPT4gMCAvLyBzdGlsbCBuZWVkZWQsIFRPRE8gZml4IVxuLy9pbnRlcmVzdF9yYXRlX2V4cGVjdGVkID0gKCkgPT4gMFxuXG4vLy8vLyBDT1BZIEVWQUxTXG5cbm1qc19xX2V2YWwgPSAgeyByZXR1cm4gKHtcInNhdmluZ3NcIjpbW3tuYW1lOiBcInllYXJcIiwgdmFsdWU6c2F2aW5ncy55ZWFyKHsgeWVhcl9pbiB9KX0se25hbWU6IFwieWVhclwiLCB2YWx1ZTpzYXZpbmdzLnllYXIoeyB5ZWFyX2luIH0pfSx7bmFtZTogXCJkZXBvc2l0c1wiLCB2YWx1ZTpzYXZpbmdzLmRlcG9zaXRzKHsgeWVhcl9pbiwgZHVyYXRpb25faW4sIGFubnVhbF9wYXltZW50X2luIH0pfSx7bmFtZTogXCJiYWxhbmNlXCIsIHZhbHVlOnNhdmluZ3MuYmFsYW5jZSh7IGR1cmF0aW9uX2luLCBhbm51YWxfcGF5bWVudF9pbiwgaW50ZXJlc3RfcmF0ZV9pbiwgeWVhcl9pbjpzYXZpbmdzLnllYXIoeyB5ZWFyX2luIH0pIC0gMSB9KSwgaGFuZGxlcjogKCkgPT4ge3NldCh2aWV3b2YgeWVhcl9pbiwgc2F2aW5ncy55ZWFyKHsgeWVhcl9pbiB9KSAtIDEpfX0se25hbWU6IFwieWVhclwiLCB2YWx1ZTpzYXZpbmdzLnllYXIoeyB5ZWFyX2luIH0pfSx7bmFtZTogXCJkZXBvc2l0c1wiLCB2YWx1ZTpzYXZpbmdzLmRlcG9zaXRzKHsgeWVhcl9pbiwgZHVyYXRpb25faW4sIGFubnVhbF9wYXltZW50X2luIH0pfSx7bmFtZTogXCJpbnRlcmVzdFwiLCB2YWx1ZTpzYXZpbmdzLmludGVyZXN0KHsgeWVhcl9pbiwgZHVyYXRpb25faW4sIGFubnVhbF9wYXltZW50X2luLCBpbnRlcmVzdF9yYXRlX2luIH0pfSx7bmFtZTogXCJ5ZWFyXCIsIHZhbHVlOnNhdmluZ3MueWVhcih7IHllYXJfaW4gfSl9LHtuYW1lOiBcInllYXJcIiwgdmFsdWU6c2F2aW5ncy55ZWFyKHsgeWVhcl9pbiB9KX0se25hbWU6IFwiZHVyYXRpb25cIiwgdmFsdWU6c2F2aW5ncy5kdXJhdGlvbih7IGR1cmF0aW9uX2luIH0pfSx7bmFtZTogXCJhbm51YWxfcGF5bWVudFwiLCB2YWx1ZTpzYXZpbmdzLmFubnVhbF9wYXltZW50KHsgYW5udWFsX3BheW1lbnRfaW4gfSl9LHtuYW1lOiBcInllYXJcIiwgdmFsdWU6c2F2aW5ncy55ZWFyKHsgeWVhcl9pbiB9KX0se25hbWU6IFwiYmFsYW5jZVwiLCB2YWx1ZTpzYXZpbmdzLmJhbGFuY2UoeyBkdXJhdGlvbl9pbiwgYW5udWFsX3BheW1lbnRfaW4sIGludGVyZXN0X3JhdGVfaW4sIHllYXJfaW46c2F2aW5ncy55ZWFyKHsgeWVhcl9pbiB9KSAtIDEgfSksIGhhbmRsZXI6ICgpID0+IHtzZXQodmlld29mIHllYXJfaW4sIHNhdmluZ3MueWVhcih7IHllYXJfaW4gfSkgLSAxKX19LHtuYW1lOiBcInllYXJcIiwgdmFsdWU6c2F2aW5ncy55ZWFyKHsgeWVhcl9pbiB9KX0se25hbWU6IFwiaW50ZXJlc3RfcmF0ZVwiLCB2YWx1ZTpzYXZpbmdzLmludGVyZXN0X3JhdGUoeyBpbnRlcmVzdF9yYXRlX2luIH0pfV1dLFwic2F2aW5nc19yZWNcIjpbW3tuYW1lOiBcInllYXJcIiwgdmFsdWU6c2F2aW5nc19yZWMueWVhcih7IHllYXJfaW4gfSl9LHtuYW1lOiBcImFjdHVhbF9pbnRlcmVzdF9yYXRlX2NvXCIsIHZhbHVlOnNhdmluZ3NfcmVjLmFjdHVhbF9pbnRlcmVzdF9yYXRlX2NvKHsgYWN0dWFsX2ludGVyZXN0X3JhdGVfY29faW4gfSl9LHtuYW1lOiBcImludGVyZXN0X3JhdGVfZXhwZWN0ZWRcIiwgdmFsdWU6aW50ZXJlc3RfcmF0ZV9leHBlY3RlZCh7fSl9LHtuYW1lOiBcImFjdHVhbF9pbnRlcmVzdF9yYXRlc1wiLCB2YWx1ZTpzYXZpbmdzX3JlYy5hY3R1YWxfaW50ZXJlc3RfcmF0ZXMoe30pfSx7bmFtZTogXCJ5ZWFyXCIsIHZhbHVlOnNhdmluZ3NfcmVjLnllYXIoeyB5ZWFyX2luIH0pfV0sW10sW3tuYW1lOiBcInllYXJcIiwgdmFsdWU6c2F2aW5nc19yZWMueWVhcih7IHllYXJfaW4gfSl9LHtuYW1lOiBcInllYXJcIiwgdmFsdWU6c2F2aW5nc19yZWMueWVhcih7IHllYXJfaW4gfSl9LHtuYW1lOiBcImRlcG9zaXRzXCIsIHZhbHVlOnNhdmluZ3NfcmVjLmRlcG9zaXRzKHsgeWVhcl9pbiB9KX0se25hbWU6IFwiYmFsYW5jZVwiLCB2YWx1ZTpzYXZpbmdzX3JlYy5iYWxhbmNlKHsgYWN0dWFsX2ludGVyZXN0X3JhdGVfY29faW4sIHllYXJfaW46c2F2aW5nc19yZWMueWVhcih7IHllYXJfaW4gfSkgLSAxIH0pLCBoYW5kbGVyOiAoKSA9PiB7c2V0KHZpZXdvZiB5ZWFyX2luLCBzYXZpbmdzX3JlYy55ZWFyKHsgeWVhcl9pbiB9KSAtIDEpfX0se25hbWU6IFwieWVhclwiLCB2YWx1ZTpzYXZpbmdzX3JlYy55ZWFyKHsgeWVhcl9pbiB9KX0se25hbWU6IFwiZGVwb3NpdHNcIiwgdmFsdWU6c2F2aW5nc19yZWMuZGVwb3NpdHMoeyB5ZWFyX2luIH0pfSx7bmFtZTogXCJpbnRlcmVzdFwiLCB2YWx1ZTpzYXZpbmdzX3JlYy5pbnRlcmVzdCh7IHllYXJfaW4sIGFjdHVhbF9pbnRlcmVzdF9yYXRlX2NvX2luIH0pfSx7bmFtZTogXCJ5ZWFyXCIsIHZhbHVlOnNhdmluZ3NfcmVjLnllYXIoeyB5ZWFyX2luIH0pfSx7bmFtZTogXCJ5ZWFyXCIsIHZhbHVlOnNhdmluZ3NfcmVjLnllYXIoeyB5ZWFyX2luIH0pfSx7bmFtZTogXCJkdXJhdGlvblwiLCB2YWx1ZTpzYXZpbmdzX3JlYy5kdXJhdGlvbih7fSl9LHtuYW1lOiBcImFubnVhbF9wYXltZW50XCIsIHZhbHVlOnNhdmluZ3NfcmVjLmFubnVhbF9wYXltZW50KHt9KX0se25hbWU6IFwieWVhclwiLCB2YWx1ZTpzYXZpbmdzX3JlYy55ZWFyKHsgeWVhcl9pbiB9KX0se25hbWU6IFwiYmFsYW5jZVwiLCB2YWx1ZTpzYXZpbmdzX3JlYy5iYWxhbmNlKHsgYWN0dWFsX2ludGVyZXN0X3JhdGVfY29faW4sIHllYXJfaW46c2F2aW5nc19yZWMueWVhcih7IHllYXJfaW4gfSkgLSAxIH0pLCBoYW5kbGVyOiAoKSA9PiB7c2V0KHZpZXdvZiB5ZWFyX2luLCBzYXZpbmdzX3JlYy55ZWFyKHsgeWVhcl9pbiB9KSAtIDEpfX0se25hbWU6IFwieWVhclwiLCB2YWx1ZTpzYXZpbmdzX3JlYy55ZWFyKHsgeWVhcl9pbiB9KX0se25hbWU6IFwiaW50ZXJlc3RfcmF0ZVwiLCB2YWx1ZTpzYXZpbmdzX3JlYy5pbnRlcmVzdF9yYXRlKHsgeWVhcl9pbiwgYWN0dWFsX2ludGVyZXN0X3JhdGVfY29faW4gfSl9XV0sXCJzdGFyZmllbGRcIjpbW3tuYW1lOiBcInJhbmRvbV9zZWVkXCIsIHZhbHVlOnN0YXJmaWVsZC5yYW5kb21fc2VlZCh7IHJhbmRvbV9zZWVkX2luIH0pfSx7bmFtZTogXCJzZWVkZWRcIiwgdmFsdWU6c3RhcmZpZWxkLnNlZWRlZCh7IHJhbmRvbV9zZWVkX2luOnN0YXJmaWVsZC5yYW5kb21fc2VlZCh7IHJhbmRvbV9zZWVkX2luIH0pIH0pLCBoYW5kbGVyOiAoKSA9PiB7c2V0KHZpZXdvZiByYW5kb21fc2VlZF9pbiwgc3RhcmZpZWxkLnJhbmRvbV9zZWVkKHsgcmFuZG9tX3NlZWRfaW4gfSkpfX0se25hbWU6IFwicmFuZG9tX3NlZWRcIiwgdmFsdWU6c3RhcmZpZWxkLnJhbmRvbV9zZWVkKHsgcmFuZG9tX3NlZWRfaW4gfSl9LHtuYW1lOiBcInJhbmRvbVwiLCB2YWx1ZTpzdGFyZmllbGQucmFuZG9tKHsgcmFuZG9tX3NlZWRfaW4sIHN0YXJfaW46c3RhcmZpZWxkLnN0YXIoeyBzdGFyX2luIH0pLCBpZDogXCJ4XCIgfSksIGhhbmRsZXI6ICgpID0+IHtzZXQodmlld29mIHN0YXJfaW4sIHN0YXJmaWVsZC5zdGFyKHsgc3Rhcl9pbiB9KSl9fSx7bmFtZTogXCJzdGFyXCIsIHZhbHVlOnN0YXJmaWVsZC5zdGFyKHsgc3Rhcl9pbiB9KX0se25hbWU6IFwicmFuZG9tXCIsIHZhbHVlOnN0YXJmaWVsZC5yYW5kb20oeyByYW5kb21fc2VlZF9pbiwgc3Rhcl9pbjpzdGFyZmllbGQuc3Rhcih7IHN0YXJfaW4gfSksIGlkOiBcInlcIiB9KSwgaGFuZGxlcjogKCkgPT4ge3NldCh2aWV3b2Ygc3Rhcl9pbiwgc3RhcmZpZWxkLnN0YXIoeyBzdGFyX2luIH0pKX19LHtuYW1lOiBcInN0YXJcIiwgdmFsdWU6c3RhcmZpZWxkLnN0YXIoeyBzdGFyX2luIH0pfSx7bmFtZTogXCJyYW5kb21cIiwgdmFsdWU6c3RhcmZpZWxkLnJhbmRvbSh7IHJhbmRvbV9zZWVkX2luLCBzdGFyX2luOnN0YXJmaWVsZC5zdGFyKHsgc3Rhcl9pbiB9KSwgaWQ6IFwielwiIH0pLCBoYW5kbGVyOiAoKSA9PiB7c2V0KHZpZXdvZiBzdGFyX2luLCBzdGFyZmllbGQuc3Rhcih7IHN0YXJfaW4gfSkpfX0se25hbWU6IFwic3RhclwiLCB2YWx1ZTpzdGFyZmllbGQuc3Rhcih7IHN0YXJfaW4gfSl9LHtuYW1lOiBcImZyYW1lXCIsIHZhbHVlOnN0YXJmaWVsZC5mcmFtZSh7IGZyYW1lX2luIH0pfSx7bmFtZTogXCJ6MFwiLCB2YWx1ZTpzdGFyZmllbGQuejAoeyByYW5kb21fc2VlZF9pbiwgc3Rhcl9pbiB9KX0se25hbWU6IFwielwiLCB2YWx1ZTpzdGFyZmllbGQueih7IHJhbmRvbV9zZWVkX2luLCBzdGFyX2luLCBzcGVlZF9pbiwgZnJhbWVfaW46c3RhcmZpZWxkLmZyYW1lKHsgZnJhbWVfaW4gfSkgLSAxIH0pLCBoYW5kbGVyOiAoKSA9PiB7c2V0KHZpZXdvZiBmcmFtZV9pbiwgc3RhcmZpZWxkLmZyYW1lKHsgZnJhbWVfaW4gfSkgLSAxKX19LHtuYW1lOiBcImZyYW1lXCIsIHZhbHVlOnN0YXJmaWVsZC5mcmFtZSh7IGZyYW1lX2luIH0pfSx7bmFtZTogXCJzcGVlZFwiLCB2YWx1ZTpzdGFyZmllbGQuc3BlZWQoeyBzcGVlZF9pbiB9KX0se25hbWU6IFwielwiLCB2YWx1ZTpzdGFyZmllbGQueih7IHJhbmRvbV9zZWVkX2luLCBzdGFyX2luLCBzcGVlZF9pbiwgZnJhbWVfaW46c3RhcmZpZWxkLmZyYW1lKHsgZnJhbWVfaW4gfSkgLSAxIH0pLCBoYW5kbGVyOiAoKSA9PiB7c2V0KHZpZXdvZiBmcmFtZV9pbiwgc3RhcmZpZWxkLmZyYW1lKHsgZnJhbWVfaW4gfSkgLSAxKX19LHtuYW1lOiBcImZyYW1lXCIsIHZhbHVlOnN0YXJmaWVsZC5mcmFtZSh7IGZyYW1lX2luIH0pfSx7bmFtZTogXCJzcGVlZFwiLCB2YWx1ZTpzdGFyZmllbGQuc3BlZWQoeyBzcGVlZF9pbiB9KX0se25hbWU6IFwielwiLCB2YWx1ZTpzdGFyZmllbGQueih7IGZyYW1lX2luLCByYW5kb21fc2VlZF9pbiwgc3Rhcl9pbiwgc3BlZWRfaW4gfSl9LHtuYW1lOiBcImZyYW1lXCIsIHZhbHVlOnN0YXJmaWVsZC5mcmFtZSh7IGZyYW1lX2luIH0pfSx7bmFtZTogXCJ4MFwiLCB2YWx1ZTpzdGFyZmllbGQueDAoeyByYW5kb21fc2VlZF9pbiwgc3Rhcl9pbiB9KX0se25hbWU6IFwidmlzaWJsZVwiLCB2YWx1ZTpzdGFyZmllbGQudmlzaWJsZSh7IHJhbmRvbV9zZWVkX2luLCBzdGFyX2luLCBzcGVlZF9pbiwgZnJhbWVfaW46c3RhcmZpZWxkLmZyYW1lKHsgZnJhbWVfaW4gfSkgLSAxIH0pLCBoYW5kbGVyOiAoKSA9PiB7c2V0KHZpZXdvZiBmcmFtZV9pbiwgc3RhcmZpZWxkLmZyYW1lKHsgZnJhbWVfaW4gfSkgLSAxKX19LHtuYW1lOiBcImZyYW1lXCIsIHZhbHVlOnN0YXJmaWVsZC5mcmFtZSh7IGZyYW1lX2luIH0pfSx7bmFtZTogXCJ4MFwiLCB2YWx1ZTpzdGFyZmllbGQueDAoeyByYW5kb21fc2VlZF9pbiwgc3Rhcl9pbiB9KX0se25hbWU6IFwieDBcIiwgdmFsdWU6c3RhcmZpZWxkLngwKHsgcmFuZG9tX3NlZWRfaW4sIHN0YXJfaW4gfSl9LHtuYW1lOiBcInpcIiwgdmFsdWU6c3RhcmZpZWxkLnooeyBmcmFtZV9pbiwgcmFuZG9tX3NlZWRfaW4sIHN0YXJfaW4sIHNwZWVkX2luIH0pfSx7bmFtZTogXCJmcmFtZVwiLCB2YWx1ZTpzdGFyZmllbGQuZnJhbWUoeyBmcmFtZV9pbiB9KX0se25hbWU6IFwieTBcIiwgdmFsdWU6c3RhcmZpZWxkLnkwKHsgcmFuZG9tX3NlZWRfaW4sIHN0YXJfaW4gfSl9LHtuYW1lOiBcInZpc2libGVcIiwgdmFsdWU6c3RhcmZpZWxkLnZpc2libGUoeyByYW5kb21fc2VlZF9pbiwgc3Rhcl9pbiwgc3BlZWRfaW4sIGZyYW1lX2luOnN0YXJmaWVsZC5mcmFtZSh7IGZyYW1lX2luIH0pIC0gMSB9KSwgaGFuZGxlcjogKCkgPT4ge3NldCh2aWV3b2YgZnJhbWVfaW4sIHN0YXJmaWVsZC5mcmFtZSh7IGZyYW1lX2luIH0pIC0gMSl9fSx7bmFtZTogXCJmcmFtZVwiLCB2YWx1ZTpzdGFyZmllbGQuZnJhbWUoeyBmcmFtZV9pbiB9KX0se25hbWU6IFwieTBcIiwgdmFsdWU6c3RhcmZpZWxkLnkwKHsgcmFuZG9tX3NlZWRfaW4sIHN0YXJfaW4gfSl9LHtuYW1lOiBcInkwXCIsIHZhbHVlOnN0YXJmaWVsZC55MCh7IHJhbmRvbV9zZWVkX2luLCBzdGFyX2luIH0pfSx7bmFtZTogXCJ6XCIsIHZhbHVlOnN0YXJmaWVsZC56KHsgZnJhbWVfaW4sIHJhbmRvbV9zZWVkX2luLCBzdGFyX2luLCBzcGVlZF9pbiB9KX0se25hbWU6IFwieFwiLCB2YWx1ZTpzdGFyZmllbGQueCh7IGZyYW1lX2luLCByYW5kb21fc2VlZF9pbiwgc3Rhcl9pbiwgc3BlZWRfaW4gfSl9LHtuYW1lOiBcIngwXCIsIHZhbHVlOnN0YXJmaWVsZC54MCh7IHJhbmRvbV9zZWVkX2luLCBzdGFyX2luIH0pfSx7bmFtZTogXCJ4MFwiLCB2YWx1ZTpzdGFyZmllbGQueDAoeyByYW5kb21fc2VlZF9pbiwgc3Rhcl9pbiB9KX0se25hbWU6IFwieFwiLCB2YWx1ZTpzdGFyZmllbGQueCh7IHJhbmRvbV9zZWVkX2luLCBzdGFyX2luLCBzcGVlZF9pbiwgZnJhbWVfaW46c3RhcmZpZWxkLmZyYW1lKHsgZnJhbWVfaW4gfSkgLSAxIH0pLCBoYW5kbGVyOiAoKSA9PiB7c2V0KHZpZXdvZiBmcmFtZV9pbiwgc3RhcmZpZWxkLmZyYW1lKHsgZnJhbWVfaW4gfSkgLSAxKX19LHtuYW1lOiBcImZyYW1lXCIsIHZhbHVlOnN0YXJmaWVsZC5mcmFtZSh7IGZyYW1lX2luIH0pfSx7bmFtZTogXCJ5XCIsIHZhbHVlOnN0YXJmaWVsZC55KHsgZnJhbWVfaW4sIHJhbmRvbV9zZWVkX2luLCBzdGFyX2luLCBzcGVlZF9pbiB9KX0se25hbWU6IFwieTBcIiwgdmFsdWU6c3RhcmZpZWxkLnkwKHsgcmFuZG9tX3NlZWRfaW4sIHN0YXJfaW4gfSl9LHtuYW1lOiBcInkwXCIsIHZhbHVlOnN0YXJmaWVsZC55MCh7IHJhbmRvbV9zZWVkX2luLCBzdGFyX2luIH0pfSx7bmFtZTogXCJ5XCIsIHZhbHVlOnN0YXJmaWVsZC55KHsgcmFuZG9tX3NlZWRfaW4sIHN0YXJfaW4sIHNwZWVkX2luLCBmcmFtZV9pbjpzdGFyZmllbGQuZnJhbWUoeyBmcmFtZV9pbiB9KSAtIDEgfSksIGhhbmRsZXI6ICgpID0+IHtzZXQodmlld29mIGZyYW1lX2luLCBzdGFyZmllbGQuZnJhbWUoeyBmcmFtZV9pbiB9KSAtIDEpfX0se25hbWU6IFwiZnJhbWVcIiwgdmFsdWU6c3RhcmZpZWxkLmZyYW1lKHsgZnJhbWVfaW4gfSl9XV0sXCJmaXp6YnV6elwiOltbe25hbWU6IFwiaVwiLCB2YWx1ZTpmaXp6YnV6ei5pKHsgaV9pbiB9KX0se25hbWU6IFwiaVwiLCB2YWx1ZTpmaXp6YnV6ei5pKHsgaV9pbiB9KX0se25hbWU6IFwiZml6elwiLCB2YWx1ZTpmaXp6YnV6ei5maXp6KHsgaV9pbiB9KX0se25hbWU6IFwiYnV6elwiLCB2YWx1ZTpmaXp6YnV6ei5idXp6KHsgaV9pbiB9KX0se25hbWU6IFwiZml6elwiLCB2YWx1ZTpmaXp6YnV6ei5maXp6KHsgaV9pbiB9KX0se25hbWU6IFwiYnV6elwiLCB2YWx1ZTpmaXp6YnV6ei5idXp6KHsgaV9pbiB9KX0se25hbWU6IFwiaVwiLCB2YWx1ZTpmaXp6YnV6ei5pKHsgaV9pbiB9KX1dXSxcInllYXJfcmVtYWluaW5nXCI6W1t7bmFtZTogXCJkYXRlXCIsIHZhbHVlOnllYXJfcmVtYWluaW5nLmRhdGUoeyBkYXRlX2luIH0pfSx7bmFtZTogXCJ5ZWFyXCIsIHZhbHVlOnllYXJfcmVtYWluaW5nLnllYXIoeyBkYXRlX2luIH0pfSx7bmFtZTogXCJpc0xlYXBcIiwgdmFsdWU6eWVhcl9yZW1haW5pbmcuaXNMZWFwKHsgZGF0ZV9pbiB9KX0se25hbWU6IFwiZGF0ZVwiLCB2YWx1ZTp5ZWFyX3JlbWFpbmluZy5kYXRlKHsgZGF0ZV9pbiB9KX0se25hbWU6IFwiZGF0ZVwiLCB2YWx1ZTp5ZWFyX3JlbWFpbmluZy5kYXRlKHsgZGF0ZV9pbiB9KX0se25hbWU6IFwiZGF0ZVwiLCB2YWx1ZTp5ZWFyX3JlbWFpbmluZy5kYXRlKHsgZGF0ZV9pbiB9KX0se25hbWU6IFwiZGF0ZVwiLCB2YWx1ZTp5ZWFyX3JlbWFpbmluZy5kYXRlKHsgZGF0ZV9pbiB9KX0se25hbWU6IFwiZGF5c0ludG9ZZWFyU3RhcnRUb21vcnJvd1wiLCB2YWx1ZTp5ZWFyX3JlbWFpbmluZy5kYXlzSW50b1llYXJTdGFydFRvbW9ycm93KHsgZGF0ZV9pbiB9KX0se25hbWU6IFwidGltaW5nXCIsIHZhbHVlOnllYXJfcmVtYWluaW5nLnRpbWluZyh7IHRpbWluZ19pbiB9KX0se25hbWU6IFwiZGF5c0ludG9ZZWFyU3RhcnRUb2RheVwiLCB2YWx1ZTp5ZWFyX3JlbWFpbmluZy5kYXlzSW50b1llYXJTdGFydFRvZGF5KHsgZGF0ZV9pbiB9KX0se25hbWU6IFwiZGF5c0ludG9ZZWFyU3RhcnRUb21vcnJvd1wiLCB2YWx1ZTp5ZWFyX3JlbWFpbmluZy5kYXlzSW50b1llYXJTdGFydFRvbW9ycm93KHsgZGF0ZV9pbiB9KX0se25hbWU6IFwiZGF5c0ludG9ZZWFyXCIsIHZhbHVlOnllYXJfcmVtYWluaW5nLmRheXNJbnRvWWVhcih7IHRpbWluZ19pbiwgZGF0ZV9pbiB9KX0se25hbWU6IFwiZGF5c0luWWVhclwiLCB2YWx1ZTp5ZWFyX3JlbWFpbmluZy5kYXlzSW5ZZWFyKHsgZGF0ZV9pbiB9KX0se25hbWU6IFwiZnJhY3Rpb25JbnRvWWVhclwiLCB2YWx1ZTp5ZWFyX3JlbWFpbmluZy5mcmFjdGlvbkludG9ZZWFyKHsgdGltaW5nX2luLCBkYXRlX2luIH0pfV1dfVxuKX1cblxuXG5mbnNfd2l0aF9tanNfcV9ldmFsID17IHJldHVybiAoXG57XCJzYXZpbmdzXCI6W1t7bmFtZTpcImJhbGFuY2VcIix2YWx1ZTpzYXZpbmdzLmJhbGFuY2Uoe3llYXJfaW4sZHVyYXRpb25faW4sYW5udWFsX3BheW1lbnRfaW4saW50ZXJlc3RfcmF0ZV9pbn0pfSx7bmFtZTpcImRlcG9zaXRzXCIsdmFsdWU6c2F2aW5ncy5kZXBvc2l0cyh7eWVhcl9pbixkdXJhdGlvbl9pbixhbm51YWxfcGF5bWVudF9pbn0pfSx7bmFtZTpcImludGVyZXN0XCIsdmFsdWU6c2F2aW5ncy5pbnRlcmVzdCh7eWVhcl9pbixkdXJhdGlvbl9pbixhbm51YWxfcGF5bWVudF9pbixpbnRlcmVzdF9yYXRlX2lufSl9LHtuYW1lOlwieWVhclwiLHZhbHVlOnNhdmluZ3MueWVhcih7eWVhcl9pbn0pfSx7bmFtZTpcImFubnVhbF9wYXltZW50XCIsdmFsdWU6c2F2aW5ncy5hbm51YWxfcGF5bWVudCh7YW5udWFsX3BheW1lbnRfaW59KX0se25hbWU6XCJkdXJhdGlvblwiLHZhbHVlOnNhdmluZ3MuZHVyYXRpb24oe2R1cmF0aW9uX2lufSl9LHtuYW1lOlwiaW50ZXJlc3RfcmF0ZVwiLHZhbHVlOnNhdmluZ3MuaW50ZXJlc3RfcmF0ZSh7aW50ZXJlc3RfcmF0ZV9pbn0pfV1dLFwic2F2aW5nc19yZWNcIjpbW3tuYW1lOlwieWVhclwiLHZhbHVlOnNhdmluZ3NfcmVjLnllYXIoe3llYXJfaW59KX0se25hbWU6XCJhY3R1YWxfaW50ZXJlc3RfcmF0ZXNcIix2YWx1ZTpzYXZpbmdzX3JlYy5hY3R1YWxfaW50ZXJlc3RfcmF0ZXMoe30pfSx7bmFtZTpcImFjdHVhbF9pbnRlcmVzdF9yYXRlX2NvXCIsdmFsdWU6c2F2aW5nc19yZWMuYWN0dWFsX2ludGVyZXN0X3JhdGVfY28oe2FjdHVhbF9pbnRlcmVzdF9yYXRlX2NvX2lufSl9LHtuYW1lOlwiaW50ZXJlc3RfcmF0ZVwiLHZhbHVlOnNhdmluZ3NfcmVjLmludGVyZXN0X3JhdGUoe3llYXJfaW4sYWN0dWFsX2ludGVyZXN0X3JhdGVfY29faW59KX1dLFt7bmFtZTpcImFubnVhbF9wYXltZW50XCIsdmFsdWU6c2F2aW5nc19yZWMuYW5udWFsX3BheW1lbnQoe30pfSx7bmFtZTpcImR1cmF0aW9uXCIsdmFsdWU6c2F2aW5nc19yZWMuZHVyYXRpb24oe30pfV0sW3tuYW1lOlwiYmFsYW5jZVwiLHZhbHVlOnNhdmluZ3NfcmVjLmJhbGFuY2Uoe3llYXJfaW4sYWN0dWFsX2ludGVyZXN0X3JhdGVfY29faW59KX0se25hbWU6XCJkZXBvc2l0c1wiLHZhbHVlOnNhdmluZ3NfcmVjLmRlcG9zaXRzKHt5ZWFyX2lufSl9LHtuYW1lOlwiaW50ZXJlc3RcIix2YWx1ZTpzYXZpbmdzX3JlYy5pbnRlcmVzdCh7eWVhcl9pbixhY3R1YWxfaW50ZXJlc3RfcmF0ZV9jb19pbn0pfV1dLFwic3RhcmZpZWxkXCI6W1t7bmFtZTpcInJhbmRvbV9zZWVkXCIsdmFsdWU6c3RhcmZpZWxkLnJhbmRvbV9zZWVkKHtyYW5kb21fc2VlZF9pbn0pfSx7bmFtZTpcInNlZWRlZFwiLHZhbHVlOnN0YXJmaWVsZC5zZWVkZWQoe3JhbmRvbV9zZWVkX2lufSl9LHtuYW1lOlwicmFuZG9tXCIsdmFsdWU6c3RhcmZpZWxkLnJhbmRvbSh7cmFuZG9tX3NlZWRfaW59KX0se25hbWU6XCJmcmFtZVwiLHZhbHVlOnN0YXJmaWVsZC5mcmFtZSh7ZnJhbWVfaW59KX0se25hbWU6XCJzdGFyXCIsdmFsdWU6c3RhcmZpZWxkLnN0YXIoe3N0YXJfaW59KX0se25hbWU6XCJzdGFyX2xpZmVcIix2YWx1ZTpzdGFyZmllbGQuc3Rhcl9saWZlKHt9KX0se25hbWU6XCJ4MFwiLHZhbHVlOnN0YXJmaWVsZC54MCh7cmFuZG9tX3NlZWRfaW4sc3Rhcl9pbn0pfSx7bmFtZTpcInkwXCIsdmFsdWU6c3RhcmZpZWxkLnkwKHtyYW5kb21fc2VlZF9pbixzdGFyX2lufSl9LHtuYW1lOlwiejBcIix2YWx1ZTpzdGFyZmllbGQuejAoe3JhbmRvbV9zZWVkX2luLHN0YXJfaW59KX0se25hbWU6XCJzcGVlZFwiLHZhbHVlOnN0YXJmaWVsZC5zcGVlZCh7c3BlZWRfaW59KX0se25hbWU6XCJ6XCIsdmFsdWU6c3RhcmZpZWxkLnooe2ZyYW1lX2luLHJhbmRvbV9zZWVkX2luLHN0YXJfaW4sc3BlZWRfaW59KX0se25hbWU6XCJ2aXNpYmxlXCIsdmFsdWU6c3RhcmZpZWxkLnZpc2libGUoe2ZyYW1lX2luLHJhbmRvbV9zZWVkX2luLHN0YXJfaW4sc3BlZWRfaW59KX0se25hbWU6XCJ4XCIsdmFsdWU6c3RhcmZpZWxkLngoe2ZyYW1lX2luLHJhbmRvbV9zZWVkX2luLHN0YXJfaW4sc3BlZWRfaW59KX0se25hbWU6XCJ5XCIsdmFsdWU6c3RhcmZpZWxkLnkoe2ZyYW1lX2luLHJhbmRvbV9zZWVkX2luLHN0YXJfaW4sc3BlZWRfaW59KX0se25hbWU6XCJweFwiLHZhbHVlOnN0YXJmaWVsZC5weCh7ZnJhbWVfaW4scmFuZG9tX3NlZWRfaW4sc3Rhcl9pbixzcGVlZF9pbn0pfSx7bmFtZTpcInB5XCIsdmFsdWU6c3RhcmZpZWxkLnB5KHtmcmFtZV9pbixyYW5kb21fc2VlZF9pbixzdGFyX2luLHNwZWVkX2lufSl9XV0sXCJmaXp6YnV6elwiOltbe25hbWU6XCJmaXp6XCIsdmFsdWU6Zml6emJ1enouZml6eih7aV9pbn0pfSx7bmFtZTpcImJ1enpcIix2YWx1ZTpmaXp6YnV6ei5idXp6KHtpX2lufSl9LHtuYW1lOlwiZml6emJ1enpcIix2YWx1ZTpmaXp6YnV6ei5maXp6YnV6eih7aV9pbn0pfSx7bmFtZTpcImlcIix2YWx1ZTpmaXp6YnV6ei5pKHtpX2lufSl9XV0sXCJ5ZWFyX3JlbWFpbmluZ1wiOltbe25hbWU6XCJkYXRlXCIsdmFsdWU6eWVhcl9yZW1haW5pbmcuZGF0ZSh7ZGF0ZV9pbn0pfSx7bmFtZTpcInllYXJcIix2YWx1ZTp5ZWFyX3JlbWFpbmluZy55ZWFyKHtkYXRlX2lufSl9LHtuYW1lOlwiaXNMZWFwXCIsdmFsdWU6eWVhcl9yZW1haW5pbmcuaXNMZWFwKHtkYXRlX2lufSl9LHtuYW1lOlwiZGF5c0luWWVhclwiLHZhbHVlOnllYXJfcmVtYWluaW5nLmRheXNJblllYXIoe2RhdGVfaW59KX0se25hbWU6XCJkYXlzSW50b1llYXJTdGFydFRvbW9ycm93XCIsdmFsdWU6eWVhcl9yZW1haW5pbmcuZGF5c0ludG9ZZWFyU3RhcnRUb21vcnJvdyh7ZGF0ZV9pbn0pfSx7bmFtZTpcImRheXNJbnRvWWVhclN0YXJ0VG9kYXlcIix2YWx1ZTp5ZWFyX3JlbWFpbmluZy5kYXlzSW50b1llYXJTdGFydFRvZGF5KHtkYXRlX2lufSl9LHtuYW1lOlwiZGF5c0ludG9ZZWFyXCIsdmFsdWU6eWVhcl9yZW1haW5pbmcuZGF5c0ludG9ZZWFyKHt0aW1pbmdfaW4sZGF0ZV9pbn0pfSx7bmFtZTpcImZyYWN0aW9uSW50b1llYXJcIix2YWx1ZTp5ZWFyX3JlbWFpbmluZy5mcmFjdGlvbkludG9ZZWFyKHt0aW1pbmdfaW4sZGF0ZV9pbn0pfSx7bmFtZTpcImZyYWN0aW9uTGVmdEluWWVhclwiLHZhbHVlOnllYXJfcmVtYWluaW5nLmZyYWN0aW9uTGVmdEluWWVhcih7dGltaW5nX2luLGRhdGVfaW59KX0se25hbWU6XCJ0aW1pbmdcIix2YWx1ZTp5ZWFyX3JlbWFpbmluZy50aW1pbmcoe3RpbWluZ19pbn0pfV1dfVxuKX1cblxuXG5cbiBcbntcbiB3aW5kb3cuZm5zX3dpdGhfbWpzX3FfZXZhbCA9IGZuc193aXRoX21qc19xX2V2YWxcbiB3aW5kb3cubWpzX3FfZXZhbCA9IG1qc19xX2V2YWxcbiAvLyB0cmlnZ2VyIGFuIHVwZGF0ZSBhbmltYXRpb24gaGVyZSwgYnV0IGlzIHRoYXQgZ29vZCB3aXRob3V0IGNoZWNraW5nIGlmIGluZGl2aWR1YWwgbnVtYmVycyBjaGFuZ2VkID9cbiAvLyBzZXR1cCBhIGhpc3Rvcnk/XG59XG5cblxuXG57XG4gIC8vIGNhbiBJIG1ha2UgdGhpcyBydW4gb24gZWRpdG9yIHNjcm9sbD8gb3IgbWFrZSBDTSBnZW5lcmF0ZSBmdWxsIGRvbT9cbiAgICAgIC8vZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2EtJyszMikudGV4dENvbnRlbnQgPSBmbXQoZm5zX3dpdGhfbWpzX3FfZXZhbFszMl0pO1xuLy8gU2VlbXMgbGlrZSB0aGVzZSBjZWxscyBzdG9wIGlmIHRoZXJlIGlzIGEgc2luZ2xlIGVycm9yLFxuLy8gbGlrZSBtb2RpZnlpbmcgYW4gZWxlbWVudCB0aGF0IGlzbid0IHlldCBjcmVhdGVkXG4vLyBRdWFydG8vT0pTIGdpdmVzIG5vIGVycm9yIVxuLy8gbWF5YmUgZHVlIHRvIG91dHB1dDogZmFsc2U/IERBTkdFUk9VU1xuLy9jb25zb2xlLmxvZygnVVBEQVRFJylcblxuICBmbnNfd2l0aF9tanNfcV9ldmFsW21vZGVsbmFtZV1bY3VsX3Njb3BlX2lkXS5mb3JFYWNoKCh2LCBpKSA9PiB7XG4gICAgbGV0IGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYS0nK2kpXG4gICAgaWYgKGQpXG4gICAgZC50ZXh0Q29udGVudCA9IGZtdDIodi5uYW1lLCB2LnZhbHVlKS8vZm10KHYpO1xuICB9KVxuICBtanNfcV9ldmFsW21vZGVsbmFtZV1bY3VsX3Njb3BlX2lkXS5mb3JFYWNoKCh7bmFtZSwgdmFsdWV9LCBpKSA9PiB7XG4gICAgICAgIGxldCBkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ctJytpKVxuICAgIGlmIChkKSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndy0nK2kpLnRleHRDb250ZW50ID0gZm10MihuYW1lLCB2YWx1ZSk7IC8vIGRvZXMgdGhpcyBnZXQgdXNlZD8gb24gdXBkYXRlP1xuICB9KVxufVxuXG4vLyB0b2RvIGZtdCBoaW50cyBvciB0ZW1wbGF0ZXM/IGxpa2UgYSB0eXBlIG9yIHVuaXQ/XG5mbXQyID0gKG5hbWUsIHZhbHVlKSA9PiB7XG4gIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChuYW1lLmluY2x1ZGVzKFwiX2NvXCIpKSByZXR1cm4gZDMuZm9ybWF0KFwiLC4wZlwiKSh2YWx1ZSlcbiAgaWYgKG5hbWUuaW5jbHVkZXMoXCJyYXRlXCIpIHx8IG5hbWUuaW5jbHVkZXMoXCJwZXJjZW50XCIpIHx8IG5hbWUuaW5jbHVkZXMoXCJmcmFjdGlvblwiKSkgcmV0dXJuIGQzLmZvcm1hdChcIi4yJVwiKSh2YWx1ZSlcbiAgaWYgKChuYW1lLmluY2x1ZGVzKFwieWVhclwiKSkgfHwgbmFtZS5pbmNsdWRlcyhcInRlcm1cIikgfHwgbmFtZS5pbmNsdWRlcyhcImR1cmF0aW9uXCIpIHx8IG5hbWUuaW5jbHVkZXMoXCJmcmFtZVwiKSkgcmV0dXJuIGQzLmZvcm1hdChcIiwuMGZcIikodmFsdWUpXG4gIGlmIChuYW1lLmluY2x1ZGVzKFwib2JqZWN0XCIpIHx8IHR5cGVvZiB2YWx1ZSAhPSAnbnVtYmVyJykgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbHVlKVxuXG4gIHJldHVybiBkMy5mb3JtYXQoXCIsLjJmXCIpKHZhbHVlKVxufVxuXG5cbi8vLy9cblxuLy8gaG93IHRvIGNhbGwgYSBmdW5jdGlvblxuXG5mbnNfd2l0aF9tanMgPSBPYmplY3QudmFsdWVzKGNhbGN1bGFuZ19zb3VyY2VfaW50cm9zcGVjdGlvbi5jdWxfZnVuY3Rpb25zKVxuICAuZmlsdGVyKFxuICAgIChkKSA9PlxuICAgICAgZC5yZWFzb24gPT0gXCJkZWZpbml0aW9uXCIgLyppbnB1dCBkZWZpbml0aW9uIGRvZXNuJ3QgaGF2ZSBhIGxvYyovICYmXG4gICAgICBkLmN1bF9zY29wZV9pZCA9PSBjdWxfc2NvcGVfaWRcbiAgKVxuICAubWFwKChkKSA9PiAoeyAuLi5kLCBtanM6IGB7JHtkLmlucHV0cy5qb2luKFwiLFwiKX19YCB9KSkgLy8gYXNzdW1pbmcgY29tcGxldGVseSBvbiBvbmUgbGluZVxuXG4vLyBleC0gY2FsbHNfd2l0aF9tanMsIHJlbGF0ZXMgdG8gdGhhdCBpbiBnZW5lcmF0b3JcbmNhbGxzID0gY2FsY3VsYW5nX3NvdXJjZV9pbnRyb3NwZWN0aW9uLmN1bF9saW5rc1xuICAuZmlsdGVyKGQgPT4gIWQuZnJvbS5pbmNsdWRlcygndW5kZWZpbmVkJykpLmZpbHRlcigoZCkgPT4gZC5yZWFzb24gPT0gXCJjYWxsXCIgJiYgY3VsX3Njb3BlX2lkID09ICtkLnRvLnNwbGl0KFwiX1wiKVswXSkgLy8gYnVncyBmb3IgZG91YmxlIGRpZ2l0IHNjb3Blc1xuXG5cbi8vIGV4IENoZWNrYm94V2lkZ2V0XG5jbGFzcyBBbnN3ZXJzV29ya2luZ3NPdmVybGF5V2lkZ2V0IGV4dGVuZHMgY21JbXBvcnRzLnZpZXcuV2lkZ2V0VHlwZSB7XG4gIGNvbnN0cnVjdG9yKHYsIGNhbGwsIGNhbGxfaSwgdHlwZSkge1xuICAgIC8vYSA9IHY7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnYgPSB2O1xuICAgIHRoaXMuY2FsbCA9IGNhbGw7XG4gICAgdGhpcy5jYWxsX2kgPSBjYWxsX2k7XG4gICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAvL3RoaXMuZXZhbHMgPSB0eXBlID09IFwiZGVmaW5pdGlvblwiID8gbWpzX3FfZXZhbCA6IGZuc193aXRoX21qc19xX2V2YWw7XG4gICAgLy90aGlzLmluZm8gPSB0eXBlID09IFwiZGVmaW5pdGlvblwiID8gZm5zX3dpdGhfbWpzIDogY2FsbHNfd2l0aF9tanNfcXVhbGlmaWVkO1xuICB9XG5cbiAgdG9ET00oKSB7XG4gICAgLy8gbWpzX3FfZXZhbDsgdXNlIHRoaXMgdG8gdGVzdCBmbGlja2VyL3BhcnNlIGlzc3VlcyBmb3IgcGx1Z2lucyBzZXR0aW5nIHZhbHVlcyAobm93IHNldCBzZXRwYXJhdGVseSBieSBET00gY2FsbHMpXG4gICAgbGV0IHdyYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAvL3dyYXAuY2xhc3NOYW1lID0gXCJ0b29sdGlwXCI7XG4gICAgLy93cmFwLnRleHRDb250ZW50ID0gXCIxMDEuMTlcIjtcbiAgICB3cmFwLnNldEF0dHJpYnV0ZShcImFyaWEtaGlkZGVuXCIsIFwidHJ1ZVwiKTsgLy8gbm90IGluIGEgZ29vZCBwbGFjZSwgdG9kbyBmaXhcbiAgICB3cmFwLmNsYXNzTmFtZSA9IFwiY2FsY3VsYW5nX3Rvb2x0aXBcIjtcbiAgICBpZiAodGhpcy50eXBlID09IFwiZGVmaW5pdGlvblwiKSB7XG4gICAgICByZXR1cm4gaHRsLmh0bWxgPHNwYW4gY2xhc3M9XCJjYWxjdWxhbmdfdG9vbHRpcCBhbnN3ZXJcIiBpZD1cImMtYS0ke3RoaXMudn1cIj48IS0tPGlucHV0IHR5cGU9XCJjaGVja2JveFwiPjwvaW5wdXQ+LS0+PHNwYW4gaWQ9XCJhLSR7dGhpcy52fVwiIGNsYXNzPVwidG9vbHRpcHRleHRcIiBhbmNob3I9XCJjLWEtJHt0aGlzLnZ9XCI+JHtmbXQyKFxuICAgICAgICB3aW5kb3cuZm5zX3dpdGhfbWpzX3FfZXZhbFttb2RlbG5hbWVdW2N1bF9zY29wZV9pZF1bdGhpcy52XS5uYW1lLCB3aW5kb3cuZm5zX3dpdGhfbWpzX3FfZXZhbFttb2RlbG5hbWVdW2N1bF9zY29wZV9pZF1bdGhpcy52XS52YWx1ZS8vOTk5XG4gICAgICApfTwvc3Bhbj48L3NwYW4+YDtcbiAgICB9XG4gICAgcmV0dXJuIGh0bC5odG1sYDxzcGFuIG9uY2xpY2s9JHsoKSA9PiB7XG4gICAgICAvKiBUT0RPKi8gc2V0KHZpZXdvZiBmb3JtdWxhZV92aXNpYmxlLCBbIC8vIEknbSBzdXBwb3NlZCB0byB1c2Ugb3B0aW9ucy5mb3JtdWxhZV92aXNpYmxlICEhXG4gICAgICAgIGNhbGxzW3RoaXMudl0uZnJvbS5zbGljZSgyKVxuICAgICAgXSk7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FsY3VsYW5nX2ZfJytjYWxsc1t0aGlzLnZdLmZyb20uc2xpY2UoMikpLnNjcm9sbEludG9WaWV3KHNjcm9sbEludG9WaWV3T3B0cylcbiAgICAgIGlmICh3aW5kb3cubWpzX3FfZXZhbFttb2RlbG5hbWVdW2N1bF9zY29wZV9pZF1bdGhpcy52XS5oYW5kbGVyKSB3aW5kb3cubWpzX3FfZXZhbFttb2RlbG5hbWVdW2N1bF9zY29wZV9pZF1bdGhpcy52XS5oYW5kbGVyKCk7XG5cbiAgICB9fSBjbGFzcz1cImNhbGN1bGFuZ190b29sdGlwXCIgaWQ9XCJjLXctJHt0aGlzLmNhbGxfaX1cIj48IS0tJm5ic3A7PGlucHV0IHR5cGU9XCJjaGVja2JveFwiPjwvaW5wdXQ+LS0+PHNwYW4gaWQ9XCJ3LSR7dGhpcy5jYWxsX2l9XCIgY2xhc3M9XCJ0b29sdGlwdGV4dFwiIGFuY2hvcj1cImMtdy0ke3RoaXMuY2FsbF9pfVwiPiR7Zm10Miggd2luZG93Lm1qc19xX2V2YWxbbW9kZWxuYW1lXVtjdWxfc2NvcGVfaWRdW3RoaXMuY2FsbF9pXS5uYW1lLFxuICAgICB3aW5kb3cubWpzX3FfZXZhbFttb2RlbG5hbWVdW2N1bF9zY29wZV9pZF1bdGhpcy5jYWxsX2ldLnZhbHVlXG4gICAgKX08L3NwYW4+PC9zcGFuPmA7XG4gICAgcmV0dXJuIHdyYXA7XG4gIH1cblxuICBpZ25vcmVFdmVudCgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuZnVuY3Rpb24gd29ya2luZ3Modmlldykge1xuICByZXR1cm4gRGVjb3JhdGlvbi5zZXQoXG4gICAgW1xuICAgICAgLi4uY2FsbHMubWFwKChkLCBpKSA9PlxuICAgICAgICBEZWNvcmF0aW9uLndpZGdldCh7XG4gICAgICAgICAgd2lkZ2V0OiBuZXcgQW5zd2Vyc1dvcmtpbmdzT3ZlcmxheVdpZGdldChpLCBkLCBpKSxcbiAgICAgICAgICBzaWRlOiAxXG4gICAgICAgIH0pLnJhbmdlKFxuICAgICAgICAgIGQubG9jLnN0YXJ0LmluZGV4ICtcbiAgICAgICAgICAgIGQuZnJvbS5sZW5ndGggLVxuICAgICAgICAgICAgMiAtIE1hdGguZmxvb3IoZC5mcm9tLmxlbmd0aC8yKSAvLyB0aGlzIHNwbGl0IGlzIHdyb25nIGZvciBpbnRlcmVzdF9yYXRlIGZvciBleGFtcGxlIVxuICAgICAgICApXG4gICAgICApXG4gICAgXVxuICApO1xufVxuXG5mdW5jdGlvbiBhbnN3ZXJzKHZpZXcpIHtcbiAgcmV0dXJuIERlY29yYXRpb24uc2V0KFxuICAgIFtcbiAgICAgIC4uLmZuc193aXRoX21qcy5tYXAoKGQsIGkpID0+XG4gICAgICAgIERlY29yYXRpb24ud2lkZ2V0KHtcbiAgICAgICAgICB3aWRnZXQ6IG5ldyBBbnN3ZXJzV29ya2luZ3NPdmVybGF5V2lkZ2V0KGksIGQsIGksIFwiZGVmaW5pdGlvblwiKSxcbiAgICAgICAgICBzaWRlOiAxXG4gICAgICAgIH0pLnJhbmdlKFxuICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICB9KS5yYW5nZSh2aWV3LnN0YXRlLmRvYy5saW5lKGUpLmZyb20pXG5cbiAgICAgICAgICB2aWV3LnN0YXRlLmRvYy5saW5lKGQubG9jLnN0YXJ0LmxpbmUpLnRvXG4gICAgICAgICAgLy9kLmZyb20ubGVuZ3RoIC1cbiAgICAgICAgICAvKiB0b2RvIHRha2UgbWlkcG9pbnQgc3RhcnQtZW5kICovXG4gICAgICAgIClcbiAgICAgIClcbiAgICBdIC8qIHRvZG8gdGFrZSBtaWRwb2ludCBzdGFydC1lbmQgKi9cbiAgKTtcbn1cblxuXG5vdmVybGF5X2Fuc3dlcnMgPSB7XG4gIC8vIHByZXZlbnQgaW5wdXQgZXZlbnRzIGNvbWluZyBmcm9tIHRoZSBjb250ZW50ZWRpdGFibGUgZGl2IHRoYXRcbiAgLy8gcHJvcGFnYXRlcyBhbmQgdHJpZ2dlcnMgYSBjZWxsIHJlZnJlc2g7IHdlIHNoYWxsIGhhbmRsZSBpdCBvdXJzZWx2ZXMuXG4gIGNvbnN0IGFuc3dlcnNfZGVjb3JhdGlvbnMgPSBjbUltcG9ydHMudmlldy5WaWV3UGx1Z2luLmZyb21DbGFzcyhcbiAgICBjbGFzcyB7XG4gICAgICBjb25zdHJ1Y3Rvcih2aWV3KSB7XG4gICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSBhbnN3ZXJzKHZpZXcpO1xuICAgICAgfVxuICAgICAgdXBkYXRlKHVwZGF0ZSkge1xuICAgICAgICAvLyB1cGRhdGVzIGNhdXNlIGRpZmZpY3VsdHkgY2xpY2tpbmcgbnVtYmVycyAtIHRoYW5rZnVsbHkgbm90IG5lZWRlZFxuXG4gICAgICAgIC8vdGhpcy5kZWNvcmF0aW9ucyA9IGFuc3dlcnModXBkYXRlLnZpZXcpO1xuXG4gICAgICAgIC8vIG5vdCBuZWNlc3NhcnkgZm9yIHJlYWQtb25seVxuICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgZGVjb3JhdGlvbnM6ICh2KSA9PiB2LmRlY29yYXRpb25zLFxuICAgICAgZXZlbnRIYW5kbGVyczoge31cbiAgICB9XG4gICk7XG5cbiAgcmV0dXJuIFthbnN3ZXJzX2RlY29yYXRpb25zXTtcbn1cblxub3ZlcmxheV93b3JraW5ncyA9IHtcbiAgLy8gcHJldmVudCBpbnB1dCBldmVudHMgY29taW5nIGZyb20gdGhlIGNvbnRlbnRlZGl0YWJsZSBkaXYgdGhhdFxuICAvLyBwcm9wYWdhdGVzIGFuZCB0cmlnZ2VycyBhIGNlbGwgcmVmcmVzaDsgd2Ugc2hhbGwgaGFuZGxlIGl0IG91cnNlbHZlcy5cbiAgY29uc3QgY2hlY2tib3hQbHVnaW4gPSBjbUltcG9ydHMudmlldy5WaWV3UGx1Z2luLmZyb21DbGFzcyhcbiAgICBjbGFzcyB7XG4gICAgICBjb25zdHJ1Y3Rvcih2aWV3KSB7XG4gICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSB3b3JraW5ncyh2aWV3KTtcbiAgICAgIH1cblxuICAgICAgdXBkYXRlKHVwZGF0ZSkge1xuICAgICAgICAvLyB1cGRhdGVzIGNhdXNlIGRpZmZpY3VsdHkgY2xpY2tpbmcgbnVtYmVycyAtIHRoYW5rZnVsbHkgbm90IG5lZWRlZFxuICAgICAgICAvLyBub3QgbmVjZXNzYXJ5IGZvciByZWFkLW9ubHlcbiAgICAgICAgLy9pZiAodXBkYXRlLmRvY0NoYW5nZWQgfHwgdXBkYXRlLnZpZXdwb3J0Q2hhbmdlZClcbiAgICAgICAgIC8vdGhpcy5kZWNvcmF0aW9ucyA9IHdvcmtpbmdzKHVwZGF0ZS52aWV3KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIGRlY29yYXRpb25zOiAodikgPT4gdi5kZWNvcmF0aW9ucyxcblxuICAgICAgZXZlbnRIYW5kbGVyczoge1xuICAgICAgICBtb3VzZWRvd246IChlLCB2aWV3KSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJIRUxMTzIyMlwiKTtcblxuICAgICAgICAgIGxldCB0YXJnZXQgPSBlLnRhcmdldDtcblxuICAgICAgICAgIGNvbnNvbGUubG9nKFwiRkRTQUZTQURcIiwgZS50YXJnZXQuY2xhc3NMaXN0KTtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAxIHx8IC8vIEROXG4gICAgICAgICAgICAodGFyZ2V0Lm5vZGVOYW1lID09IFwiSU5QVVRcIiAmJlxuICAgICAgICAgICAgICB0YXJnZXQucGFyZW50RWxlbWVudCAvKiEgSSByZW1vdmVkIHRoaXMgYmFuZyovLmNsYXNzTGlzdFxuICAgICAgICAgICAgICAgIC5jb250YWlucyhcImNtLWJvb2xlYW4tdG9nZ2xlXCIpKVxuICAgICAgICAgIClcbiAgICAgICAgICAgIDE7Ly9yZXR1cm4gdG9nZ2xlQm9vbGVhbih2aWV3LCB2aWV3LnBvc0F0RE9NKHRhcmdldCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICApO1xuXG4gIHJldHVybiBbY2hlY2tib3hQbHVnaW5dO1xufVxuXG5cblxuZm10ID0gZCA9PiAodHlwZW9mIGQgPT0gJ251bWJlcicpID8gKE1hdGguYWJzKGQpIDwgMiA/IGQzLmZvcm1hdCgnLjIlJykoZCkgOiBkMy5mb3JtYXQoZm10X2ZtdCkoZCkpIDogSlNPTi5zdHJpbmdpZnkoZClcblxuZW1iZWQgPSByZXF1aXJlKFwidmVnYS1lbWJlZFwiKVxuXG57XG4gIGZfaW47XG4gIG11dGFibGUgZnJhbWVfdmFsID0gZl9pbjtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxuc2Nyb2xsSW50b1ZpZXdPcHRzID0gKHtiZWhhdmlvdXI6J3Ntb290aCd9KVxuXG5JbnB1dHMuYnV0dG9uKFtcbiAgW1wiZXhwYW5kIGFsbFwiLCAoKSA9PiBzZXQodmlld29mIGZvcm11bGFlX3Zpc2libGUsIGZvcm11bGFlX2FsbCldLFxuICBbXCJjb2xsYXBzZSBhbGxcIiwgKCkgPT4gc2V0KHZpZXdvZiBmb3JtdWxhZV92aXNpYmxlLCBbXSldLFxuICBbXCJ4eFwiLCAoKSA9PiB7Y29uc29sZS5sb2codmlld29mIGVkaXRvci52YWx1ZSl9XVxuXSlcblxuXG52aWV3b2Ygb3B0aW9ucyA9IElucHV0cy5jaGVja2JveChbXCJleHBvcnQgY29uc3RzXCIsIFwiaW5wdXRzXCIvKiwgXCJsaXN0cyAodG9kbylcIiovXSwge2xhYmVsOiBcInVuaGlkZT9cIiwgdmFsdWU6IFtcImV4cG9ydCBjb25zdHNcIiwgXCJpbnB1dHNcIl19KVxuXG52aWV3b2Ygb3ZlcmxheSA9IElucHV0cy50b2dnbGUoeyBsYWJlbDogXCJvdmVybGF5P1wiLCB2YWx1ZTogZmFsc2UgfSlcblxuLy9tZGAtLS1gXG5cblxudmlld29mIGN1bF9qcyA9IElucHV0cy5yYWRpbyhbXCLwn5OdIGNhbGN1bGFuZyBzb3VyY2Ug8J+SrFwiLCBcIuKcqCBKUy9FU00gb3V0cHV0IOKcqCAobW9kdWxhciBhbm5vdGF0aW9ucyBiYWQpXCJdLCB7bGFiZWw6IFwi8J+rtlwiLCB2YWx1ZTogXCLwn5OdIGNhbGN1bGFuZyBzb3VyY2Ug8J+SrFwifSlcblxuY3VsX2pzX2N1bCA9IGN1bF9qcyA9PSBcIvCfk50gY2FsY3VsYW5nIHNvdXJjZSDwn5KsXCIgPyB0cnVlIDogZmFsc2VcbnZpZXdvZiBjYWxjdWxhbmdfc291cmNlX25vbWVtbyA9IElucHV0cy5jaGVja2JveChbXCJub21lbW9cIl0sIHt2YWx1ZTogW1wibm9tZW1vXCJdLCBsYWJlbDogJ3NlZSBtZW1vPyDwn5KAJywgZGlzYWJsZWQ6Y3VsX2pzPT1cIvCfk50gY2FsY3VsYW5nIHNvdXJjZSDwn5KsXCJ9KVxudmlld29mIG9wdCA9IElucHV0cy50b2dnbGUoe2xhYmVsOidvcHRpb25zJ30pXG52aWV3b2YgcmVhZG9ubHkgPSBJbnB1dHMudG9nZ2xlKHtsYWJlbDoncmVhZG9ubHknfSlcblxudmlld29mIGZvcm11bGFlX3Zpc2libGUgPSBJbnB1dHMuaW5wdXQoW1wiYmFsYW5jZVwiLCBcImludGVyZXN0XCIsIFwiZGVwb3NpdHNcIl0pXG5cbnZpZXdvZiBmbXRfZm10ID0gSW5wdXRzLnRleHQoe3ZhbHVlOlwiLC4yZlwiLCBsYWJlbDogJ2Zvcm1hdCd9KVxuXG52aWV3b2YgYWN0aW9ucyA9IElucHV0cy50b2dnbGUoe2xhYmVsOid2ZWdhIGFjdGlvbnM/JywgdmFsdWU6ZmFsc2V9KVxuXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuXG4vLyBodHRwczovL29ic2VydmFibGVocS5jb20vZC84NjdlMTQyNGUxZDA5M2FiXG5cbm11dGFibGUgZnJhbWVfdmFsID0gMFxuXG5cbm11dGFibGUga2V5c19zaGFyZWQgPSBbXVxuXG4vL0lucHV0cy5iaW5kKFNjcnViYmVyKF8ucmFuZ2UoMCwgMjAwKSwgeyBhdXRvcGxheTogZmFsc2UsIGRlbGF5OiA1MCB9KSwgdmlld29mIGZfaW4pXG5cblxuXG5cblxudmlld29mIGtleXNfc3RyZWFtID0geyAvLyBodHRwczovL29ic2VydmFibGVocS5jb20vZC84NjdlMTQyNGUxZDA5M2FiXG4gIGxldCBlID0gaHRtbGA8ZGl2IGNsYXNzPSd0YXJnZXQnIHN0eWxlPSdjb2xvcjpwaW5rOyBiYWNrZ3JvdW5kOiNlZWUnIHRhYkluZGV4PTE+S2V5Ym9hcmQgdGFyZ2V0PC9kaXY+YDtcbiAgbGV0IGtleXMgPSBbXTtcbiAgZS52YWx1ZSA9IGtleXM7XG4gIGxldCBnYXAgPSBuZXcgRGF0ZSgpO1xuICBlLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCAoZXZ0KSA9PiB7XG4gICAga2V5cy5wdXNoKHtcbiAgICAgIGtleTogZXZ0LmtleSxcbiAgICAgIGRlbGF5OiBuZXcgRGF0ZSgpIC0gZ2FwLFxuICAgICAgZnJhbWU6IG11dGFibGUgZnJhbWVfdmFsICsgMVxuICAgIH0pO1xuICAgIGtleXNfc2hhcmVkLnB1c2goe1xuICAgICAga2V5OiBldnQua2V5LFxuICAgICAgZGVsYXk6IG5ldyBEYXRlKCkgLSBnYXAsXG4gICAgICBmcmFtZTogbXV0YWJsZSBmcmFtZV92YWwgKyAxXG4gICAgfSk7XG4gICAgZ2FwID0gbmV3IERhdGUoKTtcbiAgICBlLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwiaW5wdXRcIikpO1xuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOyAvLyBmb3IgcmV2ZWFsanM/IG5vdCBlbm91Z2hcbiAgICAgICAgICBzZXQodmlld29mIGZfaW4sIHZpZXdvZiBmX2luLnZhbHVlKzEpXG5cbiAgfSk7XG4gIGUuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGV2dCkgPT4ge1xuICAgIG11dGFibGUgc2hvd19yYXkgPSBmYWxzZTtcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGU7XG59XG5cbnZpZXdvZiBzY2VuZSA9IGVtYmVkKHNjZW5lX3NwZWMsIHsgcmVuZGVyZXI6IFwic3ZnXCIsIHBhZGRpbmc6IDAsIGFjdGlvbnMsIGNvbmZpZzogeyBhdXRvc2l6ZTogJ2ZpdC15JyB9fSlcbi8qdmlld29mIHNjZW5lMiA9IGVtYmVkKHsuLi5zY2VuZV9zcGVjLCBlbmNvZGluZzogey4uLnNjZW5lX3NwZWMuZW5jb2RpbmcsIGNvbG9yOiB7XG4gICAgICAvL2NvbmRpdGlvbjogeyBwYXJhbTogXCJyYXlfYW5nbGVfaW5cIiwgdmFsdWU6IFwiYmx1ZVwiIH0sXG4gICAgICBmaWVsZDogXCJyX2hpdF9oX29yX3ZcIixcbiAgICAgIHR5cGU6IFwib3JkaW5hbFwiLFxuICAgICAgbGVnZW5kOiBndWlkZXNcbiAgICB9fX0sIHsgcmVuZGVyZXI6IFwic3ZnXCIsIHBhZGRpbmc6IDAsIGFjdGlvbnMsIGNvbmZpZzogeyBhdXRvc2l6ZTogJ2ZpdC15JyB9fSkqL1xuXG4vKklucHV0cy5iaW5kKElucHV0cy50ZXh0KHtcbiAgbGFiZWw6IFwia2V5c19zdHJlYW1fdmVyc2lvbl9pblwiLFxuICB2YWx1ZTogXCJhYmNcIixcbiAgbGVuZ3RoOiAyMDBcbn0pLCB2aWV3b2Yga2V5c19zdHJlYW1fdmVyc2lvbl9pbikqL1xuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG52aWV3b2YgcmVmcmVzaCA9IElucHV0cy5idXR0b24oXCJyZWZyZXNoIGNhbGN1bGFuZyBtb2RlbFwiKVxuXG5odGwuaHRtbGA8YnV0dG9uIG9uY2xpY2s9JHsoKSA9PiAobXV0YWJsZSBzY2VuZV9kYXRhMCA9IHNjZW5lX2RhdGEpfT5pbnNlcnQgZGF0YSAtPiB2ZWdhIGVkaXRvciAoZGV2KTwvYnV0dG9uPmBcblxudmlld29mIGd1aWRlcyA9IElucHV0cy50b2dnbGUoeyBsYWJlbDogXCJndWlkZXNcIiwgdmFsdWU6IGZhbHNlIH0pXG5cbnZpZXdvZiBtb2RlbF94ID0gSW5wdXRzLnJhbmdlKFswLDEwXSwge3N0ZXA6MSwgbGFiZWw6ICdtb2RlbCB2ZXJzaW9uJ30pXG5cbnZpZXdvZiBzY2VuZV9zaXplID0gSW5wdXRzLnJhbmdlKFswLjEsMV0sIHt2YWx1ZTowLjUsIGxhYmVsOiAnc2l6ZSd9KVxuXG52aWV3b2Ygc2hvd19yYXlfc3RlcHMgPSBJbnB1dHMudG9nZ2xlKHtsYWJlbDogJ3Nob3cgcmF5IHN0ZXBzPycsIHZhbHVlOiBmYWxzZX0pXG5cblxuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaHRsLmh0bWxgPGJ1dHRvbiBvbmNsaWNrPSR7KCkgPT4gKG11dGFibGUgc2NlbmVfZGF0YTAgPSBzY2VuZV9kYXRhKX0+aW5zZXJ0IGRhdGEgLT4gdmVnYSBlZGl0b3IgKGRldik8L2J1dHRvbj5gXG5JbnB1dHMuYmluZChJbnB1dHMucmFuZ2UoWy0xMCwxMDBdLCB7c3RlcDoxLCBsYWJlbDogJ3N0ZXAnfSksIHZpZXdvZiBzdGVwX2luKVxuXG57XG4gIHNjZW5lO1xuICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ3Jlc2l6ZScpKVxufVxuXG5cblxuICAvLy5odG1sLWZpbGwtY29udGFpbmVyPi5odG1sLWZpbGwtaXRlbSB7IC8qIG1lc3N5ISBpbnRlcmFjdHMgd2l0aCBvdGhlciBzdHlsaW5nICovXG4gIC8vICBmbGV4OiBub25lO1xuICAvL31cbmh0bWxgXG48c3R5bGU+XG4gICNyYXljYXN0aW5nMiAuZml0LXkgc3ZnIHtcbiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgbGlnaHRibHVlLCBwaW5rLCB3aGl0ZSk7XG4gIH1cbiAgI3JlZmxlY3Rpb24gc3ZnIHtcbiAgICBtYXJnaW4tdG9wOiAtMTBweDtcbiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGJvdHRvbSwgb3JhbmdlLCBwaW5rLCB3aGl0ZSk7XG5cbiAgICAvKmZpbHRlcjogYmx1cigxMHB4KTtcbiAgICAgIGJhY2tncm91bmQ6IHdoaXRlOyBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tLCBsaWdodGJsdWUsIGdyZWVuLCB3aGl0ZSk7Ki9cbiAgICAgIHRyYW5zZm9ybTogc2NhbGVZKC0wLjcpOyAvKnRyYW5zbGF0ZVkoNjVweCk7Ki9cbiAgICAgIG1hc2s6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20sIHRyYW5zcGFyZW50LCBibGFjayA5OCUpO1xuICB9XG5cbjwvc3R5bGU+XG5gXG5cbi8vSW5wdXRzLnRhYmxlKHNjZW5lX2RhdGEpXG5cbnNjZW5lX3NwZWMgPSB7IHJldHVybiAoe1xuICBjb25maWc6IHthdXRvc2l6ZTogJ2ZpdCd9LFxuICAgIFwiZGF0YVwiOiB7XCJuYW1lXCI6IFwic291cmNlXCJ9LFxuXG4gIGRhdGFzZXRzOiB7J3NvdXJjZSc6IHNjZW5lX2RhdGEwIH0sXG4gIHdpZHRoOiBcImNvbnRhaW5lclwiLFxuICBoZWlnaHQ6IDM1MCpzY2VuZV9zaXplLFxuICAvL2hlaWdodDogNDAwLFxuICAvL2hlaWdodDogXCJjb250YWluZXJcIixcbiAgLy9iYWNrZ3JvdW5kOiBcImxpbmVhci1ncmFkaWVudChibHVlLCBwaW5rKVwiLFxuICBtYXJrOiB7IHR5cGU6IFwiYmFyXCIsIGNsaXA6IHRydWUgfSxcbiAgLy90cmFuc2Zvcm06IFt7Y2FsY3VsYXRlOiBcIjIqZGF0dW0ucl9oaXRfdisoMClcIiwgYXM6IFwicl9oaXRfdl9fcl9oaXRfaF9vcl92XCJ9XSxcbiAgZW5jb2Rpbmc6IHtcbiAgICB4OiB7XG4gICAgICBmaWVsZDogXCJyYXlfYW5nbGVfaW5cIixcbiAgICAgIHR5cGU6IFwib3JkaW5hbFwiLFxuICAgICAgYXhpczogZ3VpZGVzID8geyBmb3JtYXQ6IFwiLC4yZlwiLCBncmlkOiBmYWxzZSB9IDogbnVsbCxcbiAgICAgIHNvcnQ6IFwiZGVzY2VuZGluZ1wiXG4gICAgfSxcbiAgICB5OiB7XG4gICAgICBmaWVsZDogXCJyX2ludmVyc2VfbGVuZ3RoXCIsXG4gICAgICB0eXBlOiBcInF1YW50aXRhdGl2ZVwiLFxuICAgICAgc2NhbGU6IHsgZG9tYWluOiBbMCwgMV0gfSxcbiAgICAgIGF4aXM6IGd1aWRlcyA/IHsgZ3JpZDogZmFsc2UgfSA6IG51bGxcbiAgICB9LFxuICAgIHN0cm9rZToge3ZhbHVlOiAnYmxhY2snfSxcbiAgICBzdHJva2VPcGFjaXR5OiB7ICAgICAgY29uZGl0aW9uOiB7IHBhcmFtOiBcInJheV9hbmdsZV9pblwiLCB2YWx1ZTogMSB9LFxuICAgICAgdmFsdWU6IDAuMSxcbn0sXG4gICAgc3Ryb2tlV2lkdGg6IHtcbiAgICAgIGNvbmRpdGlvbjogeyBwYXJhbTogXCJyYXlfYW5nbGVfaW5cIiwgdmFsdWU6IDIgfSxcbiAgICAgIHZhbHVlOiAxLFxuICAgIH0sXG4gICAgY29sb3I6IHtcbiAgICAgIGNvbmRpdGlvbjogeyBwYXJhbTogXCJyYXlfYW5nbGVfaW5cIiwgdmFsdWU6IFwicmVkXCIgfSxcbiAgICAgIC8vXCJkYXR1bVwiOiB7XG4gICAgICAgIC8vXCJ2YWx1ZVwiOiBcIjFcIixcbiAgICAgIC8vfSxcbiAgICAgIHNjYWxlOiB7ZG9tYWluOiBbMiwzLDQsNSw2LDddLHJhbmdlOiBbXCJoc2woMjUwLCA3NiUsIDYwJSlcIixcImhzbCgyNTAsIDc2JSwgNzIlKVwiLFwiaHNsKDIwMCwgNzYlLCA2MCUpXCIsXCJoc2woMjAwLCA3NiUsIDcyJSlcIixcImhzbCgxMDAsIDc2JSwgNjAlKVwiLFwiaHNsKDEwMCwgNzYlLCA3MiUpXCJdfSxcbiAgICAgIGZpZWxkOiBcInJfaGl0X3ZfX3JfaGl0X2hfb3JfdlwiLFxuICAgICAgLy90eXBlOiBcIm5vbWluYWxcIixcbiAgICAgIGxlZ2VuZDogZ3VpZGVzXG4gICAgfSxcbiAgICBvcGFjaXR5OiB7XG4gICAgICBmaWVsZDogJ3JfbGVuZ3RoJyxcbiAgICAgIGxlZ2VuZDogZ3VpZGVzLFxuICAgICAgc2NhbGU6IHtkb21haW46IFswLDE1XSwgcmFuZ2U6IFsxLC4xXX0sXG4gICAgICB0eXBlOiAncXVhbnRpdGF0aXZlJ1xuICAgIH1cbiAgfSxcbiAgcGFyYW1zOiBbXG4gICAge1xuICAgICAgbmFtZTogXCJwbGF5ZXJfYW5nbGVfaW5cIixcbiAgICAgIHZhbHVlOiB7IHBsYXllcl9hbmdsZV9pbjogMCB9LFxuICAgICAgc2VsZWN0OiB7XG4gICAgICAgIHR5cGU6IFwicG9pbnRcIixcbiAgICAgICAgLy9vbjogXCJtb3VzZW1vdmV7MCw1MH1cIixcbiAgICAgICAgb246IFwiW3RvdWNoZG93biwgdG91Y2h1cF0gPiB0b3VjaG1vdmUsIFttb3VzZWRvd24sIG1vdXNldXBdID4gbW91c2Vtb3ZlXCIsIC8vezEwLCAxMDB9XCIsXG4gICAgICAgIC8vICAgICAgICBvbjogXCJbbW91c2Vkb3duLCBtb3VzZXVwXSA+IG1vdXNlbW92ZVwiLFxuICAgICAgICBuZWFyZXN0OiB0cnVlLFxuICAgICAgICB0b2dnbGU6IGZhbHNlLFxuICAgICAgICBjbGVhcjogZmFsc2UsXG4gICAgICAgIGVuY29kaW5nczogW1wieFwiXVxuICAgICAgfVxuICAgIH0sXG5cbiAgICB7XG4gICAgICBuYW1lOiBcInJheV9hbmdsZV9pblwiLFxuICAgICAgdmFsdWU6IHsgcmF5X2FuZ2xlX2luOiAwIH0sXG4gICAgICBzZWxlY3Q6IHtcbiAgICAgICAgdHlwZTogXCJwb2ludFwiLFxuICAgICAgICAvL29uOiBcIm1vdXNlbW92ZXswLDUwfVwiLFxuICAgICAgICBvbjogXCJtb3VzZW1vdmVcIiwgLy97MTAsIDEwMH1cIixcbiAgICAgICAgLy8gICAgICAgIG9uOiBcIlttb3VzZWRvd24sIG1vdXNldXBdID4gbW91c2Vtb3ZlXCIsXG4gICAgICAgIG5lYXJlc3Q6IHRydWUsXG4gICAgICAgIHRvZ2dsZTogZmFsc2UsXG4gICAgICAgIGNsZWFyOiBmYWxzZSxcbiAgICAgICAgZW5jb2RpbmdzOiBbXCJ4XCJdXG4gICAgICB9XG4gICAgfVxuICBdXG59KSB9XG5cbnBsYXllcl9hbmdsZV9pbiA9IHJheWNhc3RpbmcyLnBsYXllcl9hbmdsZSh7a2V5c19zdHJlYW1fZnVuY3Rpb25faW4sXG5rZXlzX3N0cmVhbV92ZXJzaW9uX2luLCBmX2lufSlcblxuLy8gYWRkIGFkZGl0aW9uYWwgZm9yIHNpZ25hbGxlZCByYXkgYW5nbGUgZXhhY3RseT8/XG5zY2VuZV9kYXRhID0gY2FsY3V2ZWdhZGF0YSh7XG4gICRzY2hlbWE6IFwiaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby9zY2hlbWEvdmVnYS1saXRlL3Y1Lmpzb25cIixcbiAgbW9kZWxzOiBbcmF5Y2FzdGluZzJdLFxuICBzcGVjOiAoey4uLnNjZW5lX3NwZWMsIGE6IHtmaWVsZDogJ3JfaGl0X3YnLCBiOiB7ZmllbGQ6J3JfaGl0X2hfb3Jfdid9fX0pLFxuICBkb21haW5zOiB7XG4gICAgLy9zdGVwX2luOiBfLnJhbmdlKDAsIDguMSwgMSksXG4gICAgcmF5X2FuZ2xlX2luOiBfLnJhbmdlKC0xIC8gMiwgMS4wMSAvIDIsIDAuMDEpLm1hcCgoZCkgPT4gZCArIHBsYXllcl9hbmdsZV9pbikgLy9bcmF5X2FuZ2xlX2luLCByYXlfYW5nbGVfaW4gKyAwLjQsIHJheV9hbmdsZV9pbiAtIDAuNF1cbiAgfSxcbiAgaW5wdXRfY3Vyc29yczogW1xuICAgIHtcbmtleXNfc3RyZWFtX2Z1bmN0aW9uX2luLFxua2V5c19zdHJlYW1fdmVyc2lvbl9pbiwgZl9pbixcbi8vcGxheWVyX2FuZ2xlX2luIC8qIG5lZWRlZCBmb3IgZmlzaGV5ZSAqL1xuICAgIH1cbiAgXVxufSkubWFwKGQgPT4gKHsuLi5kLCByX2hpdF92X19yX2hpdF9oX29yX3Y6IDIqZC5yX2hpdF92KyhkLnJfaGl0X2hfb3JfdiA9PSAnaCcgPyAxIDogMCl9KSlcbi8vfCBvdXRwdXQ6IGZhbHNlXG4vL3wgXG5zY2VuZV91cGRhdGVzID0ge1xuICAvL3NjZW5lLnNpZ25hbChcInJheV9hbmdsZV9pblwiLCByYXlfYW5nbGVfaW4pOyBjYXVzZXMgaW5maW5pdGUgcmUtcnVuc1xuICBzY2VuZS5kYXRhKFwic291cmNlXCIsIHNjZW5lX2RhdGEpLnJlc2l6ZSgpLnJ1bigpO1xuICAvL3NjZW5lMi5kYXRhKFwic291cmNlXCIsIHNjZW5lX2RhdGEpLnJlc2l6ZSgpLnJ1bigpO1xufVxuXG5zY2VuZS5hZGRTaWduYWxMaXN0ZW5lcihcInBsYXllcl9hbmdsZV9pblwiLCAoYSwgYikgPT4ge1xuICAvKnZpZXdvZiBhYS52YWx1ZSA9IGIucmF5X2FuZ2xlX2luOyAvL3NjZW5lLnNpZ25hbChcInJheV9hbmdsZV9pblwiKTtcbiAgdmlld29mIGFhLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwiaW5wdXRcIiwgeyBidWJibGVzOiB0cnVlIH0pKTtcbiAgKi9cbiAvL2lmIChiLnJheV9hbmdsZV9pblswXSAhPT0gcmF5X2FuZ2xlX2luKSB7XG4gIC8vY29uc29sZS5sb2coYi5yYXlfYW5nbGVfaW5bMF0sIHJheV9hbmdsZV9pbiwgYi5yYXlfYW5nbGVfaW5bMF0gIT09IHJheV9hbmdsZV9pbilcbiAvL3ZpZXdvZiByYXlfYW5nbGVfaW4udmFsdWUgPSBiLnJheV9hbmdsZV9pblswXTsgLy9zY2VuZS5zaWduYWwoXCJyYXlfYW5nbGVfaW5cIik7XG4gLy8gdmlld29mIHJheV9hbmdsZV9pbi5kaXNwYXRjaEV2ZW50KFxuIC8vICAgbmV3IEN1c3RvbUV2ZW50KFwiaW5wdXRcIiwgeyBidWJibGVzOiB0cnVlIH0pXG4gIC8vKTtcbiAgLy9kZWJ1Z2dlcjtcbiAgLy8vLyBzZXQodmlld29mIHBsYXllcl9hbmdsZV9pbiwgYi5yYXlfYW5nbGVfaW5bMF0pXG4gIC8vc2V0KHZpZXdvZiBmb3JtdWxhZV92aXNpYmxlLCAncl9pbnZlcnNlX2xlbmd0aCcpIC8vLyB0aGlzIGlzIGJhZCBkdXJpbmcgYnJ1c2hpbmcgaWYgSSB3YW50IHRvIHNjYW4gbGVuZ3RoIGZvciBleGFtcGxlIDpvXG4gLy99XG59KVxuXG5zY2VuZS5hZGRTaWduYWxMaXN0ZW5lcihcInJheV9hbmdsZV9pblwiLCAoYSwgYikgPT4ge1xuICBtdXRhYmxlIHNob3dfcmF5ID0gdHJ1ZTtcbiAgc2V0KHZpZXdvZiByYXlfYW5nbGVfaW4sIGIucmF5X2FuZ2xlX2luWzBdKVxuICBjb25zb2xlLmxvZygnb29vJyxiLnJheV9hbmdsZV9pblswXSlcbn0pXG5cbnJheV9hbmdsZV9pblxuXG5zY2VuZV9kYXRhXG5cbm1qc19xX2V2YWxcblxuZm5zX3dpdGhfbWpzX3FfZXZhbFxuXG5JbnB1dHMuYmluZChJbnB1dHMucmFuZ2UoWy0xMDAsMTAwXSwge3N0ZXA6IDAuMX0pLCB2aWV3b2YgcmF5X2FuZ2xlX2luKVxuLy9JbnB1dHMuYmluZChJbnB1dHMucmFuZ2UoWy0xMDAsMTAwXSwge3N0ZXA6IDAuMX0pLCB2aWV3b2YgcGxheWVyX2FuZ2xlX2luKVxuSW5wdXRzLmJpbmQoSW5wdXRzLnJhbmdlKFstMTAsMTBdLCB7c3RlcDoxfSksIHZpZXdvZiB5ZWFyX2luKVxuXG52aWV3b2Ygb3BhY2l0eV92ZXJ0aWNhbCA9IElucHV0cy5yYW5nZShbMCwgMV0sIHtcbiAgc3RlcDogMC4xLFxuICB2YWx1ZTogMC41LFxuICBsYWJlbDogXCJ2ZXJ0XCJcbn0pXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcblxuLy8vLy8vLy8vLyBsZXZlbCB2aXN1YWxcblxuLy8gY29vcmRpbmF0ZSBzaG93X3JheV9zdGVwc1xue1xuICBmb3JtdWxhZV92aXNpYmxlLmZvckVhY2goZiA9PiB7XG4gICAgaWYgKE9iamVjdC52YWx1ZXMoaW50cm9zcGVjdGlvbl9ub21lbW8uY3VsX2Z1bmN0aW9ucykuZmluZChkID0+IGQubmFtZSA9PSBmICYmIGQuaW5wdXRzLmluY2x1ZGVzKCdzdGVwX2luJykpKVxuICAgICAgc2V0KHZpZXdvZiBzaG93X3JheV9zdGVwcywgdHJ1ZSlcbiAgfSlcbn1cblxue1xuICBpZiAoIXNob3dfcmF5KSBzZXQodmlld29mIHNob3dfcmF5X3N0ZXBzLCBmYWxzZSlcbn1cblxuc2hvd19yYXlfc3RlcHNcblxuLy8gY29vcmRpbmF0ZSBzaG93X3JheVxubXV0YWJsZSBzaG93X3JheSA9IGZhbHNlXG5cbnNob3dfcmF5XG5cbmxldmVsLmFkZFNpZ25hbExpc3RlbmVyKCdzdGVwX2luJywgKF8sYikgPT4ge1xuICBzZXQodmlld29mIHN0ZXBfaW4sIGJbMF0pXG4gIC8vIFRPRE8gcHJvY2VzcyB0aGUgZm9ybXVsYSBwYXJ0IFsxXVxuICBjb25zb2xlLmxvZyhiKTtcbn0pXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcblxudmlld29mIGxldmVsID0gZW1iZWQobGV2ZWxfc3BlYywge3JlbmRlcmVyOiAnc3ZnJywgYWN0aW9uc30pXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbmltcG9ydCB7IGNhbGN1dmVnYWRhdGEgfSBmcm9tIFwiYmFhZmE0YjA3MWE1YjY2YVwiXG5cbmltcG9ydCB7U2NydWJiZXJ9IGZyb20gXCJAbWJvc3RvY2svc2NydWJiZXJcIlxuXG5rZXlzX3N0cmVhbV9mdW5jdGlvbl9pbiA9IChhKSA9PiBbXG4gICAgICAgIC4uLmtleXNfc2hhcmVkXVxuXG5sZXZlbF9kYXRhID0gY2FsY3V2ZWdhZGF0YSh7XG4gIG1vZGVsczogW3JheWNhc3RpbmcyXSxcbiAgc3BlYzogcmF5cyxcbiAgZG9tYWluczoge1xuICAgIHN0ZXBfaW46IF8ucmFuZ2UoMCwgOC4xLCAxKSxcbiAgICByYXlfYW5nbGVfaW46IFtyYXlfYW5nbGVfaW4sIF0sLy9fLnJhbmdlKC0xIC8gMiwgMS4wMSAvIDIsIC8qMC4wMjUqMjAgUk9VTkRJTkcgQ0FVU0VTIEJVRyBUTyBOT1QgU0hPVyovKS5tYXAoKGQpID0+IGQgKyByYXlfYW5nbGVfaW4pIC8vW3JheV9hbmdsZV9pbiwgcmF5X2FuZ2xlX2luICsgMC40LCByYXlfYW5nbGVfaW4gLSAwLjRdXG4gIH0sXG4gIGlucHV0X2N1cnNvcnM6IFt7ICAgICAgIGtleXNfc3RyZWFtX2Z1bmN0aW9uX2luLFxua2V5c19zdHJlYW1fdmVyc2lvbl9pbiwgZl9pbixcbi8vcGxheWVyX2FuZ2xlMF9pbi8vOiByYXlfYW5nbGVfaW5cblxuXG59XVxufSlcblxuXG5mb3ZfY3Vyc29yID0geyByZXR1cm4gKHsgICAga2V5c19zdHJlYW1fZnVuY3Rpb25faW4sXG4gICAga2V5c19zdHJlYW1fdmVyc2lvbl9pbixcbiAgICBmX2luLFxufSl9XG5mb3ZfZGF0YSA9IFt7aWQ6MCwgeDpyYXljYXN0aW5nMi5wbGF5ZXJfeChmb3ZfY3Vyc29yKSwgeTpyYXljYXN0aW5nMi5wbGF5ZXJfeShmb3ZfY3Vyc29yKX0se2lkOjEsIHg6cmF5Y2FzdGluZzIucnZ4KHsuLi5mb3ZfY3Vyc29yLCBzdGVwX2luOiAxMCwgcmF5X2FuZ2xlX2luOiBwbGF5ZXJfYW5nbGVfaW4tLjV9KSwgeTpyYXljYXN0aW5nMi5ydnkoey4uLmZvdl9jdXJzb3IsIHN0ZXBfaW46IDEwLCByYXlfYW5nbGVfaW46IHBsYXllcl9hbmdsZV9pbi0uNX0pfSx7aWQ6MSwgeDpyYXljYXN0aW5nMi5ydngoey4uLmZvdl9jdXJzb3IsIHN0ZXBfaW46IDEwLCByYXlfYW5nbGVfaW46IHBsYXllcl9hbmdsZV9pbisuNX0pLCB5OnJheWNhc3RpbmcyLnJ2eSh7Li4uZm92X2N1cnNvciwgc3RlcF9pbjogMTAsIHJheV9hbmdsZV9pbjogcGxheWVyX2FuZ2xlX2luKy41fSl9XVxuXG5wbGF5ZXJfZGF0YSA9ICBjYWxjdXZlZ2FkYXRhKHtcbiAgbW9kZWxzOiBbcmF5Y2FzdGluZzJdLFxuICBzcGVjOiBwbGF5ZXJfc3BlYyxcbiAgZG9tYWluczoge1xuICB9LFxuICBpbnB1dF9jdXJzb3JzOiBbe1xuICAgIGtleXNfc3RyZWFtX2Z1bmN0aW9uX2luLFxuICAgIGtleXNfc3RyZWFtX3ZlcnNpb25faW4sXG4gICAgZl9pbixcbiAgfV1cbn0pXG5cbnJheV9zdGVwc19kYXRhID0gIGNhbGN1dmVnYWRhdGEoe1xuICBtb2RlbHM6IFtyYXljYXN0aW5nMl0sXG4gIHNwZWM6IHJheV9zdGVwc19zcGVjLFxuICBkb21haW5zOiB7XG4gICAgc3RlcF9pbjogXy5yYW5nZSgwLDguMSlcbiAgfSxcbiAgaW5wdXRfY3Vyc29yczogW3tcbiAgICBrZXlzX3N0cmVhbV9mdW5jdGlvbl9pbixcbiAgICBrZXlzX3N0cmVhbV92ZXJzaW9uX2luLFxuICAgIGZfaW4sXG4gICAgcmF5X2FuZ2xlX2luXG4gIH1dXG59KVxuXG5cbm1hcF9kYXRhID0gXy5yYW5nZSgwLjUsOCkubWFwKHhfaW4gPT4gXy5yYW5nZSgwLjUsOCkubWFwKHlfaW4gPT4gKHt4X2luLCB5X2luLCBtYXBfY2hlY2s6IHJheWNhc3RpbmcyLm1hcF9jaGVjayh7eF9pbix5X2lufSl9KSkpLmZsYXQoKVxuXG51cGRhdGVzX2xldmVsID0ge1xuICBpZiAocmF5X2FuZ2xlX2luICE9IG51bGwpXG4gIC8vbGV2ZWwuc2lnbmFsKFwicmF5X2FuZ2xlX2luXCIsIHJheV9hbmdsZV9pbik7XG4gIGxldmVsXG4gICAgLmRhdGEoXCJzb3VyY2VcIiwgbGV2ZWxfZGF0YSkgLyoucmVzaXplKCkqL1xuICAgIC5ydW4oKTtcbn1cblxubGV2ZWwuZGF0YSgncGxheWVyX2RhdGEnLCBwbGF5ZXJfZGF0YSkucnVuKClcbmxldmVsLmRhdGEoJ3JheV9zdGVwc19kYXRhJywgcmF5X3N0ZXBzX2RhdGEpLnJ1bigpXG5cbmxldmVsLnNpZ25hbCgncGxheWVyX2FuZ2xlX2luJywgcGxheWVyX2FuZ2xlX2luKS5ydW4oKVxuXG5cblxudXBkYXRlc19mb3YgPSB7XG4gIGxldmVsXG4gICAgLmRhdGEoXCJmb3ZcIiwgZm92X2RhdGEpIC8qLnJlc2l6ZSgpKi9cbiAgICAucnVuKCk7XG59XG5cblxubXV0YWJsZSBzY2VuZV9kYXRhMCA9IFtdXG5tdXRhYmxlIGxldmVsX2RhdGEwID0gW10gLy8gaW5jbHVkZXMgZGF0YSBpbiBzcGVjIGZvciB3aGVuIEkgT3BlbiBpbiBWZWdhIEVkaXRvclxubXV0YWJsZSBmb3ZfZGF0YTAgPSBbXSBcblxucmF5cyA9IHtyZXR1cm4gW1xue1xuICAgICAgZnJvbTogeyBkYXRhOiBcInNvdXJjZVwiIH0sXG4gICAgICB0eXBlOiBcInN5bWJvbFwiLFxuICAgICAgZW5jb2RlOiB7XG4gICAgICAgIGVudGVyOiB7XG4gICAgICAgICAgeDogeyBmaWVsZDogXCJyX2hpdF94XCIsIHNjYWxlOiBcInhcIiB9LFxuICAgICAgICAgIHk6IHsgZmllbGQ6IFwicl9oaXRfeVwiLCBzY2FsZTogXCJ5XCIgfSxcbiAgICAgICAgICBzaXplOiB7IGZpZWxkOiBcInJfbGVuZ3RoXCIsIHNjYWxlOiBcImxlbmd0aFwiIH0sXG4gICAgICAgICAgZmlsbDogeyB2YWx1ZTogXCJvcmFuZ2VcIiB9LFxuICAgICAgICAgIC8vb3BhY2l0eToge3ZhbHVlOiAwLjR9LFxuICAgICAgICAgIGZpbGxPcGFjaXR5OiB7dmFsdWU6IDAuMX0sXG4gICAgICAgICAgc3Ryb2tlOiB7IHZhbHVlOiBcImJsYWNrXCIgfSxcbiAgICAgICAgICBzaGFwZTogeyB2YWx1ZTogXCJzcXVhcmVcIiB9XG4gICAgICAgIH0sXG4gICAgICAgIHVwZGF0ZToge1xuICAgICAgICAgIHg6IHsgZmllbGQ6IFwicl9oaXRfeFwiLCBzY2FsZTogXCJ4XCIgfSxcbiAgICAgICAgICB5OiB7IGZpZWxkOiBcInJfaGl0X3lcIiwgc2NhbGU6IFwieVwiIH0sXG4gICAgICAgICAgc2l6ZTogeyBmaWVsZDogXCJyX2xlbmd0aFwiLCBzY2FsZTogXCJsZW5ndGhcIiB9LFxuICAgICAgICB9XG4gICAgICB9XG5cbn0sXG4oe1xuICBmcm9tOiB7IGRhdGE6IFwic291cmNlXCIgfSxcbiAgLy9tYXJrOiB7dHlwZTogXCJydWxlXCIsIGNsaXA6IHRydWV9LFxuICB0eXBlOiAncnVsZScsXG4gIGVuY29kZToge1xuICAgIGVudGVyOiB7XG4gICAgICBzdHJva2U6IHsgdmFsdWU6IFwicmVkXCIgfSxcbiAgICAgIHN0cm9rZVdpZHRoOiB7IHZhbHVlOiAzIH0sXG4gICAgICBzdHJva2VPcGFjaXR5OiB7IHZhbHVlOiAxIH0sXG4gICAgICBzdHJva2VEYXNoOiB7dmFsdWU6IFs4LDhdfVxuICAgIH0sXG4gICAgdXBkYXRlOiB7XG4gICAgICB4OiB7IGZpZWxkOiBcInBsYXllcl94XCIsIHNjYWxlOiBcInhcIiB9LFxuICAgICAgeTogeyBmaWVsZDogXCJwbGF5ZXJfeVwiLCBzY2FsZTogXCJ5XCIgfSxcbiAgICAgIHgyOiB7IGZpZWxkOiBcInJfaGl0X3hcIiwgc2NhbGU6IFwieFwiIH0sXG4gICAgICB5MjogeyBmaWVsZDogXCJyX2hpdF95XCIsIHNjYWxlOiBcInlcIiB9XG4gICAgICAvL3N0cm9rZTogeyBmaWVsZDogXCJyYXlfYW5nbGVfaW5cIiB9XG4gICAgfVxuICB9XG59KV19XG5cblxuaGl0cyA9IHtyZXR1cm4gKHtcbiAgICAgIC8vXG4gICAgfSl9XG5cblxuZm92X3NwZWMgPSB7cmV0dXJuICh7XG4gIGZyb206IHsgZGF0YTogXCJmb3ZcIiB9LFxuICB0eXBlOiBcImxpbmVcIixcbiAgZW5jb2RlOiB7XG4gICAgZW50ZXI6IHtcbiAgICAgIHN0cm9rZTogeyB2YWx1ZTogXCIjMEZGRjUwXCIgfSxcbiAgICAgIHN0cm9rZVdpZHRoOiB7IHZhbHVlOiA1LjAxIH0sXG4gICAgICBzdHJva2VPcGFjaXR5OiB7IHZhbHVlOiAxIH0sXG4gICAgICBpbnRlcnBvbGF0ZToge3ZhbHVlOiAnbGluZWFyLWNsb3NlZCd9XG4gICAgfSxcbiAgICB1cGRhdGU6IHtcbiAgICAgIHg6IHsgZmllbGQ6IFwieFwiLCBzY2FsZTogXCJ4XCIgfSxcbiAgICAgIHk6IHsgZmllbGQ6IFwieVwiLCBzY2FsZTogXCJ5XCIgfSxcbiAgICAgIGZpbGw6IHsgdmFsdWU6IFwiZ3JlZW5cIiB9LFxuICAgICAgZmlsbE9wYWNpdHk6IHt2YWx1ZTogMC4yfVxuICAgICAgLy94MjogeyBmaWVsZDogXCJydnhcIiwgc2NhbGU6IFwieFwiIH0sXG4gICAgICAvL3kyOiB7IGZpZWxkOiBcInJ2eVwiLCBzY2FsZTogXCJ5XCIgfVxuICAgICAgLy9zdHJva2U6IHsgZmllbGQ6IFwicmF5X2FuZ2xlX2luXCIgfVxuICAgIH1cbiAgfVxufSl9XG5cbm1hcF9zcGVjID0ge3JldHVybiAoe1xuICBmcm9tOiB7IGRhdGE6IFwibWFwX2RhdGFcIiB9LFxuICB0eXBlOiBcInJlY3RcIixcbiAgZW5jb2RlOiB7XG4gICAgZW50ZXI6IHtcbiAgICAgIHg6IHsgc2lnbmFsOiBcImZsb29yKGRhdHVtLnhfaW4pXCIsIHNjYWxlOiAneCcgfSxcbiAgICAgIHgyOiB7IHNpZ25hbDogXCJmbG9vcihkYXR1bS54X2luKSsxLTAuMDVcIiwgc2NhbGU6ICd4JyB9LFxuICAgICAgeTogeyBzaWduYWw6IFwiZmxvb3IoZGF0dW0ueV9pbilcIiAsIHNjYWxlOiAneSd9LFxuICAgICAgeTI6IHsgc2lnbmFsOiBcImZsb29yKGRhdHVtLnlfaW4pKzEtMC4wNVwiLCBzY2FsZTogJ3knIH0sXG4gICAgICBmaWxsOiB7IGZpZWxkOiAnbWFwX2NoZWNrJywgc2NhbGU6ICdtYXBfY2hlY2snfVxuICAgICAgLy9jb2xvcjogeyBmaWVsZDogXCJmbG9vcihkYXR1bS55X2luKSsxXCIgfSxcblxuICAgIH0sXG4gIH1cbn0pfVxuXG5cbnBsYXllcl9zcGVjID0ge3JldHVybiAoe1xuICAgICAgLy8gUExBWUVSXG4gICAgICBmcm9tOiB7IGRhdGE6IFwicGxheWVyX2RhdGFcIiB9LFxuICAgICAgdHlwZTogXCJzeW1ib2xcIixcbiAgICAgIGVuY29kZToge1xuICAgICAgICBlbnRlcjoge1xuICAgICAgICAgIHg6IHsgZmllbGQ6IFwicGxheWVyX3hcIiwgc2NhbGU6IFwieFwiIH0sXG4gICAgICAgICAgeTogeyBmaWVsZDogXCJwbGF5ZXJfeVwiLCBzY2FsZTogXCJ5XCIgfSxcbiAgICAgICAgICBzaXplOiB7IHZhbHVlOiA1MDAgfSxcbiAgICAgICAgICBmaWxsOiB7IHZhbHVlOiBcInllbGxvd1wiIH0sXG4gICAgICAgICAgc3Ryb2tlOiB7IHZhbHVlOiBcImJsYWNrXCIgfSxcbiAgICAgICAgICBzaGFwZTogeyB2YWx1ZTogXCJhcnJvd1wiIH1cbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlOiB7XG4gICAgICAgICAgeDogeyBmaWVsZDogXCJwbGF5ZXJfeFwiLCBzY2FsZTogXCJ4XCIgfSxcbiAgICAgICAgICB5OiB7IGZpZWxkOiBcInBsYXllcl95XCIsIHNjYWxlOiBcInlcIiB9LFxuICAgICAgICAgIGFuZ2xlOiB7IHNpZ25hbDogXCItMTgwIC0gOTAgLSBwbGF5ZXJfYW5nbGVfaW4gKiAxODAgLyBQSVwiIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pfVxuXG5yYXlfc3RlcHNfc3BlYyA9IHtyZXR1cm4gKFtcbntcbiAgICAgIC8vIEhPUklaT05UQUwgUkVEU1xuICAgICAgZnJvbTogeyBkYXRhOiBcInJheV9zdGVwc19kYXRhXCIgfSxcbiAgICAgIG5hbWU6ICdoJyxcbiAgICAgIHR5cGU6IFwic3ltYm9sXCIsXG4gICAgICBlbmNvZGU6IHtcbiAgICAgICAgZW50ZXI6IHtcbiAgICAgICAgICAvL29wYWNpdHk6IHsgdmFsdWU6IG9wYWNpdHlfdmVydGljYWwgfSxcbiAgICAgICAgICAvL29wYWNpdHk6IHsgZmllbGQ6IFwiaWZfcmF5X2hpdF9ob3Jpem9udGFsXCIsIHNjYWxlOiBcImhpdFwiIH0sXG4gICAgICAgICAgeDogeyBmaWVsZDogXCJyaHhcIiwgc2NhbGU6IFwieFwiIH0sXG4gICAgICAgICAgeTogeyBmaWVsZDogXCJyaHlcIiwgc2NhbGU6IFwieVwiIH0sXG4gICAgICAgICAgc2l6ZTogeyB2YWx1ZTogMzAwIH0sXG4gICAgICAgICAgZmlsbDogeyB2YWx1ZTogXCJyZWRcIiB9LFxuICAgICAgICAgIHNoYXBlOiB7IHZhbHVlOiBcImNpcmNsZVwiIH0sXG4gICAgICAgICAgc3Ryb2tlV2lkdGg6IHt2YWx1ZTogNX0sXG4gICAgICAgIH0sXG4gICAgICAgIHVwZGF0ZToge1xuICAgICAgICAgIHN0cm9rZTogeyBzaWduYWw6IFwiKGRhdHVtLnN0ZXBfaW4gPT0gc3RlcF9pblswXSAmJiBzdGVwX2luWzFdID09ICdoJykgPyAneWVsbG93JyA6IG51bGxcIn0sLy8sIHNjYWxlOiBcImhpdFwiIH0sXG4gICAgICAgICAgeDogeyBmaWVsZDogXCJyaHhcIiwgc2NhbGU6IFwieFwiIH0sXG4gICAgICAgICAgeTogeyBmaWVsZDogXCJyaHlcIiwgc2NhbGU6IFwieVwiIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgLy8gVkVSVElDQUwgR1JFRU5TXG4gICAgICBmcm9tOiB7IGRhdGE6IFwicmF5X3N0ZXBzX2RhdGFcIiB9LFxuICAgICAgdHlwZTogXCJzeW1ib2xcIixcbiAgICAgIG5hbWU6ICd2JyxcbiAgICAgIGVuY29kZToge1xuICAgICAgICBlbnRlcjoge1xuICAgICAgICAgIC8vb3BhY2l0eTogeyB2YWx1ZTogb3BhY2l0eV92ZXJ0aWNhbCB9LFxuICAgICAgICAgIC8vb3BhY2l0eTogeyBmaWVsZDogXCJpZl9yYXlfaGl0X3ZlcnRpY2FsXCIsIHNjYWxlOiBcImhpdFwiIH0sXG4gICAgICAgICAgeDogeyBmaWVsZDogXCJydnhcIiwgc2NhbGU6IFwieFwiIH0sXG4gICAgICAgICAgeTogeyBmaWVsZDogXCJydnlcIiwgc2NhbGU6IFwieVwiIH0sXG4gICAgICAgICAgc2l6ZTogeyB2YWx1ZTogMjAwIH0sXG4gICAgICAgICAgZmlsbDogeyB2YWx1ZTogXCJncmVlblwiIH0sXG4gICAgICAgICAgc2hhcGU6IHsgdmFsdWU6IFwiY2lyY2xlXCIgfSxcbiAgICAgICAgICBzdHJva2VXaWR0aDoge3ZhbHVlOiA1fSxcblxuICAgICAgICB9LFxuICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICAvL29wYWNpdHk6IHsgdmFsdWU6IG9wYWNpdHlfdmVydGljYWwgfSxcbiAgICAgICAgICBzdHJva2U6IHsgc2lnbmFsOiBcIihkYXR1bS5zdGVwX2luID09IHN0ZXBfaW5bMF0gJiYgc3RlcF9pblsxXSA9PSAndicpID8gJ3llbGxvdycgOiBudWxsXCJ9LC8vLCBzY2FsZTogXCJoaXRcIiB9LFxuICAgICAgICAgIHg6IHsgZmllbGQ6IFwicnZ4XCIsIHNjYWxlOiBcInhcIiB9LFxuICAgICAgICAgIHk6IHsgZmllbGQ6IFwicnZ5XCIsIHNjYWxlOiBcInlcIiB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XSl9XG5cblxuXG5sZXZlbF9zcGVjID0geyByZXR1cm4gKHtcbiAgZGF0YTogW1xuICAgIHsgbmFtZTogXCJzb3VyY2VcIiwgdmFsdWVzOiBsZXZlbF9kYXRhMCB9LCAvLyBsYXllciA1IGZvciByYXlzIGJ5IHN0ZXBcbiAgICB7IG5hbWU6IFwiZm92XCIsIHZhbHVlczogZm92X2RhdGEwIH0sXG4gICAgeyBuYW1lOiBcIm1hcF9kYXRhXCIsIHZhbHVlczogbWFwX2RhdGEgfSxcbiAgICB7IG5hbWU6IFwicGxheWVyX2RhdGFcIiwgdmFsdWVzOiBbXSB9LFxuICAgIHsgbmFtZTogXCJoaXRzX2RhdGFcIiwgdmFsdWVzOiBbXSB9LFxuICAgIHsgbmFtZTogXCJyYXlfc3RlcHNfZGF0YVwiLCB2YWx1ZXM6IFtdIH0sXG4gIF0sXG4gIC8vYmFja2dyb3VuZDogXCJncmV5XCIsXG4gIC8vd2lkdGg6ICdjb250YWluZXInLFxuICB3aWR0aDogNDAwLFxuICBoZWlnaHQ6IDMwMCxcbiAgYmFja2dyb3VuZDogJyNkZGQnLFxuICBzaWduYWxzOiBbXG4gICAgeyBuYW1lOiBcInBsYXllcl9hbmdsZV9pblwiIH0sXG5cblxuICAgIHtcbiAgICAgIFwibmFtZVwiOiBcInN0ZXBfaW5cIixcbiAgICAgIHZhbHVlOiBbLTEwLCc/J10sXG4gICAgICBcIm9uXCI6IFt7XCJldmVudHNcIjogXCJAaDptb3VzZW92ZXJcIiwgXCJ1cGRhdGVcIjogXCJbZGF0dW0uc3RlcF9pbiwgJ2gnXVwifSx7XCJldmVudHNcIjogXCJAdjptb3VzZW92ZXJcIiwgXCJ1cGRhdGVcIjogXCJbZGF0dW0uc3RlcF9pbiwgJ3YnXVwifV1cbiAgICB9XG4gIF0sXG4gIHNjYWxlczogW1xuICAgIHsgbmFtZTogXCJ4XCIsIHR5cGU6IFwibGluZWFyXCIsIGRvbWFpbjogWzAsIDhdLCByYW5nZTogXCJ3aWR0aFwiIH0sXG4gICAgeyBuYW1lOiBcInlcIiwgdHlwZTogXCJsaW5lYXJcIiwgZG9tYWluOiBbMCwgOF0sIHJhbmdlOiBcImhlaWdodFwiLCByZXZlcnNlOiB0cnVlIH0sXG4gICAgeyBuYW1lOiBcImhpdFwiLCB0eXBlOiBcIm9yZGluYWxcIiwgZG9tYWluOiBbMCwgMV0sIHJhbmdlOiBbMC4wMSwgMC4xXSB9LFxuICAgIHsgbmFtZTogXCJsZW5ndGhcIiwgdHlwZTogXCJsaW5lYXJcIiwgZG9tYWluOiBbMiwgOF0sIHJhbmdlOiBbMTAwMCwgMTBdICB9LFxuICAgIHsgbmFtZTogXCJsZW5ndGgyXCIsIHR5cGU6IFwibGluZWFyXCIsIGRvbWFpbjogWzIsIDZdLCByYW5nZTogWzEwMDAsIDBdICB9LFxuICAgIHsgbmFtZTogXCJtYXBfY2hlY2tcIiwgdHlwZTogXCJvcmRpbmFsXCIsIGRvbWFpbjogWzAsIDEsIDIsIDNdLCByYW5nZTogW1wid2hpdGVcIiwgXCJoc2woMjUwLCA3NiUsIDYwJSlcIixcImhzbCgyMDAsIDc2JSwgNjAlKVwiLFwiaHNsKDEwMCwgNzYlLCA2MCUpXCJdIH1cbiAgXSxcbiAgbWFya3M6IFtcbiAgICBtYXBfc3BlYyxcblxuICAgIGZvdl9zcGVjLFxuICAgIC4uLihzaG93X3JheSA/IHJheXMgOiBbXSksXG4gICAgcGxheWVyX3NwZWMsXG4gICAgLi4uKHNob3dfcmF5X3N0ZXBzID8gcmF5X3N0ZXBzX3NwZWMgOiBbXSksXG5cbiAgXSxcbiAgYXhlczogW1xuICAgIHsgb3JpZW50OiBcInRvcFwiLCBzY2FsZTogXCJ4XCIsIGxhYmVsRm9udFNpemU6IDIwLCBsYWJlbENvbG9yOiAnYmx1ZSd9LFxuICAgIHsgb3JpZW50OiBcImxlZnRcIiwgc2NhbGU6IFwieVwiLCBsYWJlbEZvbnRTaXplOiAyMCwgbGFiZWxDb2xvcjogJ2JsdWUnfVxuICBdLFxufSlcbn1cblxuXG5odG1sYDxzdHlsZT5cblxuLm1vZGVsZGVwdCB7XG4gIGRpc3BsYXk6IG5vbmU7XG59XG5cbiMke21vZGVsbmFtZX0ubW9kZWxkZXB0IHtcbiAgZGlzcGxheTogYmxvY2s7XG59XG48L3N0eWxlPmBcblxuXG5cbiAge1xuICAgIHNhdmluZ3Nfdml6LmFkZFNpZ25hbExpc3RlbmVyKCdkb3VibGVjbGljaycsIF8gPT4ge1xuICAgICAgc2V0KHZpZXdvZiBvdmVybGF5LCB0cnVlKVxuICAgIH0pXG4gIH1cblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxubXV0YWJsZSBzYXZpbmdzX2RhdGEwID0gW11cblxuXG5zYXZpbmdzX3NwZWMgPSB7IHJldHVybiAoe1xuICAvL3dpZHRoOiAnY29udGFpbmVyJywgaGVpZ2h0Oidjb250YWluZXInLCBiYWQgZm9yIG1vYmlsZVxuICB3aWR0aDogJ2NvbnRhaW5lcicsIGhlaWdodDogMzUwLFxuICBcImRhdGFcIjoge1wibmFtZVwiOiBcInNvdXJjZVwifSxcbiAgZGF0YXNldHM6IHsnc291cmNlJzogc2F2aW5nc19kYXRhMCB9LFxuICBtYXJrOiB7IHR5cGU6ICd0ZXh0JywgZm9udFNpemU6IDIwLCB0b29sdGlwOiB0cnVlfSxcbiAgZW5jb2Rpbmc6IHtcbiAgICB4OiB7ZmllbGQ6ICdmb3JtdWxhJ30sXG4gICAgY29sb3I6IHtmaWVsZDogJ2Zvcm11bGEnLCBsZWdlbmQ6IGZhbHNlfSxcbiAgICB5OiB7ZmllbGQ6ICd5ZWFyX2luJ30sXG4gICAgdGV4dDoge2ZpZWxkOiAndmFsdWUnLyosIGZvcm1hdDonLC4yZicqL31cbiAgfSxcblxuICBwYXJhbXM6IFtcbiAgICB7XG4gICAgICBuYW1lOiBcImZvcm11bGFcIixcbiAgICAgIC8vdmFsdWU6IHsgcmF5X2FuZ2xlX2luOiAwIH0sXG4gICAgICBzZWxlY3Q6IHtcbiAgICAgICAgdHlwZTogXCJwb2ludFwiLFxuICAgICAgICAvL29uOiBcIm1vdXNlbW92ZXswLDUwfVwiLFxuICAgICAgICBvbjogXCJtb3VzZXVwLCB0b3VjaHVwLCBbbW91c2Vkb3duLCBtb3VzZXVwXSA+IG1vdXNlbW92ZVwiLFxuICAgICAgICAvL29uOiBcIlt0b3VjaGRvd24sIHRvdWNodXBdID4gdG91Y2htb3ZlLCBbbW91c2Vkb3duLCBtb3VzZXVwXSA+IG1vdXNlbW92ZVwiLCAvL3sxMCwgMTAwfVwiLFxuICAgICAgICAvLyAgICAgICAgb246IFwiW21vdXNlZG93biwgbW91c2V1cF0gPiBtb3VzZW1vdmVcIixcbiAgICAgICAgbmVhcmVzdDogdHJ1ZSxcbiAgICAgICAgdG9nZ2xlOiBmYWxzZSxcbiAgICAgICAgY2xlYXI6IGZhbHNlLFxuICAgICAgICBlbmNvZGluZ3M6IFtcInhcIiwgXCJ5XCJdXG4gICAgICB9XG4gICAgfVxuICBdXG59KSB9XG5cbnNhdmluZ3NfZGF0YSA9IGNhbGN1dmVnYWRhdGEoe1xuICBtb2RlbHM6IFtzYXZpbmdzXSxcbiAgc3BlYzogc2F2aW5nc19zcGVjLFxuICBkb21haW5zOiB7XG4gICAgeWVhcl9pbjogXy5yYW5nZSgtMSxkdXJhdGlvbl9pbiswLjEpLFxuICAgIGZvcm11bGE6IFsnYmFsYW5jZScsICdpbnRlcmVzdCcsICdkZXBvc2l0cyddXG4gIH0sXG4gIGlucHV0X2N1cnNvcnM6IFt7ZHVyYXRpb25faW4saW50ZXJlc3RfcmF0ZV9pbixhbm51YWxfcGF5bWVudF9pbn1dXG59KS5tYXAoZCA9PiAoey4uLmQsIHZhbHVlOiBmbXQyKGQuZm9ybXVsYSwgZC52YWx1ZSl9KSkgLy8gZm10MiBkb2Vzbid0IG1hdHRlciBpbiB0aGlzIGNhc2VcblxuLy9JbnB1dHMudGFibGUoc2F2aW5nc19kYXRhKVxuXG52aWV3b2Ygc2F2aW5nc192aXogPSBlbWJlZChzYXZpbmdzX3NwZWMsIHtyZW5kZXJlcjonc3ZnJywgYWN0aW9ucyxcbnBhdGNoOiBzID0+IHtzLnNpZ25hbHMucHVzaCh7XG4gIFxuICAgIG5hbWU6IFwiZG91YmxlY2xpY2tcIixcbiAgICB2YWx1ZTogMCxcbiAgICAgIFwib25cIjogW3tcImV2ZW50c1wiOiBcImRibGNsaWNrXCIsIFwidXBkYXRlXCI6IFwiZGF0dW1cIn1dXG4gIFxufSk7XG4gcmV0dXJuIHN9XG5cbiAgfSlcblxuXG5cbi8vSW5wdXRzLnRhYmxlKHNhdmluZ3NfZGF0YSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbmh0bC5odG1sYDxidXR0b24gb25jbGljaz0keygpID0+IChtdXRhYmxlIHNhdmluZ3NfZGF0YTAgPSBzYXZpbmdzX2RhdGEpfT5pbnNlcnQgZGF0YSAtPiB2ZWdhIGVkaXRvciAoZGV2KTwvYnV0dG9uPmBcblxuXG57XG4gIHNhdmluZ3Nfdml6OyAvLyBmb3JjZSByZXNpemUgZXZlbnQgb24gbG9hZCBvciB1c2VyIHNlZXMgbm90aGluZ1xuICAvLyBzZWUgbGltaXRhdGlvbnMgaGVyZTogaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby92ZWdhLWxpdGUvZG9jcy9zaXplLmh0bWwjc3BlY2lmeWluZy1yZXNwb25zaXZlLXdpZHRoLWFuZC1oZWlnaHRcbiAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdyZXNpemUnKSlcbn1cblxuXG5zYXZpbmdzX3Zpei5hZGRTaWduYWxMaXN0ZW5lcihcImZvcm11bGFcIiwgKGEsIGIpID0+IHtcbiAgLyp2aWV3b2YgYWEudmFsdWUgPSBiLnJheV9hbmdsZV9pbjsgLy9zY2VuZS5zaWduYWwoXCJyYXlfYW5nbGVfaW5cIik7XG4gIHZpZXdvZiBhYS5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcImlucHV0XCIsIHsgYnViYmxlczogdHJ1ZSB9KSk7XG4gICovXG4gLy9pZiAoYi5yYXlfYW5nbGVfaW5bMF0gIT09IHJheV9hbmdsZV9pbikge1xuICAvL2NvbnNvbGUubG9nKGIucmF5X2FuZ2xlX2luWzBdLCByYXlfYW5nbGVfaW4sIGIucmF5X2FuZ2xlX2luWzBdICE9PSByYXlfYW5nbGVfaW4pXG4gLy92aWV3b2YgcmF5X2FuZ2xlX2luLnZhbHVlID0gYi5yYXlfYW5nbGVfaW5bMF07IC8vc2NlbmUuc2lnbmFsKFwicmF5X2FuZ2xlX2luXCIpO1xuIC8vIHZpZXdvZiByYXlfYW5nbGVfaW4uZGlzcGF0Y2hFdmVudChcbiAvLyAgIG5ldyBDdXN0b21FdmVudChcImlucHV0XCIsIHsgYnViYmxlczogdHJ1ZSB9KVxuICAvLyk7XG4gIHNldCh2aWV3b2YgZm9ybXVsYWVfdmlzaWJsZSwgW2IuZm9ybXVsYVswXV0pXG4gIHNldCh2aWV3b2YgeWVhcl9pbiwgYi55ZWFyX2luWzBdKVxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FsY3VsYW5nX2ZfJytiLmZvcm11bGFbMF0pLnNjcm9sbEludG9WaWV3KHNjcm9sbEludG9WaWV3T3B0cylcbiAvL31cbn0pXG5cblxuc2F2aW5nc19hY3R1YWxhdG9yLmFkZFNpZ25hbExpc3RlbmVyKFwiZm9ybXVsYVwiLCAoYSwgYikgPT4ge1xuICAvKnZpZXdvZiBhYS52YWx1ZSA9IGIucmF5X2FuZ2xlX2luOyAvL3NjZW5lLnNpZ25hbChcInJheV9hbmdsZV9pblwiKTtcbiAgdmlld29mIGFhLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwiaW5wdXRcIiwgeyBidWJibGVzOiB0cnVlIH0pKTtcbiAgKi9cbiAvL2lmIChiLnJheV9hbmdsZV9pblswXSAhPT0gcmF5X2FuZ2xlX2luKSB7XG4gIC8vY29uc29sZS5sb2coYi5yYXlfYW5nbGVfaW5bMF0sIHJheV9hbmdsZV9pbiwgYi5yYXlfYW5nbGVfaW5bMF0gIT09IHJheV9hbmdsZV9pbilcbiAvL3ZpZXdvZiByYXlfYW5nbGVfaW4udmFsdWUgPSBiLnJheV9hbmdsZV9pblswXTsgLy9zY2VuZS5zaWduYWwoXCJyYXlfYW5nbGVfaW5cIik7XG4gLy8gdmlld29mIHJheV9hbmdsZV9pbi5kaXNwYXRjaEV2ZW50KFxuIC8vICAgbmV3IEN1c3RvbUV2ZW50KFwiaW5wdXRcIiwgeyBidWJibGVzOiB0cnVlIH0pXG4gIC8vKTtcbiAgY29uc29sZS5sb2coYilcbiAgc2V0KHZpZXdvZiBmb3JtdWxhZV92aXNpYmxlLCBbYi5mb3JtdWxhWzBdXSlcbiAgc2V0KHZpZXdvZiB5ZWFyX2luLCBiLnllYXJfaW5bMF0pXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYWxjdWxhbmdfZl8nK2IuZm9ybXVsYVswXSkuc2Nyb2xsSW50b1ZpZXcoc2Nyb2xsSW50b1ZpZXdPcHRzKVxuIC8vfVxufSlcblxuLypzYXZpbmdzX3Zpei5hZGRTaWduYWxMaXN0ZW5lcihcInllYXJfaW5cIiwgKGEsIGIpID0+IHtcbiAgY29uc29sZS5sb2coYik7XG4gIHNldCh2aWV3b2YgeWVhcl9pbiwgYi55ZWFyX2luWzBdKVxufSkqL1xuXG5cblxuXG57XG4gIC8vc2NlbmUuc2lnbmFsKFwicmF5X2FuZ2xlX2luXCIsIHJheV9hbmdsZV9pbik7IGNhdXNlcyBpbmZpbml0ZSByZS1ydW5zXG4gIHNhdmluZ3Nfdml6LmRhdGEoXCJzb3VyY2VcIiwgc2F2aW5nc19kYXRhKS5yZXNpemUoKS5ydW4oKTtcbn1cblxuXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbklucHV0cy5iaW5kKFNjcnViYmVyKF8ucmFuZ2UoMCw2MCo1KSwge2F1dG9wbGF5OiBmYWxzZSwgZGVsYXk6NTAsIGxhYmVsOidmcmFtZScsIGluaXRpYWw6IDJ9KSwgdmlld29mIGZyYW1lX2luKVxuXG4vL3ZpZXdvZiBzcGVlZF9pbiA9IElucHV0cy5yYW5nZShbLTMsMTVdLCB7dmFsdWU6MywgbGFiZWw6ICdzcGVlZCcsIHN0ZXA6MC4wMX0pXG5cbnN0YXJmaWVsZF9zcGVjID0geyByZXR1cm4gKHtcbiAgYmFja2dyb3VuZDogJ2JsYWNrJywvLydsaWdodGJsdWUnLFxuICBcImRhdGFcIjoge1wibmFtZVwiOiBcImRhdGFcIn0sXG4gIFwiZGF0YXNldHNcIjogeyBcImRhdGFcIjogc3RhcmZpZWxkX2RhdGEwfSxcbiAgICBcImhlaWdodFwiOiA0MDAsIHdpZHRoOiA0MDAsXG4gICAgbGF5ZXI6IFt7XG4gICAgXCJtYXJrXCI6IHt0eXBlOiBcInBvaW50XCIsIHRvb2x0aXA6IHRydWUsIGNsaXA6IGZhbHNlfSxcblxuICBwYXJhbXM6IFtcbiAgICB7XG4gICAgICBuYW1lOiBcInN0YXJfc2VsZWN0XCIsXG4gICAgICAvL3ZhbHVlOiB7IHJheV9hbmdsZV9pbjogMCB9LFxuICAgICAgc2VsZWN0OiB7XG4gICAgICAgIHR5cGU6IFwicG9pbnRcIixcbiAgICAgICAgLy9vbjogXCJtb3VzZW1vdmV7MCw1MH1cIixcbiAgICAgICAgb246IFwibW91c2V1cCwgdG91Y2h1cCwgW21vdXNlZG93biwgbW91c2V1cF0gPiBtb3VzZW1vdmVcIixcbiAgICAgICAgLy9vbjogXCJbdG91Y2hkb3duLCB0b3VjaHVwXSA+IHRvdWNobW92ZSwgW21vdXNlZG93biwgbW91c2V1cF0gPiBtb3VzZW1vdmVcIiwgLy97MTAsIDEwMH1cIixcbiAgICAgICAgLy8gICAgICAgIG9uOiBcIlttb3VzZWRvd24sIG1vdXNldXBdID4gbW91c2Vtb3ZlXCIsXG4gICAgICAgIG5lYXJlc3Q6IHRydWUsXG4gICAgICAgIHRvZ2dsZTogZmFsc2UsXG4gICAgICAgIGNsZWFyOiBmYWxzZSxcbiAgICAgICAgLy9lbmNvZGluZ3M6IFtcInhcIiwgXCJ5XCJdXG4gICAgICAgIGZpZWxkczogW1wic3Rhcl9pblwiXVxuICAgICAgfVxuICAgIH1cbiAgXSxcbiAgICAvKlwicGFyYW1zXCI6IFt7XG4gICAgICBcIm5hbWVcIjogXCJicnVzaFwiLFxuICAgICAgIHZhbHVlOiB7IHg6IFtsZWFwX3llYXJfc3RhcnQsIGxlYXBfeWVhcl9zdGFydCs1MF19LCAvLyBpbml0aWFsIHZhbHVlIGhlcmUgZmFpbHMgd2hlbmV2ZXIgSSBzd2l0Y2ggdG8gdGhpcyBtb2RlbCBhZnRlciBsb2FkaW5nIGEgZGlmZmVyZW50IG9uZSAuLi4gdW5kZXJzdGFuZFxuICAgICAgLy9cInZhbHVlXCI6IHtcInllYXJfaW5cIjogWzIwMDAsIDIwMTBdfSxcbiAgICAgIFwic2VsZWN0XCI6IHtcInR5cGVcIjogXCJpbnRlcnZhbFwiLCBcImVuY29kaW5nc1wiOiBbXCJ4XCJdfVxuICAgIH1dLCovXG4gICAgXCJlbmNvZGluZ1wiOiB7XG4gICAgICBcInhcIjoge1xuICAgICAgICBcImZpZWxkXCI6IFwieFwiLFxuICAgICAgICBcInR5cGVcIjogXCJxdWFudGl0YXRpdmVcIixcbiAgICAgICAgc2NhbGU6IHt6ZXJvOmZhbHNlLCBuaWNlOiBmYWxzZSwgZG9tYWluOlstNTAsNTBdfSxcbiAgICAgICAgLy9heGlzOiB7Zm9ybWF0OlwiLjBmXCIsIGdyaWQ6IGZhbHNlLCB0aWNrQ291bnQ6MTIsIHRpY2tzOnRydWUgfVxuICAgICAgfSxcbiAgICAgIFwieVwiOiB7XG4gICAgICAgIFwiZmllbGRcIjogXCJ5XCIsXG4gICAgICAgIFwidHlwZVwiOiBcInF1YW50aXRhdGl2ZVwiLFxuICAgICAgICBzY2FsZToge3plcm86ZmFsc2UsIG5pY2U6IGZhbHNlLCBkb21haW46Wy01MCw1MF19LFxuICAgICAgICAvL1wiYXhpc1wiOiB7IFwiZ3JpZFwiOiBmYWxzZSwgdmFsdWVzOiBbMCwxXSwgZm9ybWF0OiAnLjBmJ31cbiAgICAgIH0sXG4gICAgICBcInNpemVcIjoge1xuICAgICAgICBcImZpZWxkXCI6IFwielwiLFxuICAgICAgICBcInR5cGVcIjogXCJxdWFudGl0YXRpdmVcIixcbiAgICAgICAgc2NhbGU6IHtyZXZlcnNlOnRydWV9LFxuICAgICAgICBsZWdlbmQ6ZmFsc2VcbiAgICAgICAgLy9zY2FsZToge3plcm86ZmFsc2UsIG5pY2U6IGZhbHNlLCBkb21haW46Wy01MCw1MF19LFxuICAgICAgICAvL1wiYXhpc1wiOiB7IFwiZ3JpZFwiOiBmYWxzZSwgdmFsdWVzOiBbMCwxXSwgZm9ybWF0OiAnLjBmJ31cbiAgICAgIH0sXG4gICAgICBjb2xvcjoge3ZhbHVlOid3aGl0ZSd9LCAvL29wYWNpdHk6IHt2YWx1ZToxfVxuICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIG1hcms6ICdydWxlJyxcbiAgICAgIGVuY29kaW5nOiB7XG5cbiAgICAgIFwieFwiOiB7XG4gICAgICAgIFwiZmllbGRcIjogXCJ4XCIsXG4gICAgICAgIFwidHlwZVwiOiBcInF1YW50aXRhdGl2ZVwiLFxuICAgICAgICBzY2FsZToge3plcm86ZmFsc2UsIG5pY2U6IGZhbHNlLCBkb21haW46Wy01MCw1MF19LFxuICAgICAgICAvL2F4aXM6IHtmb3JtYXQ6XCIuMGZcIiwgZ3JpZDogZmFsc2UsIHRpY2tDb3VudDoxMiwgdGlja3M6dHJ1ZSB9XG4gICAgICB9LFxuICAgICAgXCJ5XCI6IHtcbiAgICAgICAgXCJmaWVsZFwiOiBcInlcIixcbiAgICAgICAgXCJ0eXBlXCI6IFwicXVhbnRpdGF0aXZlXCIsXG4gICAgICAgIHNjYWxlOiB7emVybzpmYWxzZSwgbmljZTogZmFsc2UsIGRvbWFpbjpbLTUwLDUwXX0sXG4gICAgICAgIC8vXCJheGlzXCI6IHsgXCJncmlkXCI6IGZhbHNlLCB2YWx1ZXM6IFswLDFdLCBmb3JtYXQ6ICcuMGYnfVxuICAgICAgfSxcbiAgICAgIFwieDJcIjoge1xuICAgICAgICBcImZpZWxkXCI6IFwicHhcIixcbiAgICAgICAgXCJ0eXBlXCI6IFwicXVhbnRpdGF0aXZlXCIsXG4gICAgICAgIHNjYWxlOiB7emVybzpmYWxzZSwgbmljZTogZmFsc2UsIGRvbWFpbjpbLTUwLDUwXX0sXG4gICAgICAgIC8vYXhpczoge2Zvcm1hdDpcIi4wZlwiLCBncmlkOiBmYWxzZSwgdGlja0NvdW50OjEyLCB0aWNrczp0cnVlIH1cbiAgICAgIH0sXG4gICAgICBcInkyXCI6IHtcbiAgICAgICAgXCJmaWVsZFwiOiBcInB5XCIsXG4gICAgICAgIFwidHlwZVwiOiBcInF1YW50aXRhdGl2ZVwiLFxuICAgICAgICBzY2FsZToge3plcm86ZmFsc2UsIG5pY2U6IGZhbHNlLCBkb21haW46Wy01MCw1MF19LFxuICAgICAgICAvL1wiYXhpc1wiOiB7IFwiZ3JpZFwiOiBmYWxzZSwgdmFsdWVzOiBbMCwxXSwgZm9ybWF0OiAnLjBmJ31cbiAgICAgIH0sXG4gICAgICBjb2xvcjoge3ZhbHVlOid3aGl0ZSd9XG5cblxuICAgICAgfVxuICAgIH1dXG59KX1cblxuc3RhcmZpZWxkX2RhdGEgPSBjYWxjdXZlZ2FkYXRhKHtcbiAgbW9kZWxzOiBbc3RhcmZpZWxkXSwvL21vZGVsbmFtZSA9PSAnc3RhcmZpZWxkJyA/IFtzdGFyZmllbGRdIDogW10sXG4gIHNwZWM6IHN0YXJmaWVsZF9zcGVjLFxuICBkb21haW5zOiB7IHN0YXJfaW46IF8ucmFuZ2UoMCwgMTAwKSB9LFxuICBpbnB1dF9jdXJzb3JzOiBbe3NwZWVkX2luLCBmcmFtZV9pbiwgcmFuZG9tX3NlZWRfaW46J2hlbGxvJ31dXG59KVxuXG5cbnZpZXdvZiBzdGFyZmllbGRfdml6ID0gZW1iZWQoc3RhcmZpZWxkX3NwZWMsIHthY3Rpb25zfSlcblxue1xuICBzdGFyZmllbGRfdml6LmRhdGEoXCJkYXRhXCIsIHN0YXJmaWVsZF9kYXRhKS8qLnJlc2l6ZSgpKi8ucnVuKCk7XG59XG5cbntcbiAgc3RhcmZpZWxkX3Zpei5hZGRTaWduYWxMaXN0ZW5lcignc3Rhcl9zZWxlY3QnLCAoXywgYikgPT4ge1xuICAgIHNldCh2aWV3b2Ygc3Rhcl9pbiwgYi5zdGFyX2luWzBdKVxuICAgIC8vY29uc29sZS5sb2coYilcbiAgfSlcbn1cblxuLypcbntcbiAgbGVhcF95ZWFyX3Zpei5zaWduYWwoJ2JydXNoJywgeyB4OiBbMjAwMCwgMTk5MCs1MF19KS5ydW4oKTtcbn0qL1xuXG4vKlxuLy8gbm8gaWRlYSB3aHkgdGhpcyBkb2Vzbid0IHdvcmtcbmh0bC5odG1sYDxidXR0b24gb25jbGljaz0keygpID0+IHtsZWFwX3llYXJfdml6LnNpZ25hbCgnYnJ1c2gnLCB7IHg6IFsyMDAwLCAxOTkwKzUwXX0pLnJ1bigpfSB9PnNpZzwvYnV0dG9uPmBcbmh0bC5odG1sYDxidXR0b24gb25jbGljaz0keygpID0+IHtsZWFwX3llYXJfdml6LnNpZ25hbCgnYnJ1c2gnLCB7IHllYXJfaW46IFsyMDAwLCAxOTkwKzUwXX0pLnJ1bigpfSB9PnNpZzwvYnV0dG9uPmAqL1xuXG5tdXRhYmxlIHN0YXJmaWVsZF9kYXRhMCA9IFtdIC8vIGluY2x1ZGVzIGRhdGEgaW4gc3BlYyBmb3Igd2hlbiBJIE9wZW4gaW4gVmVnYSBFZGl0b3JcblxuaHRsLmh0bWxgPGJ1dHRvbiBvbmNsaWNrPSR7KCkgPT4gKG11dGFibGUgc3RhcmZpZWxkX2RhdGEwID0gc3RhcmZpZWxkX2RhdGEpfT5pbnNlcnQgZGF0YSAtPiB2ZWdhIGVkaXRvciAoZGV2KTwvYnV0dG9uPmBcblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuSW5wdXRzLmJpbmQoSW5wdXRzLnJhbmdlKFstMSw2XSwge3ZhbHVlOjIsIGxhYmVsOidhY3R1YWxfaW50ZXJlc3RfcmF0ZV9jb19pbicsIHN0ZXA6MX0pLCB2aWV3b2YgYWN0dWFsX2ludGVyZXN0X3JhdGVfY29faW4pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG57XG4gIHNhdmluZ3NfYWN0dWFsYXRvcjtcbiAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdyZXNpemUnKSlcbn1cblxuXG5cbnNhdmluZ3NfYWN0dWFsYXRvci5hZGRTaWduYWxMaXN0ZW5lcihcInlcIiwgKF8sIHIpID0+IHsgLy8gdGhpcyBkaWRuJ3QgaW1wcm92ZSBwZXJmIGEgbG90IHZzIGV2ZW50IGxpc3RlbmVyOiBuZWFybHkgZXZlcnkgbW91c2Vtb3ZlIGlzIGEgc2lnbmFsIGNoYW5nZSwgSSBzdXBwb3NlXG4gIC8vaWYgKG9ic2VydmFibGVfd29ybGQgPT0gMCkgcmV0dXJuO1xuICB2aWV3b2YgYWN0dWFsX2ludGVyZXN0X3JhdGVfY29faW4udmFsdWUgPSByLnllYXJfaW5bMF07XG4gIHZpZXdvZiBhY3R1YWxfaW50ZXJlc3RfcmF0ZV9jb19pbi5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5wdXQnKSwge2J1YmJsZXM6dHJ1ZX0pO1xufSkgJiYgMVxuXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbmltcG9ydCB7Y2FsY3VkYXRhLCBjYWxjdXZpenNwZWN9IGZyb20gJ0BkZWNsYW5uL2xpdHRsZS1jYWxjdS1oZWxwZXJzJ1xuXG5cbnNhdmluZ3NfcmVjX2RhdGEgPSBjYWxjdWRhdGEoe1xuICBtb2RlbHM6IFtzYXZpbmdzX3JlY10sXG4gIGlucHV0X2RvbWFpbnM6IHt5ZWFyX2luOl8ucmFuZ2UoMCw2KSwgYWN0dWFsX2ludGVyZXN0X3JhdGVfY29faW46IFthY3R1YWxfaW50ZXJlc3RfcmF0ZV9jb19pbi0xLGFjdHVhbF9pbnRlcmVzdF9yYXRlX2NvX2luXX0sXG4gIGlucHV0X2N1cnNvcnM6IFt7YW5udWFsX3BheW1lbnRfaW46MTAwMH1dLCBcbiAgb3V0cHV0czogWydiYWxhbmNlJywnaW50ZXJlc3QnLCdkZXBvc2l0cycsJ2ludGVyZXN0X3JhdGUnXVxufSlcblxue1xuICBzYXZpbmdzX2FjdHVhbGF0b3IuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQsIGl0ZW0pID0+IHsgY29uc29sZS5sb2coaXRlbSkgfSkgXG4gIC8vIGRpZmZpY3VsdCBmb3IgbGF5ZXJzP1xufVxuXG52aWV3b2Ygc2F2aW5nc19hY3R1YWxhdG9yID0gZW1iZWQoXG4gIHtcbiAgXCJkYXRhXCI6IHtcIm5hbWVcIjogXCJkYXRhXCJ9LFxuICB3aWR0aDogXCJjb250YWluZXJcIixcbiAgaGVpZ2h0OiAzMDAsXG4gIFwidHJhbnNmb3JtXCI6IFtcbiAgICB7XG4gICAgICBcIndpbmRvd1wiOiBbe1wib3BcIjogXCJsYWdcIiwgXCJmaWVsZFwiOiBcInZhbHVlXCIsIFwiYXNcIjogXCJBX3ZhbHVlXCJ9XSxcbiAgICAgIFwiZ3JvdXBieVwiOiBbXCJmb3JtdWxhXCIsXCJ5ZWFyX2luXCJdLFxuICAgICAgXCJzb3J0XCI6IFt7XCJmaWVsZFwiOiBcImFjdHVhbF9pbnRlcmVzdF9yYXRlX2NvX2luXCJ9XSxcbiAgICAgIFwiZnJhbWVcIjogWy0xLCAwXVxuICAgIH0sXG4gICAge1wiY2FsY3VsYXRlXCI6IFwiZGF0dW0udmFsdWUtZGF0dW0uQV92YWx1ZVwiLCBcImFzXCI6IFwiaW1wYWN0XCJ9LFxuICBdLFxuICBcImVuY29kaW5nXCI6IHtcbiAgICBcInlcIjoge1wiZmllbGRcIjogXCJ5ZWFyX2luXCIsIFwidHlwZVwiOiBcIm5vbWluYWxcIiwgXCJzb3J0XCI6IFwiYXNjZW5kaW5nXCJ9LFxuICAgIFwiY29sb3JcIjoge1wiZmllbGRcIjogXCJmb3JtdWxhXCIsIFwidHlwZVwiOiBcIm5vbWluYWxcIn0sXG4gICAgXCJ4XCI6IHtcbiAgICAgIFwiZmllbGRcIjogXCJmb3JtdWxhXCIsXG4gICAgICBcInR5cGVcIjogXCJub21pbmFsXCIsXG4gICAgICBcImF4aXNcIjoge1wibGFiZWxBbmdsZVwiOiAwLCBcIm9yaWVudFwiOiBcInRvcFwiLCBcImxhYmVsTGltaXRcIjogOTB9XG4gICAgfVxuICB9LFxuICBsYXllcjogW3tcbiAgICAgICAgICAgIFwicGFyYW1zXCI6IFt7XCJuYW1lXCI6IFwieVwiLCBcInNlbGVjdFwiOiB7IFwidHlwZVwiOiBcInBvaW50XCIsIFwib25cIjogXCJtb3VzZW92ZXJcIiwgXCJuZWFyZXN0XCI6IHRydWUsIFwiZW5jb2RpbmdzXCI6IFtcInlcIl0sIFwidG9nZ2xlXCI6ZmFsc2V9fSxcbiAgICAgICAgICAgICAgICAgLy8gcGFyYW1zIGZvciBsYXllcnMgbm90IHdvcmtpbmcgZ29vZCAhe1wibmFtZVwiOiBcImZvcm11bGFcIiwgXCJzZWxlY3RcIjogeyBcInR5cGVcIjogXCJwb2ludFwiLCBcIm9uXCI6IFwibW91c2V1cCwgdG91Y2h1cCwgW21vdXNlZG93biwgbW91c2V1cF0gPiBtb3VzZW1vdmVcIiwgXCJuZWFyZXN0XCI6IHRydWUsIFwiZW5jb2RpbmdzXCI6IFtcInhcIiwgXCJ5XCJdfX1cbiAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAsXG4gIFwibWFya1wiOiB7XG4gICAgXCJ0eXBlXCI6IFwidGV4dFwiLFxuICAgIFwiZm9udFNpemVcIjogMTUsXG4gICAgXCJmb250V2VpZ2h0XCI6IFwiYm9sZFwiLFxuICAgIFwidG9vbHRpcFwiOiBmYWxzZVxuICB9LFxuICAgICAgICBcInRyYW5zZm9ybVwiOiBbe1wiZmlsdGVyXCI6IGBkYXR1bS5hY3R1YWxfaW50ZXJlc3RfcmF0ZV9jb19pbiAhPSAke2FjdHVhbF9pbnRlcmVzdF9yYXRlX2NvX2luLTF9YH0sXG4gICAgICAgIC8ve1wiY2FsY3VsYXRlXCI6IFwiZGF0dW0ueWVhcl9pbiA+IGRhdHVtLmFjdHVhbF9pbnRlcmVzdF9yYXRlX2NvX2luXCIsIFwiYXNcIjogXCJmdXRcIn1cbiAgICAgICAgXSxcblxuICBlbmNvZGluZzoge1xuICAgIFwib3BhY2l0eVwiOiAgICAgICAgICAgICB7XCJjb25kaXRpb25cIjoge1widGVzdFwiOiBcImRhdHVtLnllYXJfaW4gPiBkYXR1bS5hY3R1YWxfaW50ZXJlc3RfcmF0ZV9jb19pblwiLCBcInZhbHVlXCI6IDAuNX0sIFwidmFsdWVcIjogMX0sXG4vLyB7XCJmaWVsZFwiOiBcImZ1dFwiLCBcInR5cGVcIjogXCJub21pbmFsXCIsIFwic29ydFwiOiBcImRlc2NlbmRpbmdcIn0sXG4gICAgICAgIFwidGV4dFwiOiB7XG4gICAgICBcImZpZWxkXCI6IFwidmFsdWVcIixcbiAgICAgIFwidHlwZVwiOiBcInF1YW50aXRhdGl2ZVwiLFxuICAgICAgXCJmb3JtYXRcIjogXCIsLjJmXCIsIC8vIEkgY2FuJ3QgZG8gYSBjb25kaXRpb25hbCBmb3JtYXQgaGVyZSB5ZXRcbiAgICAgIFwiYXhpc1wiOiB7XCJmb3JtYXRcIjogXCIsLjJmXCJ9XG4gICAgfSxcblxuICB9XG4gIH0se1xuICBcIm1hcmtcIjoge1xuICAgIFwidHlwZVwiOiBcInRleHRcIiwgZHg6MjAsIGR5OiAtMTAsXG4gICAgXCJmb250U2l6ZVwiOiAxMixcbiAgICBcImZvbnRXZWlnaHRcIjogXCJib2xkXCIsLy9cbiAgICBcInRvb2x0aXBcIjogZmFsc2VcbiAgfSxcbiAgICAgICAgXCJ0cmFuc2Zvcm1cIjogW3tcImZpbHRlclwiOiBgYWJzKGRhdHVtLmltcGFjdCkgPj0gMC4wMDAwMSAmJiBkYXR1bS5hY3R1YWxfaW50ZXJlc3RfcmF0ZV9jb19pbiAhPSAke2FjdHVhbF9pbnRlcmVzdF9yYXRlX2NvX2luLTF9YH1dLFxuXG4gIGVuY29kaW5nOiB7XG4gICAgICAgICAgICBcImNvbG9yXCI6IHtcInZhbHVlXCI6IFwiZ3JlZW5cIiwgXCJjb25kaXRpb25cIjoge1widGVzdFwiOiBcImRhdHVtLmltcGFjdCA8IDBcIiwgXCJ2YWx1ZVwiOiBcInJlZFwifX0sXG4gICAgICAgICAgICAgICAgXCJvcGFjaXR5XCI6ICAgICAgICAgICAgIHtcImNvbmRpdGlvblwiOiB7XCJ0ZXN0XCI6IFwiZGF0dW0ueWVhcl9pbiA+IGRhdHVtLmFjdHVhbF9pbnRlcmVzdF9yYXRlX2NvX2luXCIsIFwidmFsdWVcIjogMC41fSwgXCJ2YWx1ZVwiOiAxfSxcblxuICAgICAgICBcInRleHRcIjoge1xuICAgICAgXCJmaWVsZFwiOiBcImltcGFjdFwiLFxuICAgICAgXCJ0eXBlXCI6IFwicXVhbnRpdGF0aXZlXCIsXG4gICAgICBcImZvcm1hdFwiOiBcIiwuMmZcIixcbiAgICAgIFwiYXhpc1wiOiB7XCJmb3JtYXRcIjogXCIsLjJmXCJ9XG4gICAgfSxcblxuICB9XG4gIH1dLFxuICBcImNvbmZpZ1wiOiB7XCJsZWdlbmRcIjoge1wiZGlzYWJsZVwiOiB0cnVlfX0sXG4gIFwiZGF0YXNldHNcIjogeyBkYXRhOiBzYXZpbmdzX3JlY19kYXRhXG4gIH0sXG59KVxuXG5cblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuZW1iZWQoXG4gIGNhbGN1dml6c3BlYyh7XG4gICAgbW9kZWxzOiBbZml6emJ1enpdLFxuICAgIGlucHV0X2N1cnNvcnM6IFt7fV0sXG4gICAgbWFyazoge3R5cGU6ICd0ZXh0JywgZm9udFNpemU6MTUsIGZvbnRXZWlnaHQ6ICdib2xkJ30sXG4gICAgZW5jb2RpbmdzOiB7XG4gICAgICB4OiB7bmFtZTogJ2Zvcm11bGEnLCB0eXBlOidub21pbmFsJywgZG9tYWluOiBbJ2ZpenonLCdidXp6JywnZml6emJ1enonXSwgYXhpczoge2xhYmVsRm9udFNpemU6IDYwfSwgc29ydDogWydmaXp6YnV6eiddfSxcbiAgICAgIHk6IHtuYW1lOiAnaV9pbicsIHR5cGU6J25vbWluYWwnLCBkb21haW46IF8ucmFuZ2UoaV9pbiwgaV9pbisyMCksIGdyaWQ6IHRydWV9LFxuICAgICAgdGV4dDoge25hbWU6ICd2YWx1ZScsIHR5cGU6ICdub21pbmFsJ30sXG4gICAgICBjb2xvcjoge25hbWU6ICd2YWx1ZScsIHR5cGU6ICdub21pbmFsJywgbGVnZW5kOmZhbHNlfSxcbiAgICB9LFxuICAgIHdpZHRoOiAyNTB9KSlcblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuSW5wdXRzLmJpbmQoSW5wdXRzLnNlbGVjdChbXCJzdGFydCBvZiB0b2RheVwiLCBcInN0YXJ0IG9mIHRvbW9ycm93XCJdLCB7bGFiZWw6J2Zyb20nfSksIHZpZXdvZiB0aW1pbmdfaW4pXG5cbm1kYCoqJHsoZDMuZm9ybWF0KCcuMiUnKSh5ZWFyX3JlbWFpbmluZy5mcmFjdGlvbkxlZnRJblllYXIoe2RhdGVfaW46IG5ldyBEYXRlKCksIHRpbWluZ19pbn0pKSl9Kiogb2YgeWVhciByZWFtaW5pbmcsIG9yIHZpc3VhbGx5OmBcblxuUGxvdC5wbG90KHtcbiAgLy9tYXJnaW5MZWZ0OiA5MCxcbiAgaGVpZ2h0OjgwLFxuICAvL3dpZHRoOjUwMDAsXG4gIGNvbG9yOiB7IGxlZ2VuZDogdHJ1ZSB9LFxuICBtYXJrczogWyAgICBQbG90LmF4aXNYKHthbmNob3I6IFwidG9wXCJ9KSxcbixQbG90LmJhclgoXG4gICAgW3tzb3J0OiAxLCBzdGF0dXM6J3JlbWFpbmluZycscGVyY2VudDoxMDAqeWVhcl9yZW1haW5pbmcuZnJhY3Rpb25MZWZ0SW5ZZWFyKHtkYXRlX2luOiBuZXcgRGF0ZSgpLCB0aW1pbmdfaW59KX0sXG4gICAge3NvcnQ6IDAsIHN0YXR1czonY29tcGxldGUnLHBlcmNlbnQ6MTAwKnllYXJfcmVtYWluaW5nLmZyYWN0aW9uSW50b1llYXIoe2RhdGVfaW46IG5ldyBEYXRlKCksIHRpbWluZ19pbn0pXG59XVxuLHsgeDogXCJwZXJjZW50XCIsIGZpbGw6IFwic3RhdHVzXCIsIHNvcnQ6J3NvcnQnIH0pXVxufSlcblxuLy8ganVzdCB0byBnZXQgc29tZSB3aWR0aCAhXG4vL0lucHV0cy5yYW5nZShbMCwxXSwge2Rpc2FibGVkOnRydWV9KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuaHRtbGBcbjxzdHlsZT5cblxuLnZlZ2EtZW1iZWQge1xuICB3aWR0aDogMTAwJTtcbiAgaGVpZ2h0OiAxMDAlO1xufVxuICBcbiAgLmFuc3dlciB7XG4gICAgY29sb3I6IHJlZCAhaW1wb3J0YW50O1xuICAgIGZvbnQtd2VpZ2h0OiBib2xkO1xuICAgIGZvbnQtc2l6ZTogMS41ZW0gIWltcG9ydGFudDtcbiAgICBsZWZ0OiAxMDBweCAhaW1wb3J0YW50O1xufVxuICAuYW5zd2VyIC50b29sdGlwdGV4dCAge1xuICAgIGJvcmRlcjogMnB4IGRhc2hlZCBibGFjaztcbiAgXG4gIH1cblxuICAuYW5zd2VyIC50b29sdGlwdGV4dDo6YWZ0ZXIge1xuICAgIGNvbG9yOiByZWQ7XG4gICAgYm9yZGVyOiBub25lO1xuICB9XG4gIFxuLmFuc3dlcjpob3ZlciB7XG4gIC8qZm9udC1zaXplOjJlbSAhaW1wb3J0YW50OyovXG59XG4gIFxuICBib2R5IHtcbiAgZm9udC1mYW1pbHk6IHN5c3RlbS11aTtcbn1cblxucHJlIHtcbiAgbGluZS1oZWlnaHQ6IDI1cHg7XG59XG5cbi5jYWxjdWxhbmdfdG9vbHRpcCB7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcblxufVxuXG4udG9vbHRpcHRleHQge1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIGJvdHRvbTogY2FsYygxMDAlIC0gMTBweCk7XG4gIGxlZnQ6IGFuY2hvcihjZW50ZXIpO1xuICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7XG4gIHdpZHRoOiBtYXgtY29udGVudDtcbn1cblxuLnRvb2x0aXB0ZXh0IHtcbiAgY3Vyc29yOiB6b29tLWluO1xufVxuXG5cbi5jYWxjdWxhbmdfdG9vbHRpcC5hbnN3ZXIgLnRvb2x0aXB0ZXh0IHtcbiAgYm90dG9tOiAwO1xufSBcblxuY2FsY3VsYW5nX3Rvb2x0aXAuYW5zd2VyIHtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiBsaWdodG9yYW5nZTtcbn1cblxuXG5wcmUge1xuICBjdXJzb3I6ZGVmYXVsdFxufVxuICA8L3N0eWxlPlxuYFxuXG52aWV3b2YgY29sb3IgPSBJbnB1dHMudGV4dCh7IGxhYmVsOiBcImNvbG9yXCIsIHZhbHVlOiBcIiMwRDBcIiB9KVxuXG5pbXBvcnQge1RhbmdsZX0gZnJvbSBcIkBkZWNsYW5uL2NvbG9yZWQtdGFuZ2xlXCIgLy8gdG9kbyB1c2UgaHR0cHM6Ly9qc2ZpZGRsZS5uZXQvYXBpL3Bvc3QvbGlicmFyeS9wdXJlLyA/XG4vLyBodHRwczovL3d3dy5yZWRibG9iZ2FtZXMuY29tL21ha2luZy1vZi9kcmFnZ2FibGUvZXhhbXBsZXMuaHRtbFxuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3BsYXllcl94X2luJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3BsYXllcl95X2luJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3JheV9hbmdsZV9pbicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzdGVwX2luJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3hfaW4nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgneV9pbicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdmX2luJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2tleV9zdHJlYW1fdmVyc2lvbl9pbicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdrZXlzX3N0cmVhbV92ZXJzaW9uX2luJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2FubnVhbF9wYXltZW50X2luJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2R1cmF0aW9uX2luJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2ludGVyZXN0X3JhdGVfaW4nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgneWVhcl9pbicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdpX2luJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2RhdGVfaW4nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgndGltaW5nX2luJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3N0YXJfaW4nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc3BlZWRfaW4nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnZnJhbWVfaW4nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncmFuZG9tX3NlZWRfaW4nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnYWN0dWFsX2ludGVyZXN0X3JhdGVfY29faW4nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgneCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdjdWxfc2NvcGVfaWQnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnZWRpdG9yJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ29wdGlvbnMnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnb3ZlcmxheScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdjdWxfanMnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnY2FsY3VsYW5nX3NvdXJjZV9ub21lbW8nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnb3B0JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3JlYWRvbmx5JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2Zvcm11bGFlX3Zpc2libGUnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnZm10X2ZtdCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdhY3Rpb25zJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2tleXNfc3RyZWFtJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NjZW5lJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3JlZnJlc2gnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnZ3VpZGVzJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ21vZGVsX3gnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2NlbmVfc2l6ZScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzaG93X3JheV9zdGVwcycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdvcGFjaXR5X3ZlcnRpY2FsJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2xldmVsJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NhdmluZ3Nfdml6JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3N0YXJmaWVsZF92aXonKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2F2aW5nc19hY3R1YWxhdG9yJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2NvbG9yJykifV19
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p><a type="button" data-cc="c-settings" class="cc-link">Cookies/analytics preferences</a></p>
<div class="toc-actions"><ul><li><a href="https://github.com/declann/calculang-at-fosdem/edit/main/example.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/declann/calculang-at-fosdem/blob/main/example.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/declann/calculang-at-fosdem/issues" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Made with 💓 and <a href="https://calculang.dev">calculang</a></p>
</div>
  </div>
</footer>

<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (_event) {
  if (window.bslib.Card) {
    window.bslib.Card.initializeAllCards();
  }
}); 
</script>
  



</body></html>